;/*!/comp/design/design_config.js*/
define("comp/design/design_config", [], {
    DESIGN_BLANK: {
        left: 50,
        right: 50,
        top: 50,
        bottom: 50
    },
    BLEED_SIZE: parseFloat(23.622048).toFixed(8),
    MAX_PAGE_NUM: 30,
    MATERIAL_PAGE_SIZE: 10,
    ANXID: "texteventtarget",
    ANXIDCOPY: "texteventtarget-clone",
    FONTLOCALHOST: "/fonts/fontWoff/",
    PAGE_EDITBAR_CHANGE_HEIGHT: "250",
    PAGE_EDITBAR_CHANGE_MARGIN: "330",
    FONT_FAMILY_DEFAULT: "Microsoft YaHei",
    FONTFAMILY: {
        "Abril Fatface": "Abril Fatface.woff",
        "Alegreya SC": "Alegreya SC.woff",
        Allura: "Allura.woff",
        "Aria Slab": "Aria Slab.woff",
        "Arial Rounded MT Bold": "Arial Rounded MT Bold.woff",
        Arvo: "Arvo.woff",
        "Black Ops One": "Black Ops One.woff",
        "BradleyHandITCTT-Bold": "Bradleyhand-Bold.woff",
        "BradleyhandITCTT-Bold": "Bradleyhand-Bold.woff",
        "Broadway BT": "Broadway BT.woff",
        "BroadwayBT-Regular": "Broadway BT.woff",
        CabinSketch: "CabinSketch.woff",
        "Cinzel-Bold": "Cinzel-Bold.woff",
        "Comic Sans MS": "Comic Sans MS.woff",
        ComicSansMS: "Comic Sans MS.woff",
        DroidSerif: "Droidserif-Regular.woff",
        Elegante: "Elegante.woff",
        GingerPeachy: "GingerPeachy.woff",
        GlaserSteD: "Glasersted-Regular.woff",
        Graduate: "Graduate.woff",
        "IM FELL Double Pica": "IM FELL Double Pica.woff",
        "Myanmar Sangam MN": "Myanmar Sangam MN.woff",
        Unica: "Unica.woff",
        "微软雅黑": "weiruanyahei.woff",
        "方正彩云简体": "fzcaiyunjianti.woff",
        "方正超粗黑简体": "fzchaocuheijianti.woff",
        "方正大黑简体": "fzdaheijianti.woff",
        "方正行楷简体": "fzxingkaijianti.woff",
        "方正剪纸简体": "fzjianzhijianti.woff",
        "方正楷体简体": "fzkaitijianti.woff",
        "方正隶书简体": "fzlishujianti.woff",
        "方正美黑简体": "fzmeiheijianti.woff",
        "方正书宋简体": "fzshusongjianti.woff",
        "方正舒体简体": "fzshutijianti.woff",
        "方正宋黑简体": "fzsongheijianti.woff",
        "方正宋一简体": "fzsongyijianti.woff",
        "方正魏碑简体": "fzweibeijianti.woff",
        "方正细等线简体": "fzxidengxianjianti.woff",
        "方正细黑一简体": "fzxiheijianti.woff",
        "方正细圆简体": "fzxiyuanjianti.woff",
        "方正小标宋简体": "fzxiaobiaosongjianti.woff",
        "方正姚体简体": "fzyaotijianti.woff",
        "方正中等线简体": "fzzhongdengxianjianti.woff",
        "方正综艺简体": "fzzongyijianti.woff",
        "大侦探": "dazhentan.woff",
        "喵想细黑朱古力体": "mxxhzglt.woff",
        "奇思_奔跑吧电影": "qsbpbdy.woff",
        "奇思黑体恐怖医院体": "qshtkbyyt.woff",
        "奇思黑体小丑体": "qshtxct.woff",
        "奇思源黑": "qsyh.woff",
        "字体管家仿宋": "ztgjfangsong.woff",
        "字体管家楷体": "ztgjkaiti.woff",
        "字体管家黑体": "ztgjheiti.woff",
        "字体管家细圆": "ztgjxihei.woff",
        "站酷高端黑": "zkgdh.woff",
        "站酷快乐体": "zkklt.woff",
        "AmaticSC-Regular": "Amaticsc-Regular.woff",
        Amaranth: "Amaranth-Regular.woff",
        Anton: "Anton-Regular.woff",
        ArialNarrow: "Arialnarrow-Regular.woff",
        ArialMT: "Arial-Regular.woff",
        BanglaSangamMN: "Banglasangammn-Regular.woff",
        Calibri: "Calibri-Regular.woff",
        "DINcondensed-Bold": "Dincondensed-Bold.woff",
        "Economica-Regular": "Economica-Regular.woff",
        EngraversMT: "Engraversmt-Regular.woff",
        Gruppo: "Gruppo-Regular.woff",
        Helvetica: "Helvetica-Regular.woff",
        "JosefinSans-Bold": "Josefinsans-Bold.woff",
        "JuliusSansOne-Regular": "Juliussansone-Regular.woff",
        "Lowanoldstyle-Black": "Lowanoldstyle-Black.woff",
        OratorStd: "Oratorstd-Medium.woff",
        "Quicksand-Regular": "Quicksand-Regular.woff",
        Didot: "Didot.woff",
        "Bickham Script Pro": "BickhamScriptPro-Regular.woff",
        Bauhaus: "Bauhaus.woff",
        "Antenna-Light": "Antenna-Light.woff",
        "方正剪纸简体": "fzjz.woff",
        "方正细圆简体": "fzxy.woff",
        "方正综艺简体": "fzzy.woff",
        "汉真广标": "hzgb.woff",
        "迷你简长艺": "changyi.woff",
        "迷你简超粗黑": "chaocuhei.woff",
        "迷你简粗宋": "cusong.woff",
        "迷你简大黑": "dahei.woff",
        "迷你简方叠体": "fangdieti.woff",
        "迷你简黑体": "heiti.woff",
        "迷你简家书": "jiashu.woff",
        "迷你简菱心": "lingxin.woff",
        "迷你简美黑": "meihei.woff",
        "迷你简平黑": "pinghei.woff",
        "迷你简特细等线": "txdx.woff",
        "迷你简细等线": "xidengxian.woff",
        "迷你简细行楷": "xixingkai.woff",
        "迷你简细黑": "xihei.woff",
        "迷你简细倩": "xiqian.woff",
        "迷你简细圆": "xiyuan.woff",
        "迷你简小标宋": "xiaobiaosong.woff",
        "迷你简小隶书": "xiaolishu.woff",
        "迷你简新舒体": "xinshuti.woff",
        "迷你简丫丫": "yaya.woff",
        "迷你简姚体": "yaoti.woff",
        "迷你简艺黑": "yihei.woff",
        "迷你简硬笔行书": "ybxs.woff",
        "迷你简幼线": "youxian.woff",
        "迷你简稚艺": "zhiyi.woff",
        "迷你简中倩": "zhongqian.woff",
        "迷你简准圆": "zhunyuan.woff",
        "迷你简综艺": "zongyi.woff",
        "时尚中黑简体": "sszh.woff",
        "宋体": "songti.woff",
        "造字工房映力黑规体": "zzgfylhg.woff",
        "新蒂黑板报体": "xdhbb.woff",
        "迷你简中等线": "mnjzdx.woff",
        "迷你简楷体": "mnjkt.woff",
        "迷你简北魏楷书": "mnjbwks.woff",
        "李旭科书法": "lxksf.woff"
    }
});
;/*!/comp/design/toolbar/toolbar_config.js*/
define("comp/design/toolbar/toolbar_config", ["comp/b", "components/jquery/jquery", "libs/requirejs/plugins/text!/comp/design/toolbar/toolbar_config.htm", "comp/design/design_config"], function(e, t, r) {
    var n = t(r).filter(function() {
        return 1 === this.nodeType
    });
    return {
        getGoToPrint: function() {
            var e = n.filter(".go-to-print");
            return e
        },
        getDesignEditbar: function() {
            var e = n.filter(".design-bar");
            return 1 == KIND_ID || 39 == KIND_ID ? e.find(".ppt-show").css("display", "block") : e.find(".ppt-show").css("display", "none"),
            [e[0], e[1], e[2]]
        },
        getElementEditbar: function() {
            var e = n.filter(".element-edit-bar");
            return e
        },
        getPageEditbar: function() {
            var e = n.filter(".page-edit-bar").clone();
            return "true" == window.localStorage.preview_new && e.find(".page_preview").removeClass("new-function"),
            e.find(".page-copy").find(".page-edit-bar-text").html("复制页面</ br>最多" + MAX_PAGE + "页"),
            e.find(".page-add").find(".page-edit-bar-text").html("添加新页</ br>最多" + MAX_PAGE + "页"),
            e[0]
        },
        getPagePreview: function() {
            if (6 == KIND_ID) {
                var e = n.filter(".preview_accross_bar").clone()[0];
                return e
            }
            if (4 == KIND_ID) {
                var e = n.filter(".preview-wechat-moments-container").clone()[0];
                return e
            }
            if (20 == KIND_ID) {
                var e = n.filter(".preview_max_bar").clone()[0];
                return e
            }
        },
        getMultiElementBar: function() {
            var e = n.filter(".multi-element-bar");
            return e
        },
        getFontSizeSet: function() {
            var e = n.filter(".fontSizeSet");
            return e
        },
        getFontSize: function(e) {
            var r, i = n.filter("#text-size-bar"), a = i.children("ul");
            if (a.children().size() < 1)
                for (var o = e; 2048 >= o; o++)
                    r = '<li class="text-size-son">' + o + "</li>",
                    t(r).appendTo(a);
            return i
        },
        getFontFamily: function() {
            var e = n.filter("#text-family-bar")
              , r = e.find("#text-family-list");
            0 != window.font_family.font_family_list.length && r.children().detach();
            for (var i, a, o, l, f = window.font_family.font_family_list, u = 0; u < f.length; u++) {
                a = '<li class="text-family-group"><span class="text-family-group-text small_font">' + f[u].kindName + "</span></li>",
                r.append(a),
                o = f[u].fonts;
                for (var c = 0; c < o.length; c++)
                    if (!o[c].fontIsExpired) {
                        if (o[c].fontNeedsVip) {
                            if (window.api || window.ziyun)
                                continue;
                            l = '<span class="text-family-vip"></span>'
                        } else
                            l = "";
                        i = '<li class="text-family-son"><div data-index="' + o[c].fontImgIndex + '" data-alt="' + o[c].fontFamily + '" style="background-position:0px -' + 17 * o[c].fontImgIndex + 'px"></div>' + l + "</li>",
                        r.append(i)
                    }
            }
            var s = window.font_family.font_family_img_url;
            return t(".text-family-son div").css("background-image", "url(" + s + ")"),
            window.font_family.font_family_list = [],
            e
        },
        getFontAlign: function() {
            var e = n.filter("#text-align-bar");
            return e
        },
        getEleReverse: function() {
            var e = n.filter("#ele-turn-bar");
            return e
        },
        getEleMove: function() {
            var e = n.filter("#ele-move-bar");
            return e
        },
        getEleGroupAlign: function() {
            var e = n.filter("#group-align-bar");
            return e
        },
        getEleGroupDistributed: function() {
            var e = n.filter("#group-distributed-bar");
            return e
        },
        getOpacityWrap: function() {
            var e = n.filter("#opacity-wrap");
            return e
        },
        getShadowWrap: function() {
            var e = n.filter("#box-shadow-wrap");
            return e
        },
        getBoldWrap: function() {
            var e = n.filter("#bold-wrap");
            return e
        },
        getTextSpaceWrap: function() {
            var e = n.filter("#text-spacing-wrap");
            return e
        },
        getColorWrap: function() {
            var e = n.filter(".colorWrap");
            return e
        },
        getEditDiv: function() {
            var e = n.filter("#edit-div");
            return e
        },
        getEditColor: function() {
            var e = n.filter("#edit-color");
            return e
        },
        getDownload: function() {
            var e = n.filter("#download");
            return (1 == KIND_ID || 39 == KIND_ID) && e.find(".download-ppt").css("display", "block"),
            e
        },
        getDownloadPhone: function() {
            var e = n.filter("#download_phone");
            return e
        },
        getUploadPhone: function() {
            var e = n.filter("#upload_phone");
            return e
        },
        getActive: function() {
            var e = n.filter(".active");
            return e
        },
        getActiveWeixinShare: function() {
            var e = n.filter(".active-weixin-share");
            return e
        },
        getShare: function() {
            var e = n.filter(".public_share_box");
            return e
        },
        getShareTitle: function() {
            var e = n.filter(".share");
            return e
        },
        getSharebox: function() {
            var e = n.filter(".share_box");
            return e
        },
        getThumbWait: function() {
            var e = n.filter("#thumb-wait");
            return e
        },
        getDownloadWait: function() {
            var e = n.filter("#download-wait");
            return e
        },
        getShareYes: function() {
            var e = n.filter("#share-yes");
            return e
        },
        getConfirm: function() {
            var e = n.filter(".confirm-container");
            return e
        },
        getFilter: function() {
            var e = n.filter(".filter-wrap");
            return e.appendTo(t("#leftToolbarWrap")),
            e
        },
        getTextMenuMore: function() {
            var e = n.filter("#edit-menu-more");
            return e.children().css("display", "block"),
            e
        },
        getMenuMore: function() {
            var e = n.filter("#edit-menu-more");
            return e.children().css("display", "block"),
            e.find(".text-menu-more").css("display", "none"),
            e
        },
        getElementGroup: function() {
            var e = n.filter(".elementGroup").clone();
            return e
        },
        getPreviewAccross: function() {
            var e = n.filter(".preview_accross_bar");
            return e
        },
        getPreviewMax: function() {
            var e = n.filter(".preview_max_bar");
            return e
        },
        getCanvasSize: function() {
            var e = n.filter(".canvas-adjustment");
            return e
        },
        getChangesence: function() {
            var e = n.filter(".sence-change");
            return e
        },
        getChangeVipsence: function() {
            var e = n.filter(".sence-change-vip");
            return e
        },
        getChangeTips: function() {
            var e = n.filter(".sence_tips_success");
            return e
        },
        getMydesign: function() {
            var e = n.filter("#myDesign_content");
            return e
        },
        getMyDesignPage: function() {
            var e = n.filter(".myDesign-content-page");
            return e
        },
        getTemplateModal: function() {
            var e = n.filter("#bigTpl");
            return e
        }
    }
});
;/*!/comp/design/Chuangkit.js*/
"use strict";
define("comp/design/Chuangkit", ["comp/config/global_config", "components/jquery/jquery", "comp/b", "libs/jquery/jquery.mousewheel", "libs/webuploader/webuploader", "libs/jquery/minicolors/jquery.minicolors", "libs/handsontable/handsontable.full.min", "comp/design/design_config", "libs/jquery/jquery.transit.min", "widget/logreg/logreg", "widget/pop/pop", "comp/design/toolbar/toolbar_config", "widget/vipExclusive/vipExclusive", "libs/crypto-js", "libs/colorpicker/colorpicker"], function(e, a, t, i, o, n, r, l, s, d, c, p, f, u, h) {
    function g() {
        this.startUpload = function() {
            if (this.index++,
            this.index < this.fileLength) {
                var e = this.fileList[this.index];
                this.width = e.w,
                this.height = e.h,
                this.uploadImgId = e.uploadImgId,
                this.$img = a("#" + e.uploadImgId),
                this.constructor(e.imgurl),
                this.computeMD5()
            }
        }
        ,
        this.constructor = function(e) {
            this.dataBin = window.atob(e.split(",")[1]),
            this.buffer = new Uint8Array(this.dataBin.length);
            for (var a = 0; a < this.dataBin.length; a++)
                this.buffer[a] = this.dataBin.charCodeAt(a);
            console.log(this.fileType),
            this.blob = new Blob([this.buffer.buffer],{
                type: this.fileType
            })
        }
        ,
        this.computeMD5 = function() {
            var e = this
              , a = u.algo.MD5.create()
              , t = new FileReader;
            t.readAsBinaryString(this.blob),
            t.onload = function(t) {
                a.update(u.enc.Latin1.parse(t.target.result));
                var i = a.finalize()
                  , o = {
                    md5: i,
                    blob: e.blob
                };
                e.preUpload(o)
            }
        }
        ,
        this.preUpload = function(e) {
            var t = new FormData
              , i = this;
            t.append("md5", e.md5),
            t.append("file", e.blob.slice(0, 10));
            var o = a(".folder_wrap").find(".folderClick").attr("data-id");
            t.append("fid", o),
            2 == a("#folderKindWrap").attr("data-drag") && t.append("tid", window.TEAM_ID),
            a.ajax({
                url: "/material/preUploadMaterial.do",
                dataType: "json",
                type: "POST",
                data: t,
                processData: !1,
                contentType: !1,
                success: function(a) {
                    var t = a.uploadPms;
                    switch (a.code) {
                    case 1:
                        i.progress(100),
                        i.uploadComplete(a),
                        i.callback(a);
                        break;
                    case 0:
                        var o = t.accessid
                          , n = t.policy
                          , r = t.signature
                          , l = t.fileKey
                          , s = t.host
                          , d = t.md5;
                        i.uploading(o, n, r, l, s, d, e.blob),
                        window.upload = !0;
                        break;
                    default:
                        c.back({
                            str: "图片解析失败！",
                            kind: "warning"
                        }),
                        i.uploadFailed()
                    }
                },
                error: function() {
                    c.back({
                        str: "图片上传失败！",
                        kind: "error"
                    }),
                    i.this.uploadFailed()
                }
            })
        }
        ,
        this.uploading = function(e, t, i, o, n, r, l) {
            var s = new FormData
              , d = this;
            s.append("OSSAccessKeyId", e),
            s.append("policy", t),
            s.append("Signature", i),
            s.append("key", o),
            s.append("Content-MD5", r),
            s.append("file", l);
            a.ajax({
                url: "//" + n,
                dataType: "json",
                type: "POST",
                xhr: function() {
                    var e = a.ajaxSettings.xhr();
                    return e.upload.addEventListener("progress", function(e) {
                        var a = parseInt(e.loaded / e.total * 100);
                        d.progress(a)
                    }, !1),
                    e
                },
                data: s,
                processData: !1,
                contentType: !1,
                success: function() {
                    d.reportUpload(t, i)
                },
                error: function() {
                    console.log("图片上传,error"),
                    d.uploadFailed()
                }
            })
        }
        ,
        this.progress = function(e) {
            this.$img.find(".waiting-text").hide(),
            this.$img.find(".progress-text").show().find(".progress-num").text(e),
            this.$img.find(".progress-color").height(e + "%")
        }
        ,
        this.reportUpload = function(e, t) {
            var i = {
                p: e,
                s: t,
                w: this.width,
                h: this.height,
                fid: 0
            }
              , o = this
              , n = a(".folder_wrap").find(".folderClick").attr("data-id");
            i.fid = n ? n : 0,
            2 == a("#folderKindWrap").attr("data-drag") && (i.tid = window.TEAM_ID),
            a.ajax({
                url: "/material/reportUploadMaterial.do",
                dataType: "json",
                type: "POST",
                data: i,
                success: function(e) {
                    o.uploadComplete(e),
                    o.callback(e)
                },
                error: function() {
                    console.log("上报个人/团队素材的上传结果,error"),
                    o.uploadFailed()
                }
            })
        }
        ,
        this.uploadComplete = function(e) {
            var t = this;
            window.personalMaterialData.page.recordData[t.index].ik = e.ik,
            window.personalMaterialData.page.recordData[t.index].mid = e.mid,
            window.personalMaterialData.page.recordData[t.index].dt = e.dt,
            window.personalMaterialData.page.recordData[t.index].uploadImgId = 0,
            t.$img.find("img").attr("data-id", e.mid),
            t.$img.attr({
                "data-id": e.mid,
                "data-type": e.dt
            }).find(".progress-text").html("上传成功");
            var i = t.$img.removeClass("img_uploading").find(".progress-color, .waiting-color, .progress-text, .waiting-text")
              , o = parseInt(a(".folder_wrap").find(".folderClick").find(".folder-del").attr("data-count"));
            if (o++,
            a(".folder_wrap").find(".folderClick").find(".folder-del").attr("data-count", o),
            setTimeout(function() {
                i.fadeOut(400, function() {
                    a(this).remove()
                })
            }, 2e3),
            this.insertPage) {
                var n = t.chuangkit._owner_design
                  , r = n.getCurPage()
                  , l = r.getIndex();
                a("#leadingMenuBtn").hasClass("listBtnClick") || a("#leadingMenuBtn").click(),
                W.call(t.$img, l, t.chuangkit, !0)
            }
            this.startUpload()
        }
        ,
        this.uploadFailed = function() {
            this.$img.find(".progress-text").hide(),
            this.$img.find(".waiting-text").show().text("上传失败"),
            this.startUpload()
        }
    }
    function m() {
        var e = localStorage.color;
        if (void 0 != e)
            for (var t = e.split(","), i = t.length, o = 0; i > o; o++)
                a("#edit-color").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor"),
                a("#backColorPreinstall").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor")
    }
    function _() {
        a("#design_title>input").focus(function() {
            var e = a(this);
            0 == e.val().length && (e.val(""),
            e.attr("placeholder", ""))
        }).blur(function() {
            a(this).attr("placeholder", "点击设置作品标题")
        })
    }
    function w(e, i) {
        var o = a(this)
          , n = Oa._owner_design;
        if (a(".panelArrow").hasClass("rightArrow") && a(".panelArrow").click(),
        "chartMenuBtn" == o.attr("id")) {
            var r = n._focus_element;
            null != r && "svgChart" == r._element_type ? e.initChartBtn(r) : (n.nodeMousedown(i),
            e.initChartBtn(null))
        } else
            n.nodeMousedown(i);
        var s = a(".leftPanelMenuListBtn").index(this);
        if (0 == s && (D(),
        L(i)),
        1 == s && (t.addSomeMouseClick("左侧-图案按钮"),
        L(i)),
        3 == s && (t.addSomeMouseClick("左侧-文字按钮"),
        1 == a("#fontMaterialShow").attr("data-index"))) {
            var c = {
                pageNo: 1,
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 133
            };
            e.queryMaterial(e._ajax_url.queryMaterial, c, [0, 0, 0], "fontMaterialShow")
        }
        if (4 == s) {
            t.addSomeMouseClick("左侧-模板按钮");
            var p;
            if (window.TEAM_ID > 0) {
                if (p = "teamTemplate",
                1 == a("#teamTemplate").attr("data-index")) {
                    var c = {
                        pageNo: 1,
                        pageSize: e._ajax_page_size,
                        sort: 0,
                        tid: window.TEAM_ID,
                        skid: KIND_ID
                    };
                    e.queryTemplate(c, p)
                }
            } else if (p = "templateShow",
            1 == a("#templateShow").attr("data-index")) {
                var c = {
                    pageNo: 1,
                    pageSize: l.MATERIAL_PAGE_SIZE,
                    secondKindId: KIND_ID,
                    stickOrder: 1
                };
                e.queryTemplate(c, p)
            }
        }
        if (6 == s && a(".folder").not(".folder-add").size() <= 2) {
            if (window.VIP_EXPIRED) {
                var f = window.localStorage.getItem("vip_end_tip_in_design_page_folder");
                "false" != f && (a(".vip-end-wrap").show(),
                a(".vip-end-wrap-again-sign").click(function() {
                    a(this).hasClass("vip-end-sign-checked") ? (a(this).removeClass("vip-end-sign-checked"),
                    window.localStorage.setItem("vip_end_tip_in_design_page_folder", "true")) : (a(this).addClass("vip-end-sign-checked"),
                    window.localStorage.setItem("vip_end_tip_in_design_page_folder", "false"))
                }),
                a(".vip-end-donate-later").click(function() {
                    a(".vip-end-wrap").hide()
                }))
            }
            if (!window.ISLOGIN)
                return d.show(),
                !1;
            fa(e),
            Aa(),
            window.TEAM_ID > 0 && (Pa(e),
            Ka()),
            a(".folder_wrap").find(".folder-define").click()
        }
        if (5 == s && (t.addSomeMouseClick("左侧-背景按钮"),
        1 == a("#backImgChooseWrap").attr("data-index"))) {
            var c = {
                pageNo: 1,
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 2
            };
            e.queryMaterial(e._ajax_url.queryMaterial, c, [0, 0, 0], "backImgChooseWrap")
        }
        if (-324 == parseInt(a("#leftPanelWrap").css("left")) && a("#leftPanelWrap").css({
            left: 0
        }),
        a(this).hasClass("listBtnClick"))
            return !1;
        a(".leftPanelMenuBorder").stop();
        var u = a(this).offset().top - 50;
        a(".listBtnClick").removeClass("listBtnClick"),
        a(this).addClass("listBtnClick"),
        a("#leftPanelMenuBorder").css({
            top: u
        }),
        a("#leftPanelContentWrap").css({
            top: -1 * a("#leftPanelWrap").getHeight() * s
        })
    }
    function v(e) {
        var t = a(this)
          , i = e._owner_design
          , o = 400;
        if (a(".page-edit-bar").fadeOut(100),
        t.hasClass("leftArrow")) {
            var n = document.body.clientWidth - 54;
            a(".element-edit-bar").css({
                left: "54px",
                width: n + "px"
            }),
            a("#rightPanel").animate({
                left: "54px",
                width: n + "px"
            }, o),
            a("#div_design").animate({
                left: "+=182"
            }),
            a("#leftToolbarWrap, #leftPanelNoClick").hide(),
            a("#multipageWrap, #leftPanelWrap").animate({
                width: "0px"
            }, o),
            a("#leftPanel").animate({
                width: "54px"
            }, o, function() {
                a(".page-edit-bar").fadeIn(100)
            }),
            t.removeClass("leftArrow").addClass("rightArrow");
            var r = i.getCurPage();
            r.nodeMousedown()
        } else {
            var n = document.body.clientWidth - 378;
            a(".element-edit-bar").css({
                left: "378px",
                width: n + "px"
            }),
            a("#rightPanel").animate({
                left: "378px",
                width: n + "px"
            }, o),
            a("#div_design").animate({
                left: "-=182"
            }),
            a("#multipageWrap, #leftPanelWrap").animate({
                width: "324px"
            }, o),
            a("#leftPanel").animate({
                width: "378px"
            }, o, function() {
                a("#leftToolbarWrap").show(),
                a(".page-edit-bar").fadeIn(100)
            }),
            t.removeClass("rightArrow").addClass("leftArrow");
            var r = i.getCurPage();
            r.nodeMousedown()
        }
    }
    function k(e, t) {
        if (!e._kind_click_drag) {
            var i = a(this);
            if (!window.ISLOGIN && -1 == i.attr("data-kind"))
                return d.show(),
                !1;
            L(t),
            e._kind_click_drag = !0;
            var o = a("#materialWrap")
              , n = a(".materialShow .secondKindWrap");
            if (0 == n.find(".point-out-circle").length) {
                var r = {
                    name: "secondKindWrap",
                    element: n[0],
                    position_left: 83,
                    position_top: -1
                };
                c.pointOut(r)
            }
            if (a(".secondKindUl").css("display", "none"),
            i.hasClass("materialKindClick") || i.hasClass("materialKindNoClick"))
                o.stop(),
                "pending" == e._query_ajax.promise().state() && e._query_ajax.abort(),
                a("#meterialSecondKindListWrap").animate({
                    height: 0
                }, "fast", function() {
                    a(this).css("display", "none")
                }),
                o.animate({
                    height: 0
                }, "fast", function() {
                    a(this).css("display", "none"),
                    a(".materialKindClick").removeClass("materialKindClick"),
                    a(".materialKindNoClick").removeClass("materialKindNoClick"),
                    a(".materialShowOpen").removeClass("materialShowOpen"),
                    a("#materialWrap").children(".nohaveTipsTemplate").detach(),
                    e._kind_click_drag = !1
                }),
                a(".materialKind").css({
                    "margin-top": "15px"
                });
            else {
                i.addClass("materialKindClick"),
                a(".materialKind").not(this).each(function() {
                    a(this).addClass("materialKindNoClick")
                });
                var s = a(".materialKind").index(this)
                  , p = i.attr("data-kind")
                  , f = [0, 0, 0];
                2 == p ? (a(".materialShow").addClass("xifuShow"),
                a("#secondKindWrap").css({
                    top: "30px"
                }),
                f = [20, 20, 20]) : (a(".materialShow").removeClass("xifuShow"),
                a("#secondKindWrap").css({
                    top: "14px"
                })),
                6 == p ? (f = [100, 0, 0],
                a(".queryMaterial").show().removeClass("second-kind-go-to-upload"),
                a(".go-to-upload").show()) : a(".go-to-upload").hide(),
                e.materialSecondKindListShow.call(e, s, i);
                var u = i.offset().top + i.getHeight() + 20 - a("#materialKindList").offset().top + 60;
                u += a("#meterialSecondKindListWrap").outerHeight(),
                o.attr("data-firstid", p).removeAttr("data-secondid").children(".chooseMaterialLi").detach(),
                o.css({
                    top: u,
                    display: "block"
                }).attr({
                    "data-height": 150
                }).animate({
                    height: 150
                }, 300, function() {
                    if (o.children(".onloadMaterial").css("display", "block"),
                    a(".secondKindUl").children().detach(),
                    a("#secondKindWrap").children("div").html("全部"),
                    e.searchMaterialSecondKind(s),
                    -1 != p) {
                        var t = {
                            firstKindId: p,
                            pageNo: 1,
                            pageSize: l.MATERIAL_PAGE_SIZE
                        };
                        e.queryMaterial(e._ajax_url.queryMaterial, t, f, "materialWrap")
                    } else {
                        var t = {
                            pageNo: 1,
                            pageSize: l.MATERIAL_PAGE_SIZE
                        };
                        e.queryMaterial(e._ajax_url.queryCollMaterial, t, f, "materialWrap")
                    }
                    e._kind_click_drag = !1
                });
                for (var h = s + 3 - s % 3, g = h + 3; g > h; h++) {
                    var m = a(".materialKind").eq(h);
                    m.css("margin-top", 255)
                }
            }
        }
    }
    function y(e, t) {
        L(t);
        var i = a(this);
        a("#secondKindWrap").children("div").html(i.attr("data-name"));
        var o = a("#materialWrap");
        o.children(".chooseMaterialLi").detach(),
        o.children(".nohaveTipsTemplate").detach();
        var n = l.MATERIAL_PAGE_SIZE
          , r = {
            pageNo: 1,
            pageSize: n
        };
        a(".meterialSecondKindList").find(".secondKindListClick").removeClass("secondKindListClick");
        var s;
        "全部" == i.attr("data-name") ? (s = i.attr("data-firstid"),
        -1 == s ? r.type = 0 : r.firstKindId = i.attr("data-firstid"),
        o.removeAttr("data-secondid"),
        a(".meterialSecondKindList").find(".secondKindList").eq(0).addClass("secondKindListClick")) : (s = i.attr("data-firstid"),
        -1 == s ? r.type = i.attr("data-secondid") : r.secondKindId = i.attr("data-secondid"),
        o.attr("data-secondid", i.attr("data-secondid")),
        a(".meterialSecondKindList").find(".secondKindList[data-secondid=" + r.secondKindId + "]").addClass("secondKindListClick"));
        var d = [0, 0, 0];
        return 6 == a(".materialKindClick").attr("data-kind") && (d = [100, 0, 0],
        a(".go-to-upload").addClass("second-kind-go-to-upload")),
        2 == a(".materialKindClick").attr("data-kind") && (d = [20, 20, 20]),
        o.css({
            height: 150
        }).attr({
            "data-height": 150
        }).animate({
            height: 150
        }),
        a("#materialContent").animate({
            scrollTop: a(".materialKindClick").offset().top - a("#materialKindList").offset().top
        }, function() {
            -1 == s ? e.queryMaterial(e._ajax_url.queryCollMaterial, r, d, "materialWrap") : e.queryMaterial(e._ajax_url.queryMaterial, r, d, "materialWrap")
        }),
        t.stopPropagation(),
        !1
    }
    function C() {
        L(),
        a(this).addClass("secondKindListMoreClick").text("收起更多分类");
        var e = a("#meterialSecondKindListWrap")
          , t = e.find(".meterialSecondKindList")
          , i = t.outerHeight()
          , o = parseInt(t.attr("data-height-change"));
        t.css({
            height: i + o + "px"
        });
        var n = a("#materialWrap").css("top")
          , r = parseFloat(n) + o;
        a("#materialWrap").animate({
            top: r + "px"
        }, 300)
    }
    function T() {
        L(),
        a(this).removeClass("secondKindListMoreClick").text("展开更多分类");
        var e = a("#meterialSecondKindListWrap")
          , t = e.find(".meterialSecondKindList")
          , i = t.outerHeight()
          , o = parseInt(t.attr("data-height-change"));
        e.find(".meterialSecondKindList").css("height", i - o + "px");
        var n = a("#materialWrap").css("top")
          , r = parseFloat(n) - o;
        a("#materialWrap").animate({
            top: r + "px"
        }, 300)
    }
    function M(e) {
        var t = a("#materialSearch")
          , i = t.parent();
        if (t.offset().top <= 100 ? (a("#searchKeyWord").css({
            width: "50%",
            left: "25%"
        }).offset({
            top: 115
        }),
        a("#searchMaterialup").css({
            scale: 1
        }).offset({
            top: 115
        })) : (a("#searchKeyWord").css({
            width: "100%",
            left: "0px",
            top: "14px"
        }),
        a("#searchMaterialup").css({
            top: "14px",
            scale: 0
        })),
        t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var o = i.offset().top + i.height() + 60
          , n = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , r = Math.max(n[0], n[1], n[2]);
        if (r += t.offset().top,
        o > r && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                word: t.attr("data-key")
            }
              , d = t.find("#searchKeyWord").attr("data-type");
            d > 0 && (s.ct = d),
            t.height(t.getHeight() + 50),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.searchMaterial, s, n, "materialSearch")
        }
    }
    function I(e) {
        if ("block" == a("#materialWrap").css("display") && (a("#materialWrap").offset().top <= 100 ? (a("#secondKindWrap").css({
            opacity: "1",
            display: "block"
        }).offset({
            top: 115
        }),
        a(".secondKindLi").css({
            width: 140
        }),
        a("#materialup").css({
            scale: 1
        }).offset({
            top: 115
        })) : (a("#secondKindWrap").css({
            opacity: "0",
            display: "none"
        }),
        a("#secondKindWrap").css(a("#materialWrap").hasClass("xifuShow") ? {
            top: "30px"
        } : {
            top: "14px"
        }),
        a(".secondKindLi").css({
            width: 280
        }),
        a("#materialup").css({
            top: "14px",
            scale: 0
        }))),
        "block" == a("#materialWrap").css("display")) {
            var t = a("#materialWrap")
              , i = t.parent();
            if (t.children(".nohaveTipsTemplate").size() > 0)
                return void (e._kind_click_drag = !1);
            var o = i.offset().top + i.height() + 60
              , n = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
              , r = Math.max(n[0], n[1], n[2]);
            if (r += t.offset().top,
            o > r && !e._kind_click_drag) {
                e._kind_click_drag = !0;
                var s = {
                    pageNo: t.attr("data-index"),
                    pageSize: l.MATERIAL_PAGE_SIZE
                }
                  , d = t.attr("data-secondid")
                  , c = t.attr("data-firstid");
                void 0 != d && "" != d ? -1 == c ? s.type = d : s.secondKindId = d : -1 == c ? s.type = 0 : s.firstKindId = c,
                t.height(t.getHeight() + 50),
                t.children(".onloadMaterial").css("display", "block");
                for (var p = a(".materialKindClick").index(".materialKind"), f = p + 3 - p % 3, u = f + 3; u > f; f++) {
                    var h = a(".materialKind").eq(f);
                    h.css("margin-top", 15 + t.getHeight() + 20)
                }
                e.queryMaterial(e._ajax_url.queryMaterial, s, n, "materialWrap")
            }
        }
    }
    function x(e) {
        var t = a("#fontMaterialShow")
          , i = t.parent();
        if (t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var o = i.offset().top + i.height() + 60
          , n = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , r = Math.max(n[0], n[1], n[2]);
        if (r += t.offset().top,
        o > r && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 133
            };
            t.height(t.getHeight() + 50),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.queryMaterial, s, n, "fontMaterialShow")
        }
    }
    function S(e) {
        var t = a("#backImgChooseWrap")
          , i = t.parent();
        if (t.children(".nohaveTipsTemplate").size() > 0)
            return e._kind_click_drag = !1,
            void console.log("滚动加载完毕，无素材了，滚动已解锁");
        var o = i.offset().top + i.height() + 60
          , n = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , r = Math.max(n[0], n[1], n[2]);
        if (r += t.offset().top,
        o > r && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 2
            };
            t.height(t.getHeight() + 50),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.queryMaterial, s, n, "backImgChooseWrap")
        }
    }
    function b(e) {
        var t = a("#leadingMaterialWrap")
          , i = t.parent();
        if (t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var o = i.offset().top + i.height() + 60
          , n = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , r = Math.max(n[0], n[1], n[2]);
        if (r += t.offset().top,
        o > r && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE
            };
            t.height(t.getHeight()),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.queryMaterialsInFolder, s, n, "leadingMaterialWrap")
        }
    }
    function E(e) {
        var t, i, o = a("#templateContentKind").find(".templateKindBtnClick").index();
        if (0 == o ? (t = a("#templateShow"),
        i = "templateShow") : 1 == o ? (t = a("#collectionTemplate"),
        i = "collectionTemplate") : (t = a("#teamTemplate"),
        i = "teamTemplate"),
        t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var n = a("#templateContent");
        if (n.getHeight() - t.offset().top + n.offset().top >= t.height() - 30 && !e._kind_click_drag) {
            var r = ([parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))],
            {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: KIND_ID
            });
            0 == o ? r.stickOrder = 1 : 1 == o ? r = {
                pageNo: 1,
                pageSize: e._ajax_page_size,
                fid: -1,
                kindId: KIND_ID,
                sort: 0,
                type: 2
            } : 2 == o && (r.timeOrder = 1,
            r.tid = window.TEAM_ID),
            t.children(".onloadTemplate").appendTo(t),
            t.children(".onloadTemplate").css("display", "block"),
            e.queryTemplate(r, i)
        }
    }
    function A(e, i) {
        L(),
        a("#leftPanelWrap").find("#clear_search_material").show();
        var o;
        a(this).hasClass("search_material_his_li") ? (o = a(this).text(),
        a("#leftPanelInput").val(o)) : o = a("#leftPanelInput").val();
        var o = t.htmlUtil(o, !0);
        if (0 == o.length)
            return !1;
        if (window.localStorage) {
            var n = window.localStorage.getItem("search_material_history");
            if (null == n || void 0 == n)
                n = o;
            else {
                for (var r, s = n.split(","), d = 0; d < s.length; d++)
                    if (s[d] == o) {
                        r = !0;
                        break
                    }
                if (r || (n = o + "," + n),
                s = n.split(","),
                s.length > 19) {
                    var c = n.lastIndexOf(",");
                    n = n.substring(0, c)
                }
            }
            window.localStorage.setItem("search_material_history", n)
        }
        a("#materialSearch").children(".chooseMaterialLi").detach(),
        a("#searchKeyWord").css({
            width: "100%",
            left: "0px",
            top: "14px"
        }),
        a("#searchMaterialup").css({
            top: "14px",
            scale: 0
        }),
        a("#materialSearch").children(".nohaveTipsTemplate").detach(),
        a("#materialSearch").children(".onloadMaterial").css("display", "block"),
        a("#materialSearch").attr("data-key", o),
        a("#materialSearch").height(150),
        null != e._query_ajax && "pending" == e._query_ajax.promise().state() && e._query_ajax.abort();
        var p = {
            pageNo: 1,
            pageSize: l.MATERIAL_PAGE_SIZE,
            word: o
        }
          , i = a("#materialSearch").find("#searchKeyWord").attr("data-type");
        i > 0 && (p.ct = i),
        e.queryMaterial(e._ajax_url.searchMaterial, p, [50, 50, 50], "materialSearch"),
        a("#searchKeyWord").css("display", "block").attr("title", o).find("#searchKeyWordType").html(o),
        a("#materialSearch").show(),
        a("#search_material_history_wrap").hide()
    }
    function D() {
        if (window.localStorage) {
            var e = window.localStorage.getItem("search_material_history");
            if (null != e || void 0 != e) {
                if (e.length > 0) {
                    e = e.split(",");
                    var t = a("#leftPanelWrap").find(".search_material_his_list");
                    t.children("li").remove();
                    for (var i, o = 0; o < e.length; o++)
                        0 != e[o].length && (i = '<li class="search_material_his_li">' + e[o] + "</li>",
                        t.append(i))
                }
            } else
                a("#leftPanelWrap").find("#search_material_history_wrap").hide()
        }
    }
    function P(e, t) {
        if (0 != t.button && !t.isTrigger)
            return !1;
        L(t);
        var i = a(this);
        if (!(i.hasClass("move_chooseMaterialLi") || i.hasClass("move_chooseMaterialLi_click") || i.hasClass("img_uploading"))) {
            var o = e._owner_design
              , n = o.getCurPage();
            o.nodeMousedown(t);
            var r = (n.getNode(),
            i.hasClass("imgMaterial"))
              , l = i.hasClass("backgroundMaterial");
            if (n._svgLayoutNum > 0 && r && !l) {
                n.svgLayoutWrapCreate();
                var s = {
                    drag: !1,
                    index: 0,
                    imgIndex: 0
                }
            }
            var d = t.pageX
              , c = t.pageY
              , p = d
              , f = c
              , u = -1
              , h = i.createClone(e).appendTo("body");
            h.find(".materialInfoIcon").detach(),
            h.find(".materialCollIcon").detach();
            var g = !1
              , m = !1;
            i.parent().hasClass("leadingMaterialWrap") && (m = !0,
            a("#personMaterialDel").css("display", "block"));
            var _ = h.width()
              , w = h.height()
              , v = _ / w
              , k = h.width()
              , y = h.height()
              , C = a(".page").width()
              , T = a(".page").height();
            _ = 300,
            _ > C && (_ = C),
            w = _ / v,
            w > T && (w = T,
            _ = w * v);
            var M = (k - _) / 2
              , I = (y - w) / 2;
            a(document).mousemove(function(e) {
                var a = e.pageX
                  , t = e.pageY
                  , m = a - d
                  , v = t - c;
                "none" == h.css("display") && (h.css({
                    left: parseFloat(h.css("left")) + M,
                    top: parseFloat(h.css("top")) + I
                }),
                h.css({
                    width: _,
                    height: w
                })),
                "block" == h.css("display"),
                h.css({
                    top: "+=" + v + "px",
                    left: "+=" + m + "px",
                    display: "block"
                }),
                u = o.pageEnterCheek(a, t),
                n._svgLayoutNum > 0 && r && !l && n.svgLayoutEnter(s, h),
                d = a,
                c = t,
                i.css("visibility", "hidden"),
                (d - p > 1 || c - f > 1) && (g = !0)
            }).mouseup(function() {
                a("#personMaterialDel").css("display", "none"),
                n._svgLayoutNum > 0 && r && !l && n.svgLayoutWrapRemove(s, h),
                -1 == u || void 0 != s && 0 != s.drag || W.call(h, u, e),
                g || (u = n.getIndex(),
                W.call(h, u, e, !0)),
                i.css("visibility", "visible"),
                h.detach(),
                a(this).off("mousemove").off("mouseup")
            })
        }
    }
    function K(e) {
        var t = a(this)
          , i = t.parent()
          , o = i.attr("data-nickname")
          , n = i.attr("data-keywords")
          , r = parseFloat(i.css("top"))
          , l = parseFloat(i.css("left"))
          , s = parseFloat(i.css("width"))
          , d = parseFloat(i.css("height"))
          , c = i.parent().find(".materialInfoWrap")
          , p = i.parent();
        c.css({
            "padding-top": "7px",
            height: "auto",
            opacity: "1",
            top: r + d - 7 + "px"
        }),
        c.find(".materialTail").css({
            left: l + s / 2 - 5 + "px"
        }),
        (void 0 == o || "" == o) && (o = "创客贴"),
        c.find("#materialCreatorID").text(o),
        c.find("#materialKeywords").text(n),
        t.parent().siblings("li").addClass("meterialInfoShow"),
        p.find(".materialInfoIcon").hide(),
        p.attr("data-material-info", "show");
        var f = document.body.clientHeight
          , u = c.offset().top
          , h = c.outerHeight();
        if (u > f - h) {
            var g = u - (f - h)
              , m = a("#materialContent").scrollTop();
            a("#materialContent").animate({
                scrollTop: m + g + "px"
            }, 300)
        }
        e.stopPropagation()
    }
    function L(e) {
        "show" == a("#materialWrap").attr("data-material-info") && N(a("#materialWrap")),
        "show" == a("#materialSearch").attr("data-material-info") && N(a("#materialSearch")),
        e && e.stopPropagation()
    }
    function N(e) {
        e.find(".materialInfoWrap").css({
            opacity: "0"
        }),
        setTimeout(function() {
            e.find(".materialInfoWrap").css({
                height: "0px",
                "padding-top": "0px"
            })
        }, 300),
        e.children().removeClass("meterialInfoShow"),
        e.find(".materialInfoIcon").show(),
        e.attr("data-material-info", "hide")
    }
    function O() {
        if (!window.ISLOGIN)
            return d.show(),
            !1;
        var e = a(this)
          , t = e.parent().attr("data-id");
        a.ajax(e.hasClass("colled") ? {
            url: "/material/deleteCollectMaterial.do",
            dataType: "json",
            type: "POST",
            data: {
                id: t
            },
            success: function(a) {
                1 == a.code && (e.removeClass("colled"),
                e.attr("title", "收藏素材"),
                Na())
            },
            error: function() {}
        } : {
            url: "/material/collectMaterial.do",
            dataType: "json",
            type: "POST",
            data: {
                id: t
            },
            success: function(a) {
                1 == a.code && (e.addClass("colled"),
                e.attr("title", "取消收藏"),
                Na())
            },
            error: function() {}
        })
    }
    function W(e, i, o) {
        var n = a(this)
          , r = i._owner_design
          , l = r.pageScale
          , s = r.pages[e]
          , d = (a(s.getNode()),
        {
            "data-type": function() {
                return n.hasClass("imgMaterial") && !n.hasClass("backgroundMaterial") ? "img" : n.hasClass("svgMaterial") && !n.hasClass("backgroundMaterial") ? "svgImage" : n.hasClass("backgroundMaterial") ? "background" : n.hasClass("groupMaterial") ? "元素类型未定义" : (console.log("元素类型未定义"),
                "元素类型未定义")
            }(),
            "data-img-kind": n.attr("data-type"),
            "data-elem": {
                id: n.children().attr("data-id"),
                "data-key": n.children().attr("alt"),
                width: n.getWidth() / l,
                height: n.getHeight() / l,
                opacity: 1
            },
            transform: F.call(this, i, o, "eles")
        });
        n.hasClass("imgMaterial") && n.hasClass("backgroundMaterial") && (d["data-elem"].lock = "true"),
        window.imgsrc = n.children().attr("src"),
        window.MEMENTO_ID = t.now(),
        "background" == d["data-type"] && (s.eleDelAndUndo(s.elements[0]),
        q.call(this, i, o, d),
        s.flickerBackground({
            transform: d.transform,
            width: d["data-elem"].width,
            height: d["data-elem"].height,
            "img-key": d["data-elem"]["data-key"]
        }));
        var c;
        if (n.hasClass("groupMaterial")) {
            var p = {
                transform: d.transform
            };
            c = s.addElementGroup({
                width: d["data-elem"].width,
                height: d["data-elem"].height,
                json: p,
                fileurl: n.children().attr("fileurl")
            })
        } else
            c = s.createElementAndUndo({
                json: d,
                unshift: !0
            }),
            c.nodeClick()
    }
    function j(e) {
        var i = a(this)
          , o = e._owner_design
          , n = o.getCurPage()
          , r = o.pageScale
          , l = i.children().getWidth() / r
          , s = i.children().getHeight() / r
          , d = i.children().attr("data-family")
          , c = parseFloat(i.children().css("font-size")) / r
          , p = ([parseFloat(e.getFontWH("默", c, d).width), parseFloat(e.getFontWH("认", c, d).width), parseFloat(e.getFontWH("标", c, d).width), parseFloat(e.getFontWH("题", c, d).width)],
        {
            "data-type": "text",
            html: "双击修改",
            "data-elem": {
                width: l,
                height: s,
                "font-size": c,
                "font-family": d,
                fill: "#000",
                wspace: 0,
                "data-align": "center"
            },
            transform: F.call(a(this).children(), e, !0, "text"),
            v: "1.0.1"
        });
        window.MEMENTO_ID = t.now();
        var f = n.createElementAndUndo({
            json: p
        });
        f.nodeClick()
    }
    function B(e) {
        var i = a(this)
          , o = e._owner_design
          , n = o.getCurPage()
          , r = o.pageScale
          , l = i.children().getWidth() / r
          , s = i.children().getHeight() / r
          , d = i.attr("data-family")
          , c = i.attr("data-size")
          , p = i.attr("data-color")
          , f = i.attr("data-space")
          , u = i.attr("data-style")
          , h = "false"
          , g = "false"
          , m = 0
          , _ = "";
        if (null != u && u.length > 0)
            for (var w = u.split(","), v = 0; v < w.length; v++)
                2 == w[v] ? (h = "true",
                _ += "font-style: italic;") : 3 == w[v] ? (g = "true",
                _ += "text-decoration: underline;") : (w[v] = w[v].split("-"),
                m = w[v][1] / 100);
        var k = ([parseFloat(e.getFontWH("默", c, d).width), parseFloat(e.getFontWH("认", c, d).width), parseFloat(e.getFontWH("标", c, d).width), parseFloat(e.getFontWH("题", c, d).width)],
        {
            "data-type": "text",
            html: "双击修改",
            "data-elem": {
                width: l,
                height: s,
                "font-size": c,
                "font-family": d,
                fill: p,
                wspace: f,
                "data-bold": m,
                "data-italic": h,
                "data-decoration": g
            },
            transform: F.call(a(this).children(), e, !0, "text")
        });
        window.MEMENTO_ID = t.now();
        var y = n.createElementAndUndo({
            json: k
        });
        y.nodeClick()
    }
    function F(e, t) {
        var i, o, n = a(this), r = e._owner_design, l = r.pageScale, s = r.getCurPage(), d = a(s.getNode()), c = s.width, p = s.height, f = n.getWidth() / l, u = n.getHeight() / l;
        return t ? (i = (c - f) / 2,
        o = (p - u) / 2) : (i = (n.offset().left - d.offset().left) / l,
        o = (n.offset().top - d.offset().top) / l),
        "translate(" + i + "," + o + ")"
    }
    function q(e, t, i) {
        var o = a(this)
          , n = e._owner_design
          , r = n.pageScale
          , l = n.getCurPage()
          , s = (a(l.getNode()),
        l.width)
          , d = l.height
          , c = o.getWidth() / r
          , p = o.getHeight() / r
          , f = i["data-elem"];
        c / s > p / d ? (f.height = d,
        f.width = d * (c / p)) : (f.width = s,
        f.height = s * (p / c)),
        i.transform = "translate(" + (s - f.width) / 2 + "," + (d - f.height) / 2 + ")"
    }
    function U(e) {
        var t = this.value
          , i = document.getElementById(l.ANXIDCOPY);
        i.value = t;
        var o = e._owner_design
          , n = o._owner_editDiv
          , r = i.scrollHeight;
        n.resetHeight(r);
        var s = this.getBoundingClientRect()
          , d = s.left
          , c = s.top;
        this.style.height = r + "px",
        a(this).offset({
            left: d,
            top: c
        })
    }
    function H(e, i) {
        var o = a(this);
        if (o.hasClass("edit-color-span-nocolor"))
            return !1;
        t.addBugTrackClick("n1");
        var n = e._owner_design;
        n.nodeMousedown(i),
        o.siblings().filter(".now-click").removeClass("now-click"),
        o.addClass("now-click");
        var r = o.css("background-color");
        J(r, e)
    }
    function z() {
        var e = a(this);
        if (!e.hasClass("fontKindBtnClick")) {
            var t = e.parent();
            a(".fontKindBtn").removeClass("fontKindBtnClick"),
            e.addClass("fontKindBtnClick"),
            1 == t.attr("data-drag") ? (a("#fontAddUl").css({
                left: "-100%",
                opacity: "0"
            }),
            a("#teamfontAddUl").css({
                left: "0%",
                opacity: "1"
            }),
            t.attr("data-drag", 2)) : (a("#fontAddUl").css({
                left: "0%",
                opacity: "1"
            }),
            a("#teamfontAddUl").css({
                left: "100%",
                opacity: "0"
            }),
            t.attr("data-drag", 1))
        }
    }
    function R() {
        var e = a(this);
        if (!e.hasClass("backgroundColorClick")) {
            var t = e.parent();
            a(".backgroundColorClick").removeClass("backgroundColorClick"),
            e.addClass("backgroundColorClick"),
            1 == t.attr("data-drag") ? (a("#backColorPreinstall").css({
                left: "-288px",
                opacity: "0"
            }),
            a("#backColorTeaminstall").css({
                left: "0px",
                opacity: "1"
            }),
            t.attr("data-drag", 2)) : (a("#backColorPreinstall").css({
                left: "0px",
                opacity: "1"
            }),
            a("#backColorTeaminstall").css({
                left: "288px",
                opacity: "0"
            }),
            t.attr("data-drag", 1))
        }
    }
    function G() {
        var e = a(this);
        if (!e.hasClass("folderKindClick")) {
            a(".folderClick").size() > 0 && a(".folderClick").click();
            var t = e.parent();
            a(".folderKindClick").removeClass("folderKindClick"),
            e.addClass("folderKindClick"),
            1 == t.attr("data-drag") ? (a(".folder_wrap").css({
                left: "-100%",
                opacity: "0"
            }),
            a(".team_folder_wrap").css({
                left: "0%",
                opacity: "1"
            }),
            t.attr("data-drag", 2)) : (a(".folder_wrap").css({
                left: "0%",
                opacity: "1"
            }),
            a(".team_folder_wrap").css({
                left: "100%",
                opacity: "0"
            }),
            t.attr("data-drag", 1))
        }
    }
    function J(e, i, o) {
        var n = i._owner_design
          , r = n.getCurPage()
          , l = r.getPageSvg()
          , s = a(l)
          , d = r.elements;
        if (s.find(".backgroundSon").size() > 0)
            if (o)
                d[0].previewBackgroundColor(e);
            else {
                window.MEMENTO_ID = t.now(),
                r.eleDelAndUndo(d[0]);
                var c = r.width
                  , p = r.height
                  , f = {
                    "data-type": "background",
                    "data-elem": {
                        "data-key": "false",
                        width: c,
                        height: p,
                        opacity: 1,
                        "data-colors": {
                            0: e
                        }
                    },
                    transform: "translate(0,0)"
                };
                r.createElementAndUndo({
                    json: f,
                    index: 0,
                    unshift: !0
                })
            }
        else {
            var c = r.width
              , p = r.height;
            window.MEMENTO_ID = t.now();
            var f = {
                "data-type": "background",
                "data-elem": {
                    "data-key": "false",
                    width: c,
                    height: p,
                    opacity: 1,
                    "data-colors": {
                        0: e
                    }
                },
                transform: "translate(0,0)"
            };
            r.createElementAndUndo({
                json: f
            })
        }
        s.parent().hasClass("design-page-background-transparent") && s.parent().removeClass("design-page-background-transparent")
    }
    function Y() {
        var e = a(".color-input").val()
          , i = localStorage.color;
        if (void 0 == i)
            i = "" + e;
        else {
            for (var o = i.split(","), n = o.length, r = 0; n > r; r++)
                if (t.colorRgb(o[r]) == t.colorRgb(e))
                    return;
            o.length >= 6 ? (o.pop(),
            o.splice(0, 0, e)) : o.splice(0, 0, e),
            i = o.join(",")
        }
        localStorage.color = i,
        Oa.colorBtnSet()
    }
    function X(e, a) {
        e instanceof Array ? (e = e.join("haogetedingzhiling"),
        e = "elementGroup" === a ? "e" + e : "c" + e,
        localStorage.eleJson = e) : localStorage.eleJson = JSON.stringify(e)
    }
    function Z() {
        return localStorage.eleJson
    }
    function V(e, t) {
        if (0 != e.button)
            return !1;
        var i = e.pageX
          , o = e.pageY
          , n = a(".select_element").css({
            width: "0px",
            height: "0px"
        }).offset({
            left: i,
            top: o
        })
          , r = t._owner_design
          , l = r.getCurPage();
        a(document).mousemove(function(e) {
            var a = e.pageX - i
              , t = e.pageY - o
              , r = i
              , s = o;
            0 > a && (r = e.pageX,
            a = -a),
            0 > t && (s = e.pageY,
            t = -t),
            n.css({
                width: a + 1,
                height: t + 1,
                display: "block"
            }).offset({
                left: r,
                top: s
            }),
            l.selectElement(s, r + a, s + t, r)
        }).mouseup(function() {
            a(this).off("mouseup").off("mousemove"),
            n.css("display", "none"),
            l.selectElementUp()
        })
    }
    function $(e) {
        var i = a(this);
        if (!i.hasClass("templateKindBtnClick")) {
            var o = i.parent();
            a(".templateKindBtnClick").removeClass("templateKindBtnClick"),
            i.addClass("templateKindBtnClick");
            var n = i.index()
              , r = o.attr("data-drag")
              , l = a(".templateShow");
            if (r > n ? (l.eq(r).css({
                left: "100%",
                opacity: "0"
            }),
            l.eq(n).css({
                left: "0%",
                opacity: "1"
            }),
            o.attr("data-drag", n)) : (l.eq(r).css({
                left: "-100%",
                opacity: "0"
            }),
            l.eq(n).css({
                left: "0%",
                opacity: "1"
            }),
            o.attr("data-drag", n)),
            0 == n) {
                if (t.addSomeMouseClick("左侧-推荐模板"),
                0 == a("#templateShow").children(".templateLi").size() && 0 == a("#templateShow").children(".nohaveTipsTemplate").size()) {
                    var s = {
                        pageNo: 1,
                        pageSize: e._ajax_page_size,
                        isShowMyCollectedTemplates: 0,
                        secondKindId: KIND_ID,
                        stickOrder: 1
                    };
                    e.queryTemplate(s, "templateShow")
                }
            } else if (1 == n) {
                if (t.addSomeMouseClick("左侧-我的收藏"),
                t.addBugTrackClick("k2"),
                0 == a("#collectionTemplate").children(".templateLi").size() && 0 == a("#collectionTemplate").children(".nohaveTipsTemplate").size()) {
                    var s = {
                        pageNo: 1,
                        pageSize: e._ajax_page_size,
                        fid: -1,
                        kindId: KIND_ID,
                        sort: 0,
                        type: 2
                    };
                    e.queryTemplate(s, "collectionTemplate")
                }
            } else if (2 == n && 0 == a("#teamTemplate").children(".templateLi").size() && 0 == a("#teamTemplate").children(".nohaveTipsTemplate").size()) {
                var s = {
                    pageNo: 1,
                    pageSize: e._ajax_page_size,
                    sort: 0,
                    tid: window.TEAM_ID,
                    skid: KIND_ID
                };
                e.queryTemplate(s, "teamTemplate")
            }
        }
    }
    function Q(e) {
        function i() {
            _.nodeMousedown();
            var e = o.attr("alt")
              , i = 0;
            o.hasClass("multipageSon") && (i = a(".multipageSon").index(o));
            var n = {};
            window.TEAM_ID > 0 && ("teamTemplate" == o.parent().attr("id") || o.parent().hasClass("teamTemplate")) ? (n.tid = window.TEAM_ID,
            n.tt = e) : n.t = e,
            a.ajax({
                url: "/designtemplate/getTemplateContent.do",
                type: "POST",
                dataType: "json",
                data: n,
                error: function() {
                    console.log("加载json失败")
                },
                success: function(e) {
                    window.MEMENTO_ID = t.now();
                    var a = JSON.parse(la(e.j));
                    _.onloadTemplate(a, i),
                    v.pageThumbList[w].thumbnailsUrl = k,
                    v.savePageThumb(),
                    window.TEMPLATE_PAGE_THUMB_NO = w,
                    v.updatePageNode(v.pageThumbList[w].pageId, !0)
                }
            })
        }
        var o = a(this)
          , n = a(this).attr("data-price")
          , r = a(this).attr("data-own")
          , l = a(this).attr("data-vip")
          , s = a(this).attr("alt");
        if (n > 0 && "true" != r && (!(window.TEAM_ID > 0 || window.ISVIP) || "1" != l))
            return ea(s, a(this)),
            !1;
        if (o.hasClass("multipage")) {
            a("#multipage_total").attr("data-id", o.find("img").attr("alt"));
            var d = parseFloat(KIND_HEIGHT) / parseFloat(KIND_WIDTH) * 280
              , p = parseInt(o.attr("data-size"))
              , f = o.find("img").attr("data-src");
            a("#multipageContent").children().detach(),
            a("#multipageContent").height(p * (d + 18));
            for (var u = 0; p > u; u++) {
                var h;
                h = 0 == u ? f : f + "_" + u;
                var g;
                g = a(void 0 == f ? '<div alt="' + o.attr("alt") + '" class="templateMaking multipageSon" style="line-height:140px">缩略图正在生成中...</div>' : '<div class="multipageSon" style="height:' + d + 'px" alt="' + o.attr("alt") + '"><img width="100%" height="100%" draggable="false" alt="' + o.attr("alt") + '" src="' + h + '@290w_100Q_1x.jpg" /></div>'),
                g.appendTo(a("#multipageContent"))
            }
            window.TEAM_ID > 0 && "teamTemplate" == o.parent().attr("id") ? a("#multipageContent").addClass("teamTemplate") : a("#multipageContent").removeClass("teamTemplate"),
            a("#leftPanelWrap").css({
                left: "-324px"
            })
        } else {
            var m = e._owner_design
              , _ = m.getCurPage()
              , w = _.getIndex()
              , v = m._owner_pageList
              , k = o.find("img").attr("src");
            k = k.split(""),
            k.splice(-17, 17),
            k = k.join(""),
            1 != _.elements.length && _._pop_drag ? c.confirm({
                str: "使用模板后，将会覆盖掉此画布上的所有现有内容哦",
                yes: "覆盖",
                no: "不覆盖",
                successfun: function() {
                    i()
                }
            }) : i()
        }
    }
    function ea(e, t) {
        a.ajax({
            url: "/designtemplate/hasBoughtTemplate.do",
            dataType: "json",
            type: "POST",
            data: {
                t: e
            },
            success: function(e) {
                var a = e.code;
                1 == a ? (t.attr("data-own", "true"),
                t.click()) : 0 == a ? (t.attr("data-own", "false"),
                aa(t)) : 2 == a ? (t.attr("data-own", "false"),
                aa(t)) : -2 == a ? (c.dialogHide(),
                d.show()) : (c.back({
                    str: "获取模版失败！",
                    kind: "warning"
                }),
                console.log("查询用户是否购买某个模板 错误！code:" + a))
            },
            error: function() {
                c.back({
                    str: "获取模版失败！",
                    kind: "warning"
                }),
                console.log("查询用户是否购买某个模板 error！")
            }
        })
    }
    function aa(e) {
        {
            var a = p.getTemplateModal().find("#tplShow").clone()
              , t = e.attr("data-price")
              , t = parseInt(t) / 100
              , i = e.attr("data-vip");
            e.attr("data-own")
        }
        "1" == i && (a.find("#vipFreeTag").show(),
        window.ISVIP || a.find(".joinVipText").show()),
        a.find(".share_wrap").children(".price_text").text(t + "元"),
        a.find(".pay-template-wrap").find(".template-price span").text("¥" + t + "元"),
        a.find("#qr_pay_money").text(t + "元"),
        a.find(".userBalance").text(parseFloat(window.USERINFO.vmAmount) / 100),
        window.USERINFO.vmAmount < t ? a.find(".template-select-list div").eq(0).addClass("balance-not-enough").removeClass("select-way").next().addClass("select-way") : a.find(".template-select-list div").eq(0).addClass("select-way");
        var o = e.attr("data-kind")
          , n = e.attr("data-view")
          , r = e.attr("data-collect")
          , l = e.attr("data-title")
          , s = e.attr("data-pageNum");
        a.find("#collect_materialTitle").text(l),
        a.find("#materialTypeTips").text(o),
        a.find("#numViewPeople").text(n),
        "true" == r ? a.find(".share_wrap").find(".heart_icon").addClass("active") : a.find(".share_wrap").find(".heart_icon").removeClass("active"),
        1 >= s && a.find(".previewTo").hide();
        var d = e.attr("alt")
          , f = e.find("img").attr("src");
        f && f.length > 17 && (f = f.substring(0, f.length - 17) + "@690w_600h"),
        a.find("#imgMaterial").attr({
            "data-materialid": d,
            src: f,
            "data-page-num": s,
            "data-index": 1
        });
        var u = e.width()
          , h = e.height();
        if (u > h) {
            var g = 690 * h / u
              , m = (600 - g) / 2;
            a.find("#imgMaterial").css({
                top: m,
                left: "0",
                width: "690px",
                height: g
            })
        } else {
            var _ = 600 * u / h
              , w = (690 - _) / 2;
            a.find("#imgMaterial").css({
                left: w,
                top: "0",
                height: "600px",
                width: _
            })
        }
        return c.dialog(a),
        ta(a, e),
        !1
    }
    function ta(e, t) {
        var i = e.find(".buy-template-wrap");
        i.on("click", ".share_icon", function() {
            a(this).hasClass("active") ? a(this).removeClass("active") : a(this).addClass("active")
        }),
        i.on("click", "#useNow", function() {
            return a(".buy-template-wrap").animate({
                opacity: "0"
            }, 600),
            a(".pay-template-wrap").animate({
                left: "0%",
                opacity: "1"
            }, 600),
            !1
        });
        var o = e.find(".pay-template-wrap");
        o.on("click", ".template-pay-way", function() {
            if (a(this).addClass("select-way").siblings().removeClass("select-way"),
            0 == a(this).attr("data-num") && a(this).hasClass("balance-not-enough") ? (a("#template_buy").fadeOut(300),
            a("#template_depost").fadeIn(300)) : "block" == a("#template_depost").css("display") && (a("#template_depost").fadeOut(300),
            a("#template_buy").fadeIn(300)),
            1 == a(this).attr("data-num")) {
                var i = t.attr("alt");
                e.find("#template_buy").hide(),
                e.find("#template_buy_alipay").show(),
                e.find("#template_buy_alipay").hasClass("no-click") && ia(i, 1, t)
            } else
                e.find("#template_buy").show(),
                e.find("#template_buy_alipay").hide()
        }),
        o.on("click", "#template_depost", function() {
            a(this).parent().siblings(".closeBtnCross").click(),
            payment.show()
        }),
        o.on("click", "#template_buy", function() {
            var e = t.attr("alt")
              , a = o.find(".select-way").attr("data-num");
            ia(e, a, t)
        }),
        e.find(".pay-qr-wrap").on("click", "#template_back", function() {
            a(".pay-qr-wrap").animate({
                opacity: "0",
                left: "100%"
            }, 600),
            a(".pay-template-wrap").animate({
                opacity: "1"
            }, 600)
        }),
        e.find("#leftTplShow").on("click", ".previewTo", function() {
            var i = a(this).attr("id")
              , o = e.find("#imgMaterial").attr("src")
              , n = t.attr("data-pageNum")
              , r = parseInt(o.split("_thumb_")[1] || 0);
            "preToLeft" === i ? 0 == r ? r = n - 1 : r -= 1 : r == n - 1 ? r = 0 : r += 1,
            0 == r ? e.find("#imgMaterial").attr("src", o.split("_thumb")[0] + "_thumb") : e.find("#imgMaterial").attr("src", o.split("_thumb")[0] + "_thumb_" + r)
        });
        var n, r;
        e.find(".scrollToBig").on("click", function() {
            var a, t = e.find("#imgMaterial").width(), i = e.find("#imgMaterial").height();
            return n = 0,
            r = 0,
            690 == t ? (afterToBigImgWidth = 600 * t / i,
            e.find("#imgMaterial").css({
                width: afterToBigImgWidth,
                height: "600px",
                left: "0",
                top: "0"
            }),
            e.find(".scrollToBig").hide(),
            void e.find("#scrollToSmall").show()) : 600 == i ? (a = 690 * i / t,
            e.find("#imgMaterial").css({
                width: "690px",
                height: a,
                top: "0",
                left: "0"
            }),
            e.find(".scrollToBig").hide(),
            void e.find("#scrollToSmall").show()) : void 0
        }),
        e.find("#scrollToSmall").on("click", function() {
            var t, i, o = a("#imgMaterial").width(), l = a("#imgMaterial").height();
            if (o > l) {
                i = 690 * l / o;
                var s = (600 - i) / 2;
                e.find("#imgMaterial").css({
                    top: s,
                    left: 0,
                    width: "690px",
                    height: i
                }),
                n = 0,
                r = s,
                e.find("#scrollToSmall").hide(),
                e.find(".scrollToBig").show()
            } else {
                t = 600 * o / l;
                var d = (690 - t) / 2;
                e.find("#imgMaterial").css({
                    top: "0",
                    left: d,
                    width: t,
                    height: "600px"
                }),
                n = d,
                r = 0,
                e.find("#scrollToSmall").hide(),
                e.find(".scrollToBig").show()
            }
        });
        var l, s, d = !1;
        e.find("#imgMaterial").mousedown(function(t) {
            return 0 != t.button ? !1 : (d = !0,
            l = t.pageX,
            s = t.pageY,
            void a(document).mousemove(function(a) {
                if (d) {
                    var t = a.pageX
                      , i = a.pageY
                      , o = t - l
                      , n = i - s;
                    e.find("#imgMaterial").css({
                        left: "+=" + o,
                        top: "+=" + n
                    }),
                    l = t,
                    s = i
                }
            }).mouseup(function() {
                d = !1,
                a(document).off("mousemove").off("mouseup")
            }))
        }),
        e.find(".share_wrap").on("click", ".heart_icon", function() {
            var e = t.attr("alt")
              , i = a(this);
            a.ajax(i.hasClass("active") ? {
                url: "/home/delUserTemplateCollection.do",
                type: "post",
                dataType: "json",
                data: {
                    templateId: e
                },
                success: function(e) {
                    e.result && i.removeClass("active")
                },
                error: function() {
                    console.log("取消收藏 error!")
                }
            } : {
                url: "/home/addUserTemplateCollection.do",
                type: "POST",
                dataType: "json",
                data: {
                    templateId: e
                },
                success: function(e) {
                    e.result ? i.addClass("active") : (c.back({
                        str: "模版收藏失败！",
                        kind: "warning"
                    }),
                    console.log("收藏失败 code:" + e.code))
                },
                error: function() {
                    console.log("收藏失败 error")
                }
            })
        })
    }
    function ia(e, t, i) {
        var o = {
            t: e,
            pt: t
        };
        0 == t && (o.ub = 1,
        o.pt = 1),
        a.ajax({
            url: "/pay/getDesignTplPayUrl.do",
            dataType: "json",
            type: "POST",
            data: o,
            success: function(e) {
                var o = e.code;
                0 == t && 2 == o ? (i.attr("data-own", "true"),
                oa(i)) : 1 == o ? 1 == t ? (a("#template_buy_alipay").removeClass("no-click").attr("href", e.payUrl),
                window.GET_PAY_STATE_CLOCK = setTimeout(function() {
                    na(e.bill_serial_no, t, i)
                }, 5e3)) : 2 == t && (a(".pay-qr-wrap").find(".qr-img").empty().qrcode({
                    width: 120,
                    height: 120,
                    correctLevel: 0,
                    text: e.payUrl
                }),
                a(".pay-template-wra").animate({
                    opacity: "0"
                }, 600),
                a(".pay-qr-wrap").animate({
                    opacity: "1",
                    left: "0%"
                }, 600),
                window.GET_PAY_STATE_CLOCK = setTimeout(function() {
                    na(e.bill_serial_no, t, i)
                }, 5e3)) : -2 == o ? (a(".closeBtnCross").click(),
                d.show()) : -5 == o ? c.back({
                    str: "您已购买过此模板，不能重复购买！",
                    kind: "warning"
                }) : (c.back({
                    str: "获取支付链接错误！",
                    kind: "warning"
                }),
                console.log("获取支付链接错误！ code:" + o))
            },
            error: function() {
                c.back({
                    str: "获取支付链接错误！",
                    kind: "warning"
                })
            }
        })
    }
    function oa(e) {
        a.ajax({
            url: "/user/getUserInfo.do",
            dataType: "json",
            type: "GET",
            success: function(t) {
                window.USERINFO.vmAmount = t.userInfo.vmAmount,
                t.userInfo.vmAmount = t.userInfo.vmAmount / 100,
                a(".pay-success-wrap").find(".userBalance").text(t.userInfo.vmAmount),
                a(".pay-template-wra, .pay-qr-wrap").animate({
                    opacity: "0"
                }, 600),
                a(".pay-success-wrap").animate({
                    opacity: "1",
                    left: "0%"
                }, 600).find("#template_use").click(function() {
                    c.dialogHide(),
                    e.click()
                })
            },
            error: function() {
                console.log("请求登录状态失败!")
            }
        })
    }
    function na(e, t, i) {
        window.GET_PAY_STATE_CLOCK && clearTimeout(window.GET_PAY_STATE_CLOCK),
        a.ajax({
            url: "/pay/getPayState.do",
            dataType: "json",
            type: "POST",
            data: {
                billSerialNo: e
            },
            success: function(a) {
                1 == a.code ? (i.attr("data-own", "true"),
                oa(i)) : window.GET_PAY_STATE_CLOCK = setTimeout(function() {
                    na(e, t, i)
                }, 3e3)
            },
            error: function() {
                console.log("error!")
            }
        })
    }
    function ra() {
        -324 === parseInt(a("#leftPanelWrap").css("left")) && (a("#leftPanelWrap").stop(),
        a("#leftPanelWrap").css({
            left: "0px"
        }))
    }
    function la(e) {
        var a = null;
        if ("string" != typeof e)
            return a;
        var t = JSON.parse(e);
        if ("1.0.0" === t.v || "1.0.2" === t.v)
            return JSON.stringify(t);
        var i = {};
        i.title = t.title;
        var o = new Array;
        i.pages = o;
        var n = t.pages;
        if (null == n || void 0 == n || "object" != typeof n)
            return a = JSON.stringify(i);
        var r = null
          , l = null;
        for (var s in n) {
            r = n[s];
            var d = {
                elems: []
            };
            if (o.push(d),
            d.width = r.width,
            d.height = r.height,
            l = r.elements,
            null != l && void 0 != l && "object" == typeof l)
                for (var c in l) {
                    var p = sa(l[c]);
                    null != p && void 0 != p && d.elems.push(p)
                }
        }
        return a = JSON.stringify(i)
    }
    function sa(e) {
        var a = null;
        return null == e || void 0 == e || "object" != typeof e ? a : ("text" == e.type ? a = da(e) : "svg" == e.type ? a = ca(e) : ("img" == e.type || "background" == e.type) && (a = pa(e)),
        a)
    }
    function da(e) {
        var a = {
            "data-elem": {}
        }
          , t = e.width
          , i = e.height
          , o = e.top
          , n = e.left
          , r = e.scale
          , l = (e.rotateX,
        e.rotateY,
        parseInt(e.rotate_x))
          , s = parseInt(e.rotate_y)
          , d = e.fontSize[0];
        o += d;
        var c = e.fillColors[0]
          , p = e.fontFamily[0]
          , f = 1 == parseInt(e.italic)
          , u = e.opacity
          , h = 100 * parseFloat(e.fontLetter[0]) + ""
          , g = e.fontPosition[0];
        "end" == g ? (g = "right",
        n -= t) : "middle" == g ? (g = "center",
        n -= t / 2) : g = "left";
        var m = "";
        180 == l && 180 == s ? m = "matrix(-1,0,0,-1,0,0)translate(-" + e.width + ",-" + e.height + ")" : 180 == l ? m = "matrix(-1,0,0,1,0,0)translate(-" + e.width + ",0)" : 180 == s && (m = "matrix(1,0,0,-1,0,0)translate(0,-" + e.height + ")"),
        a.reverse = m;
        var _ = ""
          , w = e.content;
        if ("object" == typeof e)
            for (var v in w)
                _ += w[v] + "\n";
        return _ = _.substring(0, _.length - 1),
        a["data-type"] = "text",
        a.transform = "translate(" + n + "," + o + ")rotate(" + r + ")",
        a.html = _,
        a["data-elem"]["font-size"] = d,
        a["data-elem"].fill = c,
        a["data-elem"]["font-family"] = p,
        a["data-elem"]["data-italic"] = f + "",
        a["data-elem"].opacity = u,
        a["data-elem"]["data-align"] = g,
        a["data-elem"].wspace = h,
        a["data-elem"].width = t,
        a["data-elem"].height = i,
        a
    }
    function ca(e) {
        var a = {
            "data-elem": {}
        };
        "object" == typeof e.fillColors && (a["data-elem"]["data-colors"] = e.fillColors),
        a["data-elem"].opacity = e.opacity;
        var t = e.top
          , i = e.left
          , o = e.scale
          , n = parseFloat(e.width) / 2
          , r = parseFloat(e.height) / 2;
        a.transform = "translate(" + i + "," + t + ")rotate(" + o + "," + n + "," + r + ")",
        a["data-elem"].width = e.width,
        a["data-elem"].height = e.height;
        var l = parseInt(e.rotate_x)
          , s = parseInt(e.rotate_y)
          , d = "";
        if (180 == l && 180 == s ? d = "matrix(-1,0,0,-1,0,0)translate(-" + e.width + ",-" + e.height + ")" : 180 == l ? d = "matrix(-1,0,0,1,0,0)translate(-" + e.width + ",0)" : 180 == s && (d = "matrix(1,0,0,-1,0,0)translate(0,-" + e.height + ")"),
        a.reverse = d,
        "object" == typeof e.transform) {
            var c = {}
              , p = null;
            for (var f in e.transform)
                p = e.transform[f],
                c[f] = "translate(" + p.translate_x + "," + p.translate_y + ")scale(" + p.scale_x + "," + p.scale_y + ")";
            a["data-elem"].vary = c
        }
        "object" == typeof e.viewbox && (a["data-elem"].viewBox = e.viewbox.x + " " + e.viewbox.y + " " + e.viewbox.width + " " + e.viewbox.height),
        a["data-img-kind"] = e.content_type,
        a["data-elem"].id = e.id,
        a["data-elem"]["data-key"] = e.img_key;
        var u = Object.keys(e.svgHref).length > 0;
        if (u) {
            a["data-type"] = "svgFrame";
            var h = {};
            for (var f in e.svgHref) {
                var g = {};
                g.x = e.svgHref[f].x,
                g.y = e.svgHref[f].y,
                g.width = e.svgHref[f].width,
                g.height = e.svgHref[f].height,
                g["data-img-key"] = e.svgHref[f].img_key,
                g["data-class"] = f,
                a["data-elem"].filter = e.svgHref[f].filter,
                h[f] = g
            }
            a["data-elem"]["data-xhref-imgs"] = h
        } else
            a["data-type"] = "svgImage";
        return a
    }
    function pa(e) {
        var a = {
            "data-elem": {}
        }
          , t = e.top
          , i = e.left
          , o = e.scale
          , n = parseFloat(e.width) / 2
          , r = parseFloat(e.height) / 2;
        a.transform = "translate(" + i + "," + t + ")rotate(" + o + "," + n + "," + r + ")",
        a["data-elem"].width = e.width,
        a["data-elem"].height = e.height,
        a["data-elem"].opacity = e.opacity,
        a["data-elem"].id = e.id,
        a["data-elem"]["data-key"] = e.img_key,
        a["data-img-kind"] = e.content_type,
        a["data-elem"].filter = e.filter;
        var l = parseInt(e.rotate_x)
          , s = parseInt(e.rotate_y)
          , d = "";
        if (180 == l && 180 == s ? d = "matrix(-1,0,0,-1,0,0)translate(-" + e.width + ",-" + e.height + ")" : 180 == l ? d = "matrix(-1,0,0,1,0,0)translate(-" + e.width + ",0)" : 180 == s && (d = "matrix(1,0,0,-1,0,0)translate(0,-" + e.height + ")"),
        a.reverse = d,
        null != e.backgroundColor && void 0 != e.backgroundColor) {
            var c = {};
            c[0] = e.backgroundColor,
            a["data-elem"]["data-colors"] = c,
            a["data-type"] = "background"
        } else
            a["data-type"] = "img";
        return a
    }
    function fa(e) {
        !window.ISVIP && window.TEAM_ID <= 0 ? (a(".folder-add").css("display", "none"),
        a(".move_materialfile").css("display", "none"),
        a(".vip_line").click(function() {
            t.addSomeMouseClick("左侧-上传会员入口")
        })) : a(".folder_wrap").find(".join_vip").css("display", "none"),
        (window.api || window.ziyun) && (a(".folder-add").css("display", "none"),
        a(".move_materialfile").css("display", "none"),
        a(".folder_wrap").find(".join_vip").css("display", "none")),
        a(".folder_wrap").on("click", ".folder-edit", function() {
            return a(this).parent().addClass("folder-click"),
            !1
        }),
        a(".folder_wrap").on("mouseleave", ".folder", function() {
            a(this).find(".folder-edit-wrap").removeClass("folder-click")
        }),
        a(".folder_wrap").on("click", ".folder", function() {
            ua.call(this, e)
        }),
        a(".folder_wrap").on("click", ".folder-add", function() {
            return t.addBugTrackClick("m3"),
            t.addSomeMouseClick("左侧-新建文件夹"),
            ha.call(this, e),
            !1
        }),
        a(".folder_wrap").on("click", ".folder-del", function() {
            return ba.call(this, e),
            !1
        }),
        a(".delete-materialFloder").on("click", ".materialFloder-cansel-but", function() {
            a(".delete-materialFloder").hide()
        }),
        a(".delete-materialFloder").on("click", ".materialFloder-delete-but", function(e) {
            ga.call(this, e),
            a(".delete-materialFloder").hide()
        }),
        a(".folder_wrap").on("click", ".folder-changeName", function() {
            return ma.call(this, e),
            !1
        }),
        a(".folder_wrap").on("blur", ".folder-text", function() {
            _a.call(this)
        }),
        a(".folder_wrap").on("click", ".folder-text", function() {
            return a(this).hasClass("folder-text-click") ? !1 : void 0
        }),
        a("#personMaterialWrap").on("click", ".upload_file_manger", function() {
            return t.addBugTrackClick("m2"),
            t.addSomeMouseClick("左侧-管理"),
            Ia.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".cancel_file_manger", function() {
            return xa.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".move_chooseMaterialLi", function() {
            return ka.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".move_chooseMaterialLi_click", function() {
            return ka.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".defalut_file", function() {
            return Ca.call(this, e),
            a(this).parent(".materialfile_list").hide(),
            !1
        }),
        a("#personMaterialWrap").on("click", ".manage_delete", function() {
            t.addSomeMouseClick("左侧-删除"),
            a(".manage_delete").addClass("click_manage_delete"),
            Sa.call(this, e)
        }),
        a("#leadingContent").on("click", ".sure_file_del", function() {
            Ca.call(this, e)
        }),
        a("#leadingContent").on("click", ".cansel_file_del", function() {
            a(".manage_delete").removeClass("click_manage_delete"),
            a(".file_tips_del").hide()
        }),
        a(".move_list").click(function() {
            return t.addSomeMouseClick("左侧-移动"),
            Ea.call(this, e),
            !1
        }),
        a("#leadingContent").on("click", function() {
            a(".materialfile_list").hide()
        })
    }
    function ua(e) {
        var i = a(this)
          , o = i.attr("data-id") || 0
          , n = a("#personMaterialWrap");
        1 == a(".folder_wrap").css("opacity") ? n.find("#uploader").css("display", "block") : "Worker" == t.getTeamRole() ? n.find("#uploader").css("display", "none") : n.find("#uploader").css("display", "block"),
        a("#filePicker").attr({
            "data-id": o
        }),
        a(".folder").css("margin-top", "15px");
        var r = a("#leadingMaterialWrap");
        if (a(".folderClick").size() > 0)
            return n.css({
                top: 0,
                display: "none"
            }),
            r.css("height", "100px"),
            r.children(".chooseMaterialLi").detach(),
            a(".folderClick").removeClass("folderClick"),
            a(".cancel_file_manger").hasClass("file_click") && a(".cancel_file_manger").click(),
            !1;
        if (a(".folderClick").removeClass("folderClick"),
        i.addClass("folderClick"),
        i.hasClass("folder-add"))
            return i.removeClass("folderClick"),
            !1;
        va.call(this, e);
        var l;
        l = a(1 == a(".folder_wrap").css("opacity") ? ".folder_wrap" : ".team_folder_wrap");
        var s = l.children(".folder").index(this)
          , d = i.offset().top + i.getHeight() + 20 - a(".folder_wrap").offset().top + 60;
        Wa = a(".folder_wrap")[0].getBoundingClientRect().bottom,
        ja = n[0].getBoundingClientRect().bottom;
        var c = Wa - ja + 20
          , p = r.getHeight() + 100;
        a(".host_height").css({
            height: c
        }),
        window.TEAM_ID > 0 && (d += 64,
        p += 64),
        n.css({
            top: d,
            display: "block"
        });
        for (var f = s + 3 - s % 3, u = f + 3; u > f; f++) {
            var h = l.children(".folder").eq(f);
            h.css("margin-top", p)
        }
        return !1
    }
    function ha() {
        var e, t = a(this), i = t.children(".folder-text").text();
        window.TEAM_ID > 0 ? (e = {
            folder_name: i,
            tid: window.TEAM_ID
        },
        e.type = 1 == a(".folder_wrap").css("opacity") ? 0 : 1) : e = {
            folder_name: i
        },
        a.ajax({
            url: "/material/makeFolder.do",
            type: "POST",
            dataType: "json",
            data: e,
            success: function(t) {
                if (1 == t.code) {
                    var o = '<li class="folder folder-new" data-id="' + t.folderId + '"><span class="folder-img"></span><input class="folder-text" readonly="readonly" value="' + i + '"></input><span class="folder-edit-wrap"><span class="folder-btn folder-edit" title="设置"></span><span class="folder-btn folder-changeName" title="修改文件名" ></span><span class="folder-btn folder-del" title="删除"></span></span></li>';
                    1 === e.type ? (a(".team_folder_wrap").find(".folder-add").before(o),
                    Ka()) : (a(".folder_wrap").find(".folder-add").before(o),
                    Aa())
                }
            }
        })
    }
    function ga(e, t) {
        a(".folder_wrap").find(".folderClick").size() > 0 && a(".folder_wrap").find(".folderClick").click();
        var i;
        if (0 == a(this).attr("data-count"))
            var o = a(this).attr("data-id");
        else {
            var o = a(this).parents(".delete-materialFloder").attr("data-id");
            t = a(this).parents(".delete-materialFloder").attr("team-drag")
        }
        1 == t || "true" == t ? (i = {
            fid: o,
            tid: window.TEAM_ID
        },
        t = !0) : (i = {
            fid: o
        },
        t = !1),
        a.ajax({
            url: "/material/delMaterialFolder.do",
            dataType: "json",
            type: "POST",
            data: i,
            success: function() {
                a(".folder-new").detach(),
                t ? Ka() : Aa()
            }
        })
    }
    function ma() {
        var e = a(this)
          , t = e.parents(".folder-edit-wrap").siblings(".folder-text");
        t.addClass("folder-text-click"),
        t.select(),
        t.removeAttr("readonly")
    }
    function _a(e) {
        var t = a(this);
        t.removeClass("folder-text-click"),
        t.attr("readonly", "readonly"),
        wa(t, e)
    }
    function wa(e, t) {
        var i, o = e.val(), n = e.parents(".folder").attr("data-id");
        i = t ? {
            folder_id: n,
            folder_name: o,
            tid: window.TEAM_ID
        } : {
            folder_id: n,
            folder_name: o
        },
        a.ajax({
            url: "/material/renameMaterialFolder.do",
            type: "POST",
            dataType: "json",
            data: i,
            success: function(e) {
                1 == e.code ? Aa(!0) : alert("更改异常")
            }
        })
    }
    function va(e) {
        function t() {
            var e, t = a("#personMaterialWrap");
            e = a(1 == a(".folder_wrap").css("opacity") ? ".folder_wrap" : ".team_folder_wrap");
            var o = e.children(".folder").index(a(".folderClick"))
              , n = i.offset().top + i.getHeight() + 20 - a(".folder_wrap").offset().top + 60;
            Wa = a(".folder_wrap")[0].getBoundingClientRect().bottom,
            ja = t[0].getBoundingClientRect().bottom;
            var r = Wa - ja + 20
              , l = a("#leadingMaterialWrap")
              , s = l.getHeight() + 100;
            window.TEAM_ID > 0 && (n += 64,
            s += 64),
            a(".host_height").css({
                height: r
            }),
            t.css({
                top: n,
                display: "block"
            });
            for (var d = o + 3 - o % 3, c = d + 3; c > d; d++) {
                var p = e.children(".folder").eq(d);
                p.css("margin-top", s)
            }
        }
        var i = a(this)
          , o = i.attr("data-id") || 0;
        a(".leadingMaterialWrap").children().detach();
        var n;
        n = 1 == a(".folder_wrap").css("opacity") ? {
            pageNo: 1,
            pageSize: l.MATERIAL_PAGE_SIZE,
            fid: o,
            w: 180
        } : {
            pageNo: 1,
            pageSize: l.MATERIAL_PAGE_SIZE,
            fid: o,
            tid: window.TEAM_ID,
            w: 180
        };
        var r = "leadingMaterialWrap";
        e.queryMaterialPersonal(e._ajax_url.queryMaterialsInFolder, n, [0, 0, 0], r, t)
    }
    function ka() {
        if (a(this).hasClass("move_chooseMaterialLi"))
            a(this).removeClass("move_chooseMaterialLi"),
            a(this).addClass("move_chooseMaterialLi_click"),
            a(".manage_delete").addClass("selected_manage_delete");
        else {
            a(this).addClass("move_chooseMaterialLi"),
            a(this).removeClass("move_chooseMaterialLi_click");
            var e = a(".move_chooseMaterialLi_click");
            0 == e.length && a(".manage_delete").removeClass("selected_manage_delete")
        }
    }
    function ya() {
        if (Ba == [])
            a.ajax({
                url: "/material/getMaterialFolders.do",
                type: "GET",
                dataType: "json",
                success: function(e) {
                    var t = e.folderList.length;
                    Ba = e.folderList;
                    var i = '<li class="defalut_file" data-id="0">默认上传</li>';
                    a(".materialfile_list").append(i);
                    for (var o = 0; t > o; o++) {
                        var n = e.folderList[o]
                          , i = '<li class="defalut_file" data-id="' + n.folderId + '" title="' + n.folderName + '">' + n.folderName + "</li>";
                        a(".materialfile_list").append(i)
                    }
                }
            });
        else {
            var e = Ba.length
              , t = '<li class="defalut_file" data-id="0">默认上传</li>';
            a(".materialfile_list").append(t);
            for (var i = 0; e > i; i++) {
                var o = Ba[i]
                  , t = '<li class="defalut_file" data-id="' + o.folderId + '" title="' + o.folderName + '">' + o.folderName + "</li>";
                a(".materialfile_list").append(t)
            }
        }
    }
    function Ca(e) {
        for (var t = a(this).attr("data-id"), i = a(this).attr("team-id"), o = a(".move_chooseMaterialLi_click"), n = [], r = 0; r < o.size(); r++)
            n[r] = o.eq(r).attr("data-id");
        a(".manage_delete").hasClass("click_manage_delete") ? (a(".manage_delete").removeClass("click_manage_delete"),
        Ma(e, n),
        a(".file_tips_del").hide()) : Ta(e, n, t, i)
    }
    function Ta(e, t, i, o) {
        for (var n = [], r = 0; r < t.length; r++)
            n.push(t[r]);
        var s;
        s = o ? {
            m_ids: n.join(","),
            nfid: i,
            tid: o
        } : {
            m_ids: n.join(","),
            nfid: i
        },
        a.ajax({
            url: "/material/moveMaterials.do",
            dataType: "json",
            type: "POST",
            data: s,
            success: function() {
                a("#leadingMaterialWrap").children().detach();
                var t = {
                    pageNo: 1,
                    pageSize: l.MATERIAL_PAGE_SIZE,
                    fid: a(".folderClick").attr("data-id"),
                    w: 180
                };
                2 == a("#folderKindWrap").attr("data-drag") && (t.tid = window.TEAM_ID);
                var i = "leadingMaterialWrap";
                e.queryMaterialPersonal(e._ajax_url.queryMaterialsInFolder, t, [0, 0, 0], i)
            }
        })
    }
    function Ma(e, t) {
        for (var i = "", o = 0; o < t.length; o++)
            i = i + t[o] + ",";
        var n = {
            m_ids: i,
            fid: a(".folderClick").attr("data-id") || 0
        };
        2 == a("#folderKindWrap").attr("data-drag") && (n.tid = window.TEAM_ID),
        a.ajax({
            url: "/material/delMaterials.do",
            dataType: "json",
            type: "POST",
            data: n,
            success: function() {
                a(".leadingMaterialWrap").children().detach();
                var t = {
                    pageNo: 1,
                    pageSize: l.MATERIAL_PAGE_SIZE,
                    fid: a(".folderClick").attr("data-id"),
                    w: 180
                };
                2 == a("#folderKindWrap").attr("data-drag") && (t.tid = window.TEAM_ID);
                var i = "leadingMaterialWrap";
                e.queryMaterialPersonal(e._ajax_url.queryMaterialsInFolder, t, [0, 0, 0], i)
            }
        })
    }
    function Ia() {
        a(".cancel_file_manger").show(),
        a(".upload_file_manger").hide(),
        a(".manage_delete").show(),
        window.ISVIP && a(".move_materialfile").show(),
        a(".cancel_file_manger").addClass("file_click"),
        a(".leadingMaterialWrap").find(".chooseMaterialLi").addClass("move_chooseMaterialLi")
    }
    function xa() {
        a(".upload_file_manger").show(),
        a(".manage_delete").hide(),
        a(".cancel_file_manger").hide(),
        a(".move_materialfile").hide(),
        a(".cancel_file_manger").removeClass("file_click"),
        a(".leadingMaterialWrap").find(".imgMaterial").removeClass("move_chooseMaterialLi_click"),
        a(".leadingMaterialWrap").find(".imgMaterial").removeClass("move_chooseMaterialLi"),
        a(".manage_delete").removeClass("selected_manage_delete")
    }
    function Sa(e, t) {
        if (a(this).hasClass("selected_manage_delete")) {
            var i = t || window.event
              , o = document.documentElement.scrollLeft || document.body.scrollLeft
              , n = document.documentElement.scrollTop || document.body.scrollTop
              , r = i.pageX || i.clientX + o
              , l = i.pageY || i.clientY + n
              , s = l - 40 + "px"
              , d = r - 40 + "px";
            a(".file_tips_del").css({
                top: s,
                left: d
            }).show()
        } else
            a(".file_tips_del").hide()
    }
    function ba(e, t, i) {
        if (0 == a(this).attr("data-count"))
            ga.call(this, e, i);
        else {
            var o = a(this).attr("data-id");
            if (a(".delete-materialFloder").attr({
                "data-id": o
            }),
            a(".delete-materialFloder").attr(i ? {
                "team-drag": "true"
            } : {
                "team-drag": "false"
            }),
            "none" == a(".delete-materialFloder").css("display")) {
                var n = t || window.event
                  , r = document.documentElement.scrollLeft || document.body.scrollLeft
                  , l = document.documentElement.scrollTop || document.body.scrollTop
                  , s = n.pageX || n.clientX + r
                  , d = n.pageY || n.clientY + l
                  , c = d - 20 + "px"
                  , p = s - 20 + "px";
                a(".delete-materialFloder").css({
                    top: c,
                    left: p
                }).show()
            } else
                a(".delete-materialFloder").hide()
        }
    }
    function Ea() {
        "none" == a(".materialfile_list").css("display") ? (a(".materialfile_list").children().detach(),
        a(".materialfile_list").show(),
        ya()) : a(".materialfile_list").hide()
    }
    function Aa(e) {
        a.ajax({
            url: "/material/getMaterialFolders.do",
            dataType: "json",
            type: "POST",
            success: function(t) {
                Ba = null == t.folderList ? [] : t.folderList,
                e || (a(".folder_wrap").find(".folder-new").detach(),
                Da())
            }
        })
    }
    function Da() {
        if (0 == Ba.length)
            ;
        else
            for (var e = Ba.length, t = 0; e > t; t++) {
                var i = Ba[t]
                  , o = '<li class="folder folder-new" data-id="' + i.folderId + '"><span class="folder-img"></span><input class="folder-text" readonly="readonly" value="' + i.folderName + '"></iput><span class="folder-edit-wrap"><span class="folder-btn folder-edit"  title="设置"></span><span class="folder-btn folder-changeName" title="修改文件名"></span><span class="folder-btn folder-del" data-count="' + i.materialCounts + '" data-id="' + i.folderId + '" title="删除"></span></span></li>';
                a(".folder_wrap").find(".folder-add").before(o)
            }
    }
    function Pa(e) {
        "Worker" == t.getTeamRole() && a(".team_folder_wrap").find(".folder-add").css("display", "none"),
        a(".team_folder_wrap").on("click", ".folder-edit", function() {
            return a(this).parent().addClass("folder-click"),
            !1
        }),
        a(".team_folder_wrap").on("mouseleave", ".folder", function() {
            a(this).find(".folder-edit-wrap").removeClass("folder-click")
        }),
        a(".team_folder_wrap").on("click", ".folder", function() {
            ua.call(this, e)
        }),
        a(".team_folder_wrap").on("click", ".folder-add", function() {
            return ha.call(this, e),
            !1
        }),
        a(".team_folder_wrap").on("click", ".folder-del", function(a) {
            return ba.call(this, e, a, !0),
            !1
        }),
        a(".team_folder_wrap").on("click", ".folder-changeName", function() {
            return ma.call(this, e),
            !1
        }),
        a(".team_folder_wrap").on("blur", ".folder-text", function() {
            _a.call(this, !0)
        }),
        a(".team_folder_wrap").on("click", ".folder-text", function() {
            return a(this).hasClass("folder-text-click") ? !1 : void 0
        }),
        a(".move_list").click(function(a) {
            return t.addSomeMouseClick("左侧-移动"),
            Ea.call(this, e),
            a.stopPropagation(),
            !1
        })
    }
    function Ka(e) {
        a.ajax({
            url: "/material/getMaterialFolders.do",
            dataType: "json",
            type: "POST",
            data: {
                tid: window.TEAM_ID
            },
            success: function(t) {
                Fa = null == t.folderList ? [] : t.folderList,
                e || (a(".team_folder_wrap").find(".folder-new").detach(),
                La())
            }
        })
    }
    function La() {
        if (0 == Fa.length)
            ;
        else
            for (var e, i, o = Fa.length, n = "", r = t.getTeamRole(), l = 0; o > l; l++)
                e = Fa[l],
                "Worker" != r && (n = '<span class="folder-edit-wrap"><span class="folder-btn folder-edit"  title="设置"></span><span class="folder-btn folder-changeName" title="修改文件名"></span><span class="folder-btn folder-del" data-count="' + e.materialCounts + '" data-id="' + e.folderId + '" title="删除"></span></span>'),
                i = '<li class="folder folder-new" data-id="' + e.folderId + '"><span class="folder-img"></span><input class="folder-text" readonly="readonly" value="' + e.folderName + '"></iput>' + n + "</li>",
                a(".team_folder_wrap").find(".folder-add").before(i)
    }
    function Na() {
        a.ajax({
            url: "/material/getCollectedMaterialIdsCache.do",
            dataType: "json",
            type: "POST",
            success: function(e) {
                "" == e.collectedMaterialIds ? window.colledMaterial = [] : "undefined" != typeof e.collectedMaterialIds && (window.colledMaterial = e.collectedMaterialIds.split(","))
            },
            error: function() {}
        })
    }
    var Oa = {
        _owner_design: null,
        _kind_click_drag: !1,
        _query_ajax: null,
        _query_ajax_personal: null,
        _template_ajax: null,
        _material_kind: [],
        _chinese_content: "",
        _copy_ele: null,
        _key_down_drag: !1,
        _ajax_url: {
            queryMyMaterial: "/material/getMaterialsInSpecFolder.do",
            queryMaterialsInFolder: "/material/getMaterialsInFolder.do",
            queryMaterial: "/material/searchAllMaterialsByKind.do",
            searchMaterial: "/material/queryMaterialsByWord.do",
            queryCollMaterial: "/material/getUserCollectedMaterial.do"
        },
        _background_drag: !1,
        domOnloadSet: function(e) {
            return this._owner_design = e,
            this
        },
        materialKindOnload: function() {
            var e = this;
            return a.ajax({
                url: "/material/getAllMaterialKind.do",
                type: "POST",
                dataType: "json",
                error: function() {
                    console.log("返回素材分类列表错误")
                },
                success: function(t) {
                    e._material_kind = t.list;
                    var i, o, t = t.list, n = {
                        isColl: !0,
                        firstKindId: -1,
                        firstKindName: "我的素材",
                        imgUrl: "/img/static/colledmaterialkind.png",
                        lsQueryMaterialKindBean: [{
                            kindId: 1,
                            kindTitle: "图片"
                        }, {
                            kindId: 2,
                            kindTitle: "矢量"
                        }]
                    };
                    t.unshift(n);
                    for (var r = t.length, l = 0; r > l; l++)
                        i = t[l],
                        o = '<li class="materialKind" data-name="' + i.firstKindName + '" data-kind="' + i.firstKindId + '" style="width:80px;height:92px"><span class="materialKindOpacity1"></span><span class="materialKindOpacity2"></span><span class="materialKindIcon"><img width="100%" src="' + i.imgUrl + '" alt=""></span><span class="materialKindText">' + i.firstKindName + "</span></li>",
                        a("#materialKindList").append(o)
                }
            }),
            this
        },
        _saveToJson: [],
        _saveJsonAttr: [],
        _save_drag: "saved",
        _save_timer: null,
        set saveJsonAttr(e) {
            window.DESIGN_CHANGE_DRAG = !0;
            var t = this
              , i = e.data
              , o = e.obj
              , n = i.cont[0]
              , r = this._saveJsonAttr
              , l = r.length;
            if (l > 0 && r[l - 1].obj == o && r[l - 1].data.loc == i.loc) {
                var s = r[l - 1].data
                  , d = s.cont;
                if (3 == n.type && void 0 == d[0].tidx)
                    r.pop();
                else if (3 != n.type && void 0 == d[0].tidx && void 0 == n.tidx) {
                    for (var c = d.length, p = 0; c > p; p++)
                        if (d[p].key == n.key) {
                            d[p].val = n.val;
                            break
                        }
                    p == c && d.push(n)
                } else
                    d.push(n)
            } else
                l > 0 && r[l - 1].data.loc == i.loc && r[l - 1].data.cont[0].val && "background" === r[l - 1].data.cont[0].val["data-type"] && r[l - 1].data.cont[0].val["data-type"] === i.cont[0].val["data-type"] && "0" === r[l - 1].data.cont[0].key && r[l - 1].data.cont[0].key === i.cont[0].key ? r[l - 1].data.cont[0] = i.cont[0] : i.unshift ? r.unshift(e) : r.push(e);
            clearTimeout(t._save_timer),
            t._save_timer = setTimeout(function() {
                t.saveDesign()
            }, 4e3),
            "saved" == t._save_drag && (t._save_drag = "will saved"),
            a("#designTitle").find(".save-time").text("正在保存......"),
            a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .print-design").addClass("design-no-click"),
            (window.api || window.ziyun) && a(".download-design").addClass("design-no-click")
        },
        get saveJsonAttr() {
            for (var e = [], a = this._saveJsonAttr, t = a.length, i = 0; t > i; i++)
                e.push(a[i].data);
            return e
        },
        saveTemplate: function() {
            var e = new FormData
              , i = this
              , o = window.design_json;
            e.append("json", JSON.stringify(o)),
            e.append("k", KIND_ID),
            e.append("d", DESIGN_ID),
            e.append("kt", KIND_TITLE),
            e.append("ow", window.DESIGN_ORIGINAL_WIDTH),
            e.append("oh", window.DESIGN_ORIGINAL_HEIGHT),
            e.append("sec", DESIGN_SEC),
            e.append("dt", a(".design_title").children().val());
            var n = function() {
                return null == IS_ET ? 0 : IS_ET
            }();
            null != TEMPLATE_ID ? e.append("t", TEMPLATE_ID) : null != TEAM_TEMPLATE_ID && e.append("tt", TEAM_TEMPLATE_ID),
            window.TEAM_ID > 0 && e.append("tid", window.TEAM_ID),
            e.append("et", n),
            e.append("mp", window.MAX_PAGE),
            a.ajax({
                url: "/design/saveDesignV2.do",
                type: "POST",
                dataType: "json",
                data: e,
                cache: !1,
                contentType: !1,
                processData: !1,
                error: function() {
                    t.addSomeMouseClick("设计-保存失败"),
                    alert("设计保存失败，请尝试刷新当前页面。您还可以加入创客贴qq服务群，群号133818453（已满），538351505。")
                },
                success: function() {
                    window.saveTemplate = !0,
                    i.saveDesign();
                    var e = i._owner_design;
                    e._owner_pageList.savePageThumb()
                }
            })
        },
        saveDesign: function(e) {
            if (window.saveTemplate) {
                var t = this
                  , i = "/design/saveDesignV4.do";
                void 0 != window.DESIGNER_MAKE_TEMPLATE && (i = "/templaterepository/saveDesign.do");
                var o = a("#designTitle").find(".save-time");
                if (0 == t._saveJsonAttr.length) {
                    o.text("保存成功！");
                    {
                        setTimeout(function() {
                            var e = new Date
                              , a = e.getMinutes();
                            10 > a && (a = "0" + a),
                            o.text("今天" + e.getHours() + ":" + a + "更新")
                        }, 500)
                    }
                    return void (e && c.back({
                        str: '成功保存设计到<a href="/designmanage" target="_blank" style="color: #07aefc">设计管理</a>',
                        kind: "success"
                    }))
                }
                if (window.ISLOGIN) {
                    if ("saving" == t._save_drag)
                        return;
                    a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .print-design").addClass("design-no-click"),
                    t._save_drag = "saving";
                    var n = p.getDownload().find(".sure_download")
                      , r = p.getShareTitle().find(".publick_share_button");
                    n.addClass("not-download"),
                    r.addClass("not-share");
                    var l = this.saveJsonAttr;
                    this._saveToJson = this._saveJsonAttr,
                    this._saveJsonAttr = [];
                    var s = new FormData;
                    if (0 == l.length) {
                        t._save_drag = "saved",
                        n.removeClass("not-download"),
                        r.removeClass("not-share"),
                        a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .design_size_move, .design_change_sence, .print-design").removeClass("design-no-click"),
                        (window.api || window.ziyun) && a(".download-design").removeClass("design-no-click"),
                        o.text("保存成功！");
                        {
                            setTimeout(function() {
                                var e = new Date
                                  , a = e.getMinutes();
                                10 > a && (a = "0" + a),
                                o.text("今天" + e.getHours() + ":" + a + "更新")
                            }, 500)
                        }
                        return
                    }
                    s.append("eJson", JSON.stringify(l)),
                    s.append("k", KIND_ID),
                    s.append("d", DESIGN_ID),
                    s.append("kt", KIND_TITLE),
                    s.append("ow", window.DESIGN_ORIGINAL_WIDTH),
                    s.append("oh", window.DESIGN_ORIGINAL_HEIGHT),
                    s.append("sec", DESIGN_SEC),
                    s.append("dt", a(".design_title").children().val()),
                    s.append("third_kind_id", window.THIRD_KIND_ID);
                    var d = function() {
                        return null == IS_ET ? 0 : IS_ET
                    }();
                    s.append("et", d),
                    s.append("mp", window.MAX_PAGE),
                    null != TEMPLATE_ID ? s.append("t", TEMPLATE_ID) : null != TEAM_TEMPLATE_ID && s.append("tt", TEAM_TEMPLATE_ID),
                    window.TEAM_ID > 0 && s.append("tid", window.TEAM_ID),
                    window.COOPERATE_DESIGN && s.append("c", !0),
                    window.COOPERATE_STAMP > 0 && s.append("stamp", window.COOPERATE_STAMP),
                    window.PROMPTDSPK && s.append("dspk", window.PROMPTDSPK),
                    a.ajax({
                        url: i,
                        type: "POST",
                        dataType: "json",
                        data: s,
                        cache: !1,
                        contentType: !1,
                        processData: !1,
                        success: function(i) {
                            if ("-403" == i.code) {
                                var l = document.createElement("div");
                                l.className = "promptParent",
                                document.body.append(l);
                                var s = document.createElement("div");
                                s.className = "promptContent",
                                s.innerHTML = '<div class="promptContent-header">此设计被多次打开</div><div class="promptContent-Content">您在其他标签页面正编辑此设计</div><div class="promptContent-Content">如果希望编辑设计</div><div class="promptContent-Content">请关闭其他重复的页面并刷新此页面</div><div class="promptContent-footer">立即刷新</div>',
                                document.body.append(s);
                                var d = document.querySelector(".promptContent-footer");
                                d.addEventListener("click", function() {
                                    location.reload()
                                }, !1)
                            }
                            if (window.SAVE_TIME > 2 && a(".pop-mod-prompt-container").remove(),
                            window.SAVE_TIME = 0,
                            "-4" == i.code)
                                return window.isLoginOut = !0,
                                window.modPrompt.show(2),
                                void setTimeout(function() {
                                    location.href = "/startdesign"
                                }, 2500);
                            if (("-1" == i.code || "-101" == i.code || "-102" == i.code || "-104" == i.cde) && window.modPrompt.show(0),
                            "-106" == i.code) {
                                console.log("-106该设计已被放入回收站"),
                                t._saveJsonAttr.unshift(t._saveToJson);
                                var p = {
                                    str: "当前设计已经被移至回收站，请还原后再操作！" + i.code,
                                    yes: "还原",
                                    no: "稍后",
                                    again: !1,
                                    show_no: "hide",
                                    successfun: function() {
                                        window.location.href = "/md.html?action=recycle"
                                    }
                                };
                                return void c.confirm(p)
                            }
                            if ("-108" == i.code) {
                                console.log("-108该设计已被彻底删除"),
                                t._saveJsonAttr.unshift(t._saveToJson);
                                var p = {
                                    str: "当前设计已经被已被彻底删除！" + i.code,
                                    yes: "好的",
                                    no: "",
                                    again: !1,
                                    show_no: "hide",
                                    successfun: function() {
                                        window.location.href = "/startdesign"
                                    }
                                };
                                return void c.confirm(p)
                            }
                            if ("1" != i.code)
                                return console.log("保存失败，网络连接"),
                                void t._saveJsonAttr.unshift(t._saveToJson);
                            e && c.back({
                                str: '成功保存设计到<a href="/designmanage" style="color: #07aefc">设计管理</a>',
                                kind: "success"
                            }),
                            window.ISEXIST = !0;
                            var f;
                            clearTimeout(f),
                            t._save_drag = "saved",
                            n.removeClass("not-download"),
                            r.removeClass("not-share"),
                            a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .design_size_move, .design_change_sence, .print-design").removeClass("design-no-click"),
                            (window.api || window.ziyun) && a(".download-design").removeClass("design-no-click"),
                            o.text("保存成功！"),
                            f = setTimeout(function() {
                                var e = new Date
                                  , a = e.getMinutes();
                                10 > a && (a = "0" + a),
                                o.text("今天" + e.getHours() + ":" + a + "更新")
                            }, 500),
                            t._saveJsonAttr.length != [] && t.saveDesign(),
                            "" != i.error && void 0 != i.error && (alert("保存异常"),
                            location.href = "/startdesign")
                        },
                        error: function() {
                            console.log("保存失败，网络不可达"),
                            t._save_drag = "will save",
                            window.SAVE_TIME++;
                            for (var e = t._saveToJson.length - 1; e >= 0; e--)
                                t._saveJsonAttr.unshift(t._saveToJson[e]);
                            setTimeout(function() {
                                t.saveDesign()
                            }, 2e3),
                            3 === window.SAVE_TIME && window.modPrompt.show(1)
                        }
                    })
                }
            }
        },
        defineEveSet: function() {
            function i() {
                document.body.addEventListener("paste", function(e) {
                    {
                        var a = e.clipboardData
                          , i = N._owner_design
                          , o = i.getCurPage()
                          , n = i._focus_element;
                        i._owner_designEditbar,
                        i._owner_elementEditbar
                    }
                    if (null !== localStorage.getItem("eleJson")) {
                        if (null != n && "elementGroup" == n._element_type && n._text_ele_sum != n._text_ele_loaded)
                            return !1;
                        if (t.addBugTrackClick("e2"),
                        null != Z()) {
                            var r = Z()
                              , l = r.substr(0, 1);
                            if ("{" != l && (r = r.substr(1, r.length)),
                            /haogetedingzhiling/.test(r) && (r = r.split("haogetedingzhiling")),
                            window.MEMENTO_ID = t.now(),
                            r instanceof Array) {
                                var s = o.addEles(r, l);
                                s.nodeClick()
                            } else {
                                var s = o.eleCopyAndUndo({
                                    json: Z()
                                });
                                s.nodeClick()
                            }
                        }
                        return localStorage.removeItem("eleJson"),
                        !1
                    }
                    for (var d = [], c = 0, p = a.items.length; p > c; c++)
                        if ("file" == a.items[c].kind || a.items[c].type.indexOf("image") > -1) {
                            var f = a.items[c].getAsFile();
                            d.push(f),
                            e.preventDefault()
                        }
                    var h = u.algo.MD5.create()
                      , g = new FileReader;
                    g.readAsBinaryString(f),
                    g.onload = function(e) {
                        h.update(u.enc.Latin1.parse(e.target.result));
                        var a = h.finalize();
                        W.words[0] != a.words[0] && (W.words[0] = a.words[0],
                        N.uploadMaterialPersonal(d, !0))
                    }
                })
            }
            function n(e) {
                e.length < 7 && (e = "#" + e);
                {
                    var t = N._owner_design;
                    t.getCurPage()
                }
                if ("back" == a(".ss-function-colorPicker").attr("data-kind"))
                    J(e, Oa, !0),
                    N._background_drag = !0;
                else {
                    var i = a(".element-edit-bar").find(".ele-color").index(a(".element-edit-bar").find(".ele-color.now-click"))
                      , o = t._focus_element;
                    void 0 != o && o.previewColor(e, i),
                    a(".element-edit-bar").find(".ele-color").eq(i).children().css("background-color", e)
                }
            }
            function r(e, i) {
                function o(e, i) {
                    if (1 != i.code)
                        return a(".background-upload-proress-color").css("width", "150px"),
                        a(".background-upload-proress-color").css("background-color", "red"),
                        a(".background-upload-proress-text").html("上传失败！"),
                        void setTimeout(function() {
                            a(".background-upload-proress").css("display", "none"),
                            a(".background-upload-proress-color").css("background-color", "#F6F6F6")
                        }, 1e3);
                    window.backgroundupload = !1,
                    a(".background-upload-proress-color").css("width", "150px"),
                    a(".background-upload-proress-text").html("上传成功,设置背景...");
                    var o = {
                        "data-type": "background",
                        "data-img-kind": i.dt,
                        "data-elem": {
                            id: i.mid,
                            "data-key": void 0,
                            opacity: 1
                        }
                    }
                      , n = N._owner_design
                      , r = (n.pageScale,
                    n.getCurPage())
                      , l = r.width
                      , s = r.height
                      , d = i.w
                      , c = i.h
                      , i = o["data-elem"];
                    d / l > c / s ? (i.height = s,
                    i.width = s * (d / c)) : (i.width = l,
                    i.height = l * (c / d)),
                    o.transform = "translate(" + (l - i.width) / 2 + "," + (s - i.height) / 2 + ")",
                    window.MEMENTO_ID = t.now(),
                    r.eleDelAndUndo(r.elements[0]);
                    var p = r.createElementAndUndo({
                        json: o,
                        unshift: !0
                    });
                    setTimeout(function() {
                        a(".background-upload-proress").css("display", "none"),
                        p.nodeClick()
                    }, 500)
                }
                if (window.backgroundupload = !1,
                void 0 == window.result)
                    return o(e, i),
                    void window.backuploader.removeFile(e);
                var n = {
                    p: window.result.policy,
                    s: window.result.signature,
                    fid: 0
                };
                a.ajax({
                    url: "/material/reportUploadMaterial.do",
                    dataType: "json",
                    type: "POST",
                    data: n,
                    success: function(a) {
                        o(e, a),
                        window.backuploader.removeFile(e)
                    },
                    error: function() {
                        console.log("上报出错"),
                        window.backuploader.removeFile(e)
                    }
                })
            }
            function s(e) {
                e.stopPropagation(),
                e.preventDefault()
            }
            function d(e) {
                e.stopPropagation(),
                e.preventDefault()
            }
            function g(e) {
                e.stopPropagation(),
                e.preventDefault();
                for (var i = e.dataTransfer, o = i.files, n = [], r = 0; r < o.length; r++)
                    ("image/png" == o[r].type || "image/jpeg" == o[r].type || "image/gif" == o[r].type) && n.push(o[r]);
                window.USER_DROP_FILELIST = n,
                a("#leadingMenuBtn").hasClass("listBtnClick") ? a("#leadingContent").find(".folderClick").size() > 0 ? (window.USER_DROP_IMG = !1,
                N.uploadMaterialPersonal(window.USER_DROP_FILELIST)) : (window.USER_DROP_IMG = !0,
                a("#leadingContent").find(".folder_wrap").find(".folder-define").click(),
                window.fileOpenedupload = function() {
                    N.uploadMaterialPersonal(window.USER_DROP_FILELIST),
                    window.fileOpenedupload = t.noop
                }
                ) : (a("#leadingMenuBtn").click(),
                window.USER_DROP_IMG = !0,
                window.fileOpenedupload = function() {
                    N.uploadMaterialPersonal(window.USER_DROP_FILELIST),
                    window.fileOpenedupload = t.noop
                }
                )
            }
            var N = this;
            window.fileOpenedupload = t.noop,
            window.colledMaterial = [],
            Na(),
            m(),
            _(),
            a(".design_title input").focus(function() {
                t.addSomeMouseClick("上方-重命名")
            }),
            window.SAVE_TIME = 0,
            i();
            var W = {};
            W.words = [],
            a(".step-yes").click(function() {
                var e = a(this).attr("data-kind");
                switch (e) {
                case "1":
                    a(".first-step").css("display", "none"),
                    a(".first-o").css("display", "none"),
                    a(".second-step").css("display", "block");
                    break;
                case "2":
                    a(".second-step").css("display", "none"),
                    window.api ? a("#login-first").animate({
                        opacity: "0"
                    }, function() {
                        a("#login-first").css("display", "none"),
                        a.ajax({
                            url: "/user/guided.do",
                            dataType: "json",
                            type: "POST",
                            success: function() {},
                            error: function() {}
                        })
                    }) : a(".third-step").css("display", "block");
                    break;
                case "3":
                    a("#login-first").animate({
                        opacity: "0"
                    }, function() {
                        a("#login-first").css("display", "none"),
                        a.ajax({
                            url: "/user/guided.do",
                            dataType: "json",
                            type: "POST",
                            success: function() {},
                            error: function() {}
                        })
                    })
                }
            }),
            a(".step-skip").click(function() {
                a("#login-first").animate({
                    opacity: "0"
                }, function() {
                    a("#login-first").css("display", "none"),
                    a.ajax({
                        url: "/user/guided.do",
                        dataType: "json",
                        type: "POST",
                        success: function() {},
                        error: function() {}
                    })
                })
            }),
            a(".leftPanelMenuListBtn").click(function(e) {
                w.call(this, N, e)
            }),
            a("#leftPanel").find(".panelArrow").click(function() {
                v.call(this, N)
            }),
            a("#materialKindList").on("click", ".materialKind", function(e) {
                k.call(this, N, e)
            }),
            a("#materialWrap").on("click", ".go-to-upload", function(e) {
                return a("#leadingMenuBtn").click(),
                window.ISLOGIN ? (a("#filePicker").click(),
                !1) : void e.stopPropagation()
            }),
            127 == KIND_ID || 128 == KIND_ID ? (a("#templateMenuBtn").css("display", "none"),
            a("#materialMenuBtn").click()) : a("#templateMenuBtn").click(),
            a(".secondKindWrap").click(function() {
                var e = a(this)
                  , t = e.children("ul");
                "block" == t.css("display") ? t.css("display", "none") : t.css("display", "block");
                var i = e.find(".point-out-circle");
                if (i.length > 0) {
                    var i = i[0];
                    c.pointOutHide(i)
                }
            }),
            a("#secondKindUl").on("click", "li", function(e) {
                y.call(this, N, e),
                a(".secondKindWrap").click()
            }),
            a("#meterialSecondKindListWrap").on("click", ".secondKindList", function(e) {
                y.call(this, N, e)
            }),
            a("#meterialSecondKindListWrap").on("click", ".secondKindListMore", function() {
                a(this).hasClass("secondKindListMoreClick") ? T.call(this, N) : C.call(this, N)
            }),
            a("#materialup").click(function() {
                a("#materialContent").animate({
                    scrollTop: a(".materialKindClick").offset().top - a("#materialKindList").offset().top
                })
            });
            var F = {
                name: "design_page_search_materia",
                element: a("#searchKeyWord div")[0],
                position_left: 153,
                position_top: -1
            };
            c.pointOut(F),
            a("#searchMaterialup").click(function() {
                a("#searchContent").animate({
                    scrollTop: 0
                }),
                L()
            }),
            a("#leftPanelInput").mousedown(function() {
                a("#searchMenuBtn").click()
            }),
            a("#leftPanelInput").keyup(function(e) {
                13 == e.keyCode && (t.addBugTrackClick("h2"),
                A.call(this, N))
            }),
            a("#searchKeyWord").on("click", "li", function() {
                var e = a(this).attr("data-kind");
                a("#searchKeyWord").attr("data-type", e),
                A.call(this, N)
            }),
            a("#clear_search_material").click(function() {
                var e = a(this);
                D(),
                e.parent().find("#materialSearch").hide(),
                e.parent().find(".search_material_history_wrap").show(),
                e.prev().val(""),
                e.hide()
            }),
            a(".search_material_his_list").on("click", "li", function() {
                A.call(this, N)
            }),
            a("#materialSearch").on("mousedown", ".materialCollIcon", function(e) {
                return O.call(this, e),
                !1
            }),
            a("#materialSearch").on("mousedown", ".chooseMaterialLi", function(e) {
                P.call(this, N, e)
            }),
            a("#materialSearch").on("mousedown", ".materialInfoIcon", function(e) {
                K.call(this, e)
            }),
            a("#materialSearch").on("mousedown", ".materialInfoClose", function(e) {
                L.call(this, e)
            }),
            a("#materialSearch").on("mousedown", ".materialInfoWrap", function(e) {
                return e.stopPropagation(),
                !1
            }),
            a("#searchContent").scroll(function() {
                M.call(this, N)
            }),
            a("#materialContent").scroll(function() {
                I.call(this, N)
            }),
            a("#fontContent").scroll(function() {
                x.call(this, N)
            }),
            a("#backContent").scroll(function() {
                S.call(this, N)
            }),
            a("#leadingContent").scroll(function() {
                b.call(this, N)
            }),
            a("#templateContent").scroll(function() {
                E.call(this, N)
            }),
            a(".templateKindBtn").click(function() {
                $.call(this, N)
            }),
            a(".templateShow").on("click", ".templateLi", function() {
                t.addBugTrackClick("k1"),
                Q.call(this, N)
            }),
            a("#multipage_back").click(function() {
                ra.call(this, N)
            }),
            a("#multipageContent").on("click", ".multipageSon", function() {
                Q.call(this, N)
            }),
            a("#materialWrap").on("mousedown", ".chooseMaterialLi", function(e) {
                P.call(this, N, e)
            }),
            a("#materialWrap").on("mousedown", ".materialCollIcon", function(e) {
                a(this).parent().attr("data-id");
                return c.back(a(this).hasClass("colled") ? {
                    str: "已取消收藏",
                    kind: "success"
                } : {
                    str: "收藏成功,已添加至我的收藏",
                    kind: "success"
                }),
                O.call(this, e),
                !1
            }),
            a("#materialWrap").on("mousedown", ".materialInfoIcon", function(e) {
                K.call(this, e)
            }),
            a("#materialWrap").on("mousedown", ".materialInfoClose", function(e) {
                L.call(this, e)
            }),
            a("#materialWrap").on("mousedown", ".materialInfoWrap", function(e) {
                return e.stopPropagation(),
                !1
            }),
            a("#fontMaterialShow").on("mousedown", ".chooseMaterialLi", function(e) {
                P.call(this, N, e)
            }),
            a("#leadingMaterialWrap").on("mousedown", ".chooseMaterialLi", function(e) {
                P.call(this, N, e)
            }),
            a(".fontAddLi").click(function() {
                j.call(this, N);
                var e = a(this).attr("id");
                "fontAddh1" == e ? t.addSomeMouseClick("左侧-添加标题") : "fontAddh2" == e ? t.addSomeMouseClick("左侧-添加副标题") : "fontAddh3" == e && t.addSomeMouseClick("左侧-添加正文")
            }),
            window.TEAM_ID > 0 ? (a(".contentKindCommon").css("display", "block"),
            a(".fontKindBtn").click(function() {
                z.call(this, N)
            }),
            a("#teamfontAddUl").on("click", ".teamFontAddLi", function() {
                B.call(this, N)
            }),
            a(".backgroundColorBtn").click(function() {
                R.call(this, N)
            }),
            a("#backColorTeaminstall").on("click", ".edit-color-span", function(e) {
                H.call(this, N, e)
            }),
            a("#folderKindWrap").on("click", ".folderKindBtn", function() {
                G.call(this, N)
            }),
            a.ajax({
                url: "/team/getTeamBaseInfo.do",
                dataType: "json",
                type: "POST",
                data: {
                    tid: window.TEAM_ID
                },
                success: function(e) {
                    if (e.team) {
                        var t = e.team.colorValue
                          , i = a("#backColorTeaminstall");
                        if (t.length > 0) {
                            t = t.split(",");
                            var o;
                            i.empty();
                            for (var n = 0; n < t.length; n++)
                                o = '<div class="edit-color-span" style="background-color:' + t[n] + '" title="' + t[n] + '"></div>',
                                i.append(o)
                        } else
                            i.find("a").attr("href", "/team/setup.html?id=" + window.TEAM_ID)
                    }
                },
                error: function() {
                    console.log("获取团队色值失败！")
                }
            }),
            a.ajax({
                url: "/team/getTeamFonts.do",
                dataType: "json",
                type: "POST",
                data: {
                    tid: window.TEAM_ID
                },
                success: function(e) {
                    var t = e.fonts;
                    if (t) {
                        var i = a("#teamfontAddUl");
                        if (t.length > 0) {
                            var o;
                            i.empty();
                            for (var n = 0; n < t.length; n++)
                                o = '<li class="teamFontAddLi" data-size="' + t[n].fs + '" data-color="' + t[n].cv + '" data-family="' + t[n].fn + '" data-space="' + t[n].sl + '" data-style="' + t[n].s + '"><span>' + t[n].in + "</span></li>",
                                i.append(o)
                        } else
                            i.find("a").attr("href", "/team/setup.html?id=" + window.TEAM_ID)
                    }
                },
                error: function() {
                    console.log("获取团队色值失败！")
                }
            })) : a("#templateContentKind").css({
                display: "block",
                width: "164px",
                "margin-left": "76px"
            }).find(".templateKindBtn:eq(2)").css("display", "none"),
            a("#backImgChooseWrap").on("mousedown", ".chooseMaterialLi", function(e) {
                P.call(this, N, e)
            }),
            a("#backColorPreinstall").on("click", ".edit-color-span", function(e) {
                H.call(this, N, e)
            }),
            a("#rightPanel").on("mousewheel", function(e) {
                if ("block" != a("#edit-img-cutout").css("display") && "block" != a(".edit-div-clone").find("#edit-img-cutout").css("display") && !window.elementEditBarEnter) {
                    var t = e.originalEvent.deltaY
                      , i = N._owner_design
                      , o = i.pageScale
                      , n = i._scaleArea;
                    t > 0 ? (o -= n,
                    o < i._minPageScale && (o = i._minPageScale),
                    i.setPageScaleMouseWheel(o, e)) : (o += n,
                    o > i._maxPageScale && (o = i._maxPageScale),
                    i.setPageScaleMouseWheel(o, e));
                    var r = (i._owner_designEditbar,
                    i.getCurPage());
                    r.nodeMousedown(),
                    "true" == i.bleed && (clearTimeout(window.SET_PAGE_BLEED_CLOCK),
                    window.SET_PAGE_BLEED_CLOCK = setTimeout(function() {
                        r.showBleedBorder()
                    }, 200))
                }
            }),
            a("#rightPanel").find(".page-list-wrap").on("mousewheel", function(e) {
                e.stopPropagation()
            }),
            N.color_picker = new h,
            a(".edit-color-span-pickup").on("click", function() {
                t.addBugTrackClick("n4"),
                N.colorPickupShow(a(this))
            }),
            a(".ss-function-colorPicker").on("click", ".confirm", function() {
                var e = a(".ss-function-colorPicker .color-input").val();
                n(e),
                N.colorPickupHide(a(".edit-color-span-pickup.now-click"))
            }),
            a(".ss-function-colorPicker").on("click", ".cancel", function() {
                N.colorPickupHide(a(".edit-color-span-pickup.now-click"))
            }),
            N.color_picker.getColor(n),
            a(".edit-color-span-transparent").click(function() {
                return a(this).hasClass("edit-color-span-no-click") ? !1 : (t.addBugTrackClick("n2"),
                void (window.ISVIP || window.TEAM_ID > 0 ? N.backgroundTransparent() : f.show()))
            }),
            N.chartKindInit(N);
            var q;
            q = window.api ? e.APIDOMAIN + "/design/uploadMaterial.do?_dataType=json&api=1" : e.APIDOMAIN + "/design/uploadMaterial.do?_dataType=json",
            window.backuploader = o.create({
                auto: !0,
                withCredentials: !1,
                server: q,
                pick: {
                    id: "#background-upload",
                    label: "自定义背景",
                    multiple: !1
                },
                chunked: !1,
                accept: {
                    title: "Images",
                    extensions: "jpg,jpeg,bmp,png,gif",
                    mimeTypes: "image/png,image/jpg,image/jpeg"
                }
            }),
            window.backuploader.on("startUpload", function() {
                window.backgroundupload ? a(".background-upload-proress-text").html("图片上传中...") : this.stop()
            }),
            window.backuploader.on("fileQueued", function(e) {
                var t = 20971520;
                return e.size >= t ? void c.back({
                    str: "支持上传20M以下的图片！",
                    kind: "warning"
                }) : (a(".background-upload-proress").css("display", "block"),
                a(".background-upload-proress-color").width(0),
                a(".background-upload-proress-text").html("图片处理中..."),
                window.backuploader.md5File(e).progress(function() {}).then(function(t) {
                    if (e.size > 20971520)
                        return window.backuploader.stop(),
                        window.backuploader.removeFile(e),
                        a(".background-upload-proress-color").css("width", "150px"),
                        a(".background-upload-proress-color").css("background-color", "red"),
                        a(".background-upload-proress-text").html("图片不能超过20M"),
                        void setTimeout(function() {
                            a(".background-upload-proress").css("display", "none"),
                            a(".background-upload-proress-color").css("background-color", "#F6F6F6")
                        }, 1e3);
                    var i = new FormData;
                    i.append("md5", t),
                    i.append("file", e.source.source.slice(0, 10)),
                    i.append("fid", 0),
                    a.ajax({
                        url: "/material/preUploadMaterial.do",
                        dataType: "json",
                        type: "POST",
                        data: i,
                        processData: !1,
                        contentType: !1,
                        success: function(a) {
                            var t = a.uploadPms;
                            return window.result = t,
                            1 === a.code ? (r(e, a),
                            !1) : (window.backuploader.options.server = "//" + t.host,
                            window.backuploader.options.formData = {
                                OSSAccessKeyId: t.accessid,
                                policy: t.policy,
                                Signature: t.signature,
                                key: t.fileKey,
                                "Content-MD5": t.md5
                            },
                            window.backgroundupload = !0,
                            window.backuploader.upload(),
                            void 0)
                        },
                        error: function() {
                            console.log("error"),
                            window.backuploader.removeFile(e)
                        }
                    })
                }),
                !1)
            }),
            window.TEAM_ID > 0 && a(".background-upload-proress").css("top", "364px"),
            window.backuploader.on("uploadProgress", function(e, t) {
                a(".background-upload-proress-color").width(150 * t)
            }),
            window.backuploader.on("uploadSuccess", function(e) {
                r(e)
            }),
            a("#filePickerPhone").click(function() {
                var e = {
                    fid: a(".folder_wrap").find(".folderClick").attr("data-id") || 0
                };
                window.TEAM_ID > 0 && (e.tid = window.TEAM_ID),
                a.ajax({
                    url: "/material/getUploadToken.do",
                    dataType: "json",
                    type: "POST",
                    data: e,
                    success: function(e) {
                        function t() {
                            a(".folder_wrap").find(".folderClick").click()
                        }
                        var i = e.code;
                        if (1 === i) {
                            var o = p.getUploadPhone().clone()
                              , n = window.location.protocol + "//" + window.location.hostname + "/upload?t=" + e.token;
                            o.find(".download-text").text("用微信“扫一扫”上传手机相册图片"),
                            o.find(".qrcode").empty().qrcode({
                                width: 166,
                                height: 166,
                                correctLevel: 0,
                                text: n
                            }),
                            c.dialog(o[0], null, t),
                            clearTimeout(window.PHONE_UPLOAD_MATERIAL_CLOCK),
                            window.PHONE_UPLOAD_MATERIAL_CLOCK = setTimeout(function() {
                                o.find(".download-text").text("二维码已过期，请重新上传")
                            }, 6e5)
                        } else
                            c.back({
                                str: "获取素材上传令牌失败",
                                kind: "warning"
                            })
                    },
                    error: function() {
                        c.back({
                            str: "获取素材上传令牌错误",
                            kind: "error"
                        })
                    }
                })
            }),
            a("#filePicker").click(function() {
                a("#filePickerInput")[0].value = "",
                a("#filePickerInput").click()
            }),
            a("#filePickerInput").on("change", function() {
                a(".cancel_file_manger").hasClass("file_click") && a(".cancel_file_manger").click(),
                N.uploadMaterialPersonal(this.files, 0, N.uploadMaterialCallBack)
            }),
            window.addEventListener ? (document.body.addEventListener("dragenter", s, !1),
            document.body.addEventListener("dragover", d, !1),
            document.body.addEventListener("drop", g, !1),
            document.getElementById("materialWrap").addEventListener("mousewheel", function(e) {
                if ("show" == a("#materialWrap").attr("data-material-info")) {
                    var t = a("#materialWrap").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    L(e)
                }
            }, !1),
            document.getElementById("materialSearch").addEventListener("mousewheel", function(e) {
                if ("show" == a("#materialSearch").attr("data-material-info")) {
                    var t = a("#materialSearch").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    L(e)
                }
            }, !1),
            document.getElementById("rightPanel").addEventListener("mousewheel", function(e) {
                L(e)
            }, !1),
            document.getElementById("leftPanel").addEventListener("mousedown", function(e) {
                L(e)
            }, !1),
            document.getElementById("rightPanel").addEventListener("mousedown", function(e) {
                var a = N._owner_design
                  , t = a.getCurPage();
                t.nodeMousedown(),
                V(e, N),
                L(e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("keyup", function(e) {
                U.call(this, N, e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("keypress", function(e) {
                U.call(this, N, e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("keydown", function(e) {
                U.call(this, N, e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("mousedown", function(e) {
                e.stopPropagation()
            }, !1)) : window.attachEvent && (document.body.addEventListener("ondragenter", s, !1),
            document.body.addEventListener("ondragover", d, !1),
            document.body.addEventListener("ondrop", g, !1),
            document.getElementById("materialWrap").addEventListener("onmousewheel", function(e) {
                if ("show" == a("#materialWrap").attr("data-material-info")) {
                    var t = a("#materialWrap").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    L(e)
                }
            }, !1),
            document.getElementById("materialSearch").addEventListener("mousewheel", function(e) {
                if ("show" == a("#materialSearch").attr("data-material-info")) {
                    var t = a("#materialSearch").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    L(e)
                }
            }, !1),
            document.getElementById("rightPanel").addEventListener("onmousewheel", function(e) {
                L(e)
            }, !1),
            document.getElementById("leftPanel").addEventListener("onmousedown", function(e) {
                L(e)
            }, !1),
            document.getElementById("rightPanel").attachEvent("onmousedown", function(e) {
                var a = N._owner_design
                  , t = a.getCurPage();
                t.nodeMousedown(),
                V(e, N),
                L(e)
            }),
            document.getElementById(l.ANXID).attachEvent("onkeyup", function(e) {
                U.call(this, N, e)
            }),
            document.getElementById(l.ANXID).attachEvent("onkeypress", function(e) {
                U.call(this, N, e)
            }),
            document.getElementById(l.ANXID).attachEvent("onkeydown", function(e) {
                U.call(this, N, e)
            }),
            document.getElementById(l.ANXID).attachEvent("onmousedown", function(e) {
                e.stopPropagation()
            })),
            a("body").keydown(function(e) {
                var i = N._owner_design;
                if (e.ctrlKey && 187 == e.keyCode)
                    return i.setPageScale(i.pageScale + i._scaleArea),
                    void e.preventDefault();
                if (e.ctrlKey && 189 == e.keyCode)
                    return i.setPageScale(i.pageScale - i._scaleArea),
                    void e.preventDefault();
                if (32 == e.keyCode) {
                    var o = i._focus_element;
                    if (o && "text" == o._element_type)
                        return;
                    window.SPACE_KEY_DOWN = !0;
                    var n = i._owner_editDiv;
                    if (n) {
                        var r = n.getNode();
                        r.style.display = "none"
                    }
                    var s = a('<div class="page-mask" style="width: 100%;height: 100%;left: 0px;top: 0px;position: absolute"></div>');
                    0 == a(".page-mask").size() && a(".page-on-focus").append(s),
                    a(".page-mask").mousedown(function() {
                        a(this).addClass("page-mask-mousedown")
                    }).mouseup(function() {
                        a(this).removeClass("page-mask-mousedown")
                    })
                }
                L(e);
                var d = i.getCurPage()
                  , o = i._focus_element
                  , c = i._owner_designEditbar
                  , p = i._owner_elementEditbar;
                if ("INPUT" != e.target.tagName && ("TEXTAREA" != e.target.tagName || "copyPaste" == e.target.getAttribute("class")))
                    if (null != o && "block" == a("#" + l.ANXID).css("display"))
                        ;
                    else {
                        if ((1 == e.ctrlKey || 1 == e.metaKey) && 90 == e.keyCode)
                            return t.addBugTrackClick("b1"),
                            d.nodeMousedown(),
                            i.undoMemento(),
                            !1;
                        if (8 == e.keyCode || 46 == e.keyCode) {
                            if (null == o || "true" == o.lock) {
                                var f = null;
                                return clearTimeout(f),
                                a(".ele-lock").addClass("ele-lock-shake"),
                                a(".show-lock").show().addClass("lock-opacity"),
                                f = setTimeout(function() {
                                    a(".ele-lock").removeClass("ele-lock-shake"),
                                    a(".show-lock").hide()
                                }, 1500),
                                !1
                            }
                            return window.MEMENTO_ID = t.now(),
                            "circleSelect" == o._element_type || "elementGroup" == o._element_type ? o.removeAndUndo() : "background" === o.dataType ? (d.eleDelAndUndo(o),
                            d.addWhiteBackgroundAndUndo(!0)) : d.eleDelAndUndo(o),
                            !1
                        }
                        if (null != o && (1 == e.ctrlKey || 1 == e.metaKey) && 67 == e.keyCode) {
                            if (t.addBugTrackClick("e1"),
                            "elementGroup" == o._element_type || "circleSelect" == o._element_type) {
                                for (var u = o._elements, h = [], g = 0; g < u.length; g++)
                                    h.push(JSON.stringify(u[g].getNewJson()));
                                "elementGroup" == o._element_type && h.push(JSON.stringify(o.getNewJson())),
                                X(h, o._element_type)
                            } else {
                                var m = o.getNewJson();
                                "background" === m["data-type"] && (m["data-type"] = "img"),
                                X(m)
                            }
                            return !1
                        }
                        if (1 != e.ctrlKey && 1 != e.metaKey || 86 != e.keyCode) {
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 40 == e.keyCode)
                                return t.addBugTrackClick("a4"),
                                void 0 == o ? !1 : (p.movedownMousedown({
                                    button: 0,
                                    execute: !0
                                }, a(".ele-movedown")),
                                !1);
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 38 == e.keyCode)
                                return t.addBugTrackClick("a3"),
                                void 0 == o ? !1 : (p.moveupMousedown({
                                    button: 0,
                                    execute: !0
                                }, a(".ele-movedown")),
                                !1);
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 83 == e.keyCode)
                                return t.addBugTrackClick("d1"),
                                d.nodeMousedown(),
                                N.saveDesign(!0),
                                !1;
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 187 == e.keyCode) {
                                t.addBugTrackClick("a7"),
                                d.nodeMousedown();
                                var _ = i.pageScale + c._change_scale;
                                return c.changeDesignScale(_),
                                !1
                            }
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 189 == e.keyCode) {
                                t.addBugTrackClick("a7"),
                                d.nodeMousedown();
                                var _ = i.pageScale - c._change_scale;
                                return c.changeDesignScale(_),
                                !1
                            }
                            if (27 == e.keyCode)
                                d.nodeMousedown();
                            else {
                                if ((1 == e.ctrlKey || 1 == e.metaKey) && 71 == e.keyCode)
                                    return void 0 == o ? !1 : ("circleSelect" == o._element_type && (t.addBugTrackClick("h1"),
                                    p.setGroup({
                                        button: 0
                                    })),
                                    e.shiftKey && (t.addBugTrackClick("h2"),
                                    "elementGroup" == o._element_type && o.groupSplitAndUndo()),
                                    !1);
                                if ((1 == e.ctrlKey || 1 == e.metaKey) && 75 == e.keyCode)
                                    return void 0 == o ? !1 : (t.addBugTrackClick("h4"),
                                    p.setLock({
                                        button: 0
                                    }, a(".ele-lock")),
                                    !1);
                                if (37 == e.keyCode) {
                                    if (void 0 == o)
                                        return !1;
                                    t.addBugTrackClick("h4"),
                                    o.moveByKey(-1, 0);
                                    var w, v;
                                    return "circleSelect" === o._element_type ? (w = parseInt(o.getLeft()),
                                    v = parseInt(o.getTop())) : (w = parseInt(t.getTransformAttr(o.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    v = parseInt(t.getTransformAttr(o.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(w + "," + v).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                                if (38 == e.keyCode) {
                                    if (void 0 == o)
                                        return !1;
                                    o.moveByKey(0, -1);
                                    var w, v;
                                    return "circleSelect" === o._element_type ? (w = parseInt(o.getLeft()),
                                    v = parseInt(o.getTop())) : (w = parseInt(t.getTransformAttr(o.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    v = parseInt(t.getTransformAttr(o.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(w + "," + v).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                                if (39 == e.keyCode) {
                                    if (void 0 == o)
                                        return !1;
                                    o.moveByKey(1, 0);
                                    var w, v;
                                    return "circleSelect" === o._element_type ? (w = parseInt(o.getLeft()),
                                    v = parseInt(o.getTop())) : (w = parseInt(t.getTransformAttr(o.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    v = parseInt(t.getTransformAttr(o.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(w + "," + v).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                                if (40 == e.keyCode) {
                                    if (void 0 == o)
                                        return !1;
                                    o.moveByKey(0, 1);
                                    var w, v;
                                    return "circleSelect" === o._element_type ? (w = parseInt(o.getLeft()),
                                    v = parseInt(o.getTop())) : (w = parseInt(t.getTransformAttr(o.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    v = parseInt(t.getTransformAttr(o.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(w + "," + v).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                            }
                        } else
                            ;
                    }
            }),
            a("body").keyup(function(e) {
                32 == e.keyCode && (window.SPACE_KEY_DOWN = !1,
                a(".page-mask").remove())
            }),
            a("#chartDataSet").on("keydown", ".handsontableInput", function(e) {
                return 13 == e.keyCode ? !1 : void 0
            }),
            document.onkeydown = function(e) {
                return e || (e = window.event),
                8 != e.keyCode && 46 != e.keyCode || "INPUT" == e.target.tagName || "TEXTAREA" == e.target.tagName ? void (13 == (e.keyCode || e.which) && "folder-text folder-text-click" == e.target.getAttribute("class") && (window.TEAM_ID > 0 ? wa(a(e.target), !0) : wa(a(e.target)),
                a(e.target).removeClass("folder-text-click"),
                a(e.target).attr("readonly", "readonly"))) : !1
            }
            ,
            window.onbeforeunload = function() {
                var e = (N._owner_design,
                {
                    d: DESIGN_ID,
                    type: 1
                });
                window.TEAM_ID > 0 && (e.tid = window.TEAM_ID),
                window.COOPERATE_DESIGN && (e.c = !0),
                a.ajax({
                    url: "/design/addMakeImageTask.do",
                    dataType: "json",
                    type: "POST",
                    data: e,
                    success: function() {},
                    error: function() {}
                });
                var t, i;
                for (t in window.allChartSaveDrag)
                    if ("saving" == t.drag) {
                        i = !0;
                        break
                    }
                return !window.isLoginOut && "saved" != Oa._save_drag || i ? (Oa.saveDesign(),
                "您现在还没有保存最新修改的设计") : void 0
            }
            ,
            N.colorBtnSet(),
            window.TEAM_ID > 0 && (a(".fontKindBtn").eq(1).click(),
            a(".templateKindBtn").eq(2).click(),
            a(".backgroundColorBtn").eq(1).click())
        },
        chartKindInit: function(e) {
            function i(e, a) {
                if ("loadData" != a) {
                    var i = o._focus_element;
                    if (null == i)
                        return;
                    var n = t.deepClone(window.CHART_HOT.getData());
                    window.MEMENTO_ID = t.now(),
                    i.data = {
                        value: n,
                        undo_drag: !0
                    },
                    i.setData(!0),
                    i.updateNodeAndUndo(),
                    i.setSvgAttrData("axisTitle"),
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("legend"),
                    i.setSvgAttrData("chartKind"),
                    i.setSvgAttrData("dataSize")
                }
            }
            var o = e._owner_design;
            a("#chartDataEnterBtn").click(function() {
                a("#chartContent").toggleClass("chartData");
                var e = o._focus_element
                  , i = t.deepClone(e.data);
                window.CHART_HOT.loadData(i)
            }),
            a("#backchartSetWrap").click(function() {
                a("#chartContent").toggleClass("chartData")
            }),
            a("#backchartSetWrap").click(function() {
                var a = o._focus_element;
                e.initChartBtn(a)
            }),
            a(".chartSwitch").click(function() {
                var e = a(this);
                return e.hasClass("chart-no-click") ? !1 : void e.toggleClass("switchyes")
            }),
            a(".selectInput").click(function() {
                var e = a(this)
                  , t = e.parent()
                  , i = o._focus_element;
                return e.hasClass("chart-no-click") ? !1 : (t.hasClass("optionsShow") ? t.removeClass("optionsShow") : (a(".selectInput").parent().removeClass("optionsShow"),
                t.addClass("optionsShow")),
                "chartColors" == e.attr("id") && i.colorsGroup >= 0 && a(".selectOptionsWrap").scrollTop(30 * i.colorsGroup),
                !1)
            }),
            a("#chartSet").click(function() {
                a(".selectInput").parent().removeClass("optionsShow"),
                a("#chartColorsWrap").height(20).find("#customChartColorsChoose").height(0).prev().find(".custom-now-click").removeClass("custom-now-click")
            }),
            a("#chartTitleSwitch").click(function() {
                window.MEMENTO_ID = t.now();
                var e = a(this)
                  , i = o._focus_element;
                e.hasClass("switchyes") ? (a(".chartTitleInput").removeClass("chart-no-click"),
                a(".chartTitleInput")[0].removeAttribute("readonly"),
                i.titleShow = !0) : (a(".chartTitleInput").addClass("chart-no-click"),
                a(".chartTitleInput")[0].setAttribute("readonly", "readonly"),
                i.titleShow = !1),
                i.setTitle(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("title")
            }),
            a("#chartTitleInput").focus(function() {
                var e = a(this);
                e.attr("data-old", e.val())
            }).keyup(function() {
                var e = a(this);
                if (e.attr("data-old") != e.val()) {
                    window.MEMENTO_ID = t.now();
                    var i = o._focus_element;
                    i.title = e.val(),
                    i.setTitle(),
                    i.updateNodeAndUndo()
                }
            }),
            a(".chartTitlePosition").click(function() {
                window.MEMENTO_ID = t.now();
                var e = a(this)
                  , i = e.attr("data-position")
                  , n = o._focus_element;
                n.titlePosition = i,
                n.setTitle(),
                n.nodeClick(),
                n.updateNodeAndUndo(),
                n.setSvgAttrData("title")
            }),
            a(".chartTitleColor").click(function() {
                window.MEMENTO_ID = t.now();
                var e = a(this)
                  , i = e.attr("data-color")
                  , n = o._focus_element;
                n.titleColor = i,
                n.setTitle(),
                n.updateNodeAndUndo()
            }),
            a("#xYAxisTitleSwitch").click(function() {
                {
                    var e = a(this)
                      , t = o._focus_element
                      , i = t.getJson();
                    i["data-elem"]
                }
                e.hasClass("switchyes") ? (a(".xYAxis").removeClass("chart-no-click"),
                a(".xYAxis").removeAttr("readonly"),
                t.axisTitleShow = !0) : (a(".xYAxis").addClass("chart-no-click"),
                a(".xYAxis").attr("readonly", "readonly"),
                t.axisTitleShow = !1),
                t.setAxisTitle(),
                t.updateNodeAndUndo(),
                t.setSvgAttrData("axisTitle")
            }),
            a("#x-axis").focus(function() {
                var e = a(this)
                  , t = e.val();
                e.attr("data-old", t)
            }).keyup(function() {
                var e = a(this);
                if (e.attr("data-old") != e.val()) {
                    window.MEMENTO_ID = t.now();
                    var i = o._focus_element
                      , n = e.val();
                    i.xAxisTitle = n,
                    i.setAxisTitle(),
                    i.updateNodeAndUndo(),
                    i.setSvgAttrData("axisTitle")
                }
            }),
            a("#y-axis").focus(function() {
                var e = a(this)
                  , t = e.val();
                e.attr("data-old", t)
            }).keyup(function() {
                var e = a(this);
                if (e.attr("data-old") != e.val()) {
                    window.MEMENTO_ID = t.now();
                    var i = o._focus_element
                      , n = e.val();
                    i.yAxisTitle = n,
                    i.setAxisTitle(),
                    i.updateNodeAndUndo()
                }
            }),
            a(".chartInput").focus(function() {
                var e = a(this);
                "readonly" != e.attr("readonly") && 0 == e.val().length && (e.val(""),
                e.attr("placeholder", ""))
            }).blur(function() {
                var e = a(this);
                "readonly" != e.attr("readonly") && e.attr("placeholder", e.attr("data-holder"))
            }),
            a("#legendSwitch").click(function() {
                var e = a(this)
                  , i = o._focus_element;
                window.MEMENTO_ID = t.now(),
                i.legendShow = e.hasClass("switchyes") ? !0 : !1,
                i.setLegend(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("legend")
            }),
            a("#xYAxisSwitch").click(function() {
                var e = a(this)
                  , i = o._focus_element;
                window.MEMENTO_ID = t.now(),
                i.axisShow = e.hasClass("switchyes") ? !0 : !1,
                i.setAxis(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("axis")
            }),
            a("#yAxisGrid").click(function() {
                var e = a(this)
                  , i = o._focus_element;
                window.MEMENTO_ID = t.now(),
                i.gridShow = e.hasClass("switchyes") ? !0 : !1,
                i.setData(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("grid")
            }),
            a("#moreColors").click(function() {
                var e = a(this);
                if (e.hasClass("radioSelect"))
                    return !1;
                window.MEMENTO_ID = t.now(),
                a("#customChartColorsChoose").height(0),
                a("#chartColors").removeClass("chart-no-click");
                var i = o._focus_element;
                i.setData(!0),
                i.updateNodeAndUndo()
            }),
            a("#onlyColor").click(function() {
                var e = a(this);
                if (e.hasClass("radioSelect"))
                    return !1;
                window.MEMENTO_ID = t.now(),
                a("#customChartColorsChoose").height(0),
                a("#chartColors").addClass("chart-no-click");
                var i = o._focus_element;
                i.setData(!0),
                i.updateNodeAndUndo()
            }),
            a(".chartRadio").click(function() {
                var e = a(this)
                  , t = e.parent();
                t.children().not(e).removeClass("radioSelect"),
                e.addClass("radioSelect")
            }),
            a("#customChartColors").on("click", "span", function(e) {
                var t = a(this)
                  , i = a("#customChartColorsChoose");
                return t.hasClass("custom-now-click") ? (t.removeClass("custom-now-click"),
                i.height(0),
                t.parent().parent().height(20),
                !1) : (a(".custom-now-click").removeClass("custom-now-click"),
                t.addClass("custom-now-click"),
                t.parent().parent().height(110),
                i.height(92),
                void e.stopPropagation())
            }),
            a("#customChartColors").on("mouseenter", "span", function() {
                var e = a(this)
                  , t = e.index()
                  , i = o._focus_element;
                i.showStrokeByIndex(t)
            }),
            a("#customChartColors").on("mouseleave", "span", function() {
                var e = a(this)
                  , t = (e.index(),
                o._focus_element);
                t.hideStroke()
            }),
            a(".customChartColorsChooseSon").click(function(e) {
                var i = a(this)
                  , n = a(".custom-now-click");
                if (n.size() <= 0)
                    return !1;
                var r = i.css("background-color");
                n.css("background-color", r);
                var l = a(".customChartColorsSpan")
                  , s = l.size()
                  , d = o._focus_element
                  , c = [];
                window.MEMENTO_ID = t.now();
                for (var p = 0; s > p; p++)
                    c[p] = t.colorHex(l.eq(p).css("background-color"));
                d.colors = {
                    value: c,
                    undo_drag: !0
                },
                d.setData(),
                d.updateNodeAndUndo(),
                e.stopPropagation(),
                d.colorsGroup = 0
            }),
            a(".selectOptions").click(function() {
                var e = a(this)
                  , i = e.parent()
                  , n = i.prev();
                if (n.html(e.html()),
                e.hasClass("chartColors")) {
                    window.MEMENTO_ID = t.now();
                    var r = e.attr("data-colors");
                    n.attr("data-colors", r);
                    var l = o._focus_element;
                    l.setData(!0),
                    l.updateNodeAndUndo();
                    var s = e.index();
                    l.colorsGroup = s
                }
                i.parent().removeClass("optionsShow")
            }),
            a("#axis_min").focus(function() {
                var e = a(this)
                  , t = e.val();
                e.attr("data-old", t)
            }).blur(function() {
                var e = a(this)
                  , t = e.val()
                  , i = o._focus_element;
                if (null == i)
                    return !1;
                if ("" == t)
                    return i.setYAxisNumMin(-1),
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    !1;
                if (e.attr("data-old") != t) {
                    if (isNaN(t))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    e.val(parseInt(t));
                    var n = i.setYAxisNumMin(parseInt(t));
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    n ? e.attr("data-old", parseInt(t)) : e.val(e.attr("data-old"))
                }
            }).keyup(function(e) {
                var t = a(this)
                  , i = t.val();
                if (38 == e.keyCode)
                    i++,
                    t.val(i);
                else if (40 == e.keyCode) {
                    if (i--,
                    0 > i)
                        return !1;
                    t.val(i)
                } else if (13 != e.keyCode)
                    return !1;
                if (t.attr("data-old") != i) {
                    var n = o._focus_element;
                    if (null == n)
                        return !1;
                    if (isNaN(i))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    t.val(parseInt(i));
                    var r = n.setYAxisNumMin(i);
                    n.setSvgAttrData("axisScale"),
                    n.setSvgAttrData("chartKind"),
                    r ? t.attr("data-old", parseInt(i)) : t.val(t.attr("data-old"))
                }
            }),
            a("#axis_max").focus(function() {
                var e = a(this);
                e.attr("data-old", e.val())
            }).blur(function() {
                var e = a(this)
                  , t = e.val()
                  , i = o._focus_element;
                if (null == i)
                    return !1;
                if ("" == t)
                    return i.setYAxisNumMax(-1),
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    !1;
                if (e.attr("data-old") != t) {
                    if (isNaN(t))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    e.val(parseInt(t));
                    var n = i.setYAxisNumMax(parseInt(t));
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    n ? e.attr("data-old", parseInt(t)) : e.val(e.attr("data-old"))
                }
            }).keyup(function(e) {
                var t = a(this)
                  , i = t.val();
                if (38 == e.keyCode)
                    i++,
                    t.val(i);
                else if (40 == e.keyCode) {
                    if (i--,
                    0 > i)
                        return !1;
                    t.val(i--)
                } else if (13 != e.keyCode)
                    return !1;
                if (t.attr("data-old") != i) {
                    var n = o._focus_element;
                    if (null == n)
                        return !1;
                    if (isNaN(i))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    t.val(parseInt(i));
                    var r = n.setYAxisNumMax(parseInt(i));
                    n.setSvgAttrData("axisScale"),
                    n.setSvgAttrData("chartKind"),
                    r ? t.attr("data-old", parseInt(i)) : t.val(t.attr("data-old"))
                }
            });
            var n = [["苹果", "60"], ["香蕉", "45"], ["橘子", "20"], ["草莓", "40"], ["西瓜", "35"]]
              , l = document.getElementById("chartDataSet");
            window.CHART_HOT = new r(l,{
                data: n,
                minCols: 2,
                minRows: 20,
                maxCols: 2,
                maxRows: 10,
                minSpareRows: 1,
                rowHeaders: !0,
                colHeaders: ["名称", "数据"],
                contextMenu: !1,
                afterChange: i,
                colWidths: 100
            }),
            a(".chartKind").click(function() {
                t.addBugTrackClick("g1"),
                window.MEMENTO_ID = t.now();
                var e = a(this);
                if (e.hasClass("chart-no-click"))
                    return !1;
                var i = o.getCurPage()
                  , n = e.attr("data-kind")
                  , r = o._focus_element;
                if (void 0 != r && "svgChart" == r._element_type)
                    return r.kind = n,
                    r.setData(),
                    r.updateNodeAndUndo(),
                    r.setSvgAttrData("axisScale"),
                    r.setSvgAttrData("grid"),
                    r.setSvgAttrData("legend"),
                    r.setSvgAttrData("chartKind"),
                    e.parent().find(".chartNowSet").removeClass("chartNowSet"),
                    e.addClass("chartNowSet"),
                    !1;
                {
                    var l, s = i.pageWH;
                    o.pageScale
                }
                l = s.width < s.height ? s.width > 300 ? .5 * s.width : .8 * s.width : s.height > 300 ? .5 * s.height : .8 * s.height;
                var d = (s.height - l) / 2
                  , c = (s.width - l) / 2
                  , p = t.deepClone(window.CHART_HOT.getData())
                  , f = {
                    "data-type": "svgChart",
                    "data-elem": {
                        id: "",
                        "view-width": 500,
                        "view-height": 500,
                        width: l,
                        height: l,
                        opacity: 1,
                        viewBox: "0 0 500 500",
                        "chart-data": p,
                        "chart-kind": n,
                        "chart-colors": ["#158C99", "#1BAFA1", "#E9A72C", "#4E545B", "#717B87", "#1B88BA", "#639080", "#92C4D9", "#3E5B79", "#A7B4C4"],
                        "chart-colors-group": 0,
                        "chart-title": "默认标题",
                        "chart-titleShow": !0,
                        "chart-titleColor": "#808284",
                        "chart-titlePosition": "top",
                        "chart-axisShow": !0,
                        "chart-axisTitleShow": !0,
                        "chart-xAxisTitle": "X轴标题",
                        "chart-yAxisTitle": "Y轴标题",
                        "chart-yAxisNumMin": 0,
                        "chart-xAxisNumMax": -1,
                        "chart-gridShow": !0,
                        "chart-legendShow": !0
                    },
                    transform: "translate(" + c + "," + d + ")",
                    reverse: "translate(0,0)rotate(0,0,0)"
                };
                a("#onlyColor").removeClass("radioSelect"),
                a("#moreColors").addClass("radioSelect"),
                a("#chartColors").removeClass("chart-no-click"),
                window.chart_add_chart = !0;
                var r = i.createElementAndUndo({
                    json: f,
                    unshift: !0
                });
                r.nodeClick(),
                a("#chartDataEnterBtn").click()
            })
        },
        initChartBtn: function(e) {
            if (null != e) {
                if (a("#chartContent").hasClass("chartData")) {
                    var i = t.deepClone(e.data);
                    return void window.CHART_HOT.loadData(i)
                }
                a("#chartSetKindContent").find(".chartNowSet").removeClass("chartNowSet"),
                a(".chartKind[data-kind=" + e.kind + "]").addClass("chartNowSet"),
                a("#chartSetFirstTitle").html("修改图表类型"),
                a("#chartDataEnterBtn").css("display", "block"),
                a("#chartSetSecondTitle").css("display", "block"),
                a("#chartSetContent").css("display", "block"),
                e.titleShow ? (a("#chartTitleSwitch").addClass("switchyes"),
                a(".chartTitleInput").removeClass("chart-no-click"),
                a(".chartTitleInput")[0].removeAttribute("readonly")) : (a("#chartTitleSwitch").removeClass("switchyes"),
                a(".chartTitleInput").addClass("chart-no-click"),
                a(".chartTitleInput")[0].setAttribute("readonly", "readonly")),
                "默认标题" != e.title && a("#chartTitleInput").val(e.title);
                var o;
                switch (e.titlePosition) {
                case "top":
                    o = "上";
                    break;
                case "bottom":
                    o = "下"
                }
                a("#chartTitlePositionSelect").html(o);
                var n;
                switch (e.titleColor) {
                case "#000":
                    n = "黑";
                    break;
                case "#FFF":
                    n = "白";
                    break;
                default:
                    n = "灰"
                }
                if (a("#chartTitleColorSelect").html(n),
                e.axisTitleShow ? (a("#xYAxisTitleSwitch").addClass("switchyes"),
                a("#x-axis").removeAttr("readonly").removeClass("chart-no-click"),
                a("#y-axis").removeAttr("readonly").removeClass("chart-no-click")) : (a("#xYAxisTitleSwitch").removeClass("switchyes"),
                a("#x-axis").attr("readonly", "readonly").addClass("chart-no-click"),
                a("#y-axis").attr("readonly", "readonly").addClass("chart-no-click")),
                a("#x-axis").val("X轴标题" != e.xAxisTitle ? e.xAxisTitle : ""),
                a("#y-axis").val("Y轴标题" != e.yAxisTitle ? e.yAxisTitle : ""),
                e.axisShow ? a("#xYAxisSwitch").addClass("switchyes") : a("#xYAxisSwitch").removeClass("switchyes"),
                e.gridShow ? a("#yAxisGrid").addClass("switchyes") : a("#yAxisGrid").removeClass("switchyes"),
                e.legendShow ? a("#legendSwitch").addClass("switchyes") : a("#legendSwitch").removeClass("switchyes"),
                1 == e.colors.length ? (a(".radioSelect").removeClass("radioSelect"),
                a("#onlyColor").addClass("radioSelect"),
                a("#chartColors").addClass("chart-no-click")) : (a(".radioSelect").removeClass("radioSelect"),
                a("#moreColors").addClass("radioSelect"),
                a("#chartColors").removeClass("chart-no-click")),
                a("#chartColorsWrap").height(20).find("#customChartColorsChoose").height(0),
                a(".optionsShow").removeClass("optionsShow"),
                e.colorsGroup >= 0) {
                    var r, l = a("#chart_color_group_" + e.colorsGroup), s = l.attr("data-colors"), d = s.split(","), c = d.length, p = a("#chartColors");
                    p.empty();
                    for (var f = 0; c > f; f++)
                        r = c > 6 ? '<span class="chartColorsSpan chartColorsSpanDefault" style="background-color: ' + d[f] + ';"></span>' : '<span class="chartColorsSpan" style="background-color: ' + d[f] + ';"></span>',
                        p.append(r)
                }
                e.showCustomColors(a("#customChartColors")),
                a("#axis_min").val(e.yAxisNumMin > 0 ? e.yAxisNumMin : ""),
                a("#axis_max").val(e.yAxisNumMax > 0 ? e.yAxisNumMax : "")
            } else
                a("#chartContent").removeClass("chartData"),
                a("#chartSetFirstTitle").html("新插入图表"),
                a("#chartDataEnterBtn").css("display", "none"),
                a("#chartSetSecondTitle").css("display", "none"),
                a("#chartSetContent").css("display", "none"),
                a(".chartNowSet").removeClass("chartNowSet");
            var u = a(".chartColors");
            if (u.eq(0).children().size() < 1)
                for (var h = u.size(), f = 0; h > f; f++)
                    for (var r, s = u.eq(f).attr("data-colors"), d = s.split(","), c = d.length, g = u.eq(f), m = 0; c > m; m++)
                        r = c > 6 ? '<span class="chartColorsSpan chartColorsSpanDefault" style="background-color: ' + d[m] + ';"></span>' : '<span class="chartColorsSpan" style="background-color: ' + d[m] + ';"></span>',
                        g.append(r)
        },
        colorBtnSet: function() {
            var e = localStorage.color;
            if (void 0 != e)
                for (var t = e.split(","), i = t.length, o = 0; i > o; o++)
                    a("#edit-color").find(".default-edit-color-wrap").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor"),
                    a("#backColorPreinstall").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor")
        },
        colorPickupHide: function(e, t, i) {
            var o = this
              , n = o._owner_design
              , r = n.getCurPage()
              , l = r.elements
              , s = n._focus_element || l[0];
            if (a(".ss-function-colorPicker").attr("data-block", "none"),
            a(".ss-function-colorPicker").animate({
                left: parseFloat(a(".ss-function-colorPicker").css("left")) + 50,
                opacity: 0
            }, function() {
                e.removeClass("now-click"),
                a(".ss-function-colorPicker").css("display", "none")
            }),
            !i) {
                var d = a(".ss-function-colorPicker .color-input").val();
                if (o._background_drag)
                    J(d, o),
                    o._background_drag = !1;
                else {
                    var c = a(".element-edit-bar").find(".ele-color").index(a(".element-edit-bar").find(".ele-color.now-click"));
                    s.setColor(d, c)
                }
                a(".seeColors-temp-container").fadeOut(function() {
                    a(".seeColors-temp-container").remove()
                }),
                Y()
            }
        },
        colorPickupShow: function(e) {
            var i = this
              , o = i._owner_design
              , n = o.getCurPage();
            if (e.hasClass("now-click"))
                return i.colorPickupHide(e),
                !1;
            var r = n.getNode().firstChild;
            r = a(r)[0].outerHTML,
            r = r.toString(),
            i.color_picker.updateSVG(r),
            t.addBugTrackClick("n3"),
            e.addClass("now-click");
            var l;
            if (a(".ss-function-colorPicker").attr("data-block", "block"),
            "backColorPreinstall" == e.parent().attr("id"))
                a(".ss-function-colorPicker").attr("data-kind", "back"),
                l = n.getBackgroundColor();
            else {
                a(".ss-function-colorPicker").attr("data-kind", "element");
                var s = a(".ele-color").index(a(".ele-color.now-click"));
                a(".ss-function-colorPicker").attr("data-num", s);
                var d = o._focus_element;
                l = d.getFocusColor(s)
            }
            var c = e.offset().top - 11
              , p = e.offset().left + 40;
            return a(".ss-function-colorPicker").css({
                opacity: 0,
                left: p + 50,
                top: c,
                display: "block"
            }),
            a(".ss-function-colorPicker").animate({
                left: p,
                opacity: 1
            }),
            a(".ss-function-colorPicker .color-input").val(t.colorHex(l)),
            i.color_picker.setColor(t.colorHex(l)),
            !1
        },
        backgroundTransparent: function() {
            var e = this
              , i = e._owner_design
              , o = i.getCurPage()
              , n = o.elements[0];
            a(o.getNode()).addClass("page-transparent"),
            window.MEMENTO_ID = t.now(),
            n.previewOpacity(0),
            n.setOpacity(0)
        },
        queryMaterial: function(e, i, o, n, r) {
            r = r || t.noop;
            var l = this
              , s = a("#" + n);
            null != l._query_ajax && "pending" == l._query_ajax.promise().state() && l._query_ajax.abort(),
            l._query_ajax = a.ajax({
                url: e,
                dataType: "json",
                type: "POST",
                data: i,
                error: function() {
                    l._kind_click_drag = !1,
                    console.log("返回素材出错或者强行终止")
                },
                success: function(t) {
                    function d(t) {
                        s.children(".onloadMaterial").css("display", "none");
                        var d;
                        d = t.result ? t.result : t.page;
                        var c = d.pageTotal
                          , p = d.recordCount;
                        if (a(".folder").attr({
                            "data-size": p
                        }),
                        i.pageNo > c || 0 >= p) {
                            var f;
                            return f = "leadingMaterialWrap" == n ? '<div style="position:absolute;bottom:15px" class="nohaveTipsTemplate">已经没有更多了</div>' : '<div style="position:absolute;bottom:15px" class="nohaveTipsTemplate">素材库正在完善，敬请期待</div>',
                            s.append(f),
                            void (l._kind_click_drag = !1)
                        }
                        var u = d.recordData;
                        if ("/material/getMaterialsInFolder.do" == e)
                            for (var h, g = 0; g < u.length; g++)
                                h = u[g],
                                h.img_key = h.ik,
                                h.attach_id = h.ai,
                                h.kind_id = h.ki,
                                h.material_id = h.mid,
                                h.business_type = h.bt,
                                h.content_type = h.dt,
                                h.business_type__caption = h.bt__caption,
                                h.img_ori_height = h.h,
                                h.img_ori_width = h.w;
                        var m, _, w, v, k, y, C, T, M, I = 0, x = 0, S = 0, b = 1, E = (s.getWidth() - 20) / 3;
                        s.attr("data-index", parseInt(i.pageNo) + 1);
                        for (var g = 0, A = u.length; A > g; g++) {
                            m = u[g],
                            _ = o[0],
                            I = 0,
                            w = o[0],
                            x = 0;
                            for (var D = 1; 3 > D; D++)
                                o[D] < _ ? (_ = o[D],
                                I = D) : o[D] > w && (w = o[D],
                                x = D);
                            for (var D = 0; 3 > D; D++)
                                if (D != I && D != x) {
                                    S = D,
                                    v = o[D];
                                    break
                                }
                            switch (b = m.img_ori_width / m.img_ori_height,
                            b = b >= 1.6 && 2.5 > b ? 2 : b >= 2.5 ? 3 : 1) {
                            case 3:
                                if (30 > v - _ && 30 > w - v || 60 > w - _) {
                                    y = 3 * E + 20,
                                    C = m.img_ori_height / (m.img_ori_width / y),
                                    T = 0 * (E + 10),
                                    M = w + 10,
                                    o[0] = M + C,
                                    o[1] = M + C,
                                    o[2] = M + C;
                                    break
                                }
                            case 2:
                                if (30 > v - _) {
                                    if (1 != x) {
                                        y = 2 * E + 10,
                                        C = m.img_ori_height / (m.img_ori_width / y),
                                        T = I > S ? S * (E + 10) : I * (E + 10),
                                        M = v + 10,
                                        o[I] = M + C,
                                        o[S] = M + C;
                                        break
                                    }
                                    if (30 > w - v) {
                                        y = 2 * E + 10,
                                        C = m.img_ori_height / (m.img_ori_width / y),
                                        T = x > S ? S * (E + 10) : x * (E + 10),
                                        M = w + 10,
                                        o[x] = M + C,
                                        o[S] = M + C;
                                        break
                                    }
                                }
                            default:
                                y = E,
                                C = m.img_ori_height / (m.img_ori_width / y),
                                T = I * (E + 10),
                                M = _ + 10,
                                o[I] = M + C
                            }
                            k = s.find(".chooseMaterialLi").size();
                            var P = a('<li class="chooseMaterialLi" style="opacity:0;top:' + M + "px;left:" + T + "px;width:" + y + "px;height:" + C + 'px"></li>');
                            if ("backImgChooseWrap" == n && P.addClass("backgroundMaterial"),
                            P.attr({
                                "data-key": m.img_key,
                                "data-id": m.material_id,
                                "data-type": m.content_type
                            }),
                            "materialWrap" == n || "materialSearch" == n) {
                                P.attr({
                                    "data-nickname": decodeURI(m.nickname),
                                    "data-keywords": m.keywords
                                });
                                for (var K = '<div class="materialInfoIcon" title="素材信息"></div>', L = '<div class="materialCollIcon" title="收藏素材">', N = 0; N < window.colledMaterial.length; N++)
                                    if (m.material_id == window.colledMaterial[N]) {
                                        L = '<div class="materialCollIcon colled" title="取消收藏">';
                                        break
                                    }
                                P.append(L),
                                P.append(K)
                            }
                            s.append(P);
                            var O = new Image;
                            if ("image/svg+xml" == m.content_type ? (O.src = "/material/getMaterialsInFolder.do" == e ? m.imgUrl : m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            P.addClass("svgMaterial")) : "svg" == m.content_type ? (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            P.addClass("svgMaterial")) : "image/png" == m.content_type ? (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            P.addClass("imgMaterial")) : "image/chuangkit" == m.content_type ? (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            P.addClass("groupMaterial"),
                            O.setAttribute("fileurl", m.fileUrl)) : (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            P.addClass("imgMaterial")),
                            "/material/getMaterialsInFolder.do" == e && (O.src = m.imgurl),
                            O.alt = k,
                            O.onload = function() {
                                a(this).attr({
                                    width: "100%",
                                    draggable: "false",
                                    height: "100%"
                                });
                                var t = a(this).attr("alt")
                                  , i = s.find(".chooseMaterialLi").eq(t);
                                i.append(a(this)).css("background-color", "#f6f6f6"),
                                a(this).attr({
                                    alt: i.attr("data-key"),
                                    "data-id": i.attr("data-id")
                                }),
                                "/material/getMaterialsInFolder.do" == e && a(this).removeAttr("alt"),
                                i.removeAttr("data-key")
                            }
                            ,
                            P.animate({
                                opacity: 1
                            }, 1e3),
                            o[I] > s.getHeight() - 10) {
                                if (s.height(o[I] + 10).attr("data-height", o[I] + 10),
                                s.height(o[I] + 10 + 46),
                                "materialWrap" == n)
                                    for (var W = a(".materialKindClick").index(".materialKind"), D = W + 3 - W % 3, j = D + 3; j > D; D++) {
                                        var B = a(".materialKind").eq(D);
                                        B.css("margin-top", 15 + s.getHeight() + a("#meterialSecondKindListWrap").outerHeight() + 20 + "px")
                                    }
                                r()
                            }
                        }
                        s.attr({
                            "data-a": o[0],
                            "data-b": o[1],
                            "data-c": o[2]
                        });
                        var F = s.parent()
                          , q = F.offset().top + F.height() + 60
                          , U = Math.max(o[0], o[1], o[2]);
                        U += s.offset().top,
                        q > U && (i.pageNo++,
                        s.height(s.getHeight() + 50),
                        s.children(".onloadMaterial").css("display", "block"),
                        l.queryMaterial(e, i, o, n)),
                        l._kind_click_drag = !1
                    }
                    var c = t.cacheUrl;
                    return "/material/searchAllMaterialsByKind.do" == e && void 0 != c ? void (l._query_ajax = a.ajax({
                        url: c,
                        type: "GET",
                        success: function(e) {
                            "object" != typeof e && (e = JSON.parse(e)),
                            d(e.body)
                        }
                    })) : void d(t)
                }
            }),
            a(".cancel_file_manger ").hasClass("file_click") && a(".upload_file_manger").click()
        },
        queryMaterialPersonal: function(e, i, o, n, r) {
            r = r || t.noop;
            var l = this;
            null != l._query_ajax_personal && "pending" == l._query_ajax_personal.promise().state() && l._query_ajax_personal.abort(),
            l._query_ajax_personal = a.ajax({
                url: e,
                dataType: "json",
                type: "POST",
                data: i,
                error: function() {
                    l._kind_click_drag = !1,
                    console.log("返回素材出错或者强行终止")
                },
                success: function(t) {
                    1 == i.pageNo ? window.personalMaterialData = t : window.personalMaterialData.page.recordData = window.personalMaterialData.page.recordData.concat(t.page.recordData),
                    a("#leadingMaterialWrap").children().remove(),
                    l.loadMaterialPersonal(l, t, e, i, o, n, r),
                    window.USER_DROP_IMG && (window.USER_DROP_IMG = !1,
                    setTimeout(function() {
                        l.uploadMaterialPersonal(window.USER_DROP_FILELIST)
                    }, 500))
                }
            }),
            a(".cancel_file_manger ").hasClass("file_click") && a(".upload_file_manger").click()
        },
        loadMaterialPersonal: function(e, t, i, o, n, r, l) {
            var s = a("#" + r);
            s.children(".onloadMaterial").css("display", "none");
            var d = t.page
              , c = d.pageTotal
              , p = d.recordCount;
            if (a(".folder").attr({
                "data-size": p
            }),
            o.pageNo > c || 0 >= p) {
                var f = '<div style="position:absolute;bottom:15px" class="nohaveTipsTemplate">已经没有更多了</div>';
                return s.append(f),
                void (e._kind_click_drag = !1)
            }
            for (var u, h = d.recordData, g = 0; g < h.length; g++)
                u = h[g],
                u.img_key = u.ik,
                u.attach_id = u.ai,
                u.kind_id = u.ki,
                u.material_id = u.mid,
                u.business_type = u.bt,
                u.content_type = u.dt,
                u.business_type__caption = u.bt__caption,
                u.img_ori_height = u.h,
                u.img_ori_width = u.w;
            var m, _, w, v, k, y, C, T, M, I = 0, x = 0, S = 0, b = 1, E = (s.getWidth() - 20) / 3;
            s.attr("data-index", parseInt(o.pageNo) + 1);
            for (var g = 0, A = h.length; A > g; g++) {
                m = h[g],
                _ = n[0],
                I = 0,
                w = n[0],
                x = 0;
                for (var D = 1; 3 > D; D++)
                    n[D] < _ ? (_ = n[D],
                    I = D) : n[D] > w && (w = n[D],
                    x = D);
                for (var D = 0; 3 > D; D++)
                    if (D != I && D != x) {
                        S = D,
                        v = n[D];
                        break
                    }
                switch (b = m.img_ori_width / m.img_ori_height,
                b = b >= 1.6 && 2.5 > b ? 2 : b >= 2.5 ? 3 : 1) {
                case 3:
                    if (30 > v - _ && 30 > w - v || 60 > w - _) {
                        y = 3 * E + 20,
                        C = m.img_ori_height / (m.img_ori_width / y),
                        T = 0 * (E + 10),
                        M = w + 10,
                        n[0] = M + C,
                        n[1] = M + C,
                        n[2] = M + C;
                        break
                    }
                case 2:
                    if (30 > v - _) {
                        if (1 != x) {
                            y = 2 * E + 10,
                            C = m.img_ori_height / (m.img_ori_width / y),
                            T = I > S ? S * (E + 10) : I * (E + 10),
                            M = v + 10,
                            n[I] = M + C,
                            n[S] = M + C;
                            break
                        }
                        if (30 > w - v) {
                            y = 2 * E + 10,
                            C = m.img_ori_height / (m.img_ori_width / y),
                            T = x > S ? S * (E + 10) : x * (E + 10),
                            M = w + 10,
                            n[x] = M + C,
                            n[S] = M + C;
                            break
                        }
                    }
                default:
                    y = E,
                    C = m.img_ori_height / (m.img_ori_width / y),
                    T = I * (E + 10),
                    M = _ + 10,
                    n[I] = M + C
                }
                k = s.find(".chooseMaterialLi").size();
                var P = a('<li class="chooseMaterialLi" style="opacity:0;top:' + M + "px;left:" + T + "px;width:" + y + "px;height:" + C + 'px"></li>');
                if (P.attr({
                    "data-key": m.img_key,
                    "data-id": m.material_id,
                    "data-type": m.content_type,
                    id: m.uploadImgId ? m.uploadImgId : ""
                }),
                m.uploadImgId > 0) {
                    var K = a('<span class="waiting-color"></span><span class="progress-color"></span><p class="waiting-text">等待上传···</p><p class="progress-text"><span class="progress-num">0</span>%<br />正在上传···</p>');
                    P.append(K),
                    P.addClass("img_uploading")
                }
                s.append(P);
                var L = new Image;
                if (L.alt = k,
                "-1" != m.imgurl.indexOf("image/svg+xml") ? (L.src = m.imgUrl,
                P.addClass("svgMaterial")) : "image/svg+xml" == m.dt ? (L.src = m.imgUrl,
                P.addClass("svgMaterial")) : "svg" == m.dt ? (L.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                P.addClass("svgMaterial")) : "image/png" == m.dt ? (L.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                P.addClass("imgMaterial")) : "image/chuangkit" == m.dt ? (L.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                P.addClass("groupMaterial"),
                L.setAttribute("fileurl", m.fileUrl)) : (L.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                P.addClass("imgMaterial")),
                L.onload = function() {
                    a(this).attr({
                        width: "100%",
                        draggable: "false",
                        height: "100%"
                    });
                    var e = a(this).attr("alt")
                      , t = s.find(".chooseMaterialLi").eq(e);
                    t.find("img").remove(),
                    t.prepend(a(this)).css("background-color", "#f6f6f6"),
                    a(this).attr({
                        alt: t.attr("data-key"),
                        "data-id": t.attr("data-id")
                    }),
                    "/material/getMaterialsInFolder.do" == i && a(this).removeAttr("alt"),
                    t.removeAttr("data-key")
                }
                ,
                L.src = m.imgurl,
                P.animate({
                    opacity: 1
                }, 1e3),
                n[I] > s.getHeight() - 10) {
                    if (s.height(n[I] + 10).attr("data-height", n[I] + 10),
                    s.height(n[I] + 10 + 46),
                    "materialWrap" == r)
                        for (var N = a(".materialKindClick").index(".materialKind"), D = N + 3 - N % 3, O = D + 3; O > D; D++) {
                            var W = a(".materialKind").eq(D);
                            W.css("margin-top", 15 + s.getHeight() + a("#meterialSecondKindListWrap").outerHeight() + 20 + "px")
                        }
                    l()
                }
            }
            s.attr({
                "data-a": n[0],
                "data-b": n[1],
                "data-c": n[2]
            });
            var j = s.parent()
              , B = j.offset().top + j.height() + 60
              , F = Math.max(n[0], n[1], n[2]);
            F += s.offset().top,
            B > F && (o.pageNo++,
            s.height(s.getHeight() + 50),
            s.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(i, o, n, r)),
            e._kind_click_drag = !1
        },
        materialSecondKindListShow: function(e, t) {
            var i = this
              , o = i._material_kind[e]
              , n = o.lsQueryMaterialKindBean
              , r = n.length
              , l = a("#meterialSecondKindListWrap")
              , s = l.children("ul");
            s.children(".secondKindList").detach();
            var d = "<li class='secondKindList secondKindListClick' data-name='全部' data-firstid='" + o.firstKindId + "'>全部</li>";
            a(d).appendTo(s);
            for (var c = 0; r > c; c++)
                d = "<li class='secondKindList' data-name='" + n[c].kindTitle + "' data-firstid='" + o.firstKindId + "' data-secondid='" + n[c].kindId + "'>" + n[c].kindTitle + "</li>",
                a(d).appendTo(s);
            if (l.find(".secondKindListMore").size() > 0 && l.find(".secondKindListMore").detach(),
            r > 8) {
                var p = 40 * Math.ceil((r + 1) / 4);
                s.attr("data-height-change", p - 80).css("height", 80);
                var f = a('</div><div class="secondKindListMore">展开更多分类</div>');
                l.append(f)
            } else
                s.css("height", "auto");
            var u = t.offset().top + t.getHeight() + 20 - a("#materialKindList").offset().top + 60;
            l.css({
                top: u,
                display: "block",
                height: "auto"
            })
        },
        searchMaterialSecondKind: function(e) {
            var t, i = this, o = i._material_kind[e], n = o.lsQueryMaterialKindBean, r = a(".secondKindUl"), l = n.length;
            if (1 == l)
                a("#secondKindWrap").children("div").html(n[0].kindTitle).addClass("noHaveSecondKind"),
                r.css("height", "auto");
            else {
                a("#secondKindWrap").children("div").removeClass("noHaveSecondKind"),
                t = "<li class='secondKindLi' data-name='全部' data-firstid='" + o.firstKindId + "' >全部</li>",
                a(t).appendTo(r),
                l > 3 ? r.css("height", "133px") : r.css("height", "auto");
                for (var s = 0; l > s; s++)
                    t = "<li class='secondKindLi' data-name='" + n[s].kindTitle + "' data-firstid='" + o.firstKindId + "' data-secondid='" + n[s].kindId + "'>" + n[s].kindTitle + "</li>",
                    a(t).appendTo(r)
            }
        },
        queryTemplate: function(e, i) {
            var o = this
              , n = a("#" + i);
            if (null != o._template_ajax && "pending" == o._template_ajax.promise().state() && o._template_ajax.abort(),
            "teamTemplate" == i)
                return void (o._template_ajax = a.ajax({
                    url: "/designtemplate/listTeamTemplate.do",
                    type: "POST",
                    dataType: "json",
                    data: e,
                    error: function() {
                        o._kind_click_drag = !1,
                        console.log("团队模版请求错误")
                    },
                    success: function(r) {
                        if (-4 == r.code)
                            r.templates = [],
                            r.totalCount = 0;
                        else {
                            if (-2 == r.code)
                                return d.show(),
                                !1;
                            if (-1 == r.code || -3 == r.code)
                                return console.log("团队模版请求错误,code:" + r.code),
                                c.back({
                                    str: "团队模版获取失败！",
                                    kind: "warning"
                                }),
                                !1
                        }
                        var s = r.templates
                          , p = r.totalCount / l.MATERIAL_PAGE_SIZE;
                        if (n.children(".onloadTemplate").css("display", "none"),
                        e.pageNo > Math.ceil(p)) {
                            if (n.children(".nohaveTipsTemplate").size() <= 0) {
                                var f = '<div class="nohaveTipsTemplate">没有更多模板，去<a href="/templatecenter" target="_blank">模板中心</a>看看</div>';
                                n.append(f),
                                a(".nohaveTipsTemplate a").click(function() {
                                    t.addSomeMouseClick("左侧-模板中心")
                                })
                            }
                            return o._kind_click_drag = !1,
                            void console.log("团队模板加载结束")
                        }
                        var u, h, g = parseFloat(s[0].width), m = parseFloat(s[0].height);
                        u = g / m >= 1.8 ? 290 : 140,
                        h = m / g * u;
                        var _, w, v, k = s.length, y = a("#templateContent");
                        n.attr("data-index", parseInt(e.pageNo) + 1);
                        for (var C = 0; k > C; C++)
                            _ = a(parseInt(s[C].pageCount) > 1 ? '<li class="templateLi templateMaterial multipage" alt="' + s[C].teamTemplateId + '" style="opacity:0;width:' + u + "px;height: " + h + 'px" data-size="' + s[C].pageCount + '"><div class="multipage_show"></div><div class="templateMaking" style="line-height:' + h + 'px">缩略图正在生成中...</div></li>' : '<li class="templateLi templateMaterial" alt="' + s[C].teamTemplateId + '" style="opacity:0;width:' + u + "px;height: " + h + 'px"><div class="templateMaking" style="line-height:' + h + 'px">缩略图正在生成中...</div></li>'),
                            w = n.children(".templateMaterial").size(),
                            v = new Image,
                            v.src = s[C].thumbImgUrl,
                            v.name = w,
                            a(v).attr("data-src", s[C].thumbImgUrl),
                            v.onload = function() {
                                a(this).attr({
                                    width: "100%",
                                    height: "100%",
                                    draggable: "false"
                                });
                                var e = n.children(".templateMaterial").eq(a(this).attr("name"));
                                e.append(a(this)).css("background-color", "#F6F6F6").click(function() {}).find(".templateMaking").remove()
                            }
                            ,
                            _.appendTo(n),
                            _.animate({
                                opacity: "1"
                            });
                        o._kind_click_drag = !1,
                        y.getHeight() - n.offset().top + y.offset().top >= n.height() - 10 && (e.pageNo++,
                        n.children(".onloadTemplate").appendTo(n),
                        n.children(".onloadTemplate").css("display", "block"),
                        o.queryTemplate(e, i))
                    }
                }));
            (window.ziyun || window.api) && (e.priceType = 2);
            var r;
            r = "collectionTemplate" == i ? "/designtemplate/listTemplateInFolder.do" : "/designtemplate/getAllTemplates.do",
            o._template_ajax = a.ajax({
                url: r,
                type: "GET",
                dataType: "json",
                data: e,
                error: function() {
                    o._kind_click_drag = !1,
                    console.log("模版请求错误")
                },
                success: function(r) {
                    function s(r) {
                        {
                            var s = r.queryDesignTemplateBeanList
                              , d = r.totalCount / l.MATERIAL_PAGE_SIZE;
                            r.hasNext
                        }
                        if (n.children(".onloadTemplate").css("display", "none"),
                        e.pageNo > Math.ceil(d)) {
                            if (n.children(".nohaveTipsTemplate").size() <= 0) {
                                var c;
                                c = "collectionTemplate" == i ? '<div class="nohaveTipsTemplate">没有更多收藏，去<a href="/templatecenter" target="_blank">模板中心</a>看看</div>' : '<div class="nohaveTipsTemplate">素材库正在完善，敬请期待</div>',
                                n.append(c),
                                a(".nohaveTipsTemplate a").click(function() {
                                    t.addSomeMouseClick("左侧-模板中心")
                                })
                            }
                            return void (o._kind_click_drag = !1)
                        }
                        var p, f, u = parseFloat(s[0].width), h = parseFloat(s[0].height);
                        p = u / h >= 1.8 ? 290 : 140,
                        f = h / u * p;
                        var g, m, _, w = s.length, v = a("#templateContent");
                        n.attr("data-index", parseInt(e.pageNo) + 1);
                        for (var k, y, C = 0; w > C; C++)
                            s[C].price > 0 ? (y = s[C].price / 100,
                            y += "元",
                            k = 1 == s[C].forVipFree ? '<span class="priceIcon"></span>' : "") : (y = "免费",
                            k = ""),
                            g = a(parseInt(s[C].designTemplatePageCount) > 1 ? '<li class="templateLi templateMaterial multipage" data-own="unknow" data-vip="' + s[C].forVipFree + '" data-price="' + s[C].price + '" data-pageNum="' + s[C].designTemplatePageCount + '" data-kind="' + s[C].kindTitle + '" data-view="' + s[C].viewTimes + '" data-collect="' + s[C].isCollected + '" data-title="' + s[C].templateTitle + '" alt="' + s[C].designTemplateId + '" style="opacity:0;width:' + p + "px;height: " + f + 'px" data-size="' + s[C].designTemplatePageCount + '">' + k + '<div class="blackMask"></div><div class="priceWrap"><div class="priceTagIcon"></div><div class="priceText">' + y + '</div></div><div class="multipage_show"></div></li>' : '<li class="templateLi templateMaterial" data-own="unknow" data-vip="' + s[C].forVipFree + '" data-price="' + s[C].price + '" data-pageNum="' + s[C].designTemplatePageCount + '" data-kind="' + s[C].kindTitle + '" data-view="' + s[C].viewTimes + '" data-collect="' + s[C].isCollected + '" data-title="' + s[C].templateTitle + '" alt="' + s[C].designTemplateId + '" style="opacity:0;width:' + p + "px;height: " + f + 'px">' + k + '<div class="blackMask"></div><div class="priceWrap"><span class="priceText">' + y + '</span><span class="priceTagIcon"></span></div></li>'),
                            m = n.children(".templateMaterial").size(),
                            _ = new Image,
                            _.src = 140 == p ? s[C].designTemplateImageUrl + "@140w_100Q_1x.jpg" : s[C].designTemplateImageUrl + "@290w_100Q_1x.jpg",
                            _.name = m,
                            a(_).attr("data-src", s[C].designTemplateImageUrl),
                            _.onload = function() {
                                a(this).attr({
                                    width: "100%",
                                    height: "100%",
                                    draggable: "false"
                                });
                                var e = n.children(".templateMaterial").eq(a(this).attr("name"));
                                e.append(a(this)).css("background-color", "#f6f6f6").click(function() {})
                            }
                            ,
                            g.appendTo(n),
                            g.animate({
                                opacity: "1"
                            });
                        o._kind_click_drag = !1,
                        v.getHeight() - n.offset().top + v.offset().top >= n.height() - 10 && (e.pageNo++,
                        n.children(".onloadTemplate").appendTo(n),
                        n.children(".onloadTemplate").css("display", "block"),
                        o.queryTemplate(e, i))
                    }
                    var p = r.cacheUrl;
                    if (void 0 != p)
                        return void (o._template_ajax = a.ajax({
                            url: p,
                            type: "GET",
                            success: function(e) {
                                "object" != typeof e && (e = JSON.parse(e)),
                                s(e.body)
                            }
                        }));
                    if ("collectionTemplate" == i)
                        if (r.templates) {
                            for (var f, u, h = [], g = r.templates, m = 0; m < g.length; m++)
                                u = g[m].template,
                                f = {
                                    collectedTimes: u.collectedTimes,
                                    createTime: u.createTime,
                                    designKindId: u.designKindId,
                                    designTemplateId: u.designTemplateId,
                                    designTemplateImageUrl: u.designTemplateImageUrl,
                                    designTemplatePageCount: u.designTemplatePageCount,
                                    forVipFree: u.forVipFree,
                                    height: u.height,
                                    isCollected: u.true,
                                    kindTitle: u.kindTitle,
                                    price: u.price,
                                    templateTitle: u.templateTitle,
                                    useTimes: u.useTimes,
                                    viewTimes: u.viewTimes,
                                    width: u.width
                                },
                                h.push(f);
                            r.resultCount = r.templates.length,
                            r.queryDesignTemplateBeanList = h
                        } else
                            -1 == r.code ? c.back({
                                str: "获取收藏模版失败！",
                                kind: "warning"
                            }) : -2 == r.code ? d.show() : -3 == r.code && (r.totalCount = 0,
                            r.queryDesignTemplateBeanList = []);
                    s(r)
                }
            })
        },
        createDiv: function(e, t, i, o, n, r) {
            var l = a(e).addClass(t).css({
                top: i,
                left: o,
                height: n,
                width: r
            });
            return l
        },
        getFontWH: function(e, a, t) {
            var i = 1;
            a > 1e3 && (i = 50,
            a /= 50);
            var o = document.getElementById("text-speakable");
            o.style.display = "block",
            o.style["font-size"] = a + "px",
            o.style["font-family"] = t,
            o.innerHTML = e;
            var n = o.getBoundingClientRect();
            return o.style.display = "none",
            {
                width: (n.right - n.left) * i,
                height: (n.bottom - n.top) * i
            }
        },
        uploadMaterialCallBack: t.noop,
        uploadMaterialAndChoose: function(e) {
            this.uploadMaterialCallBack = e,
            a("#filePicker").click()
        },
        uploadMaterialPersonal: function(e, i, o) {
            void 0 == o && (o = t.noop);
            for (var n = this, r = [], s = 20971520, d = 0; d < e.length; d++) {
                if (e[d].size >= s || !/image\/\w+/.test(e[d].type))
                    return void c.back({
                        str: "支持上传20M以下的图片！",
                        kind: "warning"
                    });
                r.push(e[d])
            }
            var p, f = r.length;
            if (void 0 == window.personalMaterialData ? (window.personalMaterialData = {
                page: {
                    pageNo: 1,
                    pageTotal: 0,
                    recordCount: 0,
                    recordData: []
                }
            },
            p = []) : p = window.personalMaterialData.page.recordData,
            window.personalMaterialData.page.recordCount <= 0 && (window.personalMaterialData.page.pageTotal = Math.ceil(f / l.MATERIAL_PAGE_SIZE),
            window.personalMaterialData.page.recordCount = f),
            !(0 >= f)) {
                for (var d = 0; d < r.length; d++) {
                    var u = new FileReader;
                    u.readAsDataURL(r[d]),
                    u.fileType = r[d].type,
                    u.onload = function(e) {
                        var s = (new Date).getTime() + parseInt(1e4 * Math.random())
                          , d = new Image;
                        d.onload = function() {
                            f--;
                            var c = {
                                h: d.height,
                                w: d.width,
                                imgurl: e.target.result,
                                uploadImgId: s
                            };
                            if (p.unshift(c),
                            0 == f) {
                                var h = {
                                    pageNo: 1,
                                    pageSize: l.MATERIAL_PAGE_SIZE,
                                    fid: a("#filePicker").attr("data-id"),
                                    w: 180
                                };
                                2 == a("#folderKindWrap").attr("data-drag") && (h.tid = window.TEAM_ID),
                                a("#leadingMaterialWrap").children().detach(),
                                n.loadMaterialPersonal(n, window.personalMaterialData, n._ajax_url.queryMaterialsInFolder, h, [0, 0, 0], "leadingMaterialWrap", t.noop);
                                var m = new g;
                                return m.fileType = u.fileType,
                                m.fileList = p.slice(0, r.length),
                                m.fileLength = r.length,
                                m.index = -1,
                                m.startUpload(),
                                m.insertPage = i,
                                m.chuangkit = n,
                                void (m.callback = o)
                            }
                        }
                        ,
                        d.src = e.target.result
                    }
                }
                n.uploadMaterialCallBack = t.noop
            }
        }
    };
    return a.fn.extend({
        getHeight: function() {
            if (void 0 == a(this)[0])
                return 0;
            if (void 0 == a(this)[0].style)
                return a(this).height();
            var e = parseFloat(a(this)[0].style.height);
            return isNaN(e) ? a(this).height() : e
        },
        getWidth: function() {
            if (void 0 == a(this)[0])
                return 0;
            if (void 0 == a(this)[0].style)
                return a(this).width();
            var e = parseFloat(a(this)[0].style.width);
            return isNaN(e) ? a(this).width() : e
        },
        createClone: function(e) {
            var t, i = (a(this),
            a(this).children()), o = i.clone(), n = i.offset().top, r = i.offset().left, l = a(this).getHeight(), s = a(this).getWidth(), d = a(this).attr("data-type");
            return t = e.createDiv("<div></div>", "sourceCloneDiv", n, r, l, s),
            a(this).hasClass("imgMaterial") ? t.addClass("imgMaterial") : a(this).hasClass("svgMaterial") ? t.addClass("svgMaterial") : a(this).hasClass("textMaterial") ? t.addClass("textMaterial") : a(this).hasClass("groupMaterial") && t.addClass("groupMaterial"),
            a(this).hasClass("backgroundMaterial") && t.addClass("backgroundMaterial"),
            t.append(o),
            t.attr("data-type", d),
            t
        }
    }),
    a.extend({
        colorMove: function(e) {
            a("#color-pickup-color").css("background-color", e);
            {
                var t = Oa._owner_design;
                t.getCurPage()
            }
            if ("back" == a("#color-pickup").attr("data-kind"))
                J(e, Oa, !0),
                Oa._background_drag = !0;
            else {
                var i = a(".element-edit-bar").find(".ele-color").index(a(".element-edit-bar").find(".ele-color.now-click"))
                  , o = t._focus_element;
                void 0 != o && o.previewColor(e, i),
                a(".element-edit-bar").find(".ele-color").eq(i).children().css("background-color", e)
            }
        }
    }),
    Oa;
    var Wa, ja, Ba, Fa
});
;/*!/comp/design/Widget.js*/
"use strict";
define("comp/design/Widget", ["comp/b"], function(t) {
    var e = function() {
        this._node = this.createWidget()
    };
    return e.prototype = {
        constructor: e,
        options: {},
        _dom_object: null,
        createWidget: t.noop,
        getNode: function() {
            return this._node
        }
    },
    e
});
;/*!/comp/design/Toolbar.js*/
"use strict";
define("comp/design/Toolbar", ["comp/b", "comp/design/Chuangkit", "comp/design/Widget", "comp/design/toolbar/toolbar_config"], function(o, n, t) {
    function c() {}
    var i = function() {
        var o = this;
        t.call(o),
        c.call(o)
    };
    return i.prototype = {
        constructor: i
    },
    o.classExtend(i, t),
    i
});
;/*!/comp/design/widgets/DataWidget.js*/
"use strict";
define("comp/design/widgets/DataWidget", ["comp/b", "comp/design/Chuangkit", "comp/design/Widget", "components/jquery/jquery"], function(n, t, e, o) {
    function s(n) {
        this._json = o.extend(!0, {}, this._json, n)
    }
    var i = function(n) {
        var t = this;
        e.call(t),
        s.call(t, n)
    };
    return i.prototype = {
        constructor: i,
        _json: {},
        getJson: function() {
            return this._json
        }
    },
    n.classExtend(i, e),
    i
});
;/*!/comp/design/toolbar/PageEditbar.js*/
"use strict";
define("comp/design/toolbar/PageEditbar", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/Widget", "comp/design/toolbar/toolbar_config", "comp/design/Toolbar", "comp/design/widgets/Page", "comp/design/design_config", "widget/pop/pop"], function(e, a, i, o, n, t, s, d, r) {
    function g(e) {
        var a = this;
        e._owner_pageEditbar = a,
        p.call(a)
    }
    function p() {
        var i = this
          , o = a(i.getNode());
        o.find(".page-up").mousedown(function() {
            return e.addSomeMouseClick("画布-上移"),
            e.addBugTrackClick("a3"),
            a(this).hasClass("no-click") ? !1 : void i.pageUp()
        }),
        o.find(".page-down").mousedown(function() {
            return e.addSomeMouseClick("画布-下移"),
            e.addBugTrackClick("a4"),
            a(this).hasClass("no-click") ? !1 : void i.pageDown()
        }),
        o.find(".page-copy").mousedown(function() {
            return e.addSomeMouseClick("画布-复制"),
            e.addBugTrackClick("a1"),
            a(this).hasClass("no-click") ? !1 : (window.MEMENTO_ID = e.now(),
            i.pageCopy(),
            !1)
        }),
        o.find(".page-add").mousedown(function() {
            return e.addSomeMouseClick("画布-新建"),
            e.addBugTrackClick("a2"),
            a(this).hasClass("no-click") ? !1 : (i.pageAdd(),
            !1)
        }),
        o.find(".page-clear").mousedown(function() {
            return e.addSomeMouseClick("画布-清空"),
            e.addBugTrackClick("a5"),
            a(this).hasClass("no-click") ? !1 : void i.pageClear()
        }),
        o.find(".page-del").mousedown(function() {
            return e.addSomeMouseClick("画布-删除"),
            e.addBugTrackClick("a6"),
            a(this).hasClass("no-click") ? !1 : void i.pageDel()
        }),
        o.find(".page-bleed").mousedown(function() {
            e.addBugTrackClick("a9");
            var o = i._owner_page
              , n = o._owner_design;
            return a(this).hasClass("no-click") ? !1 : (a(this).removeClass("new-function"),
            window.localStorage.bleed_new = "true",
            window.MEMENTO_ID = e.now(),
            void (a(this).hasClass("page-bleed-showing") ? (e.addSomeMouseClick("画布-关闭出血"),
            a(".page-bleed").removeClass("page-bleed-showing").find(".page-edit-bar-text").html("出血<br />(印刷裁切)"),
            n.bleed = "false",
            n.hideBleed()) : (e.addSomeMouseClick("画布-开启出血"),
            a(".page-bleed").addClass("page-bleed-showing").find(".page-edit-bar-text").html("关闭出血<br />(印刷裁切)"),
            n.bleed = "true",
            n.showBleed())))
        }),
        o.find(".page_preview").mousedown(function() {
            return e.addSomeMouseClick("画布-预览"),
            a(this).hasClass("no-click") ? !1 : (window.localStorage.preview_new = "true",
            a(this).removeClass("new-function"),
            void (a(this).hasClass("preview-showing") ? (a(".page_preview").removeClass("preview-showing"),
            i.pagePreviewHide()) : (a(".page_preview").addClass("preview-showing"),
            i.pagePreviewShow())))
        })
    }
    var c = function(e) {
        var a = this;
        t.call(a),
        a._owner_page = e,
        g.call(a, e),
        a.show()
    };
    return c.prototype = {
        constructor: c,
        _owner_page: null,
        createWidget: function() {
            return n.getPageEditbar()
        },
        show: function() {
            var e = this._owner_page
              , i = e.getNode();
            e._owner_pageEditbar = this;
            var o = this.getNode();
            i.lastChild.appendChild(o),
            "px" === window.DESIGN_ORIGINAL_UNIT && a(o).find(".page-bleed").css("display", "none")
        },
        setBtnState: function() {
            {
                var e = this._owner_page
                  , i = e._owner_design
                  , o = i.getPageSum();
                e.getIndex()
            }
            o >= window.MAX_PAGE ? (a(".page-copy").addClass("no-click"),
            a(".page-add").addClass("no-click")) : (a(".page-copy").removeClass("no-click"),
            a(".page-add").removeClass("no-click"));
            for (var n = a(this.getNode()), t = 0; o > t; t++)
                a(".page-num").eq(t).html(t + 1);
            a(".page-up").removeClass("no-click"),
            a(".page-down").removeClass("no-click"),
            a(".page-up").eq(0).addClass("no-click"),
            a(".page-down").eq(o - 1).addClass("no-click"),
            1 == o ? a(".page-del").addClass("no-click") : a(".page-del").removeClass("no-click"),
            6 != KIND_ID && 4 != KIND_ID && 20 != KIND_ID ? a(".page_preview").css("display", "none") : a(".page_preview").css("display", "block"),
            "true" == window.localStorage.bleed_new && n.find(".page-bleed").removeClass("new-function")
        },
        setEditbarStyle: function() {
            var e = this._owner_page
              , i = e.getRect()
              , o = i.bottom - i.top
              , n = a(window).width() - i.right;
            o < d.PAGE_EDITBAR_CHANGE_HEIGHT && n > d.PAGE_EDITBAR_CHANGE_MARGIN ? a(".page-edit-bar").addClass("page-edit-bar-landscape") : a(".page-edit-bar").removeClass("page-edit-bar-landscape")
        },
        pageUp: function(i) {
            var o = this
              , n = o._owner_page
              , t = n.getIndex()
              , s = a(n.getNode())
              , d = n._owner_design
              , r = d.pages
              , g = r[t - 1]
              , p = a(g.getNode())
              , c = g._owner_pageEditbar
              , l = parseFloat(s.css("top"))
              , w = parseFloat(p.css("top"));
            window.MEMENTO_ID = e.now(),
            n.moveUp(i),
            s.animate({
                top: w
            }),
            p.animate({
                top: l
            }, function() {
                p.before(s),
                o.setBtnState(),
                c.setBtnState()
            })
        },
        pageDown: function(i) {
            var o = this
              , n = o._owner_page
              , t = n.getIndex()
              , s = a(n.getNode())
              , d = n._owner_design
              , r = d.pages
              , g = r[t + 1]
              , p = a(g.getNode())
              , c = g._owner_pageEditbar
              , l = parseFloat(s.css("top"))
              , w = parseFloat(p.css("top"));
            window.MEMENTO_ID = e.now(),
            n.moveDown(i),
            s.animate({
                top: w
            }),
            p.animate({
                top: l
            }, function() {
                p.after(s),
                o.setBtnState(),
                c.setBtnState()
            })
        },
        pageMoveTo: function(i, o) {
            var n = this
              , t = n._owner_page
              , s = t.getIndex()
              , d = a(t.getNode())
              , r = t._owner_design
              , g = r.pages
              , p = r._owner_pageList
              , c = g[i]
              , l = a(c.getNode());
            i > s ? l.after(d) : l.before(d),
            window.MEMENTO_ID = e.now(),
            t.movePage(i, o),
            p.movePage(s, i, o)
        },
        pageCopy: function(e) {
            var a = this._owner_page;
            void 0 == e && (a = this.pages[e]);
            a.copyAndUndo()
        },
        pageAdd: function() {
            var i = this._owner_page
              , o = i.getDesign()
              , n = i.getJson()
              , t = JSON.parse(JSON.stringify(n))
              , s = i.getIndex();
            t.elems = [],
            t.width = i.width,
            t.height = i.height,
            window.MEMENTO_ID = e.now();
            var d = o.insertPageAndUndo(t, s + 1)
              , g = d.getNode();
            o.setPageScale(),
            a(o._wrap).animate({
                scrollTop: g.style.top
            }),
            this.setEditbarStyle();
            var p = a(this.getNode())
              , c = p.find(".page_preview");
            c.hasClass("preview-showing") && (c.trigger("mousedown"),
            c.trigger("mousedown")),
            "true" === o.bleed && a(".page-bleed").addClass("page-bleed-showing").find(".page-edit-bar-text").html("关闭出血<br />(印刷裁切)");
            var l = o.getPageSum();
            l >= window.MAX_PAGE && r.back({
                str: "页数达到上限",
                kind: "warning"
            })
        },
        pageClear: function() {
            var a = this._owner_page;
            r.confirm({
                str: "清空页面后当前画布上的设计会消失哦！",
                yes: "继续清空",
                successfun: function() {
                    window.MEMENTO_ID = e.now(),
                    a.clear(),
                    a.addWhiteBackgroundAndUndo(!0)
                }
            })
        },
        pageDel: function() {
            var a = this
              , i = a._owner_page
              , o = i.getDesign();
            r.confirm({
                str: "删除页面后当前画布会消失哦！",
                yes: "继续删除",
                successfun: function() {
                    window.MEMENTO_ID = e.now(),
                    o.removePageAndUndo(i)
                }
            })
        },
        pagePreviewShow: function() {
            a(".page_preview").find(".page-edit-bar-text").text("关闭预览");
            var e = this._owner_page
              , i = e.getDesign()
              , o = i.pageScale;
            a("#div_design section").each(function() {
                var e = n.getPagePreview();
                if (a(this).append(e),
                a(this).find(".preview-page-all").css("transform", "scale(" + o + ")"),
                20 == KIND_ID) {
                    var i = a(this).find(".preview_max_bar");
                    i.find(".preview_top_bar_img").bind("click", function() {
                        a(this).hasClass("preview_top_bar_img_up") ? (a(this).parent().css("height", "160px"),
                        a(this).next().css("height", "140px"),
                        a(this).removeClass("preview_top_bar_img_up")) : (a(this).parent().css("height", "90px"),
                        a(this).next().css("height", "70px"),
                        a(this).addClass("preview_top_bar_img_up"))
                    })
                }
            })
        },
        pagePreviewHide: function() {
            a(".page_preview").find(".page-edit-bar-text").text("开启预览"),
            a(".preview-page-all").each(function() {
                a(this).remove()
            })
        }
    },
    e.classExtend(c, t),
    c
});
;/*!/comp/design/widgets/Element.js*/
"use strict";
define("comp/design/widgets/Element", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/widgets/DataWidget", "comp/design/Toolbar", "comp/design/design_config"], function(e, t, o, n, a, s) {
    function i(e, t) {
        var o = this;
        o._owner_page = e,
        e.addElement(o, t);
        o.getNode();
        d.call(o),
        r.call(o),
        h.call(o)
    }
    function r() {
        var t = this
          , o = t.getJson()
          , n = t.getNode()
          , a = o["data-elem"];
        n.setAttribute("opacity", a.opacity),
        this._opacity = a.opacity,
        this._shadow = a.shadow || {
            blur: 3,
            offset: 10,
            opacity: .75,
            show: !1
        },
        this.previewShadow({
            blur: parseInt(this._shadow.blur * s.ZOOM_IN),
            offset: this._shadow.offset * s.ZOOM_IN,
            opacity: this._shadow.opacity,
            show: this._shadow.show
        }, this._shadow.show);
        var i = o.transform;
        n.setAttribute("transform", e.transformScale(i, s.ZOOM_IN)),
        this._transform = i,
        this._lock = a.lock;
        var r = t.getPage();
        if (o.group && (void 0 != r.getJson().elegroups[o.group] || void 0 != r.element_groups[o.group] || window.undo)) {
            var d = o["group-transform"];
            n.setAttribute("transform", e.transformScale(d, s.ZOOM_IN)),
            this._groupTransform = d,
            this._group = o.group
        }
        var h = t.getContentNode()
          , g = o.reverse || "translate(0,0) rotate(0)";
        h.setAttribute("transform", e.transformScale(g, s.ZOOM_IN) || ""),
        this._reverse = g,
        "true" === this._lock && "background" != this._element_type && e.addClass(n, "elementsSonLock")
    }
    function d() {
        {
            var t = this
              , o = t.getPage()
              , n = o.getDesign();
            "pages]" + t.getPage().getIndex() + "]elems]"
        }
        e.dataBinding({
            obj: t,
            prop_name: "width",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "width",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "height",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "height",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "lock",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "lock",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "opacity",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "opacity",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "transform",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "transform",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "reverse",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "reverse",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "group",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "group",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "groupTransform",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "group-transform",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "shadow",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "shadow",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        })
    }
    function h() {
        var e = this
          , o = e.getNode();
        window.addEventListener ? (o.addEventListener("click", function(o) {
            if (o.ctrlKey || o.metaKey || o.shiftKey) {
                var n = e._owner_page
                  , a = n._owner_design
                  , s = a._focus_element;
                if (void 0 != s && a._focus_element._focus_drag && (s._group_drag ? a._focus_element.finishInput(s._group) : a._focus_element.finishInput()),
                e.isBackground() || "true" == e.lock)
                    return !1;
                if ("block" == t(".edit-div-write-wrap").css("display") && n.nodeMousedown(),
                "block" == t("#edit-div").css("display")) {
                    var a = n._owner_design
                      , i = a._owner_editDiv
                      , r = i._owner_element;
                    "elementGroup" !== r._element_type && 0 == n._select_element.length && "true" != r.lock && (n._select_element[0] = r)
                }
                var d = n._select_element.length;
                n._select_element[d] = e,
                n.selectElementUp()
            } else
                e.nodeClick(o);
            return !1
        }, !1),
        o.addEventListener("mousedown", function(o) {
            t(".materialInfoClose").mousedown(),
            e.nodeMousedown(o),
            e.isBackground() || "true" == e.lock || window.SPACE_KEY_DOWN || o.stopPropagation()
        }, !1),
        o.addEventListener("dblclick", function(t) {
            return (t.ctrlKey || t.metaKey || t.shiftKey) && e._group_drag ? !1 : void e.nodeDblclick(t)
        }, !1),
        o.addEventListener("mouseenter", function(t) {
            e.nodeMouseenter(t)
        }, !1),
        o.addEventListener("mouseleave", function(t) {
            e.nodeMouseleave(t)
        }, !1)) : window.attachEvent && (o.attachEvent("onclick", function(o) {
            if (o.ctrlKey || o.metaKey) {
                var n = e._owner_page;
                if ("block" == t(".edit-div-write-wrap").css("display") && n.nodeMousedown(),
                "block" == t("#edit-div").css("display")) {
                    var a = n._owner_design
                      , s = a._owner_editDiv
                      , i = s._owner_element;
                    "elementGroup" !== i._element_type && 0 == n._select_element.length && (n._select_element[0] = i)
                }
                var r = n._select_element.length;
                n._select_element[r] = e,
                n.selectElementUp()
            } else
                e.nodeClick(o);
            return !1
        }),
        o.attachEvent("onmousedown", function(o) {
            t(".materialInfoClose").mousedown(),
            e.nodeMousedown(o),
            e.isBackground() || "true" == e.lock || o.stopPropagation()
        }),
        o.attachEvent("ondblclick", function(t) {
            e.nodeDblclick(t)
        }),
        o.attachEvent("onmouseenter", function(t) {
            e.nodeMouseenter(t)
        }, !1),
        o.attachEvent("onmouseleave", function(t) {
            e.nodeMouseleave(t)
        }, !1))
    }
    var g = function(e, t, o) {
        void 0 == t && (t = e,
        e = void 0),
        n.call(this, t, o),
        i.call(this, e, o)
    };
    return g.prototype = {
        constructor: g,
        _json: {
            "data-type": "unknow",
            "data-elem": {
                "data-key": "",
                opacity: 1
            }
        },
        _owner_page: null,
        _move_drag: !1,
        _width: 0,
        _height: 0,
        _opacity: 1,
        _transform: "",
        _reverse: "",
        _group: "",
        _groupTransform: "",
        _shadow: {},
        _shadowID: 0,
        setNewJson: e.noop,
        getShowNode: function() {
            return this.getContentNode().firstChild
        },
        getSvgWidth: function() {
            var e = this.getNode()
              , o = t(e);
            return parseFloat(o.find("svg")[0].getAttribute("width"))
        },
        getSvgHeight: function() {
            var e = this.getNode()
              , o = t(e);
            return parseFloat(o.find("svg")[0].getAttribute("height"))
        },
        getWidth: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowWidth() * o
        },
        getShowWidth: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBBox().width / s.ZOOM_IN;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealWidth: function() {
            var e = this.getNode();
            return e.getBBox().width
        },
        getHeight: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowHeight() * o
        },
        getShowHeight: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBBox().height / s.ZOOM_IN;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealHeight: function() {
            var e = this.getNode();
            return e.getBBox().height
        },
        getLeft: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBoundingClientRect().left;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealLeft: function() {
            {
                var e = this._owner_page
                  , t = e._owner_design
                  , o = t.pageScale;
                this.getNode()
            }
            return this.getLeft() / o
        },
        getTop: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBoundingClientRect().top;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealTop: function() {
            {
                var e = this._owner_page
                  , t = e._owner_design
                  , o = t.pageScale;
                this.getNode()
            }
            return this.getTop() / o
        },
        setRealLeftTop: function(t, o) {
            var n = o || this.getNode()
              , a = e.setTransformAttr(n.getAttribute("transform"), "translate", t);
            n.setAttribute("transform", a)
        },
        getRect: function(e) {
            var e = e || this.getNode();
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath({
                    svg_node: e.firstChild.firstChild,
                    node: e
                })[0];
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBoundingClientRect();
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getBox: function() {
            var e = this.getNode();
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[1];
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBBox();
            return t(e).find(".seat-rect").css("display", "block"),
            {
                height: o.height,
                width: o.width,
                x: o.x,
                y: o.y
            }
        },
        getShowBox: function() {
            var e = this.getBox();
            return {
                height: e.height / s.ZOOM_IN,
                width: e.width / s.ZOOM_IN,
                x: e.x / s.ZOOM_IN,
                y: e.y / s.ZOOM_IN
            }
        },
        getTranslateLeftTop: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "translate");
            return [parseFloat(o[0]), parseFloat(o[1])]
        },
        getShowTranslateLeftTop: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "translate");
            return [parseFloat(o[0]) / s.ZOOM_IN, parseFloat(o[1]) / s.ZOOM_IN]
        },
        getTransform: function(e) {
            var t = e || this.getNode();
            return t.getAttribute("transform")
        },
        overstepPageDel: function() {
            var e = this.getRect()
              , t = e.left
              , o = e.top
              , n = e.right
              , a = e.bottom
              , s = this._owner_page
              , i = s.getRect()
              , r = i.left
              , d = i.top
              , h = i.right
              , g = i.bottom;
            return r > n || d > a || o > g || t > h ? (s.eleDelAndUndo(this),
            !0) : void 0
        },
        moveByKey: function(o, n) {
            var a = this._owner_page._owner_design
              , i = a._owner_editDiv
              , r = t(i.getNode())
              , d = this.addLeftTop(o * s.ZOOM_IN, n * s.ZOOM_IN);
            r.offset({
                top: d.top,
                left: d.left
            }),
            this.transform = {
                value: e.transformScale(this.getTransform(), 1 / s.ZOOM_IN),
                undo_drag: "noUndo"
            }
        },
        addLeftTop: function(t, o, n) {
            var a = this._owner_page
              , s = a._owner_design
              , i = s.pageScale
              , r = e.getTransformAttr(this.getTransform(n), "translate")
              , d = [parseFloat(r[0]) + t / i, parseFloat(r[1]) + o / i];
            this.setRealLeftTop(d, n);
            var h = this.getRotate(n);
            return this.setRotate(h, n),
            this.getRect()
        },
        setLeft: function(t) {
            var o = this._owner_page
              , n = o._owner_design
              , a = n.pageScale
              , s = e.getTransformAttr(this.getTransform(), "translate")
              , i = [t / a, parseFloat(s[1])];
            this.setRealLeftTop(i);
            var r = this.getRotate();
            return this.setRotate(r),
            this.getRect()
        },
        setTop: function(t) {
            var o = this._owner_page
              , n = o._owner_design
              , a = n.pageScale
              , s = e.getTransformAttr(this.getTransform(), "translate")
              , i = [parseFloat(s[0]), t / a];
            this.setRealLeftTop(i);
            var r = this.getRotate();
            return this.setRotate(r),
            this.getRect()
        },
        setLeftTop: function(e) {
            this.setRealLeftTop(e);
            var t = this.getRotate();
            return this.setRotate(t),
            this.getRect()
        },
        getRotate: function(t) {
            var o = t || this.getNode()
              , n = e.getTransformAttr(o.getAttribute("transform"), "rotate");
            return n[0]
        },
        setRotate: function(t, o) {
            var n = o || this.getNode()
              , a = this.getRealWidth()
              , s = this.getRealHeight()
              , i = a / 2
              , r = s / 2;
            "text" === this._element_type && (r = this.getRotateCenter());
            var d = [t, i, r]
              , h = e.setTransformAttr(n.getAttribute("transform"), "rotate", d);
            n.setAttribute("transform", h)
        },
        getRotateFormNode: function() {
            var e = this.getNode()
              , o = t(e);
            "text" !== this._element_type || this._fontFamilyLoaded || o.find(".fontLoad").css("display", "none");
            var n = this.getBox()
              , a = o.find(".rotate-set-left")[0];
            a.setAttribute("display", "block"),
            a.setAttribute("x", 0),
            a.setAttribute("y", n.height / 2),
            "text" == this._element_type && a.setAttribute("y", n.height / 2 + parseFloat(o.find(".autoline").eq(0).find("rect").attr("y")));
            var s = a.getBoundingClientRect()
              , i = s.left
              , r = s.top
              , d = this.getRect()
              , h = d.left + d.width / 2
              , g = d.top + d.height / 2
              , u = i - h
              , c = r - g
              , l = Math.abs(u)
              , f = Math.abs(c)
              , p = this.rotateDeg(u, c, l, f);
            return a.setAttribute("y", "0"),
            a.setAttribute("display", "none"),
            "text" !== this._element_type || this._fontFamilyLoaded || o.find(".fontLoad").css("display", "block"),
            p
        },
        rotateDeg: function(e, t, o, n) {
            var a, s = 180 * Math.atan(o / n) / Math.PI;
            return a = 0 >= e && 0 > t ? 90 - s : e > 0 && 0 >= t ? 90 + s : e >= 0 && t > 0 ? 270 - s : 270 + s
        },
        getOpacity: function() {
            var e = this.getNode();
            return e.getAttribute("opacity")
        },
        getReverse: function() {
            var t = this.getContentNode();
            return e.transformScale(t.getAttribute("transform"), 1 / s.ZOOM_IN)
        },
        resetPosition: function() {
            var e = this.getNode()
              , t = e.getBoundingClientRect()
              , o = this.getRotate();
            this.setRotate(o);
            var n = e.getBoundingClientRect();
            this.addLeftTop((t.left - n.left) * s.ZOOM_IN, (t.top - n.top) * s.ZOOM_IN)
        },
        getIndex: function() {
            for (var e = this._owner_page, t = e.elements, o = t.length, n = 0; o > n; n++)
                if (this == t[n])
                    return n;
            return -1
        },
        getPage: function() {
            return this._owner_page
        },
        changeIndexAndUndo: function(e, t) {
            var o = this.getIndex()
              , n = e.new_index
              , a = this.getPage()
              , s = a.getIndex()
              , i = a.getDesign()
              , r = e.unshift;
            this.changeIndex(e),
            i.saveDesignAndUndo({
                obj: this,
                loc: "pages]" + s + "]elems]",
                key: o,
                tidx: n,
                type: 2,
                action: "moveIndex",
                unshift: r
            }, t)
        },
        changeIndexAndUndoForCreateGroup: function(e, t) {
            var o = this.getIndex()
              , n = e.new_index
              , a = this.getPage()
              , s = a.getIndex()
              , i = a.getDesign()
              , r = e.unshift;
            if (n !== o) {
                var d = {
                    index: n,
                    element: this,
                    action: "insert"
                };
                a.elements = d,
                i.saveDesignAndUndo({
                    obj: this,
                    loc: "pages]" + s + "]elems]",
                    key: o,
                    tidx: n,
                    type: 2,
                    action: "moveIndex",
                    unshift: r
                }, t)
            }
        },
        changeIndex: function(e) {
            var o = this._owner_page
              , n = o.elements
              , a = this.getNode()
              , s = t(a)
              , i = this.getIndex()
              , r = e.new_index;
            if (r !== i) {
                var d, h = n[r];
                d = h._group_drag ? h._element_group.getNode() : h.getNode();
                var g = t(d);
                if (i > r ? g.before(s) : g.after(s),
                "img_to_back" == e.changeFor)
                    var u = {
                        index: r,
                        element: this,
                        action: "insert"
                    };
                else
                    var u = {
                        index: r,
                        element: this,
                        action: "insert"
                    };
                o.elements = u
            }
        },
        moveTo: function(e) {
            var t = (this.getNode(),
            this._owner_page)
              , o = (t.elements,
            {
                index: e,
                element: this,
                action: "insert"
            });
            t.elements = o
        },
        intersectEle: function(e) {
            var t = this.getRect()
              , o = t.left
              , n = t.top
              , a = t.right
              , s = t.bottom;
            e._group_drag && (e = e._element_group);
            var i = e.getRect()
              , r = i.left
              , d = i.top
              , h = i.right
              , g = i.bottom;
            return o > h || n > g || d > s || r > a ? !1 : !0
        },
        nodeMoveTo: function(e) {
            var o = this.getNode()
              , n = this._owner_page
              , a = n.elements;
            e >= 1 ? a[e - 1]._group_drag ? t(n.element_groups[a[e - 1].getJson().group].getNode()).after(o) : t(a[e - 1].getNode()).after(o) : t(n.getPageSvg()).prepend(o),
            this.moveTo(e)
        },
        nodeClick: function() {
            var e = this._owner_page;
            if (e.nodeMousedown(),
            this._group_drag)
                return !1;
            if (this._move_drag)
                return void (this._move_drag = !1);
            if (this.isBackground() && "false" == this.getJson()["data-elem"]["data-key"])
                return !1;
            var t = e._owner_design
              , o = t._owner_editDiv;
            void 0 != o && o._owner_element != this ? o.show(this) : void 0 != o && o.show(this);
            var n = t._owner_elementEditbar;
            void 0 != n && n._owner_element != this && n.show(this)
        },
        nodeMousedown: function(o) {
            if (!(o.ctrlKey || o.metaKey || o.shiftKey || window.SPACE_KEY_DOWN)) {
                if (this._group_drag)
                    return this._element_group.nodeMousedown(o),
                    !1;
                if ("image/jpeg" == this._img_kind && "true" != window.localStorage.filter && (t(".guide-wrap-filter").css("display", "block").animate({
                    opacity: 1,
                    top: "100px"
                }, 1e3),
                t(".guide-wrap-filter .guide-know").on("click", function() {
                    t(".guide-wrap-filter").fadeOut("slow", function() {})
                })),
                "svgFrame" == this._dataType && "true" != window.localStorage.absorb && (t(".guide-wrap-adsorb").css("display", "block").animate({
                    opacity: 1,
                    top: "100px"
                }, 1e3),
                t(".guide-wrap-adsorb .guide-know").on("click", function() {
                    t(".guide-wrap-adsorb").fadeOut("slow", function() {})
                })),
                "true" != this.lock) {
                    var n = this._owner_page;
                    n.nodeMousedown();
                    var a = n._owner_design;
                    if (this.isBackground())
                        return !1;
                    if (0 != o.button)
                        return !1;
                    {
                        var i = this
                          , r = o.pageX
                          , d = o.pageY;
                        t(this.getNode())
                    }
                    i._move_drag = !1;
                    var h = i.getTranslateLeftTop()
                      , g = this.getRect()
                      , u = {
                        drag: !1,
                        index: 0,
                        imgIndex: 0
                    };
                    n._svgLayoutNum > 0 && "img" == this._element_type && n.svgLayoutWrapCreate();
                    var c, l, f = {
                        left: g.left,
                        right: g.right,
                        top: g.top,
                        bottom: g.bottom,
                        middle_x: (g.left + g.right) / 2,
                        middle_y: (g.top + g.bottom) / 2
                    }, p = n.elementsPositionNotThis([this]), _ = a.pageScale;
                    i.showAnt(),
                    t(document).mousemove(function(e) {
                        var t = e.pageX
                          , o = e.pageY
                          , a = t - r
                          , g = o - d;
                        c = n.changeElePosition(f, a, g),
                        c.i = i.getIndex(),
                        l = n.guideShow(c, p),
                        i.setLeftTop([h[0] + (l.left - f.left) / _ * s.ZOOM_IN, h[1] + (l.top - f.top) / _ * s.ZOOM_IN]),
                        n._svgLayoutNum > 0 && "img" == i._element_type && n.svgLayoutEnter(u, i),
                        Math.abs(t - r) < 2 && Math.abs(o - d) < 2 ? i._move_drag = !1 : (i._move_drag = !0,
                        i.setMoveOpacity(!0))
                    }).mouseup(function() {
                        i.setMoveOpacity(!1);
                        for (var o = 0; o < t(".elementsSonEnter").size(); o++)
                            e.removeClass(t(".elementsSonEnter").eq(o)[0], "elementsSonEnter");
                        if (t(this).off("mousemove").off("mouseup"),
                        t(".moveGuide").detach(),
                        n._svgLayoutNum > 0 && "img" == i._element_type && (n.svgLayoutWrapRemove(u, i),
                        u.drag))
                            return !1;
                        var a = i.overstepPageDel();
                        return a ? !1 : (window.MEMENTO_ID = e.now(),
                        void (i._move_drag && !u.drag ? i.transform = e.transformScale(i.getTransform(), 1 / s.ZOOM_IN) : u.drag || i.nodeClick()))
                    })
                }
            }
        },
        nodeMouseenter: function() {
            this.showAnt()
        },
        showAnt: function() {
            var o = this.getNode()
              , n = t(o)
              , a = n.find(".ant-path")
              , i = a.eq(0)[0]
              , r = a.eq(1)[0];
            n.find(".seat-rect").css("display", "none");
            var d = this.getPage()
              , h = d.getDesign()
              , g = h.pageScale
              , u = parseFloat(this.getShowWidth()) * s.ZOOM_IN
              , c = parseFloat(this.getShowHeight()) * s.ZOOM_IN
              , l = "M 0 0 L " + u + " 0 L " + u + " " + c + " L 0 " + c + " Z";
            if ("text" === this._element_type) {
                var f = this.getBox();
                l = "M 0 " + f.y + " L " + u + " " + f.y + " L " + u + " " + (c + parseFloat(f.y)) + " L 0 " + (c + parseFloat(f.y)) + " Z"
            }
            "background" != this._element_type && e.addClass(o, "elementsSonEnter"),
            i.style.stroke = "#fff",
            i.style.strokeWidth = .8 * s.ZOOM_IN / g,
            i.style.fill = "none",
            r.style.stroke = "#000",
            r.style.strokeWidth = .8 * s.ZOOM_IN / g,
            r.style.fill = "none",
            r.style.strokeDasharray = 4 * s.ZOOM_IN / g,
            i.setAttribute("d", l),
            r.setAttribute("d", l),
            n.find(".seat-rect").css("display", "block")
        },
        nodeMouseleave: function() {
            var e = this.getPage()
              , t = e.getDesign()
              , o = t._owner_editDiv;
            (null == o._owner_element || "elementGroup" != o._owner_element._element_type || this._group != o._owner_element.id) && this.hideAnt()
        },
        hideAnt: function() {
            var t = this.getNode();
            e.removeClass(t, "elementsSonEnter")
        },
        dblclickInGroup: function(e) {
            var t = this._owner_page
              , o = t._owner_design
              , n = o._owner_editDiv
              , a = o._owner_elementEditbar;
            n.showInGroup(this),
            a.showInGroup(this, n._owner_element),
            "text" == this._element_type && this.nodeDblclick(e)
        },
        isBackground: function() {
            return "background" === this.dataType ? !0 : !1
        },
        previewOpacity: function(e) {
            var t = this.getNode();
            t.setAttribute("opacity", e)
        },
        setOpacity: function(e) {
            this.opacity = e
        },
        previewShadowShow: function(e) {
            var t = this.getContentNode()
              , o = JSON.parse(JSON.stringify(this.shadow));
            "off" == e ? (o.show = !1,
            t.setAttribute("filter", "")) : (o.show = !0,
            this._shadowID || this.previewShadow(this.shadow),
            t.setAttribute("filter", "url(#" + this._shadowID + ")"))
        },
        previewShadow: function(e, o) {
            var n = this.shadow
              , a = void 0 != e.blur ? e.blur : n.blur
              , s = void 0 != e.offset ? e.offset : n.offset
              , i = void 0 != e.opacity ? e.opacity : n.opacity;
            if (this._shadowID) {
                var r = t(this.getNode()).find("#" + this._shadowID);
                if (void 0 != e.blur) {
                    var a = e.blur;
                    r.find("feGaussianBlur")[0].setAttribute("stdDeviation", a)
                }
                if (void 0 != e.offset) {
                    var s = e.offset;
                    r.find("feOffset")[0].setAttribute("dx", s),
                    r.find("feOffset")[0].setAttribute("dy", s)
                }
                if (void 0 != e.opacity) {
                    var i = e.opacity;
                    r.find("feComponentTransfer feFuncA")[0].setAttribute("slope", i)
                }
            } else {
                var d = "shadow-" + (new Date).getTime();
                this._shadowID = d;
                var h = document.createElementNS("http://www.w3.org/2000/svg", "defs")
                  , r = document.createElementNS("http://www.w3.org/2000/svg", "filter");
                r.setAttribute("id", d),
                r.setAttribute("width", "1000%"),
                r.setAttribute("height", "1000%");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "feGaussianBlur");
                g.setAttribute("stdDeviation", a),
                g.setAttribute("in", "SourceAlpha");
                var u = document.createElementNS("http://www.w3.org/2000/svg", "feOffset");
                u.setAttribute("dx", s),
                u.setAttribute("dy", s),
                u.setAttribute("result", "offsetblur");
                var c = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer")
                  , l = document.createElementNS("http://www.w3.org/2000/svg", "feFuncA");
                l.setAttribute("type", "linear"),
                l.setAttribute("slope", i),
                c.appendChild(l);
                var f = document.createElementNS("http://www.w3.org/2000/svg", "feMerge")
                  , p = document.createElementNS("http://www.w3.org/2000/svg", "feMergeNode")
                  , _ = document.createElementNS("http://www.w3.org/2000/svg", "feMergeNode");
                p.setAttribute("in", "SourceGraphic"),
                f.appendChild(_),
                f.appendChild(p),
                r.appendChild(g),
                r.appendChild(u),
                r.appendChild(c),
                r.appendChild(f),
                h.appendChild(r),
                this.getNode().appendChild(h)
            }
            if (o) {
                var v = this.getContentNode();
                v.setAttribute("filter", "url(#" + this._shadowID + ")")
            }
        },
        setShadow: function(e) {
            var t = JSON.parse(JSON.stringify(this.shadow))
              , o = void 0 != e.blur ? e.blur : t.blur
              , n = void 0 != e.offset ? e.offset : t.offset
              , a = void 0 != e.opacity ? e.opacity : t.opacity
              , s = void 0 != e.show ? e.show : t.show;
            t.opacity = a,
            t.blur = o,
            t.offset = n,
            t.show = s,
            this.shadow = {
                value: t
            }
        },
        undoShadow: function(e) {
            var t = JSON.parse(JSON.stringify(this.shadow))
              , o = void 0 != e.blur ? e.blur : t.blur
              , n = void 0 != e.offset ? e.offset : t.offset
              , a = void 0 != e.opacity ? e.opacity : t.opacity
              , i = void 0 != e.show ? e.show : t.show;
            t.blur = o,
            t.offset = n,
            t.opacity = a,
            t.show = i,
            this.shadow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.previewShadow({
                blur: parseInt(this.shadow.blur * s.ZOOM_IN),
                offset: this.shadow.offset * s.ZOOM_IN,
                opacity: this.shadow.opacity,
                show: this.shadow.show
            })
        },
        setVerticalReverse: function() {
            var t = this.getJson()
              , o = t["data-elem"]
              , n = this.getContentNode()
              , a = n.getAttribute("transform") || ""
              , i = e.getTransformAttr(a, "matrix")
              , r = e.getTransformAttr(a, "translate");
            0 == i[0] ? (i = [1, 0, 0, -1, 0, 0],
            r[1] = -o.height * s.ZOOM_IN) : "-1" == i[3] ? (i[3] = 1,
            r[1] = 0) : (i[3] = -1,
            r[1] = -o.height * s.ZOOM_IN),
            a = e.setTransformAttr(a, "matrix", i),
            a = e.setTransformAttr(a, "translate", r),
            n.setAttribute("transform", a),
            this.reverse = e.transformScale(a, 1 / s.ZOOM_IN),
            "text" === this._element_type && this.saveParagraphs()
        },
        setHorizontalReverse: function() {
            var t = this.getJson()
              , o = t["data-elem"]
              , n = this.getContentNode()
              , a = n.getAttribute("transform") || ""
              , i = e.getTransformAttr(a, "matrix")
              , r = e.getTransformAttr(a, "translate");
            0 == i[0] ? (i = [-1, 0, 0, 1, 0, 0],
            r[0] = -o.width * s.ZOOM_IN) : "-1" == i[0] ? (i[0] = 1,
            r[0] = 0) : (i[0] = -1,
            r[0] = -o.width * s.ZOOM_IN),
            a = e.setTransformAttr(a, "matrix", i),
            a = e.setTransformAttr(a, "translate", r),
            n.setAttribute("transform", a),
            this.reverse = e.transformScale(a, 1 / s.ZOOM_IN),
            "text" === this._element_type && this.saveParagraphs()
        },
        getContentNode: function() {
            return this.getNode().firstChild
        },
        removeFormGroupAndUndo: function(o) {
            var n = this.getRect()
              , a = n.left
              , i = n.top
              , r = this._owner_page
              , d = r.getPageSvg()
              , h = r.elements
              , g = this.getRotateFormNode()
              , u = this.getIndex()
              , u = this.getIndex()
              , c = this.getNode();
            u >= 1 ? h[u - 1]._group_drag ? t(h[u - 1]._element_group.getNode()).after(c) : t(h[u - 1].getNode()).after(c) : t(d).prepend(c),
            this._group_drag = !1,
            this._group = null,
            delete this.getJson().group,
            this.setRotate(g);
            var l = this.getRect()
              , f = l.left
              , p = l.top;
            this.addLeftTop((a - f) * s.ZOOM_IN, (i - p) * s.ZOOM_IN),
            this.group = {
                value: "",
                undo_drag: o
            },
            this.transform = {
                value: e.transformScale(this.getTransform(), 1 / s.ZOOM_IN),
                undo_drag: o
            },
            this.groupTransform = {
                value: "",
                undo_drag: o
            }
        },
        setNewJsonFormGroup: function(o) {
            var n = this.getRect()
              , a = n.left
              , i = n.top
              , r = this.getRotateFormNode()
              , d = this.getNode()
              , h = (t(d),
            t(d).clone()[0])
              , g = this._owner_page
              , u = g.getPageSvg();
            h.setAttribute("opacity", "1"),
            u.appendChild(h),
            this.setRotate(r, h);
            var c = this.getRect(h)
              , l = c.left
              , f = c.top;
            if (this.addLeftTop((a - l) * s.ZOOM_IN, (i - f) * s.ZOOM_IN, h),
            "text" == this._element_type) {
                var p;
                p = t(h).find("text").size() > 0 ? parseFloat(t(h).find("text")[0].style["font-size"]) / s.ZOOM_IN : parseFloat(this.fontSize),
                this.fontSize = {
                    value: p,
                    undo_drag: o
                },
                this.saveParagraphs()
            }
            this.width = {
                value: this.getShowWidth(),
                undo_drag: o
            },
            this.height = {
                value: this.getShowHeight(),
                undo_drag: o
            },
            this.transform = {
                value: e.transformScale(h.getAttribute("transform"), 1 / s.ZOOM_IN),
                undo_drag: o
            },
            this.groupTransform = {
                value: e.transformScale(d.getAttribute("transform"), 1 / s.ZOOM_IN),
                undo_drag: o
            },
            this.reverse = {
                value: this.getReverse(),
                undo_drag: o
            },
            u.removeChild(h)
        },
        setMoveOpacity: function(e) {
            if (e)
                this.previewOpacity(".5");
            else {
                var t = this.opacity;
                this.previewOpacity(t)
            }
        },
        undoValue: function(e) {
            var t = e.key
              , o = e.val;
            switch (t) {
            case "transform":
                this.undoTransform(o);
                break;
            case "width":
                this.undoWidth(o);
                break;
            case "height":
                this.undoHeight(o);
                break;
            case "reverse":
                this.undoReverse(o);
                break;
            case "opacity":
                this.undoOpacity(o);
                break;
            case "data-colors":
                this.undoColors(o);
                break;
            case "viewBox":
                this.undoViewBox(o);
                break;
            case "vary":
                this.undoVary(o);
                break;
            case "data-xhref-imgs":
                this.undoXhrefImgs(o);
                break;
            case "group-transform":
                this.undoGroupTransform(o);
                break;
            case "fill":
                this.undoColors(o);
                break;
            case "font-size":
                this.undoFontSize(o);
                break;
            case "font-family":
                this.undoFontFamily(o);
                break;
            case "data-align":
                this.undoFontAlign(o);
                break;
            case "data-bold":
                this.undoFontBold(o);
                break;
            case "data-italic":
                this.undoItalic(o);
                break;
            case "data-decoration":
                this.undoDecoration(o);
                break;
            case "wspace":
                this.undoWspace(o);
                break;
            case "vspace":
                this.undoVspace(o);
                break;
            case "html":
                this.undoHtml(o);
                break;
            case "filter":
                this.undoFilter(o);
                break;
            case "data-type":
                this.undoDataType(o);
                break;
            case "lock":
                this.undoLock(o);
                break;
            case "cut-width":
                this.undoCutWidth(o);
                break;
            case "cut-height":
                this.undoCutHeight(o);
                break;
            case "repeat-width":
                this.undoRepeatWidth(o);
                break;
            case "group":
                this._group = null;
                break;
            case "real-width":
                this.undoWidth(o);
                break;
            case "real-height":
                this.undoHeight(o);
                break;
            case "chart-data":
                this.undoChartData(o);
                break;
            case "chart-kind":
                this.undoChartKind(o);
                break;
            case "chart-colors":
                this.undoChartColors(o);
                break;
            case "chart-title":
                this.undoChartTitle(o);
                break;
            case "chart-titleShow":
                this.undoChartTitleShow(o);
                break;
            case "chart-titleColor":
                this.undoChartTitleColor(o);
                break;
            case "chart-titlePosition":
                this.undoChartTitlePosition(o);
                break;
            case "chart-axisShow":
                this.undoChartAxisShow(o);
                break;
            case "chart-axisTitleShow":
                this.undoChartAxisTitleShow(o);
                break;
            case "chart-xAxisTitle":
                this.undoChartXAxisTitle(o);
                break;
            case "chart-yAxisTitle":
                this.undoChartYAxisTitle(o);
                break;
            case "chart-yAxisNumMin":
                this.undoChartYAxisNumMin(o);
                break;
            case "chart-yAxisNumMax":
                this.undoChartXAxisNumMax(o);
                break;
            case "chart-gridShow":
                this.undoChartGridShow(o);
                break;
            case "chart-legendShow":
                this.undoChartLegendShow(o);
                break;
            case "shadow":
                this.undoShadow(o)
            }
        },
        undoGroupTransform: function(t) {
            var o = this.getNode();
            o.setAttribute("transform", e.transformScale(t, s.ZOOM_IN)),
            this.groupTransform = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoTransform: function(t) {
            var o = this.getNode();
            this._group || o.setAttribute("transform", e.transformScale(t, s.ZOOM_IN)),
            this.transform = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoWidth: function(e) {
            var t = this.getShowNode();
            t.setAttribute("width", e * s.ZOOM_IN),
            this.width = {
                value: e,
                undo_drag: "noUndo"
            }
        },
        undoHeight: function(e) {
            var t = this.getShowNode();
            t.setAttribute("height", e * s.ZOOM_IN),
            this.height = {
                value: e,
                undo_drag: "noUndo"
            }
        },
        undoReverse: function(t) {
            var o = this.getContentNode();
            o.setAttribute("transform", e.transformScale(t, s.ZOOM_IN)),
            this.reverse = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoOpacity: function(e) {
            var t = this.getNode();
            t.setAttribute("opacity", e),
            this.opacity = {
                value: e,
                undo_drag: "noUndo"
            }
        },
        setLock: function(t) {
            var o = this.lock
              , n = this.getNode();
            "true" == o ? (this.lock = {
                value: "false",
                undo_drag: t
            },
            e.removeClass(n, "elementsSonLock")) : (this.lock = {
                value: "true",
                undo_drag: t
            },
            "background" != this._element_type && e.addClass(n, "elementsSonLock"))
        },
        undoLock: function() {
            var t = this.lock
              , o = this.getNode();
            "true" == t ? (this.lock = {
                value: "false",
                undo_drag: "noUndo"
            },
            e.removeClass(o, "elementsSonLock")) : (this.lock = {
                value: "true",
                undo_drag: "noUndo"
            },
            "background" != this._element_type && e.addClass(o, "elementsSonLock"))
        },
        seatRectSet: function() {
            if ("text" != this._element_type) {
                t(this.getNode()).find(".seat-rect").remove();
                var o, n, a = e.createSvgNode("rect"), i = this.width, r = this.height, d = this._owner_page._owner_design.pageScale;
                (20 > i * d || 20 > r * d) && (o = 20 > i * d ? 20 / d * s.ZOOM_IN : i * s.ZOOM_IN,
                n = 20 > r * d ? 20 / d * s.ZOOM_IN : r * s.ZOOM_IN,
                a.setAttribute("width", o),
                a.setAttribute("height", n),
                a.setAttribute("opacity", 0),
                a.setAttribute("x", -(o - i * s.ZOOM_IN) / 2),
                a.setAttribute("y", -(n - r * s.ZOOM_IN) / 2),
                a.setAttribute("class", "seat-rect"),
                this.getNode().appendChild(a))
            }
        }
    },
    e.classExtend(g, n),
    g
});
;/*!/comp/design/toolbar/SvgFilter.js*/
define("comp/design/toolbar/SvgFilter", ["components/jquery/jquery", "comp/design/design_config"], function(t) {
    function e(t, e, r) {
        null != e && void 0 != e && e.children().size() <= 1 && null == e.find(".brightness") && this.setBrightness(e, r, 0),
        null != t && void 0 != t && 0 !== t.size() && t.remove()
    }
    function r(t) {
        return t -= 200 / 7,
        0 > t && (t = 200 + t),
        t = n(360 * t / 200, 100, 50),
        {
            color: {
                r: t[0],
                g: t[1],
                b: t[2]
            },
            Dm: 7
        }
    }
    function n(t, e, r) {
        if (t /= 360,
        e /= 100,
        r /= 100,
        0 == e)
            r = e = t = r;
        else {
            var n = .5 > r ? r * (1 + e) : r + e - r * e
              , s = 2 * r - n;
            r = i(s, n, t + 1 / 3),
            e = i(s, n, t),
            t = i(s, n, t - 1 / 3)
        }
        return [Math.round(255 * r), Math.round(255 * e), Math.round(255 * t)]
    }
    function i(t, e, r) {
        return 0 > r && (r += 1),
        r > 1 && --r,
        1 / 6 > r ? t + 6 * (e - t) * r : .5 > r ? e : 2 / 3 > r ? t + (e - t) * (2 / 3 - r) * 6 : t
    }
    function s(t) {
        function e(e) {
            return parseFloat((e * t / -100).toFixed(2))
        }
        if (t > 0) {
            var r = function(e) {
                return parseFloat((e * t / 100).toFixed(2))
            }
              , n = [0, .2, 0, -.1, 0].map(r)
              , i = [0, .1, 0, -.1, 0].map(r)
              , r = [.2, 0, .2].map(r);
            return {
                red: [[0, 0], [.3, .3 - n[1]], [.7, .7 - n[3]], [1, 1]],
                green: [[0, 0], [.25, .25 - i[1]], [.75, .75 - i[3]], [1, 1]],
                blue: [[0, r[0]], [0 + 2 / 3 * .5, r[0] + 2 / 3 * (.5 - r[0])], [1 + 2 / 3 * -.5, 1 - r[2] + 2 / 3 * (.5 - (1 - r[2]))], [1, 1 - r[2]]]
            }
        }
        return n = [0, .2, .5, -.05].map(e),
        i = [0, -.15, 0, 0].map(e),
        r = [0, -.01, 0, .3].map(e),
        {
            red: [[0, 0], [.3, .3 - n[1]], [.7, .7 - n[2]], [.95, .95 - n[3]]],
            green: [[0, 0], [.25, .25 - i[1]], [.6, .6], [1, 1]],
            blue: [[0, 0], [.3, .3 - r[1]], [.5, .5], [1, 1 - r[3]]]
        }
    }
    function a(t, e, r, n) {
        function i(t, e) {
            var r = t * t
              , n = 1 - t
              , i = n * n;
            return e[0] * i * n + 3 * e[1] * i * t + 3 * e[2] * n * r + e[3] * r * t
        }
        for (var s, a, o = 0, c = []; 1 > o; )
            s = i(o, [t.x, e.x, r.x, n.x]),
            a = i(o, [t.y, e.y, r.y, n.y]),
            c.push({
                x: s,
                y: a
            }),
            o += 5e-5;
        var u = [{
            x: t.x,
            y: t.y
        }]
          , l = .05
          , f = null;
        return c.forEach(function(t) {
            null !== f && t.x > l && (u.push(f),
            l += .05),
            f = t
        }),
        u.push({
            x: n.x,
            y: n.y
        }),
        u
    }
    var o = function(t) {
        this._owner_design = t
    };
    return o.prototype = {
        constructor: o,
        _owner_design: null,
        createElement: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", t);
            return e
        },
        createElementSvg: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            return t
        },
        createElementDefs: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            return t
        },
        createElementFilter: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "filter");
            return t
        },
        createElementG: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "g");
            return t
        },
        createElementImage: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "image");
            return t
        },
        createElementClipPath: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "clipPath");
            return t
        },
        createElementRect: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            return t
        },
        createElementBrightness: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer");
            return e.setAttribute("class", "brightness"),
            e.setAttribute("color-interpolation-filters", "sRGB"),
            ["r", "g", "b"].forEach(function(r) {
                var n = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + r.toUpperCase());
                n.setAttribute("type", "linear"),
                n.setAttribute("slope", 1),
                n.setAttribute("intercept", t),
                e.appendChild(n)
            }),
            e
        },
        createElementContrast: function(t, e) {
            return contrast = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer"),
            contrast.setAttribute("class", "contrast"),
            contrast.setAttribute("color-interpolation-filters", "sRGB"),
            ["r", "g", "b"].forEach(function(r) {
                r = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + r.toUpperCase()),
                r.setAttribute("type", "linear"),
                r.setAttribute("slope", t),
                r.setAttribute("intercept", e),
                contrast.appendChild(r)
            }),
            contrast
        },
        createElementSaturation: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feColorMatrix");
            return e.setAttribute("class", "saturation"),
            e.setAttribute("color-interpolation-filters", "sRGB"),
            e.setAttribute("type", "matrix"),
            e.setAttribute("values", t.join(" ")),
            e
        },
        createElementGaussianBlur: function(e) {
            var r = null;
            if (0 > e)
                e *= -1,
                e = e / 100 * 4,
                e = [0, -e, 0, -e, 4 * e + 1, -e, 0, -e, 0],
                r = document.createElementNS("http://www.w3.org/2000/svg", "feConvolveMatrix"),
                r.setAttribute("order", "3"),
                r.setAttribute("kernelMatrix", e.join(" ")),
                r.setAttribute("class", "sharpen");
            else {
                r = document.createElementNS("http://www.w3.org/2000/svg", "feGaussianBlur");
                var n, i = this._owner_design._focus_element;
                if ("img" === i._element_type || "background" === i._element_type) {
                    var s = t(".page").children("svg")[0].getAttribute("viewBox").split(" ");
                    n = parseInt(s[2]) / 1e3
                } else
                    n = 1;
                r.setAttribute("stdDeviation", .125 * n * e),
                r.setAttribute("class", "blur")
            }
            return r
        },
        createElementConvolveMatrix: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feConvolveMatrix");
            return e.setAttribute("class", "convolveMatrix"),
            e.setAttribute("order", "3"),
            e.setAttribute("kernelMatrix", t.join(" ")),
            e
        },
        createElementVignette: function(t, e) {
            var r = document.createElementNS("http://www.w3.org/2000/svg", "radialGradient")
              , n = document.createElementNS("http://www.w3.org/2000/svg", "stop")
              , i = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            r.setAttribute("class", "vignette"),
            r.setAttribute("id", e + "_VIGNETTE"),
            r.appendChild(n),
            r.appendChild(i),
            r.setAttribute("cx", "50%"),
            r.setAttribute("cy", "50%"),
            r.setAttribute("r", "50%"),
            r.setAttribute("fx", "50%"),
            r.setAttribute("fy", "50%");
            var s = .7 / 1.3
              , a = Math.min(1, 1.3);
            return n.setAttribute("offset", s.toString()),
            n.setAttribute("stop-color", "#000000"),
            n.setAttribute("stop-opacity", "0"),
            i.setAttribute("offset", a.toString()),
            i.setAttribute("stop-color", "#000000"),
            i.setAttribute("stop-opacity", t / 100),
            r
        },
        createElementRect: function(t, e) {
            var r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            return r.setAttribute("x", "-75"),
            r.setAttribute("y", "-75"),
            r.setAttribute("width", "650"),
            r.setAttribute("height", "650"),
            r.setAttribute("class", e.getAttribute("class")),
            r.setAttribute("fill", e.getAttribute("id")),
            r
        },
        createElementTint: function(t) {
            var e = r(t + 100)
              , n = {
                r: e.color.r / 255,
                g: e.color.g / 255,
                b: e.color.b / 255
            }
              , i = e.Dm / 100 * 2
              , s = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer");
            return s.setAttribute("class", "tint"),
            s.setAttribute("color-interpolation-filters", "sRGB"),
            ["r", "g", "b"].forEach(function(t) {
                var e = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + t.toUpperCase());
                t = n[t] * i,
                e.setAttribute("type", "linear"),
                e.setAttribute("slope", 1 - i),
                e.setAttribute("intercept", t),
                s.appendChild(e)
            }),
            s
        },
        createElementCrossProcess: function(t) {
            t = s(t);
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer");
            e.setAttribute("color-interpolation-filters", "sRGB"),
            e.setAttribute("class", "crossProcess");
            var r = {
                r: t.red,
                g: t.green,
                b: t.blue
            };
            return ["r", "g", "b"].forEach(function(t) {
                var n = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + t.toUpperCase());
                (t = r[t]) && (t = a({
                    x: t[0][0],
                    y: t[0][1]
                }, {
                    x: t[1][0],
                    y: t[1][1]
                }, {
                    x: t[2][0],
                    y: t[2][1]
                }, {
                    x: t[3][0],
                    y: t[3][1]
                }).map(function(t) {
                    return t.y
                })),
                n.setAttribute("type", "table"),
                n.setAttribute("tableValues", t.join(" ")),
                e.appendChild(n)
            }),
            e
        },
        setBrightness: function(e, r, n) {
            var i = e.find(".brightness")
              , s = this
              , a = e.attr("id");
            n *= .5;
            var o = n / 100;
            if (0 === i.size())
                e.append(s.createElementBrightness(o));
            else {
                var c = t(i).children().toArray();
                c.forEach(function(e) {
                    t(e).attr("intercept", o)
                })
            }
            r.attr("filter", "url(#" + a + ")")
        },
        setContrast: function(r, n, i) {
            var s = r.find(".contrast")
              , a = this
              , o = r.attr("id");
            if (0 !== i) {
                i *= .6;
                var c = (i * (i > 1 ? 1 / .6 : 1) + 100) / 100
                  , u = -(.5 * c) + .5;
                if (0 === s.size())
                    r.append(a.createElementContrast(c, u));
                else {
                    var l = t(s).children().toArray();
                    l.forEach(function(e) {
                        t(e).attr("intercept", u),
                        t(e).attr("slope", c)
                    })
                }
                n.attr("filter", "url(#" + o + ")")
            } else
                e.call(this, s, r, n)
        },
        setSaturation: function(r, n, i) {
            var s = r.find(".saturation")
              , a = this
              , o = r.attr("id");
            0 !== i ? (i > 0 && (i *= .8),
            i = (i + 100) / 100,
            i *= 1 >= i ? 1 : i,
            i = [.3086 + .6914 * i, .6094 - .6094 * i, .082 - .082 * i, 0, 0, .3086 - .3086 * i, .6094 + (1 - .6094) * i, .082 - .082 * i, 0, 0, .3086 - .3086 * i, .6094 - .6094 * i, .082 + .918 * i, 0, 0, 0, 0, 0, 1, 0],
            0 === s.size() ? r.append(a.createElementSaturation(i)) : t(s).attr("values", i.join(" ")),
            n.attr("filter", "url(#" + o + ")")) : e.call(this, s, r, n)
        },
        setGaussianBlur: function(t, r, n) {
            var i = this
              , s = t.attr("id")
              , a = t.find(".blur")
              , o = t.find(".sharpen");
            0 !== n ? (0 !== a.size() ? e.call(this, a, t, r) : 0 !== o.size() && e.call(this, o, t, r),
            n *= .5,
            t.append(i.createElementGaussianBlur(n)),
            r.attr("filter", "url(#" + s + ")")) : (e.call(this, a, t, r),
            e.call(this, o, t, r))
        },
        setTint: function(n, i, s) {
            var a = n.find(".tint")
              , o = this
              , c = n.attr("id");
            if (0 !== s) {
                if (0 === a.size())
                    n.append(o.createElementTint(s));
                else {
                    var u = r(s + 100)
                      , l = {
                        r: u.color.r / 255,
                        g: u.color.g / 255,
                        b: u.color.b / 255
                    }
                      , f = u.Dm / 100 * 2
                      , p = t(a).children().toArray();
                    p.forEach(function(e) {
                        var r = l[e.tagName.substr(6).toLowerCase()] * f;
                        t(e).attr("slope", 1 - f),
                        t(e).attr("intercept", r)
                    })
                }
                i.attr("filter", "url(#" + c + ")")
            } else
                e.call(this, a, n, i)
        },
        setVignette: function(r, n, i) {
            var s = r.parent().find(".vignette")
              , a = this
              , o = r.attr("id");
            if (0 !== i)
                if (i *= .7,
                0 === s.size()) {
                    var s = a.createElementVignette(i, o);
                    t(".vignette").attr("fill", "url(#" + s.getAttribute("id") + ")"),
                    r.after(s),
                    n.attr("filter", "url(#" + o + ")")
                } else {
                    var c = t(s).children().toArray();
                    t.each(c, function(e, r) {
                        0 === e ? t(r).attr("stop-opacity", 0) : t(r).attr("stop-opacity", i / 100)
                    })
                }
            else
                e.call(this, s, r, n)
        },
        setCrossProcess: function(t, r, n) {
            var i = t.find(".crossProcess")
              , s = this
              , a = t.attr("id");
            e.call(this, i, t, r),
            0 !== n && (t.find(".brightness").after(s.createElementCrossProcess(n)),
            r.attr("filter", "url(#" + a + ")"))
        }
    },
    o
});
;/*!/comp/design/widgets/Img.js*/
"use strict";
define("comp/design/widgets/Img", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/widgets/Element", "comp/design/toolbar/toolbar_config", "comp/design/toolbar/SvgFilter", "comp/design/design_config"], function(t, e, a, i, r, s, o) {
    function n() {
        var t = this;
        g.call(t),
        d.call(t),
        this.seatRectSet()
    }
    function d() {
        function t() {
            var t = new Image;
            e.ajax({
                url: "/material/getMaterialUrlsByIds.do",
                type: "POST",
                dataType: "json",
                data: {
                    mids: h.id,
                    w: 800
                },
                success: function(a) {
                    t.src = a.urls[h.id],
                    t.onload = function() {
                        var t = e(this).attr("src");
                        g.href.baseVal = t
                    }
                },
                error: function() {}
            })
        }
        function a() {
            g.setAttribute("width", h.width * o.ZOOM_IN),
            g.setAttribute("height", h.height * o.ZOOM_IN),
            r._width = h.width,
            r._height = h.height,
            r.createFilter(),
            r._filter = h.filter,
            r.setFilterMove()
        }
        function i() {
            if (r._dataType = "img",
            "background" === n["data-type"]) {
                r._dataType = "background",
                r._element_type = "background";
                var t = n["data-elem"];
                r._lock = "true" == t.lock ? "true" : "false",
                d.setAttribute("class", "elementsSon imgSon backgroundSon")
            }
            r._width = r.getShowWidth(),
            r._height = r.getShowHeight()
        }
        {
            var r = this
              , s = r._owner_page
              , n = (s.getIndex(),
            s._owner_design,
            r.getJson())
              , d = r.getNode()
              , g = (e(d),
            r.getImgNode())
              , h = n["data-elem"]
              , c = n["data-img-kind"];
            n["data-key"]
        }
        if (r._img_kind = c,
        r.imgId = h.id,
        void 0 == h["data-key"] && void 0 != h.id && (r.personMaterial = !0),
        "false" != h["data-key"]) {
            if (void 0 == h["data-key"])
                return void (null != window.imgsrc ? (g.href.baseVal = window.imgsrc,
                a(),
                i(),
                window.imgsrc = null,
                t()) : e.ajax({
                    url: "/material/getMaterialUrlsByIds.do",
                    type: "POST",
                    dataType: "json",
                    data: {
                        mids: h.id,
                        w: 120
                    },
                    success: function(e) {
                        var r;
                        r = e.urls[h.id],
                        g.href.baseVal = r,
                        t(),
                        a(),
                        i()
                    },
                    error: function() {
                        console.log("请求img素材错误")
                    }
                }));
            var l;
            l = "image/png" == c ? "//" + img_config.imgdomain + "/materials/" + h["data-key"] + "@120w_1x.png" : "//" + img_config.imgdomain + "/materials/" + h["data-key"] + "@120w_100Q_1x.jpg",
            g.href.baseVal = l;
            var u = new Image;
            u.src = "//" + img_config.imgdomain + "/materials/" + h["data-key"] + "@0e_800w_800h_0c_0i_0o_1x.png",
            u.onload = function() {
                var t = e(this).attr("src");
                g.href.baseVal = t
            }
            ,
            a()
        } else
            void 0 == h["data-colors"] && (h["data-colors"] = {
                0: "#000"
            }),
            r.createBackgroundRect(h["data-colors"][0]);
        i()
    }
    function g() {
        {
            var e = this
              , a = this.getPage()
              , i = a.getDesign();
            "pages]" + e.getPage().getIndex() + "]elems]"
        }
        t.dataBinding({
            obj: e,
            prop_name: "filter",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "filter",
                    value: r,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "dataType",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    key: "data-type",
                    value: r,
                    type: "0",
                    action: "change",
                    unshift: !0
                }, a)
            }
        })
    }
    var h = function(t, e, a) {
        i.call(this, t, e, a),
        n.call(this)
    };
    return h.prototype = {
        constructor: h,
        _element_type: "img",
        _image_type: "img",
        _dataType: "img",
        _img_kind: "jpeg",
        _json: {
            "data-type": "img",
            "data-elem": {
                filter: {
                    brightness: 0,
                    contrast: 0,
                    crossProcess: 0,
                    gaussianBlur: 0,
                    saturation: 0,
                    tint: 0
                }
            }
        },
        _filter: {},
        createWidget: function() {
            var e = t.createSvgNode("g")
              , a = t.createSvgNode("image")
              , i = t.createSvgNode("defs")
              , r = t.createSvgNode("g")
              , s = t.createSvgNode("rect");
            s.setAttribute("width", "1"),
            s.setAttribute("height", "1"),
            s.setAttribute("class", "rotate-set-left"),
            s.setAttribute("opacity", "0"),
            s.setAttribute("display", "none"),
            e.setAttribute("class", "elementsSon imgSon"),
            e.appendChild(r),
            e.appendChild(s),
            r.appendChild(a),
            e.appendChild(i);
            var o = t.createSvgNode("path")
              , n = t.createSvgNode("path");
            return n.setAttribute("class", "ant-path"),
            o.setAttribute("class", "ant-path"),
            e.appendChild(o),
            e.appendChild(n),
            e
        },
        getImgNode: function() {
            return this.getContentNode().firstChild
        },
        nodeDblclick: function() {},
        getSvgWidth: function() {
            var t = this.getNode()
              , a = e(t);
            return parseFloat(a.find("image")[0].getAttribute("width"))
        },
        getSvgHeight: function() {
            var t = this.getNode()
              , a = e(t);
            return parseFloat(a.find("image")[0].getAttribute("height"))
        },
        previewWH: function(e, a) {
            e *= o.ZOOM_IN,
            a *= o.ZOOM_IN;
            var i = (this.getNode(),
            this.getImgNode());
            i.setAttribute("width", e),
            i.setAttribute("height", a);
            var r = this.reverse
              , s = this.getContentNode()
              , n = t.getTransformAttr(r, "translate");
            0 != n[0] && (n[0] = -e),
            0 != n[1] && (n[1] = -a),
            r = t.setTransformAttr(r, "translate", n),
            s.setAttribute("transform", r || "")
        },
        resetWH: function() {
            var t = this.getShowWidth()
              , e = this.getShowHeight();
            this.width = t,
            this.height = e,
            this.reverse = this.getReverse()
        },
        getImgKey: function() {
            var t = this.getJson()
              , e = t["data-elem"];
            return e["data-key"]
        },
        getImgId: function() {
            var t = this.getJson()
              , e = t["data-elem"];
            return e.id
        },
        createBackgroundRect: function(a) {
            var i = this.getNode()
              , r = this.getJson()
              , s = r["data-elem"]
              , n = r.transform || "translate(0,0)";
            i.setAttribute("transform", n);
            var d = this._owner_page
              , g = e(i);
            if (g.find(".background-color").size() > 0)
                g.find(".background-color").attr({
                    fill: a
                });
            else {
                var h = this.getContentNode()
                  , c = this.getImgNode();
                h.removeChild(c);
                var l = t.createSvgNode("rect");
                l.setAttribute("class", "background-color");
                var u = s.width * o.ZOOM_IN || d._width
                  , f = s.height * o.ZOOM_IN || d._height;
                l.setAttribute("x", 0),
                l.setAttribute("y", 0),
                l.setAttribute("width", u),
                l.setAttribute("height", f),
                l.setAttribute("fill", a),
                h.appendChild(l)
            }
        },
        previewBackgroundColor: function(t) {
            this.createBackgroundRect(t)
        },
        setBackgroundColor: function(t) {
            this.createBackgroundRect(t)
        },
        changeSizeByPage: function() {
            var e = this.getPage()
              , a = e.width
              , i = e.height;
            if (!e.compareElementPosition(this)) {
                var r, s, n = this.width, d = this.height;
                n / a > d / i ? (s = parseFloat(i),
                r = i * (n / d)) : (r = parseFloat(a),
                s = a * (d / n));
                var g = "translate(" + (a - r) / 2 + "," + (i - s) / 2 + ")"
                  , h = this.getNode();
                h.setAttribute("transform", t.transformScale(g, o.ZOOM_IN)),
                this.previewWH(r, s),
                this.transform = g,
                this.resetWH()
            }
        },
        imgChangeToBackground: function() {
            if ("img" == this._element_type) {
                var t = this.getPage()
                  , e = t.elements;
                e[0].isBackground() && t.eleDelAndUndoByChangeBackground(e[0]),
                this.dataType = "background",
                this._element_type = "background";
                var a = this.getNode()
                  , i = a.getAttribute("class") + " backgroundSon";
                a.setAttribute("class", i),
                this.changeIndexAndUndo({
                    new_index: 0,
                    unshift: !0
                }),
                this.nodeClick()
            }
        },
        backgroundChangeToImg: function() {
            if ("background" == this._element_type) {
                var t = this.getPage();
                this._element_type = "img",
                this.dataType = "img";
                var e = this.getNode()
                  , a = e.getAttribute("class").replace("backgroundSon", "");
                e.setAttribute("class", a),
                t.addWhiteBackgroundAndUndo(!0),
                this.nodeClick()
            }
        },
        createFilter: function() {
            var a = this._owner_page._owner_design;
            a._focus_element = this;
            var i = e(this.getNode())
              , r = this._owner_page._owner_design._svg_filter
              , s = e(r.createElementFilter())
              , o = "_FILTER_" + t.now() + "_" + Math.floor(1e6 * Math.random());
            s.attr("id", o);
            var n = this.getImgNode();
            n.setAttribute("filter", "url(#" + o + ")");
            var d = i.find("defs");
            d.append(s)
        },
        filterMove: function(t, a) {
            var i = this._owner_page._owner_design._svg_filter
              , r = e(this.getImgNode())
              , s = e(this.getNode())
              , o = (s.find("defs"),
            s.find("defs").find("filter"));
            switch (a) {
            case "brightness":
                i.setBrightness(o, r, parseInt(t));
                break;
            case "contrast":
                i.setContrast(o, r, parseInt(t));
                break;
            case "crossProcess":
                i.setCrossProcess(o, r, parseInt(t));
                break;
            case "gaussianBlur":
                i.setGaussianBlur(o, r, parseInt(t));
                break;
            case "saturation":
                i.setSaturation(o, r, parseInt(t));
                break;
            case "tint":
                i.setTint(o, r, parseInt(t))
            }
        },
        setFilter: function(t) {
            this.filter = {
                value: t
            }
        },
        undoFilter: function(t) {
            this.filter = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setFilterMove()
        },
        setFilterMove: function() {
            var t = this.filter;
            for (var e in t)
                this.filterMove(t[e], e)
        },
        resetElePosition: function(e) {
            this._json = e;
            var a = this.getJson()
              , i = a["data-elem"]
              , r = this.getNode();
            r.setAttribute("opacity", i.opacity);
            var s = a.transform;
            a["group-transform"] && (s = a["group-transform"]),
            r.setAttribute("transform", t.transformScale(s, o.ZOOM_IN));
            var n = this.getContentNode();
            if (n.setAttribute("transform", t.transformScale(a.reverse, o.ZOOM_IN) || ""),
            "false" != i["data-key"]) {
                var d = this.getImgNode();
                d.setAttribute("width", i.width * o.ZOOM_IN),
                d.setAttribute("height", i.height * o.ZOOM_IN),
                this.setFilterMove()
            } else
                this.createBackgroundRect(i["data-colors"][0])
        },
        resetEle: function(e) {
            this._json = e;
            var a = this.getJson()
              , i = a["data-elem"]
              , r = this.getNode();
            r.setAttribute("opacity", i.opacity);
            var s = a.transform;
            a["group-transform"] && (s = a["group-transform"]),
            r.setAttribute("transform", t.transformScale(s, o.ZOOM_IN));
            var n = this.getContentNode();
            if (n.setAttribute("transform", t.transformScale(a.reverse, o.ZOOM_IN) || ""),
            "false" != i["data-key"]) {
                var d = this.getImgNode();
                d.setAttribute("width", i.width * o.ZOOM_IN),
                d.setAttribute("height", i.height * o.ZOOM_IN),
                this.setFilterMove()
            } else
                this.createBackgroundRect(i["data-colors"][0])
        },
        getNewJson: function() {
            var t = this._json;
            t.transform = this.transform,
            t["group-transform"] = this.groupTransform,
            t.group = this.group,
            t["data-type"] = this.dataType,
            t.reverse = this.reverse;
            var e = t["data-elem"];
            return e.shadow = this._shadow,
            e.width = this.width,
            e.height = this.height,
            e.filter = this.filter,
            e.opacity = this.opacity,
            JSON.parse(JSON.stringify(t))
        },
        undoDataType: function(t) {
            if (this.dataType = {
                value: t,
                undo_drag: "noUndo"
            },
            this._element_type = t,
            "img" === t) {
                var e = this.getNode()
                  , a = e.getAttribute("class").replace("backgroundSon", "");
                e.setAttribute("class", a)
            }
            if ("background" === t) {
                var e = this.getNode()
                  , a = e.getAttribute("class") + " backgroundSon";
                e.setAttribute("class", a)
            }
        },
        setNewJson: function() {},
        reseatBackgroundPosition: function(t, a, i) {
            i || (t = -t,
            a = -a);
            var r, s = this.getRealWidth(), o = this.getRealHeight(), n = this.getPage(), d = {
                width: n.width,
                height: n.height
            }, g = this.getNode(), h = e(g);
            if (r = h.find(".background-color").size() > 0 ? !0 : !1,
            s / d.width <= o / d.height) {
                var c = o / s;
                s = parseFloat(s) + 2 * parseFloat(t),
                o = r ? parseFloat(o) + 2 * parseFloat(a) : parseFloat(o) + 2 * parseFloat(a) * c
            } else {
                var c = s / o;
                o = parseFloat(o) + 2 * parseFloat(a),
                s = r ? parseFloat(s) + 2 * parseFloat(t) : parseFloat(s) + 2 * parseFloat(t) * c
            }
            h.find(".background-color").size() > 0 ? h.find(".background-color").attr({
                width: s,
                height: o
            }) : h.find("image").size() > 0 && h.find("image").attr({
                width: s,
                height: o
            });
            var l = this.getShowWidth()
              , u = this.getShowHeight();
            this.width = {
                value: l,
                undo_drag: "noUndo"
            },
            this.height = {
                value: u,
                undo_drag: "noUndo"
            }
        },
        cutOut: function() {
            var e = this.getImgNode();
            window.imgsrc = e.href.baseVal;
            var a, i, r, s, n, d, g = this.getNewJson(), h = g["data-elem"], c = h.width, l = h.height, u = 0, f = 0;
            l > c ? (a = c,
            i = c,
            r = 120,
            s = l / c * 120,
            n = 0,
            d = -(s - 120) / 2,
            u = 0,
            f = (l - c) / 2) : (a = l,
            i = l,
            s = 120,
            r = c / l * 120,
            d = 0,
            n = -(r - 120) / 2,
            f = 0,
            u = (c - l) / 2);
            var m = {
                "data-type": "svgFrame",
                "data-img-kind": "image/svg+xml",
                transform: g.transform,
                reverse: g.reverse,
                group: "",
                "group-transform": "",
                "data-elem": {
                    id: "cut1",
                    "data-key": "sys/cut/rect.svg",
                    width: a,
                    height: i,
                    opacity: h.opacity,
                    "data-xhref-imgs": {
                        sorb_1: {
                            "data-class": "sorb_1",
                            "data-img-key": h["data-key"],
                            x: n,
                            y: d,
                            width: r,
                            height: s,
                            transform: "",
                            id: h.id
                        }
                    },
                    "cut-width": "120",
                    "cut-height": "120",
                    filter: h.filter,
                    "data-colors": {},
                    vary: {},
                    viewBox: "0 0 120 120"
                }
            }
              , p = this.getPage()
              , v = p.getDesign()
              , _ = v.pageScale;
            p.eleDelAndUndo(this);
            var b = p.createElementAndUndo({
                json: m,
                unshift: !0
            });
            b.imgform = !0,
            b.addLeftTop(u * _ * o.ZOOM_IN, f * _ * o.ZOOM_IN),
            b.transform = {
                value: t.transformScale(b.getTransform(), 1 / o.ZOOM_IN),
                undo_drag: "noUndo"
            }
        }
    },
    t.classExtend(h, i),
    h
});
;/*!/comp/design/widgets/Text.js*/
"use strict";
define("comp/design/widgets/Text", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/widgets/Element", "comp/design/toolbar/toolbar_config", "libs/jquery/jquery.transit.min", "widget/pop/pop", "comp/design/design_config"], function(t, e, i, a, o, n, s, r) {
    function h() {
        {
            var t = this;
            t.getJson()
        }
        d.call(t),
        g.call(t)
    }
    function g() {
        var t = this
          , e = t.getJson()
          , i = t.getNode()
          , a = (e.html,
        e["data-elem"]);
        i.setAttribute("opacity", a.opacity),
        t._width = a.width,
        t._height = a.height,
        t._fontSize = a["font-size"],
        t._fontFamily = a["font-family"],
        t._fontAlign = a["data-align"],
        t._bold = a["data-bold"],
        t._italic = a["data-italic"],
        t._decoration = a["data-decoration"],
        t._wspace = a.wspace || 0,
        t._vspace = a.vspace || 0,
        t._html = e.html,
        t._colors = a.fill,
        t._paragraphs = a.paragraphs,
        t._start_paragraphs = t.getFontPosition(a.paragraphs),
        t._fontFamilyLoaded = !1,
        t.textShow(),
        t.setFontFamily()
    }
    function d() {
        {
            var e = this
              , i = this.getPage()
              , a = i.getDesign();
            "pages]" + e.getPage().getIndex() + "]elems]"
        }
        t.dataBinding({
            obj: e,
            prop_name: "colors",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "fill",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "fontSize",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "font-size",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "fontFamily",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "font-family",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "fontAlign",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-align",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "bold",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-bold",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "italic",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-italic",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "decoration",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-decoration",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "wspace",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "wspace",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "vspace",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "vspace",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "html",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    key: "html",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        })
    }
    var l = function(t, e, i) {
        a.call(this, t, e, i),
        h.call(this, t)
    };
    return l.prototype = {
        constructor: l,
        _element_type: "text",
        _focus_drag: !1,
        _colors: "",
        _fontSize: "",
        _fontFamily: "",
        _fontAlign: "",
        _bold: "",
        _italic: "",
        _decoration: "",
        _wspace: "",
        _vspace: "",
        _html: "",
        _paragraphs: [],
        _start_paragraphs: [],
        _input_point: {},
        createWidget: function() {
            var e = t.createSvgNode("g");
            e.setAttribute("class", "elementsSon textSon");
            var i = t.createSvgNode("rect");
            i.setAttribute("width", "1"),
            i.setAttribute("height", "1"),
            i.setAttribute("class", "rotate-set-left"),
            i.setAttribute("opacity", "0"),
            i.setAttribute("display", "none");
            var a = t.createSvgNode("g");
            e.appendChild(a),
            e.appendChild(i);
            var o = t.createSvgNode("path")
              , n = t.createSvgNode("path");
            return n.setAttribute("class", "ant-path"),
            o.setAttribute("class", "ant-path"),
            e.appendChild(o),
            e.appendChild(n),
            e
        },
        createParagraph: function(e) {
            var i = t.createSvgNode("g");
            return i.setAttribute("class", "paragraph"),
            i.setAttribute("transform", e),
            i
        },
        createAutoline: function(e, i, a, o) {
            var n = t.createSvgNode("g");
            n.setAttribute("class", "autoline"),
            n.setAttribute("transform", e),
            i.appendChild(n);
            var s = t.createSvgNode("rect");
            s.setAttribute("class", "autoline-rect"),
            s.setAttribute("opacity", "0"),
            n.appendChild(s);
            var r = a || this.getFontFocusSize()
              , h = this.getFontFocusFamily()
              , g = t.createSvgNode("text");
            g.style["font-size"] = r + "px",
            g.style["font-family"] = h,
            g.setAttribute("text-rendering", "geometricPrecision"),
            g.setAttribute("x", 0),
            g.innerHTML = "x",
            n.appendChild(g);
            var d = n.getBBox()
              , l = o || this.getTextMaxWidth();
            return s.setAttribute("x", d.x),
            s.setAttribute("y", d.y),
            s.setAttribute("width", l),
            s.setAttribute("height", 1),
            n.removeChild(g),
            n
        },
        getPosition: function() {
            var t = this.getRect()
              , e = this.getPage()
              , i = e.getRect()
              , a = e.getDesign().pageScale;
            return [(parseFloat(t.left) - parseFloat(i.left)) / a, (parseFloat(t.top) - parseFloat(i.top)) / a]
        },
        getHtml: function() {
            return this.html
        },
        getRotateCenter: function() {
            var t = this.getNode()
              , e = t.getBBox()
              , i = e.height / 2 + e.y;
            return i
        },
        getLineHeight: function() {
            var e, i = this._owner_page, a = i._owner_design, o = a.pageScale, n = this.getBox(), s = n.height / r.ZOOM_IN, h = this._paragraphs, g = t.jsonLength(h);
            e = g;
            for (var d, l = 0; g > l; l++)
                d = h[l].autolines,
                e = t.jsonLength(d) - 1 + e;
            return s / e * o
        },
        getStyleFontSize: function() {
            var t = this.getNode()
              , i = e(t)
              , a = parseFloat(i.find("text")[0].style["font-size"]);
            return a
        },
        getFontFocusSize: function() {
            return this.fontSize
        },
        getFontFocusFamily: function() {
            return this.fontFamily
        },
        getFontFocusColor: function() {
            return this.colors
        },
        getFocusColor: function() {
            return this.colors
        },
        getFontFocusWspace: function() {
            return this.wspace
        },
        getFontFocusVspace: function() {
            return this.vspace
        },
        getFontFocusBold: function() {
            return this.bold
        },
        getFontFocusItalic: function() {
            return "true" == this.italic ? !0 : !1
        },
        getFontFocusDecoration: function() {
            return "true" == this.decoration ? !0 : !1
        },
        getSvgWidth: function() {
            var t = this.getNode()
              , i = e(t);
            return i.find("rect")[0].getAttribute("width")
        },
        previewFontSize: function(t) {
            var i = (this.getJson()["data-elem"],
            this.getFontFocusFamily());
            0 != this._start_paragraphs.length && (this._start_paragraphs = []),
            this.textShow({
                family: i,
                size: t
            });
            var a = this.getLeft()
              , o = this.getTop()
              , n = this.getWidth()
              , s = this.getHeight()
              , r = this._owner_page
              , h = r._owner_design
              , g = h._owner_editDiv
              , d = e(g.getNode());
            e(".editdiv-clone").size() > 0 && (d = e(".editdiv-clone")),
            d.css({
                width: n + 1,
                height: s + 1
            }).offset({
                left: a,
                top: o
            })
        },
        setFontSize: function(t) {
            this.fontSize = t,
            this.saveParagraphs()
        },
        undoFontSize: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                size: t
            }),
            this.fontSize = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        setFontFamilyAndUndo: function(t) {
            {
                var e = this.getPage();
                e.getDesign()
            }
            this.setFontFamily(t, !0)
        },
        undoFontFamily: function(t) {
            this.setFontFamily(t, !0, "noUndo")
        },
        setFontFamily: function(i, a, o) {
            var n = this;
            n.updateFontLoad(!1);
            var s = i || n.fontFamily;
            "微软雅黑" == s && (s = "Microsoft YaHei");
            var h, g = window.FONT_FAMILY[s];
            return void 0 == g ? (s = "SimHei",
            h = r.FONTLOCALHOST + r.FONTFAMILY[s],
            void this.setFontFamily(s, !0, "noUndo")) : (h = g.url,
            n.showFontLoad(),
            void t.addRequestQueue({
                url: h,
                complete: function() {
                    setTimeout(function() {
                        n.hideFontLoad(),
                        e(".font_test").detach();
                        var t, h = s;
                        t = e(n.getNode()).find("text").size() > 0 ? parseFloat(e(n.getNode()).find("text")[0].style["font-size"]) / r.ZOOM_IN : parseFloat(n.fontSize),
                        n.textShow({
                            family: h,
                            size: t,
                            width: parseFloat(e(n.getNode()).find(".autoline-rect").attr("width")) / r.ZOOM_IN
                        }),
                        a && (n.fontFamily = {
                            value: i,
                            undo_drag: o
                        },
                        n.saveParagraphs()),
                        (void 0 == n._paragraphs || void 0 != n._paragraphs && 0 == n._paragraphs.length) && n.saveParagraphs();
                        var g = n.getLeft()
                          , d = n.getTop()
                          , l = n.getWidth()
                          , c = n.getHeight()
                          , p = n._owner_page
                          , u = p._owner_design
                          , f = u._owner_editDiv;
                        if (null != f && f._owner_element == n) {
                            var v = e(f.getNode());
                            e(".editdiv-clone").size() > 0 && (v = e(".editdiv-clone")),
                            v.css({
                                width: l + 1,
                                height: c + 1
                            }).offset({
                                left: g,
                                top: d
                            })
                        }
                        n.updateFontLoad(!0)
                    }, 900)
                },
                error: function() {
                    console.log("返回字体文件失败")
                },
                font: s
            }))
        },
        updateFontLoad: function(t) {
            var e = this;
            e._fontFamilyLoaded = t,
            e._group_drag && e._element_group.uplateTextEleLoaded(t)
        },
        showFontLoad: function() {
            var e = this.getPage()
              , i = e._owner_design
              , a = i.pageScale
              , o = e.getTop()
              , n = this.getTop()
              , s = n - o;
            s /= a;
            var h = this.getShowTranslateLeftTop()
              , g = h[1] - s
              , d = this.getShowWidth()
              , l = this.getShowHeight()
              , c = g - l / 2
              , p = 24
              , u = '<svg width="' + p * r.ZOOM_IN / a + 'px" height="' + p * r.ZOOM_IN / a + 'px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><linearGradient x1="0%" y1="0%" x2="101.999998%" y2="100.999999%" id="linearGradient-1"><stop stop-color="#5EA2FF" offset="0%"></stop><stop stop-color="#00D5FF" offset="62.5956633%"></stop><stop stop-color="#00E3FF" offset="100%"></stop></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" class="fontLoad"><g id="Artboard" fill-rule="nonzero" fill="url(#linearGradient-1)"><g id="加载" transform="translate(7.000000, 6.000000)"><path d="M11,8 C11,12.418278 14.581722,16 19,16 C23.418278,16 27,12.418278 27,8 C27,3.581722 23.418278,2.71558832e-16 19,0 C14.581722,-2.60243881e-16 11,3.581722 11,8 L11,8 Z" id="Shape"></path><path d="M1.31881038e-15,23.9999999 C-3.7265705e-08,26.5008591 1.33419242,28.8117482 3.49999997,30.0621778 C5.66580752,31.3126074 8.33419248,31.3126074 10.5,30.0621778 C12.6658076,28.8117482 14,26.5008591 14,23.9999999 C14,20.1340067 10.8659932,17 7,17 C3.13400675,17 3.76802966e-16,20.1340067 0,23.9999999 L1.31881038e-15,23.9999999 Z" id="Shape" fill-opacity="0.9"></path><path d="M6,41 C5.99999997,43.1435935 7.1435935,45.1243556 8.99999997,46.1961524 C10.8564064,47.2679492 13.1435936,47.2679492 15,46.1961524 C16.8564065,45.1243556 18,43.1435935 18,41 C18,37.6862915 15.3137085,35 12,35 C8.6862915,35 6,37.6862915 6,41 L6,41 Z" id="Shape" fill-opacity="0.8"></path><path d="M22,47 C22,49.7614237 24.2385763,52 27,52 C29.7614237,52 32,49.7614237 32,47 C32,44.2385763 29.7614237,42 27,42 C24.2385763,42 22,44.2385763 22,47 Z" id="Shape" fill-opacity="0.6"></path><path d="M36,40.5 C36,42.9852814 38.0147186,45 40.5,45 C42.9852814,45 45,42.9852814 45,40.5 C45,38.0147186 42.9852814,36 40.5,36 C38.0147186,36 36,38.0147186 36,40.5 L36,40.5 Z" id="Shape" fill-opacity="0.4"></path><path d="M42,29 C42,31.209139 43.790861,33 46,33 C48.209139,33 50,31.209139 50,29 C50,26.790861 48.209139,25 46,25 C43.790861,25 42,26.790861 42,29 Z" id="Shape" fill-opacity="0.3"></path><path d="M42,18 C42,19.6568542 43.3431458,21 45,21 C46.6568542,21 48,19.6568542 48,18 C48,16.3431458 46.6568542,15 45,15 C43.3431458,15 42,16.3431458 42,18 L42,18 Z" id="Shape" fill-opacity="0.2"></path><path d="M36,11.5 C36,12.8807119 37.1192881,14 38.5,14 C39.8807119,14 41,12.8807119 41,11.5 C41,10.1192881 39.8807119,9 38.5,9 C37.1192881,9 36,10.1192881 36,11.5 Z" id="Shape" fill-opacity="0.1"></path></g></g></g></svg>'
              , f = t.createSvgNode("g");
            f.setAttribute("transform", "translate(" + (d * r.ZOOM_IN - p * r.ZOOM_IN / a) / 2 + "," + -(c + p / 2 / a) * r.ZOOM_IN + ")"),
            f.innerHTML = u,
            f.setAttribute("class", "fontLoadWrap");
            var v = this.getNode();
            v.appendChild(f)
        },
        hideFontLoad: function() {
            var t = this.getNode()
              , i = e(t);
            i.find(".fontLoadWrap").remove();
            {
                var a = this._owner_page
                  , o = a._owner_design;
                o._owner_pageList
            }
        },
        previewColor: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                color: t
            })
        },
        setColor: function(t) {
            this.colors = t,
            this.saveParagraphs()
        },
        undoColors: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                color: t
            }),
            this.colors = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        previewBold: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                bold: t
            })
        },
        setBold: function(t) {
            this.bold = t,
            this.saveParagraphs()
        },
        undoFontBold: function(t) {
            this.previewBold(t),
            this.bold = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        setItalic: function(t) {
            var i = this.italic
              , a = e(this.getNode());
            "true" == i ? (this.italic = {
                value: "false",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["font-style"] = ""
            })) : (this.italic = {
                value: "true",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["font-style"] = "italic"
            })),
            this.saveParagraphs()
        },
        undoItalic: function() {
            this.setItalic("noUndo")
        },
        setDecoration: function(t) {
            var i = this.decoration
              , a = e(this.getNode());
            "true" == i ? (this.decoration = {
                value: "false",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["text-decoration"] = ""
            })) : (this.decoration = {
                value: "true",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["text-decoration"] = "underline"
            })),
            this.saveParagraphs()
        },
        undoDecoration: function() {
            this.setDecoration("noUndo")
        },
        setAlign: function(t) {
            this.fontAlign = t;
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e
            }),
            this.saveParagraphs()
        },
        undoFontAlign: function(t) {
            this.fontAlign = {
                value: t,
                undo_drag: "noUndo"
            };
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e
            }),
            this.saveParagraphs()
        },
        previewWspace: function(t) {
            var i = this.getJson()
              , a = (i["data-elem"],
            this.getFontFocusFamily());
            0 != this._start_paragraphs.length && (this._start_paragraphs = []),
            this.textShow({
                family: a,
                wspace: t
            });
            var o = this.getLeft()
              , n = this.getTop()
              , s = this.getWidth()
              , r = this.getHeight()
              , h = this._owner_page
              , g = h._owner_design
              , d = g._owner_editDiv
              , l = e(d.getNode());
            e(".editdiv-clone").size() > 0 && (l = e(".editdiv-clone")),
            l.css({
                width: s + 1,
                height: r + 1
            }).offset({
                left: o,
                top: n
            })
        },
        setWspace: function(t) {
            this.wspace = t,
            this.saveParagraphs()
        },
        undoWspace: function(t) {
            this.previewWspace(t),
            this.wspace = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        previewVspace: function(t) {
            var i = this.getJson()
              , a = (i["data-elem"],
            this.getFontFocusFamily());
            this.textShow({
                family: a,
                vspace: t
            });
            var o = this.getLeft()
              , n = this.getTop()
              , s = this.getWidth()
              , r = this.getHeight()
              , h = this._owner_page
              , g = h._owner_design
              , d = g._owner_editDiv
              , l = e(d.getNode());
            e(".editdiv-clone").size() > 0 && (l = e(".editdiv-clone")),
            l.css({
                width: s + 1,
                height: r + 1
            }).offset({
                left: o,
                top: n
            })
        },
        setVspace: function(t) {
            this.vspace = t,
            this.saveParagraphs()
        },
        undoVspace: function(t) {
            this.previewVspace(t),
            this.vspace = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        getAlign: function() {
            var t = this.fontAlign;
            return (void 0 == t || "" === t) && (t = "left"),
            t
        },
        nodeDblclick: function() {
            var t, i = this.getFontFocusFamily(), a = window.FONT_FAMILY[i];
            if (t = void 0 == a ? !1 : a.is_vip_exclusive,
            t && !window.ISVIP)
                return void s.back({
                    str: "此字体为会员专属字体",
                    kind: "warning"
                });
            this._focus_drag = !0;
            var o = this._owner_page
              , n = o._owner_design
              , h = n.pageScale
              , g = e(o.getNode())
              , d = (g.find("svg")[0],
            this.html)
              , l = this.getWidth()
              , c = this.getHeight()
              , p = this.getLeft()
              , u = this.getTop()
              , f = this.getRotate()
              , v = this.getLineHeight()
              , m = this.getAlign()
              , _ = this.getFontFocusColor()
              , F = this.getFontFocusWspace();
            this._group_drag && (f = this.getRotateFormNode());
            var y = this.getNode()
              , w = e(y)
              , x = w.find(".autoline").eq(0)[0]
              , b = (x.getBoundingClientRect(),
            this.getFontFocusSize() * h)
              , A = document.getElementById(r.ANXID)
              , S = e(A)
              , N = document.getElementById(r.ANXIDCOPY)
              , C = e(N)
              , I = this.opacity;
            S.css({
                width: l,
                height: c,
                display: "block",
                rotate: f + "deg",
                "font-size": b,
                "font-family": i,
                "line-height": Math.round(v) + "px",
                "text-align": m,
                color: _,
                opacity: I,
                "letter-spacing": F / 1e3 + "em"
            }),
            C.css({
                width: l,
                "font-size": b,
                "font-family": i,
                "line-height": Math.round(v) + "px",
                "letter-spacing": F / 1e3 + "em"
            }),
            S.css("true" == this.italic ? {
                "font-style": "italic"
            } : {
                "font-style": "normal"
            }),
            S.offset({
                left: -1e4,
                top: -1e4
            }),
            S.offset({
                left: p,
                top: u
            }),
            A.value = d,
            e(A).addClass("focus-text"),
            A.select(),
            y.style.display = "none";
            var n = o._owner_design
              , L = n._owner_elementEditbar;
            L.hideMoreMenu()
        },
        finishInput: function(i) {
            var a = this.html
              , o = document.getElementById(r.ANXID)
              , n = o.value
              , s = this.getFontFocusFamily();
            a != n && (0 != this._start_paragraphs.length && (this._start_paragraphs = []),
            window.MEMENTO_ID = t.now(),
            this.html = n),
            this.textShow({
                family: s
            }),
            a != n && this.saveParagraphs(),
            void 0 != i && "elementGroup" === i._element_type && (i.resetWH(!0),
            e(".editdiv-clone").detach())
        },
        undoHtml: function(t) {
            this.html = {
                value: t,
                undo_drag: "noUndo"
            };
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e
            }),
            this.saveParagraphs()
        },
        saveParagraphs: function() {
            var t = this
              , e = this.getPage()
              , i = e.getDesign()
              , a = "pages]" + e.getIndex() + "]elems]";
            this._paragraphs = t.getParagraphs(),
            i.saveDesignAndUndo({
                obj: t,
                loc: a + t.getIndex() + "]",
                key: "paragraphs",
                value: t._paragraphs,
                type: "0",
                cLoc: "data-elem]",
                action: "change"
            }, "noUndo")
        },
        textShow: function(a) {
            void 0 == a && (a = {});
            var o = this._start_paragraphs
              , n = 0
              , s = this._owner_page
              , h = s._owner_design
              , g = (h.pageScale,
            this.getJson())
              , d = (g["data-elem"].paragraphs,
            a.html || this._html)
              , l = this.getNode()
              , c = (e(l),
            this.getContentNode())
              , p = e(c);
            if (void 0 != d && void 0 != d.split) {
                d = d.split("\n").join("®");
                var u = d.length
                  , f = (a.width || this.getTextMaxWidth()) * r.ZOOM_IN;
                p.children().detach();
                var v = this.createParagraph("translate(0,0)");
                c.appendChild(v);
                var m, _, F, y = (a.size || this.getFontFocusSize()) * r.ZOOM_IN, w = this.createAutoline("translate(0,0)", v, y, f), x = {
                    x: 0,
                    width: 0
                }, b = a.color || this.getFontFocusColor(), A = (this.getFontFocusItalic(),
                a.bold || this.getFontFocusBold());
                0 === a.bold && (A = a.bold);
                for (var S, N, C = (this.getFontFocusDecoration(),
                a.wspace || this.getFontFocusWspace()), I = a.vspace || this.getFontFocusVspace(), L = 0, P = 0; u > P; P++) {
                    _ = d[P],
                    " " == _ && (_ = "&nbsp;");
                    var O = _.charCodeAt(0);
                    if (!(O >= 0 && 31 >= O || 127 == O))
                        if ("®" != _) {
                            m = t.createSvgNode("text"),
                            m.innerHTML = _,
                            F = x.x + x.width,
                            N = x;
                            var M = A * y / 20 || 0;
                            m.setAttribute("x", F),
                            m.setAttribute("stroke-width", M + "px"),
                            m.setAttribute("stroke", b),
                            m.style["font-size"] = y + "px",
                            m.style["font-style"] = "",
                            m.style["text-decoration"] = "",
                            a.family && (m.style["font-family"] = a.family),
                            m.setAttribute("fill", b),
                            w.appendChild(m),
                            L++,
                            x = i.getFontWH(_, 10 * y, a.family),
                            x = {
                                height: x.height / 10,
                                width: x.width / 10
                            },
                            m.setAttribute("text-rendering", "geometricPrecision"),
                            x.width = "1.0.1" === g.v ? x.width + i.getFontWH("正", 10 * y, a.family).width / 10 * (C / 1e3) : x.width + x.width * (C / 1e3),
                            m.setAttribute("data-width", x.width),
                            m.setAttribute("data-height", x.height),
                            x.x = F,
                            S = x.x + x.width;
                            var z = e(w)
                              , j = z.children()
                              , B = !0;
                            if (0 != o.length) {
                                for (var W = 0, T = 0; n >= T; T++)
                                    W += o[T];
                                B = L > W ? !0 : !1
                            }
                            if (B && S > f && j.length >= 3) {
                                if ("&nbsp;" == _) {
                                    e(m).detach(),
                                    x = N;
                                    continue
                                }
                                var D = t.getTransformAttr(w.getAttribute("transform"), "translate")[1]
                                  , H = w.getBBox()
                                  , k = w;
                                H.height = i.getFontWH("正", 10 * y, a.family).height / 10,
                                w = this.createAutoline("translate(0," + (parseFloat(D) + parseFloat(H.height) + parseFloat(H.height) * (I / 1e3)) + ")", v, y, f),
                                n++,
                                L--,
                                m.setAttribute("x", 0),
                                w.appendChild(m),
                                L++,
                                this.setLineAlign(k, f),
                                x = i.getFontWH(_, 10 * y, a.family),
                                x = {
                                    height: x.height / 10,
                                    width: x.width / 10,
                                    x: 0
                                },
                                x.width = "1.0.1" === g.v ? x.width + i.getFontWH("正", 10 * y, a.family).width / 10 * (C / 1e3) : x.width + x.width * (C / 1e3)
                            }
                        } else {
                            var U = t.getTransformAttr(v.getAttribute("transform"), "translate")[1]
                              , Z = v.getBBox();
                            Z.height = i.getFontWH("正", 10 * y, a.family).height / 10;
                            var E = e(c).children(".paragraph").last().find(".autoline").size()
                              , J = "translate(0," + (parseFloat(U) + parseFloat(Z.height) * E * (1 + I / 1e3)) + ")";
                            this.setLineAlign(w, f),
                            v = this.createParagraph(J),
                            n++,
                            c.appendChild(v);
                            var w = this.createAutoline("translate(0,0)", v, y, f);
                            x = {
                                x: 0,
                                width: 0
                            }
                        }
                }
                this.setLineAlign(w, f),
                l.style.display = "block",
                this.resetPosition(),
                document.getElementById(r.ANXID).style.display = "none",
                this._focus_drag = !1,
                this.setFontStyle()
            }
        },
        setFontStyle: function() {
            var t = this.getNode()
              , i = e(t)
              , a = this.italic
              , o = this.decoration;
            i.find("text").each(function() {
                "true" == a && (e(this)[0].style["font-style"] = "italic"),
                "true" == o && (e(this)[0].style["text-decoration"] = "underline")
            })
        },
        setLineAlign: function(t, i) {
            var a = this.fontAlign;
            if ("left" != a && void 0 != a) {
                var o = e(t)
                  , n = o.children("text")
                  , s = n.last()
                  , r = s[0];
                if (void 0 != r) {
                    var h = (r.getBBox(),
                    parseFloat(r.getAttribute("x")) + parseFloat(r.getAttribute("data-width")))
                      , g = i || parseFloat(this.getTextMaxWidth())
                      , d = 0;
                    "center" == a ? d = (g - h) / 2 : "right" == a && (d = g - h),
                    n.each(function() {
                        e(this).attr("x", parseFloat(e(this).attr("x")) + d)
                    })
                }
            }
        },
        getTextMaxWidth: function() {
            var t = this.width;
            return t
        },
        previewWidth: function(e) {
            var i = this.getFontFocusFamily()
              , a = this.getContentNode()
              , o = this.reverse
              , n = t.getTransformAttr(o, "translate");
            0 != n[0] && (n[0] = -e),
            o = t.setTransformAttr(o, "translate", n),
            a.setAttribute("transform", o || ""),
            0 != this._start_paragraphs.length && (this._start_paragraphs = []),
            this.textShow({
                family: i,
                width: e
            })
        },
        previewWH: function(t) {
            var e = this.fontSize;
            this.previewBig(t, e / this.width * t)
        },
        resetWH: function() {
            var i = this.getNode();
            this.fontSize = parseFloat(e(i).find("text")[0].style["font-size"]) / r.ZOOM_IN,
            this.saveParagraphs();
            var a = this.getShowWidth()
              , o = this.getShowHeight();
            this.width = a,
            this.height = o,
            this.reverse = this.getReverse(),
            this.transform = t.transformScale(this.getTransform(), 1 / r.ZOOM_IN);
            var n = this._owner_page._owner_design._owner_elementEditbar;
            void 0 != n && n.show(this)
        },
        previewBig: function(e, i) {
            var a = this.getFontFocusFamily();
            this.textShow({
                family: a,
                width: e,
                size: i
            });
            var o = this.getJson()
              , n = this.getContentNode()
              , s = t.getTransformAttr(o.reverse, "translate");
            0 != s[0] && (s[0] = -e),
            0 != s[1] && (s[1] = -this.getShowHeight());
            var h = o.reverse;
            h = t.setTransformAttr(h, "translate", s),
            n.setAttribute("transform", t.transformScale(h, r.ZOOM_IN) || "")
        },
        resetWidth: function() {
            this.width = this.getShowWidth(),
            this.height = this.getShowHeight(),
            this.reverse = this.getReverse(),
            this.saveParagraphs()
        },
        undoWidth: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                width: t
            }),
            this.width = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        getParagraphs: function() {
            for (var i, a, o, n, s, h, g, d = this.getNode(), l = [], c = e(d), p = c.find(".paragraph"), u = p.length, f = this.fontSize, v = this.fontFamily, m = this.italic, _ = this.decoration, F = 0; u > F; F++) {
                i = p.eq(F)[0],
                l[F] = {
                    transform: t.transformScale(i.getAttribute("transform"), 1 / r.ZOOM_IN),
                    autolines: []
                },
                a = p.eq(F).find(".autoline"),
                n = a.length;
                for (var y = 0; n > y; y++) {
                    o = a.eq(y)[0],
                    l[F].autolines[y] = {
                        transform: t.transformScale(o.getAttribute("transform"), 1 / r.ZOOM_IN),
                        contents: []
                    },
                    s = a.eq(y).find("text"),
                    h = s.length;
                    for (var w = 0; h > w; w++) {
                        g = s.eq(w)[0];
                        var x = t.htmlUtil(g.innerHTML, !1)
                          , b = x.charCodeAt(0);
                        if (!(b >= 0 && 31 >= b || 127 == b)) {
                            var A = "font-size:" + f + "px;font-family: " + v + ";";
                            "false" != m && m && (A += "font-style: italic;"),
                            "false" != _ && _ && (A += "text-decoration: underline;"),
                            l[F].autolines[y].contents[w] = {
                                "data-txt": x,
                                x: parseFloat(g.getAttribute("x")) / r.ZOOM_IN,
                                "stroke-width": (parseFloat(g.getAttribute("stroke-width")) || 0) / r.ZOOM_IN,
                                fill: g.getAttribute("fill"),
                                style: A,
                                stroke: g.getAttribute("fill")
                            }
                        }
                    }
                }
            }
            return l
        },
        resetEle: function(i) {
            this._json = i;
            {
                var a = this.getJson()
                  , o = this.getJson()["data-elem"]
                  , n = this.getNode();
                e(n)
            }
            n.setAttribute("opacity", o.opacity);
            var s = a.transform;
            a["group-transform"] && (s = a["group-transform"]),
            n.setAttribute("transform", t.transformScale(s, r.ZOOM_IN)),
            this.textShow(),
            this.setFontFamily()
        },
        getNewJson: function() {
            var t = this._json;
            t.transform = this.transform,
            t.html = this.html,
            t["group-transform"] = this.groupTransform,
            t.group = this.group,
            t.reverse = this.reverse;
            var e = t["data-elem"];
            return e.shadow = this._shadow,
            e.width = this.width,
            e.height = this.height,
            e.wspace = this.wspace,
            e.vspace = this.vspace,
            e.fill = this.colors,
            e["font-size"] = this.fontSize,
            e["font-family"] = this.fontFamily,
            e["data-bold"] = this.bold,
            e["data-italic"] = this.italic,
            e["data-decoration"] = this.decoration,
            e["data-align"] = this.fontAlign,
            e.paragraphs = this._paragraphs,
            e.opacity = this.opacity,
            JSON.parse(JSON.stringify(t))
        },
        setNewJson: function() {},
        getFontPosition: function(t) {
            if (void 0 == t)
                return [];
            for (var e, i, a = t.length, o = [], n = 0, s = 0; a > s; s++) {
                e = t[s].autolines;
                for (var r in e)
                    i = e[r].contents,
                    o[n] = i.length,
                    n++
            }
            return o
        }
    },
    t.classExtend(l, a),
    l
});
;/*!/comp/design/widgets/Svg.js*/
"use strict";
define("comp/design/widgets/Svg", ["comp/b", "comp/design/Chuangkit", "comp/design/widgets/Element", "comp/design/toolbar/toolbar_config", "comp/design/widgets/Text", "components/jquery/jquery", "comp/design/design_config"], function(t, e, i, a, r, n, s) {
    function o() {
        var t = this;
        g.call(t),
        d.call(t),
        this.seatRectSet()
    }
    function d() {
        function e(e) {
            var u = e
              , f = u.responseText;
            if (f = f.replace(/SVGID_/g, "SVGID_" + t.now()),
            void 0 != c && d.removeChild(c),
            g.append(f),
            g.find(".cut").size() > 0 && void 0 == l["cut-width"]) {
                var v = i.getViewBoxWH();
                l["cut-width"] = v[0],
                l["cut-height"] = v[1]
            }
            var p = i.getSvgNode()
              , m = g.find("svg").children().not(".rect-position")[0]
              , y = t.createSvgNode("rect");
            if (y.setAttribute("class", "rect-position"),
            y.setAttribute("opacity", "0"),
            g.find("svg").children().eq(0).before(y),
            null != m) {
                var w = m.getAttribute("id");
                i._svg_change_kind = w
            }
            p.setAttribute("width", l.width * s.ZOOM_IN),
            p.setAttribute("height", l.height * s.ZOOM_IN),
            void 0 != l["cut-width"] && (i.setCutWidth(l["cut-width"]),
            i._cutwidth = l["cut-width"]),
            void 0 != l["cut-height"] && (i.setCutHeight(l["cut-height"]),
            i._cutheight = l["cut-height"]),
            void 0 != l["repeat-width"] && (i.setRepeatWidth(l["repeat-width"]),
            i._repeatwidth = l["repeat-width"]);
            var _ = l["data-colors"];
            if (t.isNull(_)) {
                for (var x = 0, b = {}, A = 1; 1; A++) {
                    if (0 == o.find(".color-" + A).size()) {
                        x = A;
                        break
                    }
                    b["color-" + A] = o.find(".color-" + A).attr("fill")
                }
                i.colors = {
                    value: b,
                    undo_drag: "noUndo"
                }
            } else {
                for (var A in _)
                    o.find("." + A).attr("fill", _[A]);
                i._colors = l["data-colors"]
            }
            if (void 0 != l.vary) {
                i.resetVary(),
                i._viewBox = l.viewBox;
                var N = i.getViewBox();
                n(r).find(".rect-position")[0].setAttribute("width", N[2]),
                n(r).find(".rect-position")[0].setAttribute("height", N[3])
            } else
                i.resetSvgWH("noUndo");
            if (o.find(".wbk").size() > 0 && o.find(".wbk").detach(),
            o.find(".hh").size() > 0 && o.find(".hh").detach(),
            o.find(".layoutImgWrap").size() > 0) {
                i._svg_type = "svgLayout",
                "svgFrame" != h["data-type"] && (i.dataType = "svgFrame"),
                a._svgLayoutNum++;
                var I = l["data-xhref-imgs"];
                void 0 == I && (l["data-xhref-imgs"] = {});
                var S = t.jsonLength(I);
                o.find(".layoutImgWrap").each(function() {
                    var t = n(this)
                      , e = t.children().attr("class");
                    if (0 != S) {
                        if (I[e]["data-key"] ? I[e]["data-img-key"] = I[e]["data-key"] : "",
                        t.children().attr({
                            x: I[e].x,
                            y: I[e].y,
                            width: I[e].width,
                            height: I[e].height,
                            "data-key": I[e]["data-img-key"],
                            transform: I[e].transform || ""
                        }),
                        void 0 == I[e]["data-img-key"] && void 0 == I[e].id)
                            t.children().attr({
                                "xlink:href": "",
                                "data-old": ""
                            });
                        else if (void 0 == I[e]["data-img-key"] && void 0 != I[e].id)
                            t.children().attr({
                                "data-id": I[e].id
                            }),
                            null != window.imgsrc ? (t.children().attr({
                                "xlink:href": window.imgsrc,
                                "data-old": window.imgsrc
                            }),
                            window.imgsrc = null) : n.ajax({
                                url: "/material/getMaterialUrlsByIds.do",
                                type: "POST",
                                dataType: "json",
                                data: {
                                    mids: I[e].id,
                                    w: 120
                                },
                                success: function(i) {
                                    var a;
                                    a = i.urls[I[e].id],
                                    t.children().attr({
                                        "xlink:href": a,
                                        "data-old": a
                                    }),
                                    n.ajax({
                                        url: "/material/getMaterialUrlsByIds.do",
                                        type: "POST",
                                        dataType: "json",
                                        data: {
                                            mids: I[e].id,
                                            w: 800
                                        },
                                        success: function(i) {
                                            var a = new Image;
                                            a.onload = function() {
                                                t.children().attr({
                                                    "xlink:href": i.urls[I[e].id],
                                                    "data-old": i.urls[I[e].id]
                                                })
                                            }
                                            ,
                                            a.src = i.urls[I[e].id]
                                        },
                                        error: function() {}
                                    })
                                },
                                error: function() {
                                    console.log("请求img素材错误")
                                }
                            });
                        else {
                            t.children().attr({
                                "xlink:href": "//" + img_config.imgdomain + "/materials/" + I[e]["data-img-key"] + "@120w_1x.png",
                                "data-old": "//" + img_config.imgdomain + "/materials/" + I[e]["data-img-key"] + "@120w_1x.png"
                            });
                            var a = new Image;
                            a.onload = function() {
                                t.children().attr({
                                    "xlink:href": a.src,
                                    "data-old": a.src
                                })
                            }
                            ,
                            a.src = "//" + img_config.imgdomain + "/materials/" + I[e]["data-img-key"] + "@0e_800w_800h_0c_0i_0o_1x.png"
                        }
                        i._xhrefImgs = I
                    } else
                        t.children().attr({
                            "xlink:href": "",
                            "data-old": ""
                        });
                    t.children().attr({
                        "data-x": t.children().attr("x"),
                        "data-y": t.children().attr("y"),
                        "data-width": t.children().attr("width"),
                        "data-height": t.children().attr("height"),
                        "data-transform": t.children().attr("transform")
                    })
                });
                var B = o.find(".layoutImgWrap").size();
                if (0 == S) {
                    for (var A = 0; B > A; A++) {
                        var k = o.find(".layoutImgWrap").eq(A).children();
                        l["data-xhref-imgs"][k.attr("class")] = {
                            "data-class": k.attr("class"),
                            "data-img-key": k.attr("data-key"),
                            x: k.attr("x"),
                            y: k.attr("y"),
                            width: k.attr("width"),
                            height: k.attr("height")
                        }
                    }
                    i._xhrefImgs = l["data-xhref-imgs"]
                }
                i.createFilter(),
                void 0 == l.filter || "" == l.filter ? (l.filter = {
                    brightness: 0,
                    contrast: 0,
                    crossProcess: 0,
                    gaussianBlur: 0,
                    saturation: 0,
                    tint: 0
                },
                i._filter = l.filter,
                i.filterMove(0, "brightness")) : (i._filter = l.filter,
                i.setFilterMove()),
                o.find(".layoutImgWrap").mouseenter(function() {
                    0 == n(".edit-div-write-wrap").size() && (i._layout_index = o.find(".layoutImgWrap").index(n(this)))
                })
            }
            var O = a._owner_design
              , W = O._owner_editDiv
              , j = O._owner_elementEditbar;
            void 0 != W && W._owner_element == i && (W.show(i),
            j.show(i)),
            i.imgform && i.nodeDblclick(),
            window.imgsrc = null
        }
        var i = this
          , a = i._owner_page
          , r = (a.getIndex(),
        a._owner_design,
        i.getNode())
          , o = n(r)
          , d = i.getContentNode()
          , g = n(d)
          , h = i.getJson()
          , l = h["data-elem"];
        i.imgId = l.id;
        var c;
        t.isNull(l["data-key"]) || (c = t.createSvgNode("image"),
        c.href.baseVal = "//" + img_config.imgdomain + "/materials/" + l["data-key"],
        c.setAttribute("width", l.width * s.ZOOM_IN),
        c.setAttribute("height", l.height * s.ZOOM_IN),
        i._width = l.width,
        i._height = l.height,
        d.appendChild(c)),
        n.ajax(void 0 == l["data-key"] ? {
            url: "/material/getMaterialUrlsByIds.do",
            type: "POST",
            dataType: "json",
            data: {
                mids: l.id
            },
            success: function(t) {
                n.ajax({
                    url: t.urls[l.id],
                    type: "GET",
                    error: function() {
                        console.log("返回svg素材错误")
                    },
                    complete: function(t) {
                        e(t)
                    }
                })
            },
            error: function() {}
        } : {
            url: "//" + img_config.imgdomain + "/materials/" + l["data-key"],
            type: "GET",
            error: function() {
                console.log("返回svg素材错误")
            },
            complete: function(t) {
                e(t)
            }
        })
    }
    function g() {
        {
            var e = this
              , i = this.getPage()
              , a = i.getDesign();
            "pages]" + e.getPage().getIndex() + "]elems]"
        }
        t.dataBinding({
            obj: e,
            prop_name: "colors",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-colors",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "viewBox",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "viewBox",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "vary",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "vary",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "xhrefImgs",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-xhref-imgs",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "filter",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "filter",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "dataType",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    key: "data-type",
                    value: r,
                    type: "0",
                    action: "change"
                }, "noUndo")
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "cuttransform",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "cut-transform",
                    value: r,
                    type: "0",
                    action: "change"
                }, "noUndo")
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "cutwidth",
            getFun: t.$noop,
            setFun: function(i) {
                var r = !0
                  , s = i;
                "object" == typeof i && (s = i.value,
                r = i.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "cut-width",
                    value: s,
                    type: "0",
                    action: "change"
                }, r);
                var o = (n(e.getNode()),
                e.getEnable())
                  , d = e.getSvgImageWrapNode()
                  , g = t.getTransformAttr(d[0].getAttribute("transform"), "scale");
                e.cuttransform = "scale(" + parseFloat(s) / o[0] + "," + g[1] + ")"
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "cutheight",
            getFun: t.$noop,
            setFun: function(i) {
                var r = !0
                  , s = i;
                "object" == typeof i && (s = i.value,
                r = i.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "cut-height",
                    value: s,
                    type: "0",
                    action: "change"
                }, r);
                var o = (n(e.getNode()),
                e.getEnable())
                  , d = e.getSvgImageWrapNode()
                  , g = t.getTransformAttr(d[0].getAttribute("transform"), "scale");
                e.cuttransform = "scale(" + g[0] + "," + parseFloat(s) / o[1] + ")"
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "repeatwidth",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "repeat-width",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        })
    }
    var h = function(t, e, a) {
        i.call(this, t, e, a),
        o.call(this)
    };
    return h.prototype = {
        constructor: h,
        _element_type: "svg",
        _svg_type: "svg",
        _layout_index: 0,
        _json: {
            "data-type": "svg",
            "data-elem": {}
        },
        _colors: {},
        _vary: {},
        _viewbox: "",
        _filter: {},
        _xhrefImgs: {},
        createWidget: function() {
            var e = t.createSvgNode("g");
            e.setAttribute("class", "elementsSon svgSon");
            var i = t.createSvgNode("rect");
            i.setAttribute("width", "1"),
            i.setAttribute("height", "1"),
            i.setAttribute("class", "rotate-set-left"),
            i.setAttribute("opacity", "0"),
            i.setAttribute("display", "none");
            var a = t.createSvgNode("g");
            e.appendChild(a),
            e.appendChild(i);
            var r = t.createSvgNode("path")
              , n = t.createSvgNode("path");
            return n.setAttribute("class", "ant-path"),
            r.setAttribute("class", "ant-path"),
            e.appendChild(r),
            e.appendChild(n),
            e
        },
        getEnable: function() {
            var t = this.getSvgNode()
              , e = t.getAttribute("enable-background").split(" ")
              , i = [parseFloat(e[3]), parseFloat(e[4])];
            return i
        },
        getViewBoxWH: function() {
            var t = this.getSvgNode()
              , e = t.getAttribute("viewBox").split(" ")
              , i = [e[2], e[3]];
            return i
        },
        createSvgPath: function(e) {
            void 0 == e && (e = {});
            var i = e.svg_node || this.getSvgNode()
              , a = n(i);
            a.children().css("display", "none");
            var r = this.getViewBoxWH()
              , s = t.createSvgNode("path")
              , o = "M0 0 L" + r[0] + " 0 L" + r[0] + " " + r[1] + " L0 " + r[1] + " Z";
            s.setAttribute("class", "svgLayoutHide"),
            s.setAttribute("d", o),
            i.appendChild(s);
            var d = e.node || this.getNode()
              , g = d.getBoundingClientRect()
              , h = d.getBBox();
            return i.removeChild(s),
            a.children().css("display", "block"),
            [g, h]
        },
        svgLayoutHide: function() {
            var e = this.getSvgNode()
              , i = n(e);
            i.children().css("display", "none");
            var a = this.getViewBoxWH()
              , r = t.createSvgNode("path")
              , s = "M0 0 L" + a[0] + " 0 L" + a[0] + " " + a[1] + " L0 " + a[1] + " Z";
            r.setAttribute("class", "svgLayoutHide"),
            r.setAttribute("d", s),
            e.appendChild(r)
        },
        svgLayoutShow: function() {
            var t = this.getSvgNode()
              , e = n(t);
            e.children().css("display", "block"),
            e.find(".svgLayoutHide").detach()
        },
        getRealWidth: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[1].width;
            var t = this.getNode();
            n(t).find("svg").children().not(".rect-position").css("display", "none"),
            n(t).find(".seat-rect").css("display", "none");
            var e = t.getBBox().width;
            return n(t).find(".seat-rect").css("display", "block"),
            n(t).find("svg").children().not(".rect-position").css("display", "block"),
            e
        },
        getShowWidth: function() {
            return this.getRealWidth() / s.ZOOM_IN
        },
        getShowHeight: function() {
            return this.getRealHeight() / s.ZOOM_IN
        },
        getRealHeight: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[1].height;
            var t = this.getNode();
            n(t).find("svg").children().not(".rect-position").css("display", "none"),
            n(t).find(".seat-rect").css("display", "none");
            var e = t.getBBox().height;
            return n(t).find(".seat-rect").css("display", "block"),
            n(t).find("svg").children().not(".rect-position").css("display", "block"),
            e
        },
        getLeft: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[0].left;
            var t = this.getNode();
            if (n(t).find("svg").children().not(".rect-position").css("display", "none"),
            void 0 != n(t).find("svg")[0]) {
                var e = n(t).find("svg")[0].getAttribute("viewBox")
                  , i = this.getViewBox();
                n(t).find("svg")[0].setAttribute("viewBox", "0 0 " + i[2] + " " + i[3])
            }
            n(t).find(".seat-rect").css("display", "none");
            var a = t.getBoundingClientRect().left;
            return n(t).find(".seat-rect").css("display", "block"),
            n(t).find("svg").children().not(".rect-position").css("display", "block"),
            void 0 != n(t).find("svg")[0] && n(t).find("svg")[0].setAttribute("viewBox", e),
            a
        },
        getRect: function(t) {
            var t = t || this.getNode();
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath({
                    svg_node: t.firstChild.firstChild,
                    node: t
                })[0];
            if (n(t).find(".seat-rect").css("display", "none"),
            n(t).find("svg").children().not(".rect-position").css("display", "none"),
            void 0 != n(t).find("svg")[0]) {
                var e = n(t).find("svg")[0].getAttribute("viewBox")
                  , i = this.getViewBox();
                n(t).find("svg")[0].setAttribute("viewBox", "0 0 " + i[2] + " " + i[3])
            }
            var a = t.getBoundingClientRect();
            return n(t).find(".seat-rect").css("display", "block"),
            n(t).find("svg").children().not(".rect-position").css("display", "block"),
            void 0 != n(t).find("svg")[0] && n(t).find("svg")[0].setAttribute("viewBox", e),
            a
        },
        getTop: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[0].top;
            var t = this.getNode();
            if (n(t).find("svg").children().not(".rect-position").css("display", "none"),
            void 0 != n(t).find("svg")[0]) {
                var e = n(t).find("svg")[0].getAttribute("viewBox")
                  , i = this.getViewBox();
                n(t).find("svg")[0].setAttribute("viewBox", "0 0 " + i[2] + " " + i[3])
            }
            n(t).find(".seat-rect").css("display", "none");
            var a = t.getBoundingClientRect().top;
            return n(t).find(".seat-rect").css("display", "block"),
            n(t).find("svg").children().not(".rect-position").css("display", "block"),
            void 0 != n(t).find("svg")[0] && n(t).find("svg")[0].setAttribute("viewBox", e),
            a
        },
        nodeDblclick: function() {
            if ("svgLayout" == this._svg_type) {
                var t = this.getSvgNode()
                  , e = n(t)
                  , i = this._owner_page
                  , a = i._owner_design;
                if ("svgLayout" == this._svg_type) {
                    var r = e.find(".layoutImgWrap").eq(this._layout_index);
                    if ("" == r.children().attr("xlink:href")) {
                        for (var s = -1, o = 0; o < e.find(".layoutImgWrap").size(); o++)
                            "" != e.find(".layoutImgWrap").eq(o).children().attr("xlink:href") && (s = o);
                        if (-1 == s)
                            return !1;
                        this._layout_index = s
                    }
                    a._owner_editDiv.svgLayoutShow(this)
                }
            }
        },
        getSvgNode: function() {
            return this.getContentNode().firstChild
        },
        setSvgImageLT: function(t, e) {
            t *= s.ZOOM_IN,
            e *= s.ZOOM_IN;
            var i = n(this.getSvgNode())
              , a = i.find(".layoutImgWrap").eq(this._layout_index).children()[0]
              , r = parseFloat(a.getAttribute("x"))
              , o = parseFloat(a.getAttribute("y"))
              , d = parseFloat(a.getAttribute("height"))
              , g = parseFloat(a.getAttribute("width"))
              , h = r + t
              , l = o + e
              , c = this.getSvgImageWrapBox();
            h > c.x ? (t = c.x - r,
            h = c.x) : h + g < c.x + c.width && (t = c.width + c.x - g - r,
            h = c.width + c.x - g),
            l > c.y ? (e = c.y - o,
            l = c.y) : l + d < c.y + c.height && (e = c.height + c.y - d - o,
            l = c.height + c.y - d),
            a.setAttribute("x", h),
            a.setAttribute("y", l),
            a.setAttribute("data-x", h),
            a.setAttribute("data-y", l)
        },
        getSvgImageRect: function() {
            var t = n(this.getSvgNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children()[0].getBoundingClientRect()
        },
        getSvgImageBox: function() {
            var t = n(this.getSvgNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children()[0].getBBox()
        },
        getShowSvgImageBox: function() {
            var t = this.getSvgImageBox();
            return {
                height: t.height / s.ZOOM_IN,
                width: t.width / s.ZOOM_IN,
                x: t.x / s.ZOOM_IN,
                y: t.y / s.ZOOM_IN
            }
        },
        getSvgImageWrapNode: function() {
            var t, e = n(this.getSvgNode()), i = e.find(".layoutImgWrap").eq(this._layout_index);
            return i.parent().find("rect").size() > 0 ? t = i.parent().find("rect") : i.parent().find("circle").size() > 0 ? t = i.parent().find("circle") : i.parent().find("ellipse").size() > 0 ? t = i.parent().find("ellipse") : i.parent().find("line").size() > 0 ? t = i.parent().find("line") : i.parent().find("polyline").size() > 0 ? t = i.parent().find("polyline") : i.parent().find("polygon").size() > 0 ? t = i.parent().find("polygon") : i.parent().find("path").size() > 0 && (t = i.parent().find("path")),
            t
        },
        getSvgImageWrapBox: function() {
            var e = this.getSvgImageWrapNode()
              , i = e[0].getBBox();
            if (null != e[0].getAttribute("transform")) {
                var a = t.getTransformAttr(e[0].getAttribute("transform"), "scale");
                i.width = i.width * a[0],
                i.height = i.height * a[1]
            }
            return i
        },
        getSvgImageWrapRect: function() {
            var t = this.getSvgImageWrapNode();
            return t[0].getBoundingClientRect()
        },
        getSvgScale: function() {
            var t = this.getSvgNode()
              , e = this.getViewBox()
              , i = parseFloat(t.getAttribute("width"));
            return i / parseFloat(e[2])
        },
        setRepeatWidth: function(t) {
            var e = n(this.getNode());
            e.find("rect[class=repeat]").attr("width", t)
        },
        getRepeatWidth: function() {
            var t = n(this.getNode());
            return t.find("rect[class=repeat]").attr("width")
        },
        setCutWidth: function(e) {
            var i = n(this.getNode())
              , a = this.getEnable()
              , r = this.getSvgImageWrapNode()
              , s = t.getTransformAttr(r[0].getAttribute("transform"), "scale");
            i.find(".cut").each(function(t) {
                i.find(".cut").eq(t).attr("data-width", e).attr("transform", "scale(" + e / a[0] + "," + s[1] + ")")
            })
        },
        setCutHeight: function(e) {
            var i = n(this.getNode())
              , a = this.getEnable()
              , r = this.getSvgImageWrapNode()
              , s = t.getTransformAttr(r[0].getAttribute("transform"), "scale");
            i.find(".cut").each(function(t) {
                i.find(".cut").eq(t).attr("data-height", e).attr("transform", "scale(" + s[0] + "," + e / a[1] + ")")
            })
        },
        getCutWidth: function() {
            var t = n(this.getNode());
            return t.find(".cut").attr("data-width")
        },
        getCutHeight: function() {
            var t = n(this.getNode());
            return t.find(".cut").attr("data-height")
        },
        getSvgImageSrc: function() {
            var t = n(this.getSvgNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children().attr("xlink:href")
        },
        getViewBox: function() {
            var t = this.getSvgNode()
              , e = t.getAttribute("viewBox");
            return e.split(" ")
        },
        setViewBox: function(t) {
            var e = this.getSvgNode()
              , i = t[0] + " " + t[1] + " " + t[2] + " " + t[3];
            n(e).find(".rect-position")[0].setAttribute("width", t[2]),
            n(e).find(".rect-position")[0].setAttribute("height", t[3]),
            e.setAttribute("viewBox", i)
        },
        setViewBoxWidth: function(e) {
            var i = this.getSvgNode()
              , a = this.getSvgScale()
              , r = e / a
              , n = this.getViewBox();
            n[2] = r,
            this.setViewBox(n),
            i.setAttribute("width", e);
            var o = this.reverse
              , d = this.getContentNode()
              , g = t.getTransformAttr(o, "translate");
            0 != g[0] && (g[0] = -e / s.ZOOM_IN),
            o = t.setTransformAttr(o, "translate", g),
            d.setAttribute("transform", t.transformScale(o, s.ZOOM_IN) || "")
        },
        setViewBoxHeight: function(e) {
            var i = this.getSvgNode()
              , a = this.getSvgScale()
              , r = e / a
              , n = this.getViewBox();
            n[3] = r,
            this.setViewBox(n),
            i.setAttribute("height", e);
            var o = this.reverse
              , d = this.getContentNode()
              , g = t.getTransformAttr(o, "translate");
            0 != g[1] && (g[1] = -e / s.ZOOM_IN),
            o = t.setTransformAttr(o, "translate", g),
            d.setAttribute("transform", t.transformScale(o, s.ZOOM_IN) || "")
        },
        svgLayoutPreviewWidth: function(t) {
            t *= s.ZOOM_IN;
            var e = this.getSvgScale()
              , i = t / e
              , a = n(this.getSvgNode())
              , r = a.find(".layoutImgWrap").find("image")
              , o = parseFloat(r.attr("x"))
              , d = parseFloat(r.attr("width"));
            i > o + d && (i = o + d),
            t = i * e,
            this.setViewBoxWidth(t),
            this.setCutWidth(i)
        },
        previewWidth: function(e) {
            if ("svgLayout" == this._svg_type)
                return void this.svgLayoutPreviewWidth(e);
            e *= s.ZOOM_IN;
            var i = this.getSvgNode()
              , a = n(i)
              , r = a.children().not(".rect-position")[0]
              , o = this.getSvgScale();
            this.setViewBoxWidth(e);
            var d = e / o;
            if (null != r) {
                var g = r.getAttribute("id");
                if ("hx" == g || "hs" == g) {
                    var h, l;
                    "hx" == g ? (h = [["nw", "n", "ne"]],
                    l = 1) : (h = [["nw", "n", "ne"], ["w", "c", "e"], ["sw", "s", "se"]],
                    l = 3);
                    for (var c = 0; l > c; c++) {
                        var u = a.find("#" + h[c][0])[0]
                          , f = a.find("#" + h[c][1])[0]
                          , v = a.find("#" + h[c][2])[0]
                          , p = {
                            width: 0
                        }
                          , m = {
                            width: 0
                        };
                        if (void 0 != u)
                            var p = u.getBBox();
                        if (void 0 != v) {
                            var m = v.getBBox()
                              , y = v.getAttribute("transform")
                              , w = t.getTransformAttr(y, "translate");
                            w[0] = d - m.width - m.x;
                            var _ = t.setTransformAttr(y, "translate", w);
                            v.setAttribute("transform", _)
                        }
                        if (void 0 != f) {
                            var x = f.getBBox()
                              , b = d - p.width - m.width
                              , A = f.getAttribute("transform")
                              , N = t.getTransformAttr(A, "scale")
                              , I = t.getTransformAttr(A, "translate")
                              , S = b / x.width;
                            N[0] = S,
                            I[0] = -x.x * (S - 1) / S;
                            var B = t.setTransformAttr(A, "scale", N);
                            B = t.setTransformAttr(B, "translate", I),
                            f.setAttribute("transform", B)
                        }
                    }
                } else if ("ry" == g) {
                    var k = r.getBBox()
                      , O = d / k.width
                      , W = r.getAttribute("transform")
                      , j = t.getTransformAttr(W, "scale");
                    0 == j[1] && (j[1] = 1),
                    j[0] = O;
                    var T = t.setTransformAttr(W, "scale", j);
                    r.setAttribute("transform", T)
                } else
                    "hx_def" == g && a.find("rect[class=repeat]").attr("width", d)
            }
        },
        resetWidth: function() {
            this.resetSvgWH();
            var t = this.getShowWidth();
            this.width = t
        },
        svgLayoutPreviewHeight: function(t) {
            t *= s.ZOOM_IN;
            var e = this.getSvgScale()
              , i = t / e
              , a = n(this.getSvgNode())
              , r = a.find(".layoutImgWrap").find("image")
              , o = parseFloat(r.attr("y"))
              , d = parseFloat(r.attr("height"));
            i > o + d && (i = o + d),
            t = i * e,
            this.setViewBoxHeight(t),
            this.setCutHeight(i)
        },
        previewHeight: function(e) {
            if ("svgLayout" == this._svg_type)
                return void this.svgLayoutPreviewHeight(e);
            e *= s.ZOOM_IN;
            var i = this.getSvgNode()
              , a = n(i)
              , r = a.children().not(".rect-position")[0]
              , o = this.getSvgScale();
            this.setViewBoxHeight(e);
            var d = e / o;
            if (null != r) {
                var g = r.getAttribute("id");
                if ("zx" == g || "hs" == g) {
                    var h, l;
                    "zx" == g ? (h = [["nw", "w", "sw"]],
                    l = 1) : (h = [["nw", "w", "sw"], ["n", "c", "s"], ["ne", "e", "se"]],
                    l = 3);
                    for (var c = 0; l > c; c++) {
                        var u = a.find("#" + h[c][0])[0]
                          , f = a.find("#" + h[c][1])[0]
                          , v = a.find("#" + h[c][2])[0]
                          , p = {
                            height: 0
                        }
                          , m = {
                            height: 0
                        };
                        if (void 0 != u)
                            var p = u.getBBox();
                        if (void 0 != v) {
                            var m = v.getBBox()
                              , y = v.getAttribute("transform")
                              , w = t.getTransformAttr(y, "translate");
                            w[1] = d - m.height - m.y;
                            var _ = t.setTransformAttr(y, "translate", w);
                            v.setAttribute("transform", _)
                        }
                        if (void 0 != f) {
                            var x = f.getBBox()
                              , b = d - p.height - m.height
                              , A = f.getAttribute("transform")
                              , N = t.getTransformAttr(A, "scale")
                              , I = t.getTransformAttr(A, "translate")
                              , S = b / x.height;
                            N[1] = S,
                            I[1] = -x.y * (S - 1) / S;
                            var B = t.setTransformAttr(A, "scale", N);
                            B = t.setTransformAttr(B, "translate", I),
                            f.setAttribute("transform", B)
                        }
                    }
                } else if ("ry" == g || "hx_def" == g) {
                    var k = r.getBBox()
                      , O = d / k.height
                      , W = r.getAttribute("transform")
                      , j = t.getTransformAttr(W, "scale");
                    0 == j[0] && (j[0] = 1),
                    j[1] = O;
                    var T = t.setTransformAttr(W, "scale", j);
                    r.setAttribute("transform", T)
                }
            }
        },
        resetHeight: function() {
            this.resetSvgWH();
            var t = this.getShowHeight();
            this.height = t
        },
        resetViewBox: function(t) {
            var e = this.getSvgNode()
              , i = e.getAttribute("viewBox");
            this.viewBox = {
                value: i,
                undo_drag: t
            };
            var a = this.getViewBox();
            n(e).find(".rect-position")[0].setAttribute("width", a[2]),
            n(e).find(".rect-position")[0].setAttribute("height", a[3])
        },
        resetSvgWH: function(t) {
            {
                var e = this.getSvgNode()
                  , i = this.getJson();
                i["data-elem"]
            }
            this.resetViewBox(t);
            var a, r = n(e), s = r.children().not(".rect-position")[0], o = 0, d = {};
            if (null != s) {
                var g = s.getAttribute("id");
                if ("zx" == g || "hs" == g || "hx" == g) {
                    "zx" == g ? (a = [["nw", "w", "sw"]],
                    o = 1) : "hx" == g ? (a = [["nw", "n", "ne"]],
                    o = 1) : (a = [["nw", "w", "sw"], ["n", "c", "s"], ["ne", "e", "se"]],
                    o = 3);
                    for (var h = 0; o > h; h++) {
                        var l = r.find("#" + a[h][0])[0]
                          , c = r.find("#" + a[h][1])[0]
                          , u = r.find("#" + a[h][2])[0];
                        void 0 != l && (d[a[h][0]] = l.getAttribute("transform")),
                        void 0 != c && (d[a[h][1]] = c.getAttribute("transform")),
                        void 0 != u && (d[a[h][2]] = u.getAttribute("transform"))
                    }
                } else
                    "ry" == g ? d.ry = s.getAttribute("transform") : "hx_def" == g && (d.hx_def = null == s.getAttribute("transform") ? "scale(1,1)" : s.getAttribute("transform"))
            }
            this.vary = {
                value: d,
                undo_drag: t
            },
            this.reverse = {
                value: this.getReverse(),
                undo_drag: t
            },
            void 0 != this.getCutWidth() && (this.cutwidth = {
                value: this.getCutWidth(),
                undo_drag: t
            },
            this.cutheight = {
                value: this.getCutHeight(),
                undo_drag: t
            }),
            void 0 != this.getRepeatWidth() && (this.repeatwidth = {
                value: this.getRepeatWidth(),
                undo_drag: t
            })
        },
        previewWH: function(e, i) {
            e *= s.ZOOM_IN,
            i *= s.ZOOM_IN;
            var a = (this.getNode(),
            this.getSvgNode());
            a.setAttribute("width", e),
            a.setAttribute("height", i);
            var r = this.reverse
              , n = this.getContentNode()
              , o = t.getTransformAttr(r, "translate");
            0 != o[0] && (o[0] = -e),
            0 != o[1] && (o[1] = -i),
            r = t.setTransformAttr(r, "translate", o),
            n.setAttribute("transform", r || "")
        },
        resetWH: function() {
            var t = this.getShowWidth()
              , e = this.getShowHeight();
            this.width = t,
            this.height = e,
            this.reverse = this.getReverse()
        },
        previewSvgLayoutWH: function(t, e) {
            t *= s.ZOOM_IN,
            e *= s.ZOOM_IN;
            var i = this.getSvgScale()
              , a = n(this.getSvgNode())
              , r = a.find(".layoutImgWrap").eq(this._layout_index).children()[0]
              , o = t / i
              , d = e / i
              , g = this.getSvgImageBox()
              , h = this.getSvgImageWrapBox()
              , l = g.width / g.height
              , c = h.width + h.x - g.x
              , u = c / l;
            u < h.height + h.y - g.y && (u = h.height + h.y - g.y,
            c = u * l),
            c > o && (o = c),
            u > d && (d = u),
            r.setAttribute("width", o),
            r.setAttribute("height", d),
            r.setAttribute("data-width", o),
            r.setAttribute("data-height", d)
        },
        setSvgLayoutWH: function() {
            this.setNewJson()
        },
        getFocusColor: function(t) {
            return this.colors["color-" + (parseInt(t) + 1)]
        },
        previewColor: function(t, e) {
            var i = this.getSvgNode()
              , a = n(i);
            a.find(".color-" + (e + 1)).attr("fill", t)
        },
        setColor: function(t, e) {
            if (-1 != e) {
                var i = JSON.parse(JSON.stringify(this._colors));
                i["color-" + (e + 1)] = t,
                this.colors = {
                    value: i
                }
            }
        },
        setColorOld: function(t, e) {
            if (-1 != e) {
                var i = this.getJson()
                  , a = JSON.parse(JSON.stringify(i));
                i["data-elem"]["data-colors"]["color-" + (e + 1)] = t,
                this.setNewJson({
                    old_json: a
                })
            }
        },
        getImgNode: function() {
            var t = n(this.getNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children()[0]
        },
        createFilter: function() {
            var e = this._owner_page._owner_design;
            e._focus_element = this;
            var i = n(this.getNode())
              , a = i.find(".layoutImgWrap").children()
              , r = a.parent().parent().children("defs")
              , s = this._owner_page._owner_design._svg_filter
              , o = n(s.createElementFilter())
              , d = "_FILTER_" + t.now() + "_" + Math.floor(1e6 * Math.random());
            o.attr("id", d),
            a.attr("filter", "url(#" + d + ")");
            for (var g = a.size(), h = 0; g > h; h++)
                o.clone().appendTo(r.eq(h))
        },
        getNewJson: function() {
            var t = this._json;
            t.transform = this.transform,
            t.reverse = this.reverse,
            t["group-transform"] = this.groupTransform,
            t.group = this.group;
            var e = t["data-elem"];
            return e.width = this.width,
            e.height = this.height,
            e["data-colors"] = this.colors,
            e.filter = this.filter,
            e.vary = this.vary,
            e.viewBox = this.viewBox,
            e["data-xhref-imgs"] = this.xhrefImgs,
            e["repeat-width"] = this.repeatwidth,
            e["cut-height"] = this.cutheight,
            e["cut-width"] = this.cutwidth,
            e["cut-transform"] = this.cuttransform,
            e.opacity = this.opacity,
            JSON.parse(JSON.stringify(t))
        },
        setNewJson: function() {},
        filterMove: function(t, e) {
            for (var i = this._owner_page._owner_design._svg_filter, a = n(this.getNode()), r = a.find(".layoutImgWrap").children(), s = r.parent().parent().children("defs"), o = s.find("filter"), d = o.size(), g = 0; d > g; g++)
                switch (e) {
                case "brightness":
                    i.setBrightness(o.eq(g), r, parseInt(t));
                    break;
                case "contrast":
                    i.setContrast(o.eq(g), r, parseInt(t));
                    break;
                case "saturation":
                    i.setSaturation(o.eq(g), r, parseInt(t));
                    break;
                case "tint":
                    i.setTint(o.eq(g), r, parseInt(t));
                    break;
                case "gaussianBlur":
                    i.setGaussianBlur(o.eq(g), r, parseInt(t));
                    break;
                case "crossProcess":
                    i.setCrossProcess(o.eq(g), r, parseInt(t))
                }
        },
        setFilterMove: function() {
            var t = this.getJson()["data-elem"].filter;
            for (var e in t)
                this.filterMove(t[e], e)
        },
        setFilter: function(t) {
            this.filter = {
                value: t
            }
        },
        undoFilter: function(t) {
            this.filter = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setFilterMove()
        },
        undoColors: function(t) {
            var e = this.getNode()
              , i = n(e);
            for (var a in t)
                i.find("." + a).attr("fill", t[a]);
            this.colors = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoViewBox: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("viewBox", t),
            this.viewBox = {
                value: t,
                undo_drag: "noUndo"
            };
            var i = this.getViewBox();
            n(e).find(".rect-position")[0].setAttribute("width", i[2]),
            n(e).find(".rect-position")[0].setAttribute("height", i[3])
        },
        undoVary: function(t) {
            var e = this.getSvgNode()
              , i = n(e);
            for (var a in t)
                i.find("#" + a)[0].setAttribute("transform", t[a]);
            this.vary = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoCutWidth: function(t) {
            this.setCutWidth(t),
            this.cutwidth = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoCutHeight: function(t) {
            this.setCutHeight(t),
            this.cutheight = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoRepeatWidth: function(t) {
            this.setRepeatWidth(t),
            this.repeatwidth = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        cancelSvgLayout: function(t) {
            var e, i = t, a = this.getSvgNode(), r = n(a);
            for (var s in i)
                e = i[s],
                r.find("." + s).attr({
                    x: e.x,
                    y: e.y,
                    width: e.width,
                    height: e.height,
                    transform: "",
                    "data-x": e.x,
                    "data-y": e.y,
                    "data-width": e.width,
                    "data-height": e.height
                })
        },
        undoXhrefImgs: function(t) {
            var e, i = this._owner_page, a = (i.getIndex(),
            i._owner_design,
            t), r = this.getSvgNode(), s = n(r);
            for (var o in a)
                if (e = a[o],
                s.find("." + o).attr({
                    "data-key": e["data-img-key"],
                    x: e.x,
                    y: e.y,
                    width: e.width,
                    height: e.height,
                    transform: "",
                    "data-x": e.x,
                    "data-y": e.y,
                    "data-width": e.width,
                    "data-height": e.height,
                    "data-id": e.id
                }),
                void 0 != e["data-img-key"]) {
                    s.find("." + o).attr({
                        "xlink:href": "//" + img_config.imgdomain + "/materials/" + e["data-img-key"] + "@120w_1x.png",
                        "data-old": "//" + img_config.imgdomain + "/materials/" + e["data-img-key"] + "@120w_1x.png"
                    });
                    var d = new Image;
                    d.onload = function() {
                        s.find("." + o).attr({
                            "xlink:href": d.src,
                            "data-old": d.src
                        })
                    }
                    ,
                    d.src = "//" + img_config.imgdomain + "/materials/" + e["data-img-key"] + "@0e_800w_800h_0c_0i_0o_1x.png"
                } else
                    void 0 != e.id && n.ajax({
                        url: "/material/getMaterialUrlsByIds.do",
                        type: "POST",
                        dataType: "json",
                        data: {
                            mids: e.id,
                            w: 120
                        },
                        success: function(t) {
                            s.find("." + o).attr({
                                "xlink:href": t.urls[e.id],
                                "data-old": t.urls[e.id]
                            }),
                            n.ajax({
                                url: "/material/getMaterialUrlsByIds.do",
                                type: "POST",
                                dataType: "json",
                                data: {
                                    mids: e.id,
                                    w: 800
                                },
                                success: function(t) {
                                    var i = new Image;
                                    i.src = t.urls[e.id],
                                    s.find("." + o).attr({
                                        "xlink:href": i.src,
                                        "data-old": i.src
                                    })
                                },
                                error: function() {}
                            })
                        },
                        error: function() {}
                    }),
                    s.find("." + o).attr({
                        "xlink:href": "",
                        "data-old": ""
                    });
            this.xhrefImgs = {
                value: a,
                undo_drag: "noUndo"
            }
        },
        resetVary: function() {
            var t = this.getJson()
              , e = t["data-elem"]
              , i = e.viewBox
              , a = this.getSvgNode();
            a.setAttribute("viewBox", i);
            var r = n(a)
              , s = e.vary;
            for (var o in s)
                r.find("#" + o)[0].setAttribute("transform", s[o]);
            this._vary = s
        },
        resetElePosition: function(e) {
            this._json = e;
            var i = this.getJson()
              , a = i["data-elem"]
              , r = this.getNode()
              , o = n(r);
            r.setAttribute("opacity", a.opacity);
            var d = i.transform;
            i["group-transform"] && (d = i["group-transform"]),
            r.setAttribute("transform", t.transformScale(d, s.ZOOM_IN));
            var g = this.getContentNode();
            g.setAttribute("transform", t.transformScale(i.reverse, s.ZOOM_IN) || "");
            var h = a["data-colors"];
            for (var l in h)
                o.find("." + l).attr("fill", h[l]);
            this.getSvgNode().setAttribute("width", a.width * s.ZOOM_IN),
            this.getSvgNode().setAttribute("height", a.height * s.ZOOM_IN),
            void 0 != a.vary && this.resetVary();
            var c = this.getSvgNode()
              , u = this.getViewBox();
            n(c).find(".rect-position")[0].setAttribute("width", u[2]),
            n(c).find(".rect-position")[0].setAttribute("height", u[3])
        },
        resetEle: function(e) {
            this._json = e;
            var i = this.getJson()
              , a = i["data-elem"]
              , r = this.getNode()
              , o = n(r);
            r.setAttribute("opacity", a.opacity);
            var d = i.transform;
            i["group-transform"] && (d = i["group-transform"]),
            r.setAttribute("transform", t.transformScale(d, s.ZOOM_IN));
            var g = this.getContentNode();
            g.setAttribute("transform", t.transformScale(i.reverse, s.ZOOM_IN) || "");
            var h = a["data-colors"];
            for (var l in h)
                o.find("." + l).attr("fill", h[l]);
            this.getSvgNode().setAttribute("width", a.width * s.ZOOM_IN),
            this.getSvgNode().setAttribute("height", a.height * s.ZOOM_IN),
            void 0 != a.vary && this.resetVary(),
            "svgLayout" == this._svg_type && (this.setLayoutJson(),
            this.setFilterMove())
        },
        setLayoutJson: function() {
            {
                var t, e = this.getJson(), i = e["data-elem"], a = i["data-xhref-imgs"], r = this.getSvgNode(), s = n(r), o = this._owner_page;
                o.getIndex(),
                o._owner_design
            }
            for (var d in a)
                if (t = a[d],
                s.find("." + d).attr({
                    "data-key": t["data-img-key"],
                    x: t.x,
                    y: t.y,
                    width: t.width,
                    height: t.height,
                    transform: "",
                    "data-x": t.x,
                    "data-y": t.y,
                    "data-width": t.width,
                    "data-height": t.height
                }),
                void 0 != t["data-img-key"]) {
                    s.find("." + d).attr({
                        "xlink:href": "//" + img_config.imgdomain + "/materials/" + t["data-img-key"] + "@120w_1x.png",
                        "data-old": "//" + img_config.imgdomain + "/materials/" + t["data-img-key"] + "@120w_1x.png"
                    });
                    var g = new Image;
                    g.onload = function() {
                        s.find("." + d).attr({
                            "xlink:href": g.src,
                            "data-old": g.src
                        })
                    }
                    ,
                    g.src = "//" + img_config.imgdomain + "/materials/" + t["data-img-key"] + "@0e_800w_800h_0c_0i_0o_1x.png"
                } else
                    s.find("." + d).attr({
                        "xlink:href": "",
                        "data-old": ""
                    })
        },
        setLayout: function() {
            for (var t = this.getNode(), e = n(t), i = e.find(".layoutImgWrap").size(), a = {}, r = 0; i > r; r++) {
                var s = e.find(".layoutImgWrap").eq(r).children();
                a[s.attr("class")] = {
                    "data-class": s.attr("class"),
                    "data-img-key": s.attr("data-key"),
                    x: s.attr("x"),
                    y: s.attr("y"),
                    width: s.attr("width"),
                    height: s.attr("height"),
                    transform: s.attr("transform"),
                    id: s.attr("data-id")
                }
            }
            this.xhrefImgs = {
                value: a
            }
        },
        getLayoutJson: function() {
            var t = this.getJson()
              , e = t["data-elem"];
            t["data-type"] = "svgFrame";
            var i = this.getNode()
              , a = n(i)
              , r = a.find(".layoutImgWrap").size();
            e["data-xhref-imgs"] = {};
            for (var s = 0; r > s; s++) {
                var o = a.find(".layoutImgWrap").eq(s).children();
                e["data-xhref-imgs"][o.attr("class")] = {
                    "data-class": o.attr("class"),
                    "data-img-key": o.attr("data-key"),
                    x: o.attr("x"),
                    y: o.attr("y"),
                    width: o.attr("width"),
                    height: o.attr("height"),
                    transform: o.attr("transform"),
                    id: o.attr("data-id")
                }
            }
        }
    },
    t.classExtend(h, i),
    h
});
;/*!/comp/design/widgets/Chart.js*/
"use strict";
define("comp/design/widgets/Chart", ["comp/b", "comp/design/widgets/Element", "components/jquery/jquery", "comp/design/design_config", "widget/pop/pop", "widget/logreg/logreg"], function(t, e, a, i, n, r) {
    function s() {
        var t = this;
        c.call(t),
        d.call(t),
        o.call(t)
    }
    function o() {
        window.chart_shape_info_show || (window.chart_shape_info_show = function(t) {
            var e = t.target
              , i = a(e);
            i.next().css("opacity", "1"),
            i.next().next().css("opacity", "1")
        }
        ,
        window.chart_shape_info_hide = function(t) {
            var e = t.target
              , i = a(e);
            i.next().css("opacity", "0"),
            i.next().next().css("opacity", "0")
        }
        )
    }
    function d() {
        var e = this;
        e._chart_id = "chart_" + t.now();
        var a = e.getJson();
        e._dataType = a["data-type"];
        var i = a["data-elem"];
        e._width = i.width,
        e._height = i.height,
        e._viewWidth = i["view-width"],
        e._viewHeight = i["view-height"],
        e._id = i.id,
        e._viewBox = i.viewBox,
        e._data = i["chart-data"],
        e._kind = i["chart-kind"],
        e._colors = i["chart-colors"],
        e._colorsGroup = i["chart-colors-group"] || 0,
        e._title = i["chart-title"],
        e._titleShow = i["chart-titleShow"],
        e._titleColor = i["chart-titleColor"],
        e._titlePosition = i["chart-titlePosition"],
        e._axisShow = i["chart-axisShow"],
        e._axisTitleShow = i["chart-axisTitleShow"],
        e._xAxisTitle = i["chart-xAxisTitle"],
        e._yAxisTitle = i["chart-yAxisTitle"],
        e._yAxisNumMin = i["chart-yAxisNumMin"],
        e._yAxisNumMax = i["chart-yAxisNumMax"],
        e._gridShow = i["chart-gridShow"],
        e._legendShow = i["chart-legendShow"],
        e._title_top_p = {
            y: 41
        },
        e._title_bottom_p = {
            y: 550
        },
        "bar" == e._kind && (e._title_bottom_p.y = e._title_bottom_p.y + 30),
        e._origin_p = {
            x: 35,
            y: 450
        },
        e._y_axis_length = 360,
        e._x_axis_length = 430,
        e._y_axis_num_p = {
            x: 25
        },
        e._x_axis_num_p = {
            y: 474
        },
        e._y_axis_title_p = {
            x: 25,
            y: 65
        },
        e._x_axis_title_p = {
            x: 490
        },
        e._legend_block_p = {
            y: 490
        },
        e.createSvg(),
        e.createAxis(),
        e.setAxis(),
        e.createAxisTitle(),
        e.setAxisTitle(),
        e.setTitle(),
        e.setData(),
        window.DESIGN_MAKING || e.updateNode(),
        e.resetChartWH(),
        void 0 === i["chart-title-xAttr"] && e.setSvgAttrData("saveAll"),
        window.chart_add_chart = !1
    }
    function c() {
        var e = this
          , a = this.getPage()
          , i = a.getDesign();
        t.dataBinding({
            obj: e,
            prop_name: "viewWidth",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "view-width",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "viewHeight",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "view-height",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "id",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "id",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "viewBox",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "viewBox",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "data",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-data",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "kind",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-kind",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "colors",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-colors",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "colorsGroup",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-colors-group",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "title",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-title",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "titleShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-titleShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "titleColor",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-titleColor",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "titlePosition",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-titlePosition",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "axisShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axisShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "axisTitleShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axisTitleShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "xAxisTitle",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxisTitle",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "yAxisTitle",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxisTitle",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "yAxisNumMin",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxisNumMin",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "yAxisNumMax",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxisNumMax",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "gridShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-gridShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "legendShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legendShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_grid_dAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-grid-dAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_title_xAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-title-xAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_title_yAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-title-yAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_xAxis_dAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxis-dAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_yAxis_dAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxis-dAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_xAxis_xAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxis-xAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_xAxis_yAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxis-yAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_yAxis_xAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxis-xAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_yAxis_yAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxis-yAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_axis_scale_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axis-scale-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_axis_scale_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axis-scale-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_axis_scale_numbers",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axis-scale-numbers",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_color_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-color-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_color_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-color-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_text_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-text-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_text_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-text-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_color_block",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-color-block",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_widthAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-widthAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_heightAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-heightAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_cone_polygon_pointsAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-cone-polygon-pointsAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_area_polygon_pointsAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-area-polygon-pointsAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_area_defs_linearGradient_idAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-area-defs-linearGradient-idAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_lineArea_path_dAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-lineArea-path-dAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_data_size",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-data-size",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        })
    }
    var g = function(t, a, i) {
        e.call(this, t, a, i),
        s.call(this)
    };
    return g.prototype = {
        constructor: g,
        _element_type: "svgChart",
        _viewBox: "",
        _data: {},
        _kind: "",
        _title: "",
        _titlePosition: "",
        _xyShow: !0,
        _legend: !1,
        _colors: [],
        _axisMin: 0,
        _axisMax: -1,
        updateNodeAjax: null,
        _saving_drag: !1,
        _save_node_timer: null,
        _chart_grid_dAttrs: null,
        _chart_title_xAttr: null,
        _chart_title_yAttr: null,
        _chart_xAxis_dAttr: null,
        _chart_yAxis_dAtt: null,
        _chart_xAxis_xAttr: null,
        _chart_xAxis_yAttr: null,
        _chart_yAxis_xAttr: null,
        _chart_yAxis_yAttr: null,
        _chart_axis_scale_xAttrs: null,
        _chart_axis_scale_yAttrs: null,
        _chart_axis_scale_numbers: null,
        _chart_legend_color_xAttrs: null,
        _chart_legend_color_yAttrs: null,
        _chart_legend_text_xAttrs: null,
        _chart_legend_text_yAttrs: null,
        _chart_legend_color_block: 12,
        _chart_notCone_rect_xAttrs: null,
        _chart_notCone_rect_yAttrs: null,
        _chart_notCone_rect_widthAttrs: null,
        _chart_notCone_rect_heightAttrs: null,
        _chart_cone_polygon_pointsAttrs: null,
        _chart_area_polygon_pointsAttr: null,
        _chart_area_defs_linearGradient_idAttr: null,
        _chart_lineArea_path_dAttrs: null,
        _chart_data_size: null,
        createWidget: function() {
            var e = t.createSvgNode("g");
            e.setAttribute("class", "elementsSon svgSon");
            var a = t.createSvgNode("rect");
            a.setAttribute("width", "1"),
            a.setAttribute("height", "1"),
            a.setAttribute("class", "rotate-set-left"),
            a.setAttribute("opacity", "0"),
            a.setAttribute("display", "none");
            var i = t.createSvgNode("g");
            e.appendChild(i),
            e.appendChild(a);
            var n = t.createSvgNode("path");
            return n.setAttribute("class", "ant-path"),
            e.appendChild(n),
            e
        },
        getNewJson: function() {
            var e = this._json;
            e["data-type"] = this._dataType,
            e.transform = this.transform,
            e.reverse = this.reverse;
            var a = e["data-elem"];
            return a.shadow = this._shadow,
            a.id = "",
            a.width = this.width,
            a.height = this.height,
            a["view-width"] = this.viewWidth,
            a["view-height"] = this.viewHeight,
            a.opacity = this.opacity,
            a.viewBox = this.viewBox,
            a["chart-data"] = t.deepClone(this.data),
            a["chart-kind"] = this.kind,
            a["chart-colors"] = this.colors,
            a["chart-colors-group"] = this.colorsGroup,
            a["chart-title"] = this.title,
            a["chart-titleShow"] = this.titleShow,
            a["chart-titleColor"] = this.titleColor,
            a["chart-titlePosition"] = this.titlePosition,
            a["chart-axisShow"] = this.axisShow,
            a["chart-axisTitleShow"] = this.axisTitleShow,
            a["chart-xAxisTitle"] = this.xAxisTitle,
            a["chart-yAxisTitle"] = this.yAxisTitle,
            a["chart-yAxisNumMin"] = this.yAxisNumMin,
            a["chart-xAxisNumMax"] = this.xAxisNumMax,
            a["chart-gridShow"] = this.gridShow,
            a["chart-legendShow"] = this.legendShow,
            a["chart-grid-dAttrs"] = this.chart_grid_dAttrs || a["chart-grid-dAttrs"],
            a["chart-title-xAttr"] = this.chart_title_xAttr || a["chart-title-xAttr"],
            a["chart-title-yAttr"] = this.chart_title_yAttr || a["chart-title-yAttr"],
            a["chart-xAxis-dAttr"] = this.chart_xAxis_dAttr || a["chart-xAxis-dAttr"],
            a["chart-yAxis-dAttr"] = this.chart_yAxis_dAttr || a["chart-yAxis-dAttr"],
            a["chart-xAxis-xAttr"] = this.chart_xAxis_xAttr || a["chart-xAxis-xAttr"],
            a["chart-xAxis-yAttr"] = this.chart_xAxis_yAttr || a["chart-xAxis-yAttr"],
            a["chart-yAxis-xAttr"] = this.chart_yAxis_xAttr || a["chart-yAxis-xAttr"],
            a["chart-yAxis-yAttr"] = this.chart_yAxis_yAttr || a["chart-yAxis-yAttr"],
            a["chart-axis-scale-xAttrs"] = this.chart_axis_scale_xAttrs || a["chart-axis-scale-xAttrs"],
            a["chart-axis-scale-yAttrs"] = this.chart_axis_scale_yAttrs || a["chart-axis-scale-yAttrs"],
            a["chart-axis-scale-numbers"] = this.chart_axis_scale_numbers || a["chart-axis-scale-numbers"],
            a["chart-legend-color-xAttrs"] = this.chart_legend_color_xAttrs || a["chart-legend-color-xAttrs"],
            a["chart-legend-color-yAttrs"] = this.chart_legend_color_yAttrs || a["chart-legend-color-yAttrs"],
            a["chart-legend-text-xAttrs"] = this.chart_legend_text_xAttrs || a["chart-legend-text-xAttrs"],
            a["chart-legend-text-yAttrs"] = this.chart_legend_text_yAttrs || a["chart-legend-text-yAttrs"],
            a["chart-legend-color-block"] = this.chart_legend_color_block || a["chart-legend-color-block"],
            a["chart-notCone-rect-xAttrs"] = this.chart_notCone_rect_xAttrs || a["chart-notCone-rect-xAttrs"],
            a["chart-notCone-rect-yAttrs"] = this.chart_notCone_rect_yAttrs || a["chart-notCone-rect-yAttrs"],
            a["chart-notCone-rect-widthAttrs"] = this.chart_notCone_rect_widthAttrs || a["chart-notCone-rect-widthAttrs"],
            a["chart-notCone-rect-heightAttrs"] = this.chart_notCone_rect_heightAttrs || a["chart-notCone-rect-heightAttrs"],
            a["chart-cone-polygon-pointsAttrs"] = this.chart_cone_polygon_pointsAttrs || a["chart-cone-polygon-pointsAttrs"],
            a["chart-area-polygon-pointsAttr"] = this.chart_area_polygon_pointsAttr || a["chart-area-polygon-pointsAttr"],
            a["chart-area-defs-linearGradient-idAttr"] = this.chart_area_defs_linearGradient_idAttr || a["chart-area-defs-linearGradient-idAttr"],
            a["chart-lineArea-path-dAttrs"] = this.chart_lineArea_path_dAttrs || a["chart-lineArea-path-dAttrs"],
            a["chart-data-size"] = this.chart_data_size || a["chart-data-size"],
            JSON.parse(JSON.stringify(e))
        },
        getPosition: function() {
            var t = this.getRect()
              , e = this.getPage()
              , a = e.getRect()
              , i = e.getDesign().pageScale;
            return [(parseFloat(t.left) - parseFloat(a.left)) / i, (parseFloat(t.top) - parseFloat(a.top)) / i]
        },
        nodeDblclick: function() {
            this.nodeClick(),
            a("#chartDataEnterBtn").click()
        },
        getChartWrap: function() {
            var t = this.getNode();
            return t.childNodes[0]
        },
        getSvgNode: function() {
            var t = this.getNode()
              , e = a(t);
            return e.find("svg")[0]
        },
        getRealWidth: function() {
            var t = this.getNode();
            return t.getBBox().width
        },
        getRealHeight: function() {
            var t = this.getNode();
            return t.getBBox().height
        },
        getShowWidth: function() {
            return this.getRealWidth() / i.ZOOM_IN
        },
        getShowHeight: function() {
            return this.getRealHeight() / i.ZOOM_IN
        },
        getContentNode: function() {
            return this.getNode().firstChild
        },
        getChartData: function() {
            for (var e = t.deepClone(this.data), a = [], i = 0; i < e.length; i++)
                null != e[i][0] && "" != e[i][0] && (null != e[i][1] && "" != e[i][1] ? a.push(e[i]) : (e[i][1] = "0",
                a.push(e[i])));
            return a
        },
        previewWH: function(e, a) {
            e *= i.ZOOM_IN,
            a *= i.ZOOM_IN;
            var n = (this.getNode(),
            this.getSvgNode());
            n.setAttribute("width", e),
            n.setAttribute("height", a);
            var r = this.getJson()
              , s = this.getContentNode()
              , o = t.getTransformAttr(r.reverse, "translate");
            0 != o[0] && (o[0] = -e),
            0 != o[1] && (o[1] = -a);
            var d = r.reverse;
            d = t.setTransformAttr(d, "translate", o),
            s.setAttribute("transform", d || "")
        },
        resetWH: function() {
            var t = this.getShowWidth()
              , e = this.getShowHeight();
            this.width = t,
            this.height = e,
            this.updateNode()
        },
        resetChartBox: function() {
            var t = this.getSvgNode()
              , e = t.getBBox()
              , a = e.x + " " + e.y + " " + e.width + " " + e.height;
            this.viewBox = a,
            t.setAttribute("viewBox", this.viewBox)
        },
        resetChartWH: function() {
            var t = this.getChartWrap()
              , e = this.getSvgNode()
              , a = t.getBBox();
            this._width = a.width / i.ZOOM_IN,
            this._height = a.height / i.ZOOM_IN,
            e.setAttribute("width", this.width * i.ZOOM_IN),
            e.setAttribute("height", this.height * i.ZOOM_IN);
            var n = e.getBBox()
              , r = n.x + " " + n.y + " " + n.width + " " + n.height;
            this._viewBox = r,
            e.setAttribute("viewBox", this.viewBox)
        },
        undoWidth: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("width", t * i.ZOOM_IN),
            this.width = {
                value: t,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        undoHeight: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("height", t * i.ZOOM_IN),
            this.height = {
                value: t,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        undoReverse: function(e) {
            var a = this.getSvgNode();
            a.setAttribute("transform", t.transformScale(e, i.ZOOM_IN)),
            this.reverse = {
                value: e,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        undoChartData: function(t) {
            this.data = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setData(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("legend"),
            this.setSvgAttrData("chartKind"),
            this.setSvgAttrData("dataSize")
        },
        undoChartKind: function(t) {
            this.kind = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setData(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("legend"),
            this.setSvgAttrData("chartKind")
        },
        undoChartColors: function(t) {
            this.colors = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setData(),
            this.showCustomColors(),
            this.updateNode()
        },
        undoChartTitle: function(t) {
            this.title = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode()
        },
        undoChartTitleShow: function(t) {
            this.titleShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode(),
            this.setSvgAttrData("title")
        },
        undoChartTitleColor: function(t) {
            this.titleColor = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode()
        },
        undoChartTitlePosition: function(t) {
            this.titlePosition = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode(),
            this.setSvgAttrData("title")
        },
        undoChartAxisShow: function(t) {
            this.axisShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxis(),
            this.updateNode(),
            this.setSvgAttrData("axis")
        },
        undoChartAxisTitleShow: function(t) {
            this.axisTitleShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxisTitle(),
            this.updateNode(),
            this.setSvgAttrData("axisTitle")
        },
        undoChartXAxisTitle: function(t) {
            this.xAxisTitle = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxisTitle(),
            this.updateNode(),
            this.setSvgAttrData("axisTitle")
        },
        undoChartYAxisTitle: function(t) {
            this.yAxisTitle = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxisTitle(),
            this.updateNode()
        },
        undoChartYAxisNumMin: function(t) {
            this.yAxisNumMin = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setYAxisNumAndGrid(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("chartKind")
        },
        undoChartXAxisNumMax: function(t) {
            this.yAxisNumMax = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setYAxisNumAndGrid(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("chartKind")
        },
        undoChartGridShow: function(t) {
            this.gridShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setGrid(),
            this.updateNode(),
            this.setSvgAttrData("grid")
        },
        undoChartLegendShow: function(t) {
            this.legendShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setLegend(),
            this.updateNode(),
            this.setSvgAttrData("legend")
        },
        undoViewBox: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("viewBox", t),
            this.viewBox = {
                value: t,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        setSvgAttrData: function(t) {
            var e = this;
            switch (t) {
            case "grid":
                e.saveGridData();
                break;
            case "title":
                e.saveTitleData();
                break;
            case "axis":
                e.saveAxisData();
                break;
            case "axisTitle":
                e.saveAxisTilteData();
                break;
            case "axisScale":
                e.saveAxisScaleData();
                break;
            case "legend":
                e.saveLegendData();
                break;
            case "dataSize":
                e.saveDataSizeData();
                break;
            case "chartKind":
                e.saveRectData(),
                e.saveConeData(),
                e.saveLineAndAreaData(),
                e.saveAreaData();
                break;
            case "saveAll":
                e.saveGridData(),
                e.saveTitleData(),
                e.saveAxisData(),
                e.saveAxisTilteData(),
                e.saveAxisScaleData(),
                e.saveLegendData(),
                e.saveRectData(),
                e.saveConeData(),
                e.saveLineAndAreaData(),
                e.saveAreaData(),
                e.saveDataSizeData()
            }
        },
        saveGridData: function() {
            var t = this;
            if (!t.gridShow)
                return void (t.chart_grid_dAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".yAxisGrid"), r = n.size(), s = [], o = 0; r > o; o++)
                s.push(n.eq(o).attr("d"));
            t.chart_grid_dAttrs = {
                value: s,
                undo_drag: "noUndo"
            }
        },
        saveTitleData: function() {
            var t = this;
            if (!t.titleShow)
                return t.chart_title_xAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_title_yAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e, i = t.getNode(), n = a(i);
            e = n.find("top" == t.titlePosition ? ".svgChartTitleTop" : ".svgChartTitleBottom"),
            t.chart_title_xAttr = {
                value: e.attr("x"),
                undo_drag: "noUndo"
            },
            t.chart_title_yAttr = {
                value: e.attr("y"),
                undo_drag: "noUndo"
            }
        },
        saveAxisData: function() {
            var t = this;
            if (!t.axisShow)
                return t.chart_xAxis_dAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_yAxis_dAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e = t.getNode()
              , i = a(e)
              , n = i.find(".svgXAxis")
              , r = i.find(".svgYAxis");
            t.chart_xAxis_dAttr = {
                value: n.attr("d"),
                undo_drag: "noUndo"
            },
            t.chart_yAxis_dAttr = {
                value: r.attr("d"),
                undo_drag: "noUndo"
            }
        },
        saveAxisTilteData: function() {
            var t = this;
            if (!t.axisTitleShow)
                return t.chart_xAxis_xAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_xAxis_yAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_yAxis_xAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_yAxis_yAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e = t.getNode()
              , i = a(e)
              , n = i.find(".xAxisTitle").children()
              , r = i.find(".yAxisTitle");
            t.chart_xAxis_xAttr = {
                value: n.attr("x"),
                undo_drag: "noUndo"
            },
            t.chart_xAxis_yAttr = {
                value: n.attr("y"),
                undo_drag: "noUndo"
            },
            t.chart_yAxis_xAttr = {
                value: r.attr("x"),
                undo_drag: "noUndo"
            },
            t.chart_yAxis_yAttr = {
                value: r.attr("y"),
                undo_drag: "noUndo"
            }
        },
        saveAxisScaleData: function() {
            var t = this;
            if (!t.axisShow)
                return t.chart_axis_scale_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_axis_scale_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_axis_scale_numbers = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".yAxisNum"), r = n.size(), s = "", o = "", d = "", c = "", g = 0; r > g; g++)
                s = s + c + n.eq(g).attr("x"),
                o = o + c + n.eq(g).attr("y"),
                d = d + c + n.eq(g).children().text(),
                c = " ";
            t.chart_axis_scale_xAttrs = {
                value: s,
                undo_drag: "noUndo"
            },
            t.chart_axis_scale_yAttrs = {
                value: o,
                undo_drag: "noUndo"
            },
            t.chart_axis_scale_numbers = {
                value: d,
                undo_drag: "noUndo"
            }
        },
        saveLegendData: function() {
            var t = this;
            if (!t.legendShow)
                return t.chart_legend_color_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_legend_color_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_legend_text_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_legend_text_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".legendColor"), r = i.find(".legendText"), s = n.size(), o = "", d = "", c = "", g = "", h = "", u = 0; s > u; u++)
                o = o + h + n.eq(u).attr("x"),
                d = d + h + n.eq(u).attr("y"),
                c = c + h + r.eq(u).attr("x"),
                g = g + h + r.eq(u).attr("y"),
                h = " ";
            t.chart_legend_color_xAttrs = {
                value: o,
                undo_drag: "noUndo"
            },
            t.chart_legend_color_yAttrs = {
                value: d,
                undo_drag: "noUndo"
            },
            t.chart_legend_text_xAttrs = {
                value: c,
                undo_drag: "noUndo"
            },
            t.chart_legend_text_yAttrs = {
                value: g,
                undo_drag: "noUndo"
            },
            t.chart_legend_color_block = {
                value: 12,
                undo_drag: "noUndo"
            }
        },
        saveDataSizeData: function() {
            for (var t = this, e = t.getChartData(), a = e.length, i = 0, n = 0; a > n && (null != e[n][1] && "" != e[n][1]); n++)
                i++;
            t.chart_data_size = {
                value: i,
                undo_drag: "noUndo"
            }
        },
        saveRectData: function() {
            var t = this;
            if ("histogram" != t.kind && "bar" != t.kind && "line" != t.kind && "area" != t.kind)
                return t.chart_notCone_rect_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_notCone_rect_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_notCone_rect_widthAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_notCone_rect_heightAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".svgChartData"), r = n.size(), s = "", o = "", d = "", c = "", g = "", h = 0; r > h; h++)
                s = s + g + n.eq(h).attr("x"),
                o = o + g + n.eq(h).attr("y"),
                d = d + g + n.eq(h).attr("width"),
                c = c + g + n.eq(h).attr("height"),
                g = " ";
            t.chart_notCone_rect_xAttrs = {
                value: s,
                undo_drag: "noUndo"
            },
            t.chart_notCone_rect_yAttrs = {
                value: o,
                undo_drag: "noUndo"
            },
            t.chart_notCone_rect_widthAttrs = {
                value: d,
                undo_drag: "noUndo"
            },
            t.chart_notCone_rect_heightAttrs = {
                value: c,
                undo_drag: "noUndo"
            }
        },
        saveConeData: function() {
            var t = this;
            if ("cone" != t.kind)
                return void (t.chart_cone_polygon_pointsAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".svgChartData"), r = n.size(), s = [], o = 0; r > o; o++)
                s.push(n.eq(o).attr("points"));
            t.chart_cone_polygon_pointsAttrs = {
                value: s,
                undo_drag: "noUndo"
            }
        },
        saveLineAndAreaData: function() {
            var t = this;
            if ("line" != t.kind && "area" != t.kind)
                return void (t.chart_lineArea_path_dAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".svgChartDataLine"), r = n.size(), s = "", o = "", d = 0; r > d; d++)
                s = s + o + n.eq(d).attr("d"),
                o = " ";
            t.chart_lineArea_path_dAttrs = {
                value: s,
                undo_drag: "noUndo"
            }
        },
        saveAreaData: function() {
            var t = this;
            if ("area" != t.kind)
                return t.chart_area_polygon_pointsAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_area_defs_linearGradient_idAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e = t.getNode()
              , i = a(e)
              , n = i.find(".svgChartDataArea")
              , r = i.find("linearGradient");
            t.chart_area_polygon_pointsAttr = {
                value: n.attr("points"),
                undo_drag: "noUndo"
            },
            t.chart_area_defs_linearGradient_idAttr = {
                value: r.attr("id"),
                undo_drag: "noUndo"
            }
        },
        setYAxisNumMax: function(e) {
            if (e <= this.yAxisNumMin)
                return n.back({
                    str: "最大值不能比最小值 更小！",
                    kind: "warning"
                }),
                !1;
            for (var a = this, i = a.getChartData(), r = i.length, s = Number.POSITIVE_INFINITY, o = 0; r > o; o++)
                null != i[o][0] && null != i[o][1] && (s = Math.min(s, parseFloat(i[o][1])));
            return s >= e ? (n.back({
                str: "坐标轴最大值不能比图表已有的最小数据 更小！",
                kind: "warning"
            }),
            !1) : (window.MEMENTO_ID = t.now(),
            a.yAxisNumMax = e,
            a.setData(),
            a.updateNodeAndUndo(),
            !0)
        },
        setYAxisNumMin: function(e) {
            if (e >= this.yAxisNumMax)
                return n.back({
                    str: "最小值不能比最大值 更大！",
                    kind: "warning"
                }),
                !1;
            for (var a = this, i = a.getChartData(), r = i.length, s = 0, o = 0; r > o; o++)
                null != i[o][0] && null != i[o][1] && (s = Math.max(s, parseFloat(i[o][1])));
            return e >= s ? (n.back({
                str: "坐标轴最小值不能比图表已有的最大数据 更大！",
                kind: "warning"
            }),
            !1) : (window.MEMENTO_ID = t.now(),
            a.yAxisNumMin = e,
            a.setData(),
            a.updateNodeAndUndo(),
            !0)
        },
        getYAxisAverage: function() {
            var t, e, a = this, i = 0, n = a.getMaxNum();
            return e = n.max_num,
            a.yAxisNumMax > 0 && (e = a.yAxisNumMax),
            a.yAxisNumMin > 0 && (i = a.yAxisNumMin),
            t = a._y_axis_length / (e - i)
        },
        getXAxisAverage: function() {
            var t, e, a = this, i = 0, n = a.getMaxNum();
            return e = n.max_num,
            0 == e ? 0 : (a.yAxisNumMax > 0 && (e = a.yAxisNumMax),
            a.yAxisNumMin > 0 && (i = a.yAxisNumMin),
            t = a._x_axis_length / (e - i))
        },
        showStrokeByIndex: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find(".svgChartData").eq(t);
            r[0].setAttribute("class", r.attr("class") + " svgChartDataStroke")
        },
        hideStroke: function() {
            var t = this
              , e = t.getNode()
              , i = a(e);
            i.find(".svgChartDataStroke")[0].setAttribute("class", "svgChartData")
        },
        getMaxNum: function() {
            for (var t = this, e = t.getChartData(), a = 0, i = e.length, n = 0, r = 0; i > r && (null != e[r][1] && "" != e[r][1]); r++)
                n++,
                a = Math.max(a, parseFloat(e[r][1]));
            if (t.yAxisNumMax > 0 && (a = t.yAxisNumMax),
            10 >= a)
                return {
                    max_num: a,
                    space_num: 1,
                    rlength: n
                };
            var s, o = parseInt(a).toString(), d = o.length, c = o[0], g = o[1];
            if (4 > c && 9 >= g) {
                var h = 5 * parseInt((c + g) / 5) * Math.pow(10, d - 2);
                a > h && (h = (5 * parseInt((c + g) / 5) + 5) * Math.pow(10, d - 2)),
                s = {
                    max_num: h,
                    space_num: 5 * Math.pow(10, d - 2)
                }
            } else {
                var h = parseInt(c) * Math.pow(10, d - 1);
                a > h && (h = (parseInt(c) + 1) * Math.pow(10, d - 1)),
                s = {
                    max_num: h,
                    space_num: Math.pow(10, d - 1)
                }
            }
            return s.rlength = n,
            s
        },
        chartSetColors: function(e) {
            var i = this
              , n = a("#chartColors")
              , r = n.attr("data-colors");
            r = r.split(",");
            var s;
            if (n.hasClass("chart-no-click"))
                s = [t.colorHex(a(".customChartColorsSpan").eq(0).css("background-color"))];
            else {
                var o, d = r.length;
                s = [];
                for (var c = 0; c < e.rlength; c++)
                    o = c % d,
                    s[c] = r[o]
            }
            i.colors = {
                value: s,
                undo_drag: !0
            },
            i.showCustomColors()
        },
        showCustomColors: function() {
            var t = this
              , e = a("#customChartColors")
              , i = t.colors
              , n = i.length;
            e.children().detach();
            for (var r = 0; n > r; r++) {
                var s = a('<span class="customChartColorsSpan" style="background-color:' + i[r] + '"></span>');
                s.appendTo(e)
            }
        },
        createSvg: function() {
            var t = this
              , e = t.getNode()
              , n = a(e);
            n.addClass("svgChart");
            var r = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            r.setAttribute("x", "0px"),
            r.setAttribute("y", "0px"),
            r.setAttribute("version", "1.1"),
            r.setAttribute("xmlns", "http://www.w3.org/2000/svg"),
            r.setAttribute("xmlns:xlink", "http://www.w3.org/1999/xlink"),
            r.setAttribute("viewBox", t.viewBox),
            r.setAttribute("width", t.width * i.ZOOM_IN),
            r.setAttribute("height", t.height * i.ZOOM_IN),
            n.find("g").append(r);
            var s = document.createElementNS("http://www.w3.org/2000/svg", "text");
            s.setAttribute("text-anchor", "middle"),
            s.setAttribute("x", t.viewWidth / 2),
            s.setAttribute("y", t._title_top_p.y),
            s.setAttribute("fill", "#808284"),
            s.setAttribute("font-size", "18px"),
            s.setAttribute("class", "svgChartTitle svgChartTitleTop"),
            s.setAttribute("text-rendering", "geometricPrecision");
            var o = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            o.innerHTML = t.title,
            s.appendChild(o),
            r.appendChild(s);
            var d = document.createElementNS("http://www.w3.org/2000/svg", "text");
            d.setAttribute("text-anchor", "middle"),
            d.setAttribute("x", t.viewWidth / 2),
            d.setAttribute("y", t._title_bottom_p.y),
            d.setAttribute("fill", "#808284"),
            d.setAttribute("font-size", "18px"),
            d.setAttribute("class", "svgChartTitle svgChartTitleBottom"),
            d.setAttribute("text-rendering", "geometricPrecision");
            var c = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            c.innerHTML = t.title,
            d.appendChild(c),
            r.appendChild(d)
        },
        setTitle: function() {
            var t, e, i = this, n = i.getNode(), r = a(n), s = "1";
            t = r.find("top" == i.titlePosition ? ".svgChartTitleTop" : ".svgChartTitleBottom"),
            r.find(".svgChartTitle").css("opacity", "0"),
            e = i.title,
            "" == e && (e = "默认标题",
            s = "0"),
            i.titleShow && t.css({
                opacity: s
            }).attr("fill", i.titleColor).children().html(e)
        },
        createAxis: function() {
            var t = this
              , e = t.getSvgNode()
              , a = document.createElementNS("http://www.w3.org/2000/svg", "path");
            a.setAttribute("fill", "none"),
            a.setAttribute("stroke", "#94979B");
            var i = parseFloat(t._origin_p.x) + parseFloat(t._x_axis_length);
            a.setAttribute("d", "M" + t._origin_p.x + "," + t._origin_p.y + "L" + i + "," + t._origin_p.y),
            a.setAttribute("class", "svgXAxis"),
            e.appendChild(a);
            var n = document.createElementNS("http://www.w3.org/2000/svg", "path");
            n.setAttribute("fill", "none"),
            n.setAttribute("stroke", "#94979B");
            var r = parseFloat(t._origin_p.y) - parseFloat(t._y_axis_length);
            n.setAttribute("d", "M" + t._origin_p.x + "," + t._origin_p.y + "L" + t._origin_p.x + "," + r),
            n.setAttribute("class", "svgYAxis"),
            e.appendChild(n)
        },
        setAxis: function() {
            var t = this
              , e = t.getNode()
              , i = a(e)
              , n = i.find("svg");
            t.axisShow ? n.find(".svgXAxis, .svgYAxis, .yAxisNum").css("opacity", "1") : n.find(".svgXAxis, .svgYAxis, .yAxisNum").css("opacity", "0")
        },
        setGrid: function() {
            var t = this
              , e = t.getNode()
              , i = a(e)
              , n = i.find("svg");
            t.axisShow ? n.find(".yAxisGrid").css("opacity", "1") : n.find(".yAxisGrid").css("opacity", "0")
        },
        createAxisTitle: function() {
            var t = this
              , e = t.getSvgNode()
              , a = document.createElementNS("http://www.w3.org/2000/svg", "text");
            a.setAttribute("text-anchor", "middle"),
            a.setAttribute("x", t._origin_p.x),
            a.setAttribute("y", t._y_axis_title_p.y),
            a.setAttribute("fill", "#808284"),
            a.setAttribute("font-size", "14px"),
            a.setAttribute("text-rendering", "geometricPrecision"),
            a.setAttribute("class", "yAxisTitle");
            var i = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            i.innerHTML = t.yAxisTitle,
            a.appendChild(i),
            e.appendChild(a);
            var n = t.xAxisTitle.length
              , r = document.createElementNS("http://www.w3.org/2000/svg", "text");
            r.setAttribute("fill", "#808284"),
            r.setAttribute("font-size", "14px"),
            r.setAttribute("text-rendering", "geometricPrecision"),
            r.setAttribute("class", "xAxisTitle"),
            r.setAttribute("style", "writing-mode: tb;text-orientation: upright;");
            var s, s = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            s.setAttribute("x", t._x_axis_title_p.x),
            s.setAttribute("y", t._origin_p.y - 16 * n / 2),
            s.innerHTML = t.xAxisTitle,
            r.appendChild(s),
            e.appendChild(r)
        },
        setAxisTitle: function() {
            var t = this
              , e = t.getSvgNode()
              , i = a(e);
            t.axisTitleShow ? (i.find(".yAxisTitle").css({
                display: "block",
                opacity: "1"
            }).children("tspan")[0].innerHTML = t.yAxisTitle,
            i.find(".xAxisTitle").css({
                display: "block",
                opacity: "1"
            }).children("tspan")[0].innerHTML = t.xAxisTitle,
            i.find(".xAxisTitle").children("tspan").attr("y", t._origin_p.y - 16 * t.xAxisTitle.length / 2)) : i.find(".xAxisTitle, .yAxisTitle").css("opacity", "0")
        },
        setLegend: function() {
            var t = this
              , e = t.getNode()
              , i = a(e)
              , n = t.getMaxNum();
            if (t.legendShow) {
                i.find(".legendColor").detach(),
                i.find(".legendText").detach();
                var r = 12
                  , s = 16
                  , o = 4
                  , d = i.find("svg")
                  , c = t.viewWidth - 20
                  , g = (t.viewHeight,
                a('<span id="test_text"></span>'));
                g.css({
                    opacity: 0,
                    "font-size": "14px"
                }).appendTo(a("body"));
                for (var h, u = t.getChartData(), l = 0, _ = [0], x = [0], A = 0; A < n.rlength; A++)
                    g.html(u[A][0]),
                    h = 0 == A ? s + a("#test_text").getWidth() + o : s + a("#test_text").getWidth() + r + o,
                    _[l] = h + _[l],
                    x[l] = A,
                    _[l] > c && (_[l] = _[l] - h,
                    x[l] = A - 1,
                    l++,
                    _[l] = s + a("#test_text").getWidth() + o,
                    x[l] = A);
                var p, v, y = x.length;
                v = "bar" == t.kind ? t._legend_block_p.y + 30 : t._legend_block_p.y;
                for (var m, l = 0, b = t.colors, A = 0; y > A; A++)
                    for (p = (c - _[A]) / 2 + 10; l < x[A] + 1; l++) {
                        var w = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                        w.setAttribute("y", v + 26 * A),
                        g.html(u[l][0]);
                        var f = a("#test_text").getWidth();
                        m = 1 == b.length ? b[0] : b[l],
                        w.setAttribute("x", p),
                        w.setAttribute("width", s),
                        w.setAttribute("height", s),
                        w.setAttribute("fill", m),
                        w.setAttribute("class", "legendColor"),
                        d[0].appendChild(w);
                        var N = document.createElementNS("http://www.w3.org/2000/svg", "text");
                        N.setAttribute("text-anchor", "start"),
                        N.setAttribute("x", p + s + o),
                        N.setAttribute("y", v + 26 * A + 14),
                        N.setAttribute("fill", "#808284"),
                        N.setAttribute("font-size", "14px"),
                        N.setAttribute("text-rendering", "geometricPrecision"),
                        N.setAttribute("class", "legendText");
                        var C = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        C.innerHTML = u[l][0],
                        N.appendChild(C),
                        d[0].appendChild(N),
                        p = p + s + f + r + o
                    }
                a("#test_text").detach()
            } else
                i.find(".legendColor").css("opacity", "0"),
                i.find(".legendText").css("opacity", "0")
        },
        setYAxisNumAndGrid: function() {
            var t = this;
            if ("bar" == t.kind)
                return void t.setYAxisNumAndGridVertical();
            var e = t.getNode()
              , i = a(e);
            i.find(".yAxisNum").detach(),
            i.find(".yAxisGrid").detach();
            for (var n, r = i.find("svg"), s = t.getMaxNum(), o = t.getYAxisAverage(), d = 0 - s.space_num; d < s.max_num; )
                if (d += s.space_num,
                !(d < t.yAxisNumMin)) {
                    if (t.yAxisNumMax >= 0 && d > t.yAxisNumMax)
                        break;
                    if (!(t._yAxisNumMin > 0 && d - t.yAxisNumMin > 0 && d - t.yAxisNumMin < .3 * s.space_num || t.yAxisNumMax > 0 && t.yAxisNumMax - d > 0 && t.yAxisNumMax - d < .3 * s.space_num)) {
                        n = t._yAxisNumMin > 0 ? t._origin_p.y - o * (d - t._yAxisNumMin) : t._origin_p.y - o * d;
                        var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                        c.setAttribute("text-anchor", "end"),
                        c.setAttribute("x", t._y_axis_num_p.x),
                        c.setAttribute("y", n),
                        c.setAttribute("fill", "#808284"),
                        c.setAttribute("font-size", "14px"),
                        c.setAttribute("text-rendering", "geometricPrecision"),
                        c.setAttribute("class", "yAxisNum");
                        var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        g.setAttribute("dy", "4"),
                        g.innerHTML = d,
                        c.appendChild(g),
                        r[0].appendChild(c);
                        var h = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        h.setAttribute("fill", "none"),
                        h.setAttribute("stroke", "#E7E7E7");
                        var u = parseFloat(t._origin_p.x) + parseFloat(t._x_axis_length);
                        h.setAttribute("d", "M" + t._origin_p.x + "," + n + "L" + u + "," + n),
                        h.setAttribute("stroke-dasharray", "4,3"),
                        h.setAttribute("class", "yAxisGrid"),
                        r[0].insertBefore(h, r[0].childNodes[0])
                    }
                }
            if (t._yAxisNumMin > 0) {
                n = t._origin_p.y;
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "end"),
                c.setAttribute("x", t._y_axis_num_p.x),
                c.setAttribute("y", n),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = t._yAxisNumMin,
                c.appendChild(g),
                r[0].appendChild(c)
            }
            if (t._yAxisNumMax > 0 && t._yAxisNumMax != s.max_num) {
                n = t._origin_p.y - o * (t._yAxisNumMax - t._yAxisNumMin);
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "end"),
                c.setAttribute("x", t._y_axis_num_p.x),
                c.setAttribute("y", n),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = t._yAxisNumMax,
                c.appendChild(g),
                r[0].appendChild(c)
            }
            if (t._yAxisNumMax > 0 && t._yAxisNumMax != s.max_num) {
                n = t._origin_p.y - o * (t._yAxisNumMax - t._yAxisNumMin);
                var h = document.createElementNS("http://www.w3.org/2000/svg", "path");
                h.setAttribute("fill", "none"),
                h.setAttribute("stroke", "#E7E7E7");
                var u = parseFloat(t._origin_p.x) + parseFloat(t._x_axis_length);
                h.setAttribute("d", "M" + t._origin_p.x + "," + n + "L" + u + "," + n),
                h.setAttribute("stroke-dasharray", "4,3"),
                h.setAttribute("class", "yAxisGrid"),
                r[0].insertBefore(h, r[0].childNodes[0])
            }
            t.axisShow || r.find(".yAxisNum").css("opacity", "0"),
            t.gridShow || r.find(".yAxisGrid").css("opacity", "0")
        },
        setYAxisNumAndGridVertical: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i);
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            for (var r, s = n.find("svg"), t = e.getMaxNum(), o = e.getXAxisAverage(), d = 0 - t.space_num; d < t.max_num; )
                if (d += t.space_num,
                !(d < e.yAxisNumMin)) {
                    if (e.yAxisNumMax > 0 && d > e.yAxisNumMax)
                        break;
                    if (!(e._yAxisNumMin > 0 && d - e.yAxisNumMin > 0 && d - e.yAxisNumMin < .3 * t.space_num || e.yAxisNumMax > 0 && e.yAxisNumMax - d > 0 && e.yAxisNumMax - d < .3 * t.space_num)) {
                        r = e._yAxisNumMin > 0 ? e._origin_p.x + o * (d - e._yAxisNumMin) : e._origin_p.x + o * d;
                        var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                        c.setAttribute("text-anchor", "middle"),
                        c.setAttribute("x", r),
                        c.setAttribute("y", e._x_axis_num_p.y),
                        c.setAttribute("fill", "#808284"),
                        c.setAttribute("font-size", "14px"),
                        c.setAttribute("text-rendering", "geometricPrecision"),
                        c.setAttribute("class", "yAxisNum");
                        var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        g.setAttribute("dy", "4"),
                        g.innerHTML = d,
                        c.appendChild(g),
                        s[0].appendChild(c);
                        var h = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        h.setAttribute("fill", "none"),
                        h.setAttribute("stroke", "#E7E7E7");
                        var u = (parseFloat(e._origin_p.x) + parseFloat(e._x_axis_length),
                        e._origin_p.y - e._y_axis_length);
                        h.setAttribute("d", "M" + r + "," + e._origin_p.y + "L" + r + "," + u),
                        h.setAttribute("stroke-dasharray", "4,3"),
                        h.setAttribute("class", "yAxisGrid"),
                        s[0].insertBefore(h, s[0].childNodes[0])
                    }
                }
            if (e._yAxisNumMin > 0) {
                r = e._origin_p.x;
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "middle"),
                c.setAttribute("x", r),
                c.setAttribute("y", e._x_axis_num_p.y),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = e._yAxisNumMin,
                c.appendChild(g),
                s[0].appendChild(c)
            }
            if (e._yAxisNumMax > 0 && e._yAxisNumMax != t.max_num) {
                r = e._origin_p.x + o * (e._yAxisNumMax - e._yAxisNumMin);
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "middle"),
                c.setAttribute("x", r),
                c.setAttribute("y", e._x_axis_num_p.y),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = e._yAxisNumMax,
                c.appendChild(g),
                s[0].appendChild(c)
            }
            if (e._yAxisNumMax > 0 && e._yAxisNumMax != t.max_num) {
                r = e._origin_p.x + o * (e._yAxisNumMax - e._yAxisNumMin);
                var h = document.createElementNS("http://www.w3.org/2000/svg", "path");
                h.setAttribute("fill", "none"),
                h.setAttribute("stroke", "#E7E7E7");
                var u = (parseFloat(e._origin_p.x) + parseFloat(e._x_axis_length),
                e._origin_p.y - e._y_axis_length);
                h.setAttribute("d", "M" + r + "," + e._origin_p.y + "L" + r + "," + u),
                h.setAttribute("stroke-dasharray", "4,3"),
                h.setAttribute("class", "yAxisGrid"),
                s[0].insertBefore(h, s[0].childNodes[0])
            }
            e.axisShow || s.find(".yAxisNum").css("opacity", "0"),
            e.gridShow || s.find(".yAxisGrid").css("opacity", "0")
        },
        setHistogramData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setLegend(o),
            e.setYAxisNumAndGrid();
            for (var d, c, g, h, u = e._x_axis_length / (o.rlength + 2 + (o.rlength - 1) / 3), l = e.colors, _ = e.getYAxisAverage(), x = 0; x < o.rlength; x++) {
                var A = parseFloat(s[x][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < A && (A = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (A -= e.yAxisNumMin),
                0 > A && (A = 0),
                d = _ * A,
                g = e._origin_p.y - d,
                c = e._origin_p.x + (x + 1) * u + u * x / 3,
                h = 1 == l.length ? l[0] : l[x];
                var p = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                p.setAttribute("y", g),
                p.setAttribute("x", c),
                p.setAttribute("width", u),
                p.setAttribute("height", d),
                p.setAttribute("fill", h),
                p.setAttribute("class", "svgChartData"),
                p.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                p.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(p);
                var v = document.createElementNS("http://www.w3.org/2000/svg", "text");
                v.setAttribute("text-anchor", "middle"),
                v.setAttribute("x", c + u / 2),
                v.setAttribute("y", g - 26),
                v.setAttribute("fill", h),
                v.setAttribute("class", "svgChartShapeInfo"),
                v.setAttribute("style", "opacity: 0;"),
                v.setAttribute("font-size", "18px"),
                v.setAttribute("text-rendering", "geometricPrecision"),
                v.innerHTML = s[x][1],
                r[0].appendChild(v);
                var y = document.createElementNS("http://www.w3.org/2000/svg", "text");
                y.setAttribute("text-anchor", "middle"),
                y.setAttribute("x", c + u / 2),
                y.setAttribute("y", g - 8),
                y.setAttribute("fill", h),
                y.setAttribute("class", "svgChartShapeInfo"),
                y.setAttribute("style", "opacity: 0;"),
                y.setAttribute("font-size", "14px"),
                y.setAttribute("text-rendering", "geometricPrecision"),
                y.innerHTML = s[x][0],
                r[0].appendChild(y)
            }
        },
        setConeData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            for (var d, c, g, h, u, l = e._x_axis_length / (o.rlength + 2 + (o.rlength - 1) / 3), _ = e.colors, x = e.getYAxisAverage(), A = 0; A < o.rlength; A++) {
                u = parseFloat(s[A][1]),
                e.yAxisNumMax > 0 && e.yAxisNumMax < u && (u = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (u -= e.yAxisNumMin),
                0 > u && (u = 0),
                d = x * u,
                g = e._origin_p.y - d,
                c = e._origin_p.x + (A + 1) * l + l * A / 3,
                h = 1 == _.length ? _[0] : _[A];
                var p = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                p.setAttribute("points", c + l / 2 + "," + g + " " + c + "," + (g + d) + " " + (c + l) + "," + (g + d)),
                p.setAttribute("fill", h),
                p.setAttribute("class", "svgChartData"),
                p.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                p.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(p);
                var v = document.createElementNS("http://www.w3.org/2000/svg", "text");
                v.setAttribute("text-anchor", "middle"),
                v.setAttribute("x", c + l / 2),
                v.setAttribute("y", g - 26),
                v.setAttribute("fill", h),
                v.setAttribute("font-size", "18px"),
                v.setAttribute("text-rendering", "geometricPrecision"),
                v.setAttribute("class", "svgChartShapeInfo"),
                v.setAttribute("style", "opacity: 0;"),
                v.innerHTML = s[A][1],
                r[0].appendChild(v);
                var y = document.createElementNS("http://www.w3.org/2000/svg", "text");
                y.setAttribute("text-anchor", "middle"),
                y.setAttribute("x", c + l / 2),
                y.setAttribute("y", g - 8),
                y.setAttribute("fill", h),
                y.setAttribute("font-size", "14px"),
                y.setAttribute("text-rendering", "geometricPrecision"),
                y.setAttribute("class", "svgChartShapeInfo"),
                y.setAttribute("style", "opacity: 0;"),
                y.innerHTML = s[A][0],
                r[0].appendChild(y)
            }
        },
        setBarData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            for (var d, c, g, h, u, l = e._y_axis_length / (o.rlength + 2 + (o.rlength - 1) / 3), _ = e.colors, x = e.getXAxisAverage(), A = 0; A < o.rlength; A++) {
                u = parseFloat(s[A][1]),
                e.yAxisNumMax > 0 && e.yAxisNumMax < u && (u = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (u -= e.yAxisNumMin),
                0 > u && (u = 0),
                d = x * u,
                c = e._origin_p.x,
                g = e._origin_p.y - e._y_axis_length + (A + 1) * l + l * A / 3,
                h = 1 == _.length ? _[0] : _[A];
                var p = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                p.setAttribute("y", g),
                p.setAttribute("x", c),
                p.setAttribute("width", d),
                p.setAttribute("height", l),
                p.setAttribute("fill", h),
                p.setAttribute("class", "svgChartData"),
                p.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                p.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(p);
                var v = document.createElementNS("http://www.w3.org/2000/svg", "text");
                v.setAttribute("text-anchor", "start"),
                v.setAttribute("x", c + d + 12),
                v.setAttribute("y", g + l / 2 - 2),
                v.setAttribute("fill", h),
                v.setAttribute("font-size", "18px"),
                v.setAttribute("text-rendering", "geometricPrecision"),
                v.setAttribute("class", "svgChartShapeInfo"),
                v.setAttribute("style", "opacity: 0;"),
                v.innerHTML = s[A][1],
                r[0].appendChild(v);
                var y = document.createElementNS("http://www.w3.org/2000/svg", "text");
                y.setAttribute("text-anchor", "start"),
                y.setAttribute("x", c + d + 12),
                y.setAttribute("y", g + l / 2 + 14),
                y.setAttribute("fill", h),
                y.setAttribute("font-size", "14px"),
                y.setAttribute("text-rendering", "geometricPrecision"),
                y.setAttribute("class", "svgChartShapeInfo"),
                y.setAttribute("style", "opacity: 0;"),
                y.innerHTML = s[A][0],
                r[0].appendChild(y)
            }
        },
        setLineData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            for (var d, c, g, h, u, l, _ = e._x_axis_length / (o.rlength - 1), x = e.colors, A = 10, p = e.getYAxisAverage(), v = 0; v < o.rlength; v++) {
                l = parseFloat(s[v][1]),
                e.yAxisNumMax > 0 && e.yAxisNumMax < l && (l = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (l -= e.yAxisNumMin),
                0 > l && (l = 0),
                d = p * l,
                g = e._origin_p.y - d,
                c = e._origin_p.x + v * _,
                h = 1 == x.length ? x[0] : x[v];
                var y = document.createElementNS("http://www.w3.org/2000/svg", "path");
                y.setAttribute("fill", "none"),
                y.setAttribute("stroke", "#E7E7E7");
                var m = parseFloat(e._origin_p.y) - parseFloat(e._y_axis_length);
                if (y.setAttribute("d", "M" + c + "," + e._origin_p.y + "L" + c + "," + m),
                y.setAttribute("stroke-dasharray", "4,3"),
                y.setAttribute("class", "yAxisGrid"),
                r[0].insertBefore(y, r[0].childNodes[0]),
                u) {
                    var b = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    b.setAttribute("fill", "none"),
                    b.setAttribute("stroke", "#000000"),
                    b.setAttribute("d", "M" + u.x + "," + u.y + "L" + c + "," + g),
                    b.setAttribute("class", "svgChartDataLine"),
                    r[0].appendChild(b)
                }
                u = {
                    x: c,
                    y: g
                }
            }
            e.gridShow || r.find(".yAxisGrid").css("opacity", "0");
            for (var v = 0; v < o.rlength; v++) {
                var l = parseFloat(s[v][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < l && (l = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (l -= e.yAxisNumMin),
                0 > l && (l = 0),
                d = p * l,
                g = e._origin_p.y - d,
                c = e._origin_p.x + v * _,
                h = 1 == x.length ? x[0] : x[v];
                var w = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                w.setAttribute("y", g - A / 2),
                w.setAttribute("x", c - A / 2),
                w.setAttribute("width", A),
                w.setAttribute("height", A),
                w.setAttribute("fill", h),
                w.setAttribute("stroke", "#FFF"),
                w.setAttribute("stroke-linecap", "square"),
                w.setAttribute("stroke-width", "2"),
                w.setAttribute("class", "svgChartData"),
                w.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                w.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(w);
                var f = document.createElementNS("http://www.w3.org/2000/svg", "text");
                f.setAttribute("text-anchor", "middle"),
                f.setAttribute("x", c),
                f.setAttribute("y", g - 30),
                f.setAttribute("fill", h),
                f.setAttribute("font-size", "18px"),
                f.setAttribute("text-rendering", "geometricPrecision"),
                f.setAttribute("class", "svgChartShapeInfo"),
                f.setAttribute("style", "opacity: 0;"),
                f.innerHTML = s[v][1],
                r[0].appendChild(f);
                var N = document.createElementNS("http://www.w3.org/2000/svg", "text");
                N.setAttribute("text-anchor", "middle"),
                N.setAttribute("x", c),
                N.setAttribute("y", g - 12),
                N.setAttribute("fill", h),
                N.setAttribute("font-size", "14px"),
                N.setAttribute("text-rendering", "geometricPrecision"),
                N.setAttribute("class", "svgChartShapeInfo"),
                N.setAttribute("style", "opacity: 0;"),
                N.innerHTML = s[v][0],
                r[0].appendChild(N)
            }
        },
        setAreaData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            var d = document.createElementNS("http://www.w3.org/2000/svg", "defs")
              , c = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient")
              , g = (new Date).getTime();
            c.setAttribute("id", g),
            c.setAttribute("x1", "0%"),
            c.setAttribute("x2", "0%"),
            c.setAttribute("y1", "0%"),
            c.setAttribute("y2", "100%");
            var h = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            h.setAttribute("offset", "0%"),
            h.setAttribute("stop-color", this.colors[0]);
            var u = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            u.setAttribute("offset", "100%"),
            u.setAttribute("stop-color", this.colors[0]),
            u.setAttribute("stop-opacity", "0"),
            c.appendChild(h),
            c.appendChild(u),
            d.appendChild(c),
            r[0].appendChild(d);
            for (var l, _, x, A, p, v, y = e._x_axis_length / (o.rlength - 1), m = e.colors, b = 10, w = e.getYAxisAverage(), f = 0; f < o.rlength; f++) {
                var N = parseFloat(s[f][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < N && (N = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (N -= e.yAxisNumMin),
                0 > N && (N = 0),
                l = w * N,
                x = e._origin_p.y - l,
                _ = e._origin_p.x + f * y,
                A = 1 == m.length ? m[0] : m[f];
                var C = document.createElementNS("http://www.w3.org/2000/svg", "path");
                C.setAttribute("fill", "none"),
                C.setAttribute("stroke", "#E7E7E7");
                var S = parseFloat(e._origin_p.y) - parseFloat(e._y_axis_length);
                if (C.setAttribute("d", "M" + _ + "," + e._origin_p.y + "L" + _ + "," + S),
                C.setAttribute("stroke-dasharray", "4,3"),
                C.setAttribute("class", "yAxisGrid"),
                r[0].insertBefore(C, r[0].childNodes[0]),
                p) {
                    var M = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    M.setAttribute("fill", "none"),
                    M.setAttribute("stroke", "#000000"),
                    M.setAttribute("d", "M" + p.x + "," + p.y + "L" + _ + "," + x),
                    M.setAttribute("class", "svgChartDataLine"),
                    r[0].appendChild(M),
                    v = f == o.rlength - 1 ? v + " " + _ + "," + x + " " + _ + "," + e._origin_p.y : v + " " + _ + "," + x
                } else
                    v = _ + "," + e._origin_p.y + " " + _ + "," + x;
                p = {
                    x: _,
                    y: x
                }
            }
            e.gridShow || r.find(".yAxisGrid").css("opacity", "0");
            for (var f = 0; f < o.rlength; f++) {
                var N = parseFloat(s[f][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < N && (N = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (N -= e.yAxisNumMin),
                0 > N && (N = 0),
                l = w * N,
                x = e._origin_p.y - l,
                _ = e._origin_p.x + f * y,
                A = 1 == m.length ? m[0] : m[f];
                var D = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                D.setAttribute("y", x - b / 2),
                D.setAttribute("x", _ - b / 2),
                D.setAttribute("width", b),
                D.setAttribute("height", b),
                D.setAttribute("fill", A),
                D.setAttribute("stroke", "#FFF"),
                D.setAttribute("stroke-linecap", "square"),
                D.setAttribute("stroke-width", "2"),
                D.setAttribute("class", "svgChartData"),
                D.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                D.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(D);
                var j = document.createElementNS("http://www.w3.org/2000/svg", "text");
                j.setAttribute("text-anchor", "middle"),
                j.setAttribute("x", _),
                j.setAttribute("y", x - 30),
                j.setAttribute("fill", A),
                j.setAttribute("font-size", "18px"),
                j.setAttribute("text-rendering", "geometricPrecision"),
                j.setAttribute("class", "svgChartShapeInfo"),
                j.setAttribute("style", "opacity: 0;"),
                j.innerHTML = s[f][1],
                r[0].appendChild(j);
                var k = document.createElementNS("http://www.w3.org/2000/svg", "text");
                k.setAttribute("text-anchor", "middle"),
                k.setAttribute("x", _),
                k.setAttribute("y", x - 12),
                k.setAttribute("fill", A),
                k.setAttribute("font-size", "14px"),
                k.setAttribute("text-rendering", "geometricPrecision"),
                k.setAttribute("class", "svgChartShapeInfo"),
                k.setAttribute("style", "opacity: 0;"),
                k.innerHTML = s[f][0],
                r[0].appendChild(k)
            }
            var I = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            I.setAttribute("points", v),
            I.setAttribute("class", "svgChartDataArea"),
            I.setAttribute("fill", "url(#" + g + ")"),
            r[0].insertBefore(I, r.find("defs")[0])
        },
        updateNode: function() {
            return
        },
        updateNodeAndUndo: function() {
            return
        },
        saveNode: function() {
            if (!window.ISLOGIN)
                return !1;
            var t = this
              , e = t.getNode()
              , i = a(e).clone();
            i.find("svg").attr({
                width: t.width,
                height: t.height,
                opacity: t.opacity
            }),
            i.find(".svgChartShapeInfo").detach();
            var s = i.find("svg")[0].outerHTML
              , o = {
                c: s
            };
            "" != t.id && (o.id = t.id),
            t.updateNodeAjax = a.ajax({
                url: "/material/saveChartContent.do",
                type: "POST",
                dataType: "json",
                data: o,
                success: function(e) {
                    var a = e.code
                      , i = e.id;
                    1 == a ? "" == t.id && (t.id = i) : -2 == a ? r.show() : n.back({
                        str: "修改图表错误！",
                        kind: "warning"
                    })
                },
                error: function() {
                    return window.chart_save_abort ? void (window.chart_save_abort = !1) : void n.back({
                        str: "修改图表错误！",
                        kind: "warning"
                    })
                }
            })
        },
        setData: function(t) {
            for (var e = this, a = e.getChartData(), i = a.length, n = 0; i > n; n++)
                null != a[n][0] && "" != a[n][0] && (null == a[n][1] || "" == a[n][1]) && (a[n][1] = "0");
            switch (e.kind) {
            case "histogram":
                e.setHistogramData(t);
                break;
            case "cone":
                e.setConeData(t);
                break;
            case "bar":
                e.setBarData(t);
                break;
            case "line":
                e.setLineData(t);
                break;
            case "area":
                e.setAreaData(t);
                break;
            case "scatter":
                e.setScatterData(t)
            }
        }
    },
    t.classExtend(g, e),
    g
});
;/*!/comp/design/widgets/CircleSelect.js*/
"use strict";
define("comp/design/widgets/CircleSelect", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/widgets/DataWidget", "comp/design/Toolbar", "comp/design/design_config", "widget/pop/pop"], function(e, t, n, o, r, i, s) {
    function l(e, t) {
        var n = this;
        n._owner_page = e,
        n._elements = t,
        n._split_drag = !0,
        n.resetElement(),
        n.nodeClick()
    }
    var g = function(e, t) {
        o.call(this, {}, {}),
        l.call(this, e, t)
    };
    return g.prototype = {
        constructor: g,
        _element_type: "circleSelect",
        group_inside: !1,
        createWidget: function() {},
        resetElement: function() {
            for (var t = this._owner_page, n = this._elements, o = n.length, r = [], i = 0; o > i; i++)
                r[i] = n[i].getIndex();
            e.sortByNum(r);
            for (var s, l = !1, g = 0; o > g; g++)
                s = r[g],
                t.elements[s]._group_drag ? (n[g] = t.elements[s]._element_group,
                l = !0) : n[g] = t.elements[s];
            this.group_inside = l
        },
        setColor: function(e) {
            var t = 0;
            for (t; t < this._elements.length; t++) {
                var n = this._elements[t];
                if ("svg" == n._element_type) {
                    var o = 0;
                    for (var r in n._colors)
                        this._elements[t].setColor(e, o),
                        o++
                } else
                    "img" == n._element_type || this._elements[t].setColor(e)
            }
        },
        previewColor: function(e) {
            var t = 0;
            for (t; t < this._elements.length; t++) {
                var n = this._elements[t];
                if ("svg" == n._element_type) {
                    var o = 0;
                    for (var r in n._colors)
                        this._elements[t].previewColor(e, o),
                        o++
                } else
                    "img" == n._element_type || this._elements[t].previewColor(e)
            }
        },
        resetColor: function() {
            var e = 0;
            for (e; e < this._elements.length; e++) {
                var t = this._elements[e];
                if ("svg" == t._element_type) {
                    var n = 0;
                    for (var o in t._colors)
                        this._elements[e].previewColor(t._colors["color-" + (n + 1)], n),
                        n++
                } else
                    "img" == t._element_type || this._elements[e].previewColor(this._elements[e].colors)
            }
        },
        getFocusColor: function() {
            return "ffffff"
        },
        moveByKey: function(e, n) {
            var o = this._owner_page._owner_design
              , r = o._owner_editDiv
              , s = t(r.getNode())
              , l = this.addLeftTop(e * i.ZOOM_IN, n * i.ZOOM_IN);
            s.offset({
                top: l.top,
                left: l.left
            }),
            this.setNewJson()
        },
        getPage: function() {
            return this._owner_page
        },
        nodeClick: function() {
            var e = this._owner_page
              , t = e._owner_design
              , n = t._owner_editDiv;
            n.showByCircle(this);
            var o = t._owner_elementEditbar;
            void 0 != o && o.show(this)
        },
        getTop: function() {
            var e = this.getRect();
            return e.top
        },
        getLeft: function() {
            var e = this.getRect();
            return e.left
        },
        getWidth: function() {
            var e = this.getRect();
            return e.width
        },
        getHeight: function() {
            var e = this.getRect();
            return e.height
        },
        getShowWidth: function() {
            return this.getBox().width / i.ZOOM_IN
        },
        getShowHeight: function() {
            return this.getBox().height / i.ZOOM_IN
        },
        getRect: function() {
            var e = this._elements
              , t = e.length;
            if (void 0 != e[0]) {
                for (var n, o = e[0].getRect(), r = o.top, i = o.right, s = o.bottom, l = o.left, g = 1; t > g; g++)
                    n = e[g],
                    o = n.getRect(),
                    r > o.top && (r = o.top),
                    i < o.right && (i = o.right),
                    s < o.bottom && (s = o.bottom),
                    l > o.left && (l = o.left);
                return {
                    top: r,
                    right: i,
                    bottom: s,
                    left: l,
                    width: i - l,
                    height: s - r
                }
            }
        },
        getTranslateLeftTop: function() {
            var e = this.getRect()
              , t = this.getPage()
              , n = t.getRect()
              , o = t.getDesign().pageScale;
            return [(parseFloat(e.left) - parseFloat(n.left)) / o, (parseFloat(e.top) - parseFloat(n.top)) / o]
        },
        addLeftTop: function(e, t) {
            for (var n, o = this._elements, r = o.length, i = 0; r > i; i++)
                n = o[i],
                n.addLeftTop(e, t);
            return this.getRect()
        },
        setNewJson: function() {
            for (var t, n = this._elements, o = n.length, r = 0; o > r; r++) {
                var t = n[r];
                "elementGroup" == t._element_type || (t.transform = e.transformScale(t.getTransform(), 1 / i.ZOOM_IN))
            }
        },
        getIndex: function() {
            var e = this._elements
              , t = e.length;
            return e[t - 1].getIndex()
        },
        removeAndUndo: function() {
            for (var e = this._owner_page, t = this._elements, n = t.length, o = 0; n > o; o++) {
                var r = t[o];
                "elementGroup" == r._element_type ? r.removeAndUndo() : e.eleDelAndUndo(r, void 0, !0)
            }
        },
        copy: function(e) {
            for (var t, n, o = this._owner_page, r = this._elements, i = r.length, s = [], l = 0; i > l; l++) {
                var t = r[l];
                n = o.eleCopyAndUndo({
                    ele: t
                }, !0),
                s[l] = n
            }
            o.nodeMousedown(e),
            o._select_element = s,
            o.createCircleSelect()
        },
        overstepPageDel: function() {
            var e = this.getRect()
              , t = e.left
              , n = e.top
              , o = e.right
              , r = e.bottom
              , i = this._owner_page
              , s = i.getRect()
              , l = s.left
              , g = s.top
              , a = s.right
              , f = s.bottom;
            return l > o || g > r || n > f || t > a ? (this.remove(),
            !0) : void 0
        },
        nodeDblclick: function() {},
        groupAlignBottom: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , g = l.bottom - s.bottom;
                    o[t].addLeftTop(0, g * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, l = this.getRect(), g = this._owner_page, a = g.getRect(), f = !1, c = 0; r > c; c++) {
                var h = o[c].getRect()
                  , _ = l.bottom - a.bottom
                  , d = h.bottom - h.top - 10;
                if (_ > d) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignVerticalMiddle: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = n.getRectVerticalMiddle(o[t])
                      , l = a - s;
                    o[t].addLeftTop(0, l * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, n = this, o = this._elements, r = o.length, l = this.getRect(), g = l.bottom - l.top, a = l.top + g / 2, f = this._owner_page, c = f.getRect(), h = !1, _ = 0; r > _; _++) {
                var d = this.getRectVerticalMiddle(o[_])
                  , m = a - d
                  , p = d + m
                  , u = o[_].getRect()
                  , v = u.bottom - u.top - 10;
                if (p > c.bottom + v / 2 - 10 || p < c.top - v / 2 + 10) {
                    h = !0;
                    break
                }
            }
            h ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignTop: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , g = l.top - s.top;
                    o[t].addLeftTop(0, g * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, l = this.getRect(), g = this._owner_page, a = g.getRect(), f = !1, c = 0; r > c; c++) {
                var h = o[c].getRect()
                  , _ = a.top - l.top
                  , d = h.bottom - h.top - 10;
                if (_ > d) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignRight: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , g = l.right - s.right;
                    o[t].addLeftTop(g * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, l = this.getRect(), g = this._owner_page, a = g.getRect(), f = !1, c = 0; r > c; c++) {
                var h = o[c].getRect()
                  , _ = l.right - a.right
                  , d = h.right - h.left - 10;
                if (_ > d) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignStandardlMiddle: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = n.getRectStandardlMiddle(o[t])
                      , l = a - s;
                    o[t].addLeftTop(l * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, l = this.getRect(), g = l.right - l.left, a = l.left + g / 2, f = this._owner_page, c = f.getRect(), h = !1, _ = 0; r > _; _++) {
                var d = this.getRectStandardlMiddle(o[_])
                  , m = a - d
                  , p = d + m
                  , u = o[_].getRect()
                  , v = u.right - u.left;
                if (p > c.right + v / 2 - 10 || p < c.left - v / 2 + 10) {
                    h = !0;
                    break
                }
            }
            h ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignLeft: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , g = l.left - s.left;
                    o[t].addLeftTop(g * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, l = this.getRect(), g = this._owner_page, a = g.getRect(), f = !1, c = 0; r > c; c++) {
                var h = o[c].getRect()
                  , _ = a.left - l.left
                  , d = h.right - h.left - 10;
                if (_ > d) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignVerticalAuto: function() {
            function t() {
                for (var t = 1; r - 1 > t; t++) {
                    var s = l.top + l.length * t
                      , g = n.getRectVerticalMiddle(o[t])
                      , a = s - g;
                    o[t].addLeftTop(0, a * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            var n = this
              , o = this._elements;
            this.resetElementByHeight();
            var r = o.length
              , l = (this.getRect(),
            {});
            l.top = this.getRectVerticalMiddle(o[0]),
            l.bottom = this.getRectVerticalMiddle(o[r - 1]),
            l.height = l.bottom - l.top,
            l.length = l.height / (r - 1);
            for (var g = this._owner_page, a = g.getRect(), f = !1, c = 0; r > c; c++) {
                var h = l.top + l.length * c
                  , _ = this.getRectVerticalMiddle(o[c])
                  , d = h - _
                  , m = _ + d
                  , p = o[c].getRect()
                  , u = p.bottom - p.top - 20;
                if (m > a.bottom + u / 2 || m < a.top - u / 2) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignStandardAuto: function() {
            function t() {
                for (var t = 1; r - 1 > t; t++) {
                    var s = l.left + l.length * t
                      , g = n.getRectStandardlMiddle(o[t])
                      , a = s - g;
                    o[t].addLeftTop(a * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            var n = this
              , o = this._elements;
            this.resetElementByWidth();
            var r = o.length
              , l = {};
            l.left = this.getRectStandardlMiddle(o[0]),
            l.right = this.getRectStandardlMiddle(o[r - 1]),
            l.width = l.right - l.left,
            l.length = l.width / (r - 1);
            for (var g = this._owner_page, a = g.getRect(), f = !1, c = 0; r > c; c++) {
                var h = l.left + l.length * c
                  , _ = this.getRectStandardlMiddle(o[c])
                  , d = h - _
                  , m = _ + d
                  , p = o[c].getRect()
                  , u = p.right - p.left - 20;
                if (m > a.right + u / 2 || m < a.left - u / 2) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        resetElementByHeight: function() {
            for (var e, t = this._elements, n = t.length, o = n; o > 0; o--)
                for (var r = 0; o - 1 > r; r++) {
                    var i = this.getRectVerticalMiddle(t[r])
                      , s = this.getRectVerticalMiddle(t[r + 1]);
                    i > s && (e = t[r],
                    t[r] = t[r + 1],
                    t[r + 1] = e)
                }
            this._elements = t
        },
        resetElementByWidth: function() {
            for (var e, t = this._elements, n = t.length, o = n; o > 0; o--)
                for (var r = 0; o - 1 > r; r++) {
                    var i = this.getRectStandardlMiddle(t[r])
                      , s = this.getRectStandardlMiddle(t[r + 1]);
                    i > s && (e = t[r],
                    t[r] = t[r + 1],
                    t[r + 1] = e)
                }
            this._elements = t
        },
        getRectStandardlMiddle: function(e) {
            var t = e.getRect()
              , n = t.right - t.left
              , o = t.left + n / 2;
            return o
        },
        getRectVerticalMiddle: function(e) {
            var t = e.getRect()
              , n = t.bottom - t.top
              , o = t.top + n / 2;
            return o
        },
        setMoveOpacity: function(e) {
            for (var t = this._elements, n = 0; n < t.length; n++)
                t[n].setMoveOpacity(e)
        },
        groupSetLock: function() {
            window.MEMENTO_ID = e.now();
            for (var t, n = this._elements, o = [], r = 0; r < n.length; r++)
                if ("elementGroup" === n[r]._element_type) {
                    t = n[r]._elements;
                    for (var i = 0; i < t.length; i++)
                        o.push(t[i]);
                    n[r].groupSplitAndUndo(!0)
                } else
                    o.push(n[r]);
            var s = this._owner_page
              , l = s.createElementGroupAndUndo(o, null, !0);
            l.groupSetLock(!0);
            var g = s._owner_design
              , a = g._owner_elementEditbar;
            a.hideNode(),
            s.nodeMousedown()
        },
        getBox: function() {
            for (var e, t, n, o, r, i, s, l, g, a, f, c = this._elements, h = c.length, _ = 0; h > _; _++)
                e = c[_],
                "svgLayout" == e._svg_type && e.svgLayoutHide();
            if (void 0 != c[0]) {
                e = c[0],
                t = e.getBox(),
                n = e.getTranslateLeftTop(),
                o = t.x + n[0],
                r = t.y + n[1],
                i = o + t.width,
                s = r + t.height;
                for (var d = 1; h > d; d++)
                    e = c[d],
                    t = e.getBox(),
                    n = e.getTranslateLeftTop(),
                    l = t.x + n[0],
                    g = t.y + n[1],
                    a = l + t.width,
                    f = g + t.height,
                    o > l && (o = l),
                    r > g && (r = g),
                    a > i && (i = a),
                    f > s && (s = f);
                for (_ = 0; h > _; _++)
                    e = c[_],
                    "svgLayout" == e._svg_type && e.svgLayoutShow();
                return {
                    width: i - o,
                    height: s - r,
                    x: o,
                    y: r
                }
            }
        },
        getRealWidth: function() {
            return this.getBox().width
        },
        getRealHeight: function() {
            return this.getBox().height
        },
        previewWH: function(e, t) {
            e *= i.ZOOM_IN,
            t *= i.ZOOM_IN;
            for (var n, o, r, s, l, g, a, f, c, h, _, d, m, p, u, v, w, R = this.getBox(), O = R.width, y = R.height, M = R.x, N = R.y, S = this._owner_page, b = S._owner_design, T = b.pageScale, I = this._elements, Z = I.length, C = 0; Z > C; C++) {
                n = I[C],
                "text" == n._element_type ? (u = n.getStyleFontSize(),
                v = u / y,
                w = t * v,
                o = n.getSvgWidth(),
                a = o / O,
                c = e * a,
                n.previewBig(c / i.ZOOM_IN, w / i.ZOOM_IN)) : ("elementGroup" == n._element_type ? (o = n.getRealWidth(),
                r = n.getRealHeight()) : (o = n.getSvgWidth(),
                r = n.getSvgHeight()),
                a = o / O,
                f = r / y,
                c = e * a,
                h = t * f,
                n.previewWH(c / i.ZOOM_IN, h / i.ZOOM_IN)),
                g = n.getTranslateLeftTop();
                {
                    n.getBox()
                }
                s = 0 + g[0],
                l = 0 + g[1],
                _ = (s - M) / O,
                d = (l - N) / y,
                m = (e - O) * _,
                p = (t - y) * d,
                n.addLeftTop(m * T, p * T),
                I[C].hideAnt()
            }
        },
        resetPosition: function() {
            for (var e, t = this._elements, n = t.length, o = 0; n > o; o++)
                e = t[o],
                e.resetPosition()
        },
        resetWH: function(e) {
            for (var t, n = this._elements, o = n.length, r = 0; o > r; r++)
                t = n[r],
                t.resetWH();
            e || this.setNewJson()
        }
    },
    e.classExtend(g, o),
    g
});
;/*!/comp/design/widgets/ElementGroup.js*/
"use strict";
define("comp/design/widgets/ElementGroup", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/widgets/DataWidget", "comp/design/Toolbar", "comp/design/design_config", "widget/pop/pop"], function(e, t, o, n, r, i, s) {
    function a(o, n, r) {
        r = r || {};
        var s = this;
        s._owner_page = o,
        s._elements = n,
        s.id = r.id || "element_group_" + e.now(),
        s._lock = r.lock,
        s._text_ele_sum = 0,
        s._text_ele_loaded = 0,
        d.call(s);
        var a = this.getJson();
        a.transform = r.transform || "translate(0,0)",
        s._transform = a.transform;
        var h = s.getNode();
        "1.0.0" === window.DESIGN_VERSION ? h.setAttribute("transform", a.transform) : h.setAttribute("transform", e.transformScale(a.transform, i.ZOOM_IN)),
        t(n[n.length - 1].getNode()).after(h),
        g.call(s, n),
        l.call(s)
    }
    function g(t) {
        for (var o, n = this, r = n.getNode(), s = t.length, a = 0; s > a; a++)
            if (o = t[a],
            o._group || (o.group = {
                value: n.id,
                undo_drag: "noUndo"
            },
            o.groupTransform = {
                value: e.transformScale(o.getNode().getAttribute("transform"), 1 / i.ZOOM_IN),
                undo_drag: "noUndo"
            }),
            o._group_drag = !0,
            o._element_group = n,
            "text" === o._element_type && n._text_ele_sum++,
            o._fontFamilyLoaded && n._text_ele_loaded++,
            r.appendChild(o.getNode()),
            "true" === this._lock) {
                var g = o.getNode();
                e.addClass(g, "elementsSonLock")
            }
    }
    function d() {
        var t = this
          , o = t.getPage()
          , n = o.getDesign()
          , r = "pages]" + o.getIndex() + "]elegroups]";
        e.dataBinding({
            obj: t,
            prop_name: "transform",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , i = e;
                "object" == typeof e && (i = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: r + t.id + "]",
                    key: "transform",
                    value: i,
                    type: "0",
                    action: "changeElementGroup"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "lock",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , i = e;
                "object" == typeof e && (i = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: r + t.id + "]",
                    key: "lock",
                    value: i,
                    type: "0",
                    action: "changeElementGroup"
                }, o)
            }
        })
    }
    function l() {
        var e = this
          , t = e.getNode();
        window.addEventListener ? t.addEventListener("click", function(t) {
            return t.ctrlKey || t.metaKey || t.shiftKey ? !1 : void e.nodeClick(t)
        }) : window.attachEvent && t.attachEvent("onclick", function(t) {
            return t.ctrlKey || t.metaKey || t.shiftKey ? !1 : void e.nodeClick(t)
        })
    }
    var h = function(e, t, o) {
        n.call(this, {}, {}),
        a.call(this, e, t, o)
    };
    return h.prototype = {
        constructor: h,
        _element_type: "elementGroup",
        _transform: "",
        createWidget: function() {
            var t = e.createSvgNode("g");
            return t.setAttribute("class", "elementGroup"),
            t
        },
        getPage: function() {
            return this._owner_page
        },
        getRect: function() {
            for (var e, o = this._elements, n = o.length, r = this.getNode(), i = 0; n > i; i++)
                e = o[i],
                "svgLayout" == e._svg_type && e.svgLayoutHide();
            t(r).find(".seat-rect").css("display", "none");
            var s = this.getNode().getBoundingClientRect();
            for (t(r).find(".seat-rect").css("display", "block"),
            i = 0; n > i; i++)
                e = o[i],
                "svgLayout" == e._svg_type && e.svgLayoutShow();
            return s
        },
        getBox: function() {
            for (var e, o = this._elements, n = o.length, r = 0; n > r; r++)
                e = o[r],
                "svgLayout" == e._svg_type && e.svgLayoutHide();
            var i = this.getNode();
            t(i).find(".seat-rect").css("display", "none");
            var s = i.getBBox();
            for (t(i).find(".seat-rect").css("display", "block"),
            r = 0; n > r; r++)
                e = o[r],
                "svgLayout" == e._svg_type && e.svgLayoutShow();
            return s
        },
        intersectEle: function(e) {
            var t = this.getRect()
              , o = t.left
              , n = t.top
              , r = t.right
              , i = t.bottom;
            e._group_drag && (e = e._element_group);
            var s = e.getRect()
              , a = s.left
              , g = s.top
              , d = s.right
              , l = s.bottom;
            return o > d || n > l || g > i || a > r ? !1 : !0
        },
        moveByKey: function(e, t) {
            var o = this._owner_page._owner_design
              , n = o._owner_editDiv
              , r = o._owner_elementEditbar;
            this.addLeftTop(e * i.ZOOM_IN, t * i.ZOOM_IN),
            void 0 != n && n.showByGroup(this),
            void 0 != r && r.show(this),
            this.setNewJson()
        },
        addLeftTop: function(t, o) {
            var n = this.getNode()
              , r = this._owner_page
              , i = r._owner_design
              , s = i.pageScale
              , a = e.getTransformAttr(n.getAttribute("transform"), "translate")
              , g = [parseFloat(a[0]) + t / s, parseFloat(a[1]) + o / s]
              , d = e.setTransformAttr(n.getAttribute("transform"), "translate", g);
            return n.setAttribute("transform", d),
            this.setRotate(this.getRotate()),
            this.getRect()
        },
        resetPosition: function() {
            var e = this.getNode()
              , t = e.getBoundingClientRect()
              , o = this.getRotate();
            this.setRotate(o);
            var n = e.getBoundingClientRect();
            this.addLeftTop((t.left - n.left) * i.ZOOM_IN, (t.top - n.top) * i.ZOOM_IN)
        },
        nodeMousedown: function(e) {
            this.nodeClick();
            var t = this._owner_page
              , o = t.getDesign();
            o._owner_editDiv.nodeMousedown(e)
        },
        nodeClick: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t._owner_editDiv
              , n = t._owner_elementEditbar
              , r = this._elements;
            if (e.nodeMousedown(),
            t._focus_element = this,
            void 0 != o) {
                o.showByGroup(this);
                for (var i = 0; i < r.length; i++)
                    r[i].showAnt()
            }
            void 0 != n && n.show(this)
        },
        setRotate: function(t) {
            var o = this.getNode()
              , n = this.getBox()
              , r = n.width
              , i = n.height
              , s = r / 2 + n.x
              , a = i / 2 + n.y
              , g = [t, s, a]
              , d = e.setTransformAttr(o.getAttribute("transform"), "rotate", g);
            o.setAttribute("transform", d)
        },
        resetWH: function(e) {
            var o = this._owner_page
              , n = o._owner_design
              , r = n.pageScale
              , s = (this.getNode(),
            this.getBox())
              , a = s.width
              , g = s.height
              , d = this.getRect();
            t("#edit-div").css({
                width: a / i.ZOOM_IN * r + 1,
                height: g / i.ZOOM_IN * r + 1
            }).offset({
                left: d.left,
                top: d.top
            }),
            e || this.setNewJson();
            for (var l = this._elements, h = 0; h < l.length; h++)
                l[h].showAnt()
        },
        previewWH: function(e, t) {
            e *= i.ZOOM_IN,
            t *= i.ZOOM_IN;
            for (var o, n, r, s, a, g, d, l, h, _, u, c, f, p, v, m, w, N = this.getRealWidth(), O = this.getRealHeight(), y = this.getBox(), x = y.x, S = y.y, I = this._owner_page, b = I._owner_design, k = b.pageScale, M = this._elements, A = M.length, L = 0; A > L; L++)
                o = M[L],
                "text" == o._element_type && (v = o.getStyleFontSize(),
                m = v / O,
                w = t * m);
            for (var R = 0; A > R; R++)
                o = M[R],
                "text" != o._element_type ? (n = o.getSvgWidth(),
                r = o.getSvgHeight(),
                d = n / N,
                l = r / O,
                h = e * d,
                _ = t * l,
                o.previewWH(h / i.ZOOM_IN, _ / i.ZOOM_IN)) : (v = o.getStyleFontSize(),
                m = v / O,
                w = t * m,
                n = o.getSvgWidth(),
                d = n / N,
                h = e * d,
                o.previewBig(h / i.ZOOM_IN, w / i.ZOOM_IN)),
                g = o.getTranslateLeftTop(),
                s = g[0],
                a = g[1],
                u = (s - x) / N,
                c = (a - S) / O,
                f = (e - N) * u,
                p = (t - O) * c,
                o.addLeftTop(f * k, p * k),
                M[R].hideAnt()
        },
        hideAnt: function() {
            for (var e, t = this._elements, o = t.length, n = 0; o > n; n++)
                e = t[n],
                e.hideAnt()
        },
        getLeft: function() {
            return this.getRect().left
        },
        getTop: function() {
            return this.getRect().top
        },
        getRealWidth: function() {
            return this.getBox().width
        },
        getShowWidth: function() {
            return this.getRealWidth() / i.ZOOM_IN
        },
        getWidth: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowWidth() * o
        },
        getRealHeight: function() {
            return this.getBox().height
        },
        getShowHeight: function() {
            return this.getRealHeight() / i.ZOOM_IN
        },
        getHeight: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowHeight() * o
        },
        getRotate: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "rotate");
            return o[0]
        },
        getTranslateLeftTop: function() {
            var e = this.getRect()
              , t = this.getPage()
              , o = t.getRect()
              , n = t.getDesign().pageScale;
            return [(parseFloat(e.left) - parseFloat(o.left)) / n, (parseFloat(e.top) - parseFloat(o.top)) / n]
        },
        getShowTranslateLeftTop: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "translate");
            return [parseFloat(o[0]) / i.ZOOM_IN, parseFloat(o[1]) / i.ZOOM_IN]
        },
        overstepPageDel: function() {
            {
                var e = this.getRect()
                  , t = (e.left,
                e.top,
                e.right,
                e.bottom,
                this._owner_page)
                  , o = t.getRect();
                o.left,
                o.top,
                o.right,
                o.bottom
            }
        },
        removeAndUndo: function(e, t) {
            for (var o, n = this._elements, r = n.length, i = this.getPage(), s = i.getIndex(), a = i.getDesign(), g = [], d = 0; r > d; d++)
                o = n[d],
                g.push(o.getIndex());
            for (var d = 0; r > d; d++)
                o = n[d],
                i.eleDelAndUndoByChangeBackground(o);
            a.saveDesignAndUndo({
                obj: this,
                loc: "pages]" + s + "]elegroups]",
                key: this.id,
                value: this.getNewJson(),
                type: "3",
                action: "delElementGroup",
                eles_index: g
            }, t),
            this.remove(e)
        },
        remove: function() {
            {
                var e = this._owner_page
                  , t = (e.getIndex(),
                e._owner_design,
                this._elements);
                t.length,
                this.getNode()
            }
            e.eleGroupDel(this)
        },
        getIndex: function() {
            var e = this.getFirstChildIndex();
            return e
        },
        getFirstChildIndex: function() {
            var e = this._elements;
            if (void 0 != e[0]) {
                var t = e[0].getIndex();
                return t
            }
        },
        getLastChildIndex: function() {
            var e = this._elements
              , t = e.length
              , o = e[t - 1].getIndex();
            return o
        },
        changeIndex: function(e, o) {
            var n = this.getPage()
              , r = n.getDesign()
              , i = n.elements
              , s = this.getNode()
              , a = t(s)
              , g = this.getFirstChildIndex()
              , d = e.new_index;
            if (d !== g) {
                var l, h = i[d];
                l = h._group_drag ? h._element_group.getNode() : h.getNode();
                var _, u = t(l);
                g > d ? (u.before(a),
                _ = "groupmovedown") : (u.after(a),
                _ = "groupmoveup");
                var c = {
                    index: d,
                    element: this._elements,
                    action: "groupInsert"
                };
                if (n.elements = c,
                "noUndo" !== o) {
                    var f = [{
                        page_index: n.getIndex(),
                        ele_index: this.id,
                        mememto_id: window.MEMENTO_ID,
                        action: _
                    }];
                    r.mementos = f
                }
            }
        },
        moveUp: function(e) {
            var t, o, n = this.getLastChildIndex(), r = this._owner_page, i = r.elements, s = i.length, a = i[n + 1];
            if (a._group_drag)
                for (var g = n + 1; s > g; g++) {
                    var d = i[g]
                      , l = i[g]._group;
                    if (!d._group_drag || d._group_drag && void 0 != t && t != l) {
                        o = g - 1;
                        break
                    }
                    t = l
                }
            else
                o = n + 1;
            void 0 == o && (o = s - 1),
            this.changeIndex({
                new_index: o
            }, e);
            var h = r._owner_design
              , _ = h._owner_elementEditbar;
            _._owner_element = this,
            _.moveBtnSet()
        },
        moveDown: function(e) {
            var t, o, n = this.getFirstChildIndex(), r = this._owner_page, i = r.elements, s = (i.length,
            i[n - 1]);
            if (s._group_drag)
                for (var a = n - 1; a >= 0; a--) {
                    var g = i[a]
                      , d = i[a]._group;
                    if (!g._group_drag || g._group_drag && void 0 != t && t != d) {
                        o = a + 1;
                        break
                    }
                    t = d
                }
            else
                o = n - 1;
            0 == o && (o = 1),
            this.changeIndex({
                new_index: o
            }, e);
            var l = r._owner_design
              , h = l._owner_elementEditbar;
            h._owner_element = this,
            h.moveBtnSet()
        },
        groupMousePosition: function(t) {
            for (var o, n, r, i, s, a, g, d, l, h, _, u, c, f = t.pageX, p = t.pageY, v = this.getShowTranslateLeftTop(), m = this._owner_page, w = m.getRect(), N = m._owner_design, O = N.pageScale, y = this._elements, x = y.length, S = f - w.left, I = p - w.top, b = x - 1; b >= 0; b--)
                if (o = y[b],
                n = o.getRect(),
                r = o.getShowBox(),
                i = o.getShowTranslateLeftTop(),
                s = r.x + i[0] + v[0],
                a = s + r.width,
                g = r.y + i[1] + v[1],
                d = g + r.height,
                l = (s + r.width / 2) * O,
                h = (g + r.height / 2) * O,
                _ = e.coordinateRotate(S, I, parseFloat(o.getRotate()), l, h),
                u = _.x / O,
                c = _.y / O,
                d > c && c > g && a > u && u > s) {
                    o.dblclickInGroup(t);
                    break
                }
        },
        getNewJson: function() {
            var e = this._json;
            return e.transform = this.transform,
            JSON.parse(JSON.stringify(e))
        },
        setNewJson: function() {
            for (var t, o = this._elements, n = o.length, r = 0; n > r; r++)
                t = o[r],
                t.setNewJsonFormGroup();
            var s = this.getNode();
            this.transform = e.transformScale(s.getAttribute("transform"), 1 / i.ZOOM_IN)
        },
        undoValue: function(e) {
            var t = e.key
              , o = e.val;
            switch (t) {
            case "transform":
                this.undoTransform(o);
                break;
            case "lock":
                this.groupUndoLock(o)
            }
        },
        undoTransform: function(t) {
            var o = this.getNode();
            o.setAttribute("transform", e.transformScale(t, i.ZOOM_IN)),
            this.transform = {
                value: t,
                undo_drag: "noUndo"
            },
            this.addLeftTop(1, 1)
        },
        resetGroup: function(t) {
            this._json = t;
            var o = this.getJson()
              , n = this.getNode();
            n.setAttribute("transform", e.transformScale(o.transform, i.ZOOM_IN));
            for (var r, s = this._elements, a = s.length, g = 0; a > g; g++)
                r = s[g],
                r.setNewJsonFormGroup({
                    save_drag: !0
                })
        },
        groupSplitAndUndo: function(e) {
            for (var t, o = this.getPage(), n = o.getIndex(), r = o.getDesign(), i = [], s = this._elements, a = s.length, g = 0; a > g; g++)
                t = s[g],
                i.push(t.getIndex());
            this.groupSplit(e),
            r.saveDesignAndUndo({
                obj: this,
                loc: "pages]" + n + "]elegroups]",
                key: this.id,
                value: this.getNewJson(),
                type: "3",
                action: "delElementGroup",
                eles_index: i
            }, e)
        },
        groupSplit: function(e, o) {
            for (var n, r = this._elements, i = r.length, s = 0; i > s; s++)
                n = r[s],
                n.removeFormGroupAndUndo(e);
            t(this.getNode()).remove();
            var a = this._owner_page;
            a.element_groups = {
                index: this.id
            },
            a.nodeMousedown(),
            a._select_element = r,
            o || void 0 == r[0] || a.createCircleSelect()
        },
        groupPut: function() {
            if (!window.USERINFO.isGm)
                return void s.back({
                    str: "你没有提交权限哦！",
                    kind: "warning"
                });
            var o = prompt("关键字");
            if (o) {
                var n, r = this.getBox(), a = r.width, g = r.height, d = this._owner_page, l = d.getRect(), h = l.left, _ = l.top, u = this.getRect(), c = u.left - h, f = u.top - _, p = this._elements, v = p.length;
                this.groupSplit();
                for (var m = {
                    width: a / i.ZOOM_IN,
                    height: g / i.ZOOM_IN,
                    elems: []
                }, w = {
                    title: this.id,
                    v: "1.0.0",
                    pages: [m]
                }, N = 0; v > N; N++)
                    n = p[N],
                    n.addLeftTop(-c * i.ZOOM_IN, -f * i.ZOOM_IN),
                    n.transform = e.transformScale(n.getTransform(), 1 / i.ZOOM_IN),
                    m.elems[N] = n.getNewJson();
                d.nodeMousedown(),
                t.ajax({
                    url: "/material/saveCombMaterial.do",
                    dataType: "json",
                    type: "POST",
                    data: {
                        json: JSON.stringify(w),
                        t: w.title,
                        k: o
                    },
                    error: function() {
                        console.log("上传失败")
                    },
                    success: function() {}
                })
            }
        },
        setMoveOpacity: function(e) {
            var t = this.getNode();
            e ? t.setAttribute("opacity", ".5") : t.removeAttribute("opacity")
        },
        groupSetLock: function(t) {
            var o = this.lock;
            this.lock = "true" == o ? {
                value: "false",
                undo_drag: t
            } : {
                value: "true",
                undo_drag: t
            };
            for (var n, r = this._elements, i = r.length, s = 0; i > s; s++)
                n = r[s].getNode(),
                "true" === this._lock ? e.addClass(n, "elementsSonLock") : e.removeClass(n, "elementsSonLock")
        },
        groupUndoLock: function() {
            var t = this.lock;
            this.lock = "true" == t ? {
                value: "false",
                undo_drag: "noUndo"
            } : {
                value: "true",
                undo_drag: "noUndo"
            };
            for (var o, n = this._elements, r = n.length, i = 0; r > i; i++)
                o = n[i].getNode(),
                "true" === this._lock ? e.addClass(o, "elementsSonLock") : e.removeClass(o, "elementsSonLock")
        },
        uplateTextEleLoaded: function(e) {
            var t = this;
            e ? t._text_ele_loaded++ : t._text_ele_loaded--;
            {
                var o = t._owner_page
                  , n = o._owner_design
                  , r = n._owner_editDiv
                  , i = n._owner_elementEditbar;
                t._elements
            }
            void 0 != r && r._owner_element == t && r.setGroupEdit(),
            void 0 != i && i._owner_element == t && i.groupEditbarSet(),
            t._text_ele_sum === t._text_ele_loaded && t.nodeClick()
        }
    },
    e.classExtend(h, n),
    h
});
;/*!/comp/design/widgets/Page.js*/
"use strict";
define("comp/design/widgets/Page", ["comp/b", "comp/design/Chuangkit", "comp/design/widgets/DataWidget", "components/jquery/jquery", "comp/design/design_config", "comp/design/toolbar/PageEditbar", "comp/design/widgets/Img", "comp/design/widgets/Svg", "comp/design/widgets/Chart", "comp/design/widgets/Text", "libs/jquery/jquery.transit.min", "comp/design/widgets/CircleSelect", "comp/design/widgets/ElementGroup", "comp/config/global_config"], function(e, t, o, i, n, a, r, s, d, l, g, h, p) {
    function f(e, t) {
        var o = this;
        o._owner_design = e,
        o._elements = [],
        o._element_groups = {},
        o._focus_drag = !1,
        o._owner_pageEditbar = null,
        o._select_element = [],
        o._circleSelect = [],
        o._svgLayoutNum = 0,
        o._background_updata_drag = !1,
        o._svgLayoutCheek = {
            index: 0,
            imgIndex: 0
        },
        e.addPage(o, t);
        var n = o.getNode()
          , a = e.getNode();
        void 0 == t ? a.appendChild(n) : t - 1 == -1 ? i(a).prepend(n) : i(".page").eq(t - 1).after(n),
        c.call(o),
        u.call(o),
        m.call(o),
        "true" === e.bleed && this.showBleedBorder()
    }
    function u() {
        var e = this
          , t = e.getJson()
          , o = {
            width: t.width,
            height: t.height
        };
        e.pageWH = o,
        e._width = t.width,
        e._height = t.height;
        var i = e._owner_design;
        0 === i.pageScale ? i.setPageScale() : i.setPageScale(i.pageScale)
    }
    function m() {
        var e = this
          , t = e.getNode();
        window.addEventListener ? (t.addEventListener("mousedown", function(t) {
            return 0 != t.button ? !1 : window.SPACE_KEY_DOWN ? (e.pageMouseMove(t),
            t.stopPropagation(),
            !1) : void (e._owner_design._focus_page != e ? e.nodeMouseenter() : e.nodeMousedown())
        }, !1),
        t.addEventListener("mouseenter", function(e) {
            return 0 != e.button ? !1 : void 0
        }, !1)) : window.attachEvent && (t.attachEvent("onmousedown", function(t) {
            return 0 != t.button ? !1 : (e.nodeMousedown(),
            window.SPACE_KEY_DOWN ? (e.pageMouseMove(t),
            t.stopPropagation(),
            !1) : void 0)
        }),
        t.attachEvent("onmouseenter", function(e) {
            return 0 != e.button ? !1 : void 0
        }))
    }
    function c() {
        var t = this
          , o = t._owner_design
          , i = "pages]";
        e.dataBinding({
            obj: t,
            prop_name: "width",
            getFun: e.$noop,
            setFun: function(e) {
                var n = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                n = e.undo_drag),
                o.saveDesignAndUndo({
                    obj: t,
                    loc: i + t.getIndex() + "]",
                    key: "width",
                    value: a,
                    type: "0",
                    action: "changePage"
                }, n)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "height",
            getFun: e.$noop,
            setFun: function(e) {
                var n = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                n = e.undo_drag),
                o.saveDesignAndUndo({
                    obj: t,
                    loc: i + t.getIndex() + "]",
                    key: "height",
                    value: a,
                    type: "0",
                    action: "changePage"
                }, n)
            }
        })
    }
    var _ = function(t, i, n) {
        var r = this;
        o.call(r, i),
        f.call(r, t, n);
        new a(r);
        if (!e.isNull(i)) {
            var s = i.elems
              , d = !1;
            if (s)
                for (var l in s)
                    if ("background" == s[l]["data-type"]) {
                        d = !0;
                        break
                    }
            if (!d) {
                var g = {
                    "data-type": "background",
                    "data-elem": {
                        filter: {
                            brightness: 0,
                            contrast: 0,
                            crossProcess: 0,
                            gaussianBlur: 0,
                            saturation: 0,
                            tint: 0
                        },
                        "data-key": "false",
                        width: i.width,
                        height: i.height,
                        opacity: "1",
                        "data-colors": {
                            0: "rgb(255, 255, 255)"
                        }
                    },
                    transform: "translate(0,0)",
                    reverse: ""
                };
                s.splice(0, 0, g),
                r._json.elems = s
            }
        }
    };
    return _.prototype = {
        constructor: _,
        _json: {},
        _svgLayoutCheek: {
            index: 0,
            imgIndex: 0
        },
        pageShow: function() {
            var e = this;
            e._elements = [];
            var t = this.getJson()
              , o = t.elems;
            if (o)
                for (var n in o) {
                    var a = o[n];
                    if ("background" == a["data-type"] && 0 == a["data-elem"].opacity && i(this.getNode()).addClass("page-transparent"),
                    void 0 != a && null != a)
                        var r = e.createElement(a)
                }
            var s, d = t.elegroups, l = this._elements, g = l.length;
            if (d)
                for (var h in d) {
                    s = [];
                    for (var p = d[h], f = 0; g > f; f++) {
                        var r = l[f];
                        r.getJson().group == h && s.push(r)
                    }
                    this.createElementGroup(s, {
                        id: h,
                        transform: p.transform,
                        lock: p.lock
                    })
                }
            var u = e._owner_design;
            u._owner_pageList.setPageClick()
        },
        pageHide: function() {
            if (0 != this._elements.length) {
                this._json = this.getNewJson();
                var e = i(this.getNode());
                e.children("svg").empty()
            }
        },
        createWidget: function() {
            var t = e.createNode("section", "page page-no-focus")
              , o = e.createSvgNode("svg")
              , i = e.createNode("div", "page_menu")
              , n = e.createNode("div", "bleed_top bleed_border")
              , a = e.createNode("div", "bleed_right bleed_border")
              , r = e.createNode("div", "bleed_bottom bleed_border")
              , s = e.createNode("div", "bleed_left bleed_border")
              , d = e.createNode("div", "bleed_ruler_top_left bleed_ruler")
              , l = e.createNode("div", "bleed_ruler_top_right bleed_ruler")
              , g = e.createNode("div", "bleed_ruler_right_top bleed_ruler")
              , h = e.createNode("div", "bleed_ruler_right_bottom bleed_ruler")
              , p = e.createNode("div", "bleed_ruler_bottom_right bleed_ruler")
              , f = e.createNode("div", "bleed_ruler_bottom_left bleed_ruler")
              , u = e.createNode("div", "bleed_ruler_left_top bleed_ruler")
              , m = e.createNode("div", "bleed_ruler_left_bottom bleed_ruler")
              , c = e.createNode("div", "bleed_line_top bleed_line")
              , _ = e.createNode("div", "bleed_line_bottom bleed_line");
            if (t.appendChild(o),
            t.appendChild(n),
            t.appendChild(a),
            t.appendChild(r),
            t.appendChild(s),
            t.appendChild(d),
            t.appendChild(l),
            t.appendChild(g),
            t.appendChild(h),
            t.appendChild(p),
            t.appendChild(f),
            t.appendChild(u),
            t.appendChild(m),
            t.appendChild(c),
            t.appendChild(_),
            2 == window.split) {
                var v = e.createNode("div", "center-line");
                t.appendChild(v)
            } else if (3 == window.split) {
                var b = e.createNode("div", "three-first-line")
                  , w = e.createNode("div", "three-second-line");
                t.appendChild(w),
                t.appendChild(b)
            } else if (4 == window.split) {
                var b = e.createNode("div", "four-first-line")
                  , w = e.createNode("div", "four-second-line")
                  , y = e.createNode("div", "four-third-line");
                t.appendChild(w),
                t.appendChild(b),
                t.appendChild(y)
            }
            return t.appendChild(i),
            t
        },
        getPageSvg: function() {
            return this.getNode().firstChild
        },
        getRect: function() {
            var e = this.getPageSvg().getBoundingClientRect();
            return {
                top: e.top,
                right: e.right,
                bottom: e.bottom,
                left: e.left,
                height: e.height,
                width: e.width
            }
        },
        _width: 0,
        _height: 0,
        set pageWH(e) {
            this._width = e.width,
            this._height = e.height;
            var t = this._elements[0];
            if (void 0 != t) {
                var o = t.getNode();
                i(o).find(".background-color").size() > 0 && (i(o).find(".background-color").attr({
                    width: this._width * n.ZOOM_IN,
                    height: this._height * n.ZOOM_IN
                }),
                t.resetWH())
            }
            this.setSvgViewBox()
        },
        get pageWH() {
            var e = {
                width: this._width,
                height: this._height
            };
            return e
        },
        _elements: [],
        set elements(e) {
            var t = this._owner_design
              , o = ("pages]" + this.getIndex() + "]elems]",
            this.getJson())
              , i = o.elems
              , n = e.element
              , a = e.index
              , r = this._elements;
            if (-1 == a)
                this._elements = [],
                i = [];
            else if (a >= 0 && void 0 == n)
                this._elements.splice(a, 1);
            else if ("insert" == e.action) {
                var s = n.getIndex();
                this._elements.splice(s, 1),
                this._elements.splice(a, 0, n)
            } else if ("groupInsert" == e.action) {
                var d, l = n.length, s = n[0].getIndex();
                if (s > a)
                    for (var g = l - 1; g >= 0; g--)
                        d = n[g].getIndex(),
                        this._elements.splice(n[g].getIndex(), 1),
                        this._elements.splice(a, 0, n[g]),
                        t.saveDesignAndUndo({
                            obj: n[g],
                            loc: "pages]" + this.getIndex() + "]elems]",
                            key: d,
                            tidx: a,
                            type: 2,
                            action: "moveIndex"
                        }, "noUndo");
                else
                    for (var g = 0; l > g; g++)
                        d = n[g].getIndex(),
                        this._elements.splice(n[g].getIndex(), 1),
                        this._elements.splice(a, 0, n[g]),
                        t.saveDesignAndUndo({
                            obj: n[g],
                            loc: "pages]" + this.getIndex() + "]elems]",
                            key: d,
                            tidx: a,
                            type: 2,
                            action: "moveIndex"
                        }, "noUndo")
            } else
                r.indexOf(n) < 0 && this._elements.splice(a, 0, n)
        },
        get elements() {
            return this._elements
        },
        _element_groups: {},
        set element_groups(e) {
            var t = this.getJson()
              , o = t.elegroups
              , i = e.element_group
              , n = e.index;
            -1 == n && (this._element_group = {},
            o = {}),
            void 0 == i ? delete this._element_groups[n] : this._element_groups[n] = i
        },
        get element_groups() {
            return this._element_groups
        },
        getDesign: function() {
            return this._owner_design
        },
        onload: function(e) {
            var t = this;
            for (var o in e)
                var i = e[o], n = t.createElement(i)
        },
        setSvgViewBox: function() {
            var e = {
                width: this._width,
                height: this._height
            }
              , t = this.getPageSvg();
            t.setAttribute("viewBox", "0 0 " + e.width * n.ZOOM_IN + " " + e.height * n.ZOOM_IN)
        },
        getLeft: function() {
            var e = this.getNode();
            return e.getBoundingClientRect().left
        },
        getTop: function() {
            var e = this.getNode();
            return e.getBoundingClientRect().top
        },
        setShowWH: function(e) {
            var t = this._width
              , o = this._height
              , a = t * e
              , r = o * e
              , s = this.getNode()
              , d = this.getPageSvg()
              , l = (n.DESIGN_BLANK,
            0);
            s.style.width = a + "px",
            s.style.height = r + "px",
            s.style.top = l + "px",
            d.setAttribute("width", a),
            d.setAttribute("height", r),
            i(".page_size_top, .page_size_bottom").css("width", a + 32 + "px"),
            i(".page_size_right, .page_size_left").css("height", r + 32 + "px"),
            i(".page_size_bottom_btn").css("left", a / 2 - 32 + 24)
        },
        active: function() {
            this._focus_drag = !0
        },
        getIndex: function() {
            for (var e = this._owner_design, t = e.pages, o = e.getPageSum(), i = 0; o > i; i++)
                if (this == t[i])
                    return i;
            return -1
        },
        getElementSum: function() {
            return this.elements.length
        },
        getElement: function(e) {
            var t = this.elements;
            return t[e]
        },
        createElementAndUndo: function(e, t) {
            var o, i = this.insertElement(e), n = this.getIndex(), a = this.getDesign();
            return o = "svgChart" == i._element_type ? i.getNewJson() : i.getJson(),
            a.saveDesignAndUndo({
                obj: i,
                loc: "pages]" + n + "]elems]",
                key: i.getIndex(),
                value: o,
                type: 0,
                action: "addMaterial",
                unshift: e.unshift
            }, t),
            i
        },
        createElement: function(e) {
            var t, o = e["data-type"];
            switch (o) {
            case "background":
            case "img":
                t = new r(this,e);
                break;
            case "svgImage":
            case "svgFrame":
                t = new s(this,e);
                break;
            case "text":
                t = new l(this,e);
                break;
            case "svgChart":
                t = new d(this,e);
                break;
            default:
                console.log("元素类型:" + o + "未定义")
            }
            return t
        },
        addElement: function(e, t) {
            void 0 == t && (t = this.getElementSum());
            var o = {
                index: t,
                element: e
            };
            if (void 0 != e) {
                "background" == e.getJson()["data-type"] && (o.index = 0);
                var n = e.getNode()
                  , a = this.getPageSvg()
                  , r = this.elements;
                if (e.isBackground() && void 0 != r[0] && r[0].isBackground()) {
                    var s = r[0];
                    if (a.removeChild(a.firstChild),
                    void 0 == s)
                        return;
                    {
                        JSON.parse(JSON.stringify(s.getJson())),
                        this.getIndex()
                    }
                    this._background_updata_drag = !0;
                    {
                        this._owner_design
                    }
                    this.elements = {
                        index: 0
                    }
                }
                if (void 0 != r[0] && e.isBackground() || "background" === e.getJson()["data-type"])
                    a.insertBefore(n, a.firstChild);
                else {
                    var d = r[t];
                    void 0 == d ? a.appendChild(n) : d._group_drag ? i(d._element_group.getNode()).before(n) : i(d.getNode()).before(n)
                }
                this.elements = o
            }
        },
        addElementGroup: function(t) {
            var o = t.width
              , n = t.height
              , a = e.getTransformAttr(t.json.transform, "translate")
              , r = parseFloat(a[0])
              , s = parseFloat(a[1])
              , d = this;
            i.ajax({
                url: t.fileurl,
                type: "GET",
                error: function() {
                    console.log("返回elementgroup素材错误")
                },
                complete: function(t) {
                    for (var i, t, a, l, g, h, p, f, u = t.responseText, m = JSON.parse(u), c = m.pages[0].width, _ = m.pages[0].height, v = [], b = m.pages[0].elems, w = b.length, y = 0; w > y; y++)
                        i = b[y],
                        t = i["data-elem"],
                        t.width = o * t.width / c,
                        t.height = n * t.height / _,
                        a = e.transformScale(i.transform, o / c),
                        l = e.getTransformAttr(a, "translate"),
                        l = [parseFloat(l[0]) + r, parseFloat(l[1]) + s],
                        h = e.getTransformAttr(a, "rotate"),
                        a = e.setTransformAttr(a, "translate", l),
                        i.transform = e.setTransformAttr(a, "rotate", h),
                        "text" == i["data-type"] && (t["font-size"] = t["font-size"] * o / c),
                        i["group-transform"] && (i["group-transform"] = e.transformScale(i["group-transform"], o / c)),
                        p = i.reverse,
                        f = e.getTransformAttr(p, "translate"),
                        f = [f[0] * o / c, f[1] * o / c],
                        i.reverse = e.setTransformAttr(p, "translate", f),
                        g = d.createElementAndUndo({
                            json: i,
                            unshift: !0
                        }),
                        v.push(g);
                    var x = d.createElementGroupAndUndo(v, {
                        unshift: !0
                    });
                    x.nodeClick()
                }
            })
        },
        insertElement: function(e) {
            var t, o = e.json, i = e.index || this.getElementSum(), n = o["data-type"];
            switch (n) {
            case "background":
            case "img":
                t = new r(this,o,i);
                break;
            case "svgImage":
            case "svgFrame":
                t = new s(this,o,i);
                break;
            case "text":
                t = new l(this,o,i);
                break;
            case "svgChart":
                t = new d(this,o,i);
                break;
            default:
                console.log("元素类型:" + n + "未定义")
            }
            return t
        },
        moveUp: function(t) {
            var o = this
              , i = this.getIndex()
              , n = this._owner_design
              , a = n.pages;
            e.swapItems(a, i, i - 1),
            n.saveDesignAndUndo({
                obj: o,
                loc: "pages]",
                key: i,
                tidx: i - 1,
                type: 2,
                action: "pageMoveUp"
            }, t)
        },
        moveDown: function(t) {
            var o = this
              , i = this.getIndex()
              , n = this._owner_design
              , a = n.pages;
            e.swapItems(a, i, i + 1),
            n.saveDesignAndUndo({
                obj: o,
                loc: "pages]",
                key: i,
                tidx: i + 1,
                type: 2,
                action: "pageMoveDown"
            }, t)
        },
        movePage: function(e, t) {
            var o = this
              , i = o.getIndex()
              , n = o._owner_design
              , a = n.pages
              , r = a.splice(i, 1)[0];
            return "noUndo" === t ? (n.pages = {
                index: e,
                page: r
            },
            void n.saveDesignAndUndo({
                obj: a[i],
                loc: "pages]",
                key: i,
                tidx: e,
                type: 2,
                action: "pageMoveTo"
            }, t)) : (n.pages = {
                index: e,
                page: r
            },
            void n.saveDesignAndUndo({
                obj: a[i],
                loc: "pages]",
                key: i,
                tidx: e,
                type: 2,
                action: "pageMoveTo"
            }, t))
        },
        copyAndUndo: function(e) {
            var t = this.copy()
              , o = this.getDesign();
            return o.saveDesignAndUndo({
                obj: t,
                loc: "pages]",
                key: t.getIndex(),
                value: t.getJson(),
                type: 0,
                action: "addPage"
            }, e),
            t
        },
        copy: function() {
            var e = this.getNewJson()
              , t = this.getIndex()
              , o = this._owner_design
              , i = new _(o,e,t + 1);
            return o.setPageScale(o.pageScale),
            o._owner_pageList.addPage(i, t + 1, !0),
            i
        },
        clear: function() {
            var e, t = (this.getPageSvg(),
            this._owner_design,
            this.elements), o = t.length;
            if (0 != o) {
                var i, n = this.element_groups;
                for (var a in n)
                    i = n[a],
                    i.groupSplitAndUndo();
                for (var r = t.length - 1; r >= 0; r--)
                    e = t[r],
                    void 0 != e && (e._group && (i = n[a],
                    i.removeAndUndo()),
                    this.eleDelAndUndoByChangeBackground(e))
            }
        },
        clearOld: function(e) {
            var t, o, i = this.getPageSvg(), n = this._owner_design, a = this.elements, r = a.length, s = this.getIndex(), d = [];
            if (0 != r) {
                var l, g = this.element_groups, h = [], p = 0;
                for (var f in g)
                    l = g[f],
                    o = JSON.parse(JSON.stringify(l.getJson())),
                    l.groupSplit(!0);
                for (f = 0; r > f; f++)
                    t = a[f],
                    void 0 != t && (o = JSON.parse(JSON.stringify(t.getJson())),
                    d[f] = {
                        page_num: s,
                        element_num: f,
                        old_json: o,
                        now_json: "",
                        action: "del"
                    });
                for (p = 0; p < h.length; p++)
                    d[f + p] = h[p];
                e || (n.mementos = d);
                for (var u, f = 0; r > f; f++)
                    u = a[f].getNode(),
                    i.removeChild(u),
                    a[f] = null;
                this.getJson().elems = [];
                var m = {
                    index: -1
                };
                this.elements = m,
                this.element_groups = m
            }
        },
        nodeMousedown: function(o) {
            if (1 != window.CTRL_PRESS) {
                var n = this._owner_design
                  , a = n._owner_editDiv;
                if (null != a) {
                    {
                        var r = a.getNode()
                          , s = n._owner_elementEditbar
                          , d = (s.getNode(),
                        a._owner_element)
                          , l = [];
                        n._focus_element
                    }
                    if (!window._Svg_Cut_isEdit_flag) {
                        for (var g = 0; g < i(".elementsSonEnter").size(); g++)
                            l.push(i(".elementsSonEnter").eq(g)[0]);
                        for (var h = 0; h < l.length; h++)
                            e.removeClass(l[h], "elementsSonEnter");
                        if (this._select_element = [],
                        "block" == i(".ss-function-colorPicker").attr("data-block") && t.colorPickupHide(i(".edit-color-span-pickup.now-click"), d, o),
                        i(".edit-div-clone").size() > 0 && i(".edit-div-clone").detach(),
                        i(".editdiv-clone").hasClass("editdiv-clone-text") && n._focus_element.finishInput(d),
                        "block" === r.style.display) {
                            n._focus_element = null;
                            {
                                i(d.getNode())
                            }
                            d._focus_drag && d.finishInput(),
                            r.style.display = "none",
                            s.hideNode(),
                            a._owner_element = null
                        }
                        i("#chartMenuBtn").hasClass("listBtnClick") && t.initChartBtn(null),
                        i(".edit-div-write-wrap").size() > 0 && i(".edit-div-write-wrap").remove(),
                        i(".editdiv-clone").detach()
                    }
                }
            }
        },
        pageMouseMove: function(e) {
            if ("none" != i("#pageScaleWrap").css("display")) {
                var t, o, n, a, r = this, s = e.pageX, d = e.pageY, l = i("#div_design"), g = (l.offset().top,
                l.offset().left,
                i("#pageScaleWrap").find(".page-area")), h = {
                    top: g.offset().top,
                    left: g.offset().left,
                    bottom: g.offset().top + g.innerHeight(),
                    right: g.offset().left + g.innerWidth()
                }, p = i(".page-on-focus"), f = {
                    top: p.offset().top,
                    left: p.offset().left
                };
                i(document).mousemove(function(e) {
                    t = e.pageX,
                    o = e.pageY,
                    n = t - s,
                    a = o - d;
                    r._owner_design._owner_designEditbar.getPageChangePosition(f, h, {
                        x: n,
                        y: a
                    })
                }).mouseup(function() {
                    i(this).off("mousemove").off("mouseup")
                })
            }
        },
        nodeMouseenter: function() {
            var e = this._owner_design
              , t = e._focus_page;
            null != e._focus_page && i(e._focus_page.getNode()).addClass("page-no-focus"),
            e._focus_page = this,
            i(this.getNode()).removeClass("page-no-focus"),
            t != this && this.nodeMousedown()
        },
        svgLayoutWrapCreate: function() {
            var e, t, o, t, n = this.getNode(), a = i(n), r = this.elements, s = r.length, d = a.clone();
            d.find("svg").children().remove();
            var l = this.getLeft()
              , g = this.getTop();
            d.attr("class", "page-clone").appendTo(i("body")),
            d.css("z-index", 10001).offset({
                left: l,
                top: g
            }),
            this._svgLayoutCheek.index = 0,
            this._svgLayoutCheek.imgIndex = 0;
            for (var h = 0; s > h; h++)
                if (o = r[h],
                t = i(o.getNode()),
                "svgLayout" == o._svg_type) {
                    e = t.clone(),
                    e.attr("class", "svgLayout-clone").find(".layoutImgWrap").attr("data-index", h),
                    e.find(".wonAd").each(function() {
                        var e = i(this).attr("id") + "bianhao";
                        i(this).attr("id", e),
                        i(this).parent().find(".layoutImgWrap").attr("clip-path", "url(#" + e + ")")
                    });
                    var p = e.find("filter").attr("id") + "bianhao";
                    e.find("filter").attr("id", p),
                    e.find(".layoutImgWrap").attr("filter", "url(#" + p + ")"),
                    d.children("svg").append(e)
                }
        },
        svgLayoutEnter: function(e, t) {
            var o = this
              , n = i(".page-clone");
            n.find(".svgLayout-clone").find(".layoutImgWrap").mouseenter(function() {
                var t = i(this);
                e.drag = !0,
                e.index = t.attr("data-index"),
                e.imgIndex = t.parentsUntil(".svgLayout-clone").find(".layoutImgWrap").index(this)
            }).mouseleave(function() {
                e.drag = !1
            });
            var a = o.getElement(e.index)
              , r = a.getNode()
              , s = i(r)
              , d = s.find(".layoutImgWrap").eq(e.imgIndex).children()
              , l = 1;
            if ("img" == t._element_type) {
                var g = t;
                t = i(t.getNode()),
                l = "NAN"
            }
            if (e.drag) {
                if (o._svgLayoutCheek.index != e.index || o._svgLayoutCheek.imgIndex != e.imgIndex) {
                    var h = o.getElement(o._svgLayoutCheek.index)
                      , p = i(h.getNode()).find(".layoutImgWrap").eq(o._svgLayoutCheek.imgIndex).children();
                    p.attr({
                        "xlink:href": p.attr("data-old") || "",
                        width: p.attr("data-width") || "",
                        height: p.attr("data-height") || "",
                        x: p.attr("data-x") || "",
                        y: p.attr("data-y") || "",
                        transform: p.attr("data-transform") || ""
                    })
                }
                o._svgLayoutCheek.index = e.index,
                o._svgLayoutCheek.imgIndex = e.imgIndex,
                "elementsSon imgSon" == t[0].getAttribute("class") ? d.attr("xlink:href", t.find("image")[0].href.baseVal) : d.attr("xlink:href", t.children().attr("src"));
                var f;
                d.parent().parent().find("rect").size() > 0 ? f = d.parent().parent().find("rect") : d.parent().parent().find("circle").size() > 0 ? f = d.parent().parent().find("circle") : d.parent().parent().find("ellipse").size() > 0 ? f = d.parent().parent().find("ellipse") : d.parent().parent().find("line").size() > 0 ? f = d.parent().parent().find("line") : d.parent().parent().find("polyline").size() > 0 ? f = d.parent().parent().find("polyline") : d.parent().parent().find("polygon").size() > 0 ? f = d.parent().parent().find("polygon") : d.parent().parent().find("path").size() > 0 && (f = d.parent().parent().find("path"));
                var u = f[0].getBBox()
                  , m = u.width
                  , c = u.height
                  , _ = u.x
                  , v = u.y
                  , b = t.getWidth()
                  , w = t.getHeight();
                if ((0 == b || 0 == w) && (b = g.getWidth(),
                w = g.getHeight()),
                b / m > w / c) {
                    var y = m;
                    m = c / (w / b),
                    _ -= (m - y) / 2
                } else {
                    var x = c;
                    c = m / (b / w),
                    v -= (c - x) / 2
                }
                d.attr({
                    width: m,
                    height: c,
                    x: _,
                    y: v,
                    transform: ""
                }),
                t.css("opacity", ".4"),
                o.svgLayoutShowTipsShow(t)
            } else
                d.attr({
                    "xlink:href": d.attr("data-old") || "",
                    width: d.attr("data-width") || "",
                    height: d.attr("data-height") || "",
                    x: d.attr("data-x") || "",
                    y: d.attr("data-y") || "",
                    transform: d.attr("data-transform") || ""
                }),
                "NAN" == l ? t.css("opacity", "") : t.css("opacity", l),
                o.svgLayoutShowTipsHide()
        },
        svgLayoutShowTipsShow: function(e) {
            var t = e[0].getBoundingClientRect();
            i(".enterSvgLayout").css({
                left: (t.left + t.right) / 2,
                top: t.bottom + 8,
                display: "block"
            })
        },
        svgLayoutShowTipsHide: function() {
            i(".enterSvgLayout").css("display", "none")
        },
        svgLayoutWrapRemove: function(t, o) {
            if (i(".page-clone").remove(),
            i(".enterSvgLayout").css("display", "none"),
            t.drag) {
                var n, a, r = this.getElement(t.index), s = i(r.getNode()), d = s.find(".layoutImgWrap").eq(t.imgIndex).children();
                if ("img" == o._element_type ? (n = o.getImgKey(),
                a = o.getImgId()) : (n = o.children().attr("alt"),
                a = o.children().attr("data-id")),
                d.attr({
                    "data-old": d.attr("xlink:href"),
                    "data-key": n,
                    "data-width": d.attr("width"),
                    "data-height": d.attr("height"),
                    "data-x": d.attr("x"),
                    "data-y": d.attr("y"),
                    "data-transform": d.attr("transform"),
                    "data-id": a
                }),
                void 0 == n)
                    d.removeAttr("data-key"),
                    i.ajax({
                        url: "/material/getMaterialUrlsByIds.do",
                        type: "POST",
                        dataType: "json",
                        data: {
                            mids: a,
                            w: 800
                        },
                        success: function(e) {
                            var t = new Image;
                            t.src = e.urls[a],
                            t.onload = function() {
                                d.attr({
                                    "data-old": t.src,
                                    "xlink:href": t.src
                                })
                            }
                        },
                        error: function() {}
                    });
                else {
                    var l = new Image;
                    l.src = "//" + img_config.imgdomain + "/materials/" + n + "@0e_800w_800h_0c_0i_0o_1x.png",
                    l.onload = function() {
                        d.attr({
                            "data-old": l.src,
                            "xlink:href": l.src
                        })
                    }
                }
                window.MEMENTO_ID = e.now(),
                r.setLayout(),
                "img" == o._element_type && this.eleDelAndUndo(o)
            }
        },
        elementsPositionNotThis: function(e) {
            var t = this.elements
              , o = (this.getDesign(),
            t.length)
              , n = this.getRect();
            3 != window.split ? n.middle_x = (n.left + n.right) / 2 : (n.three_first = n.left + (n.right - n.left) * (parseFloat(i(".three-first-line")[0].style.left) / 100),
            n.three_secend = n.left + (n.right - n.left) * (parseFloat(i(".three-second-line")[0].style.left) / 100)),
            n.middle_y = (n.top + n.bottom) / 2;
            for (var a, r, s, d = {
                0: n
            }, l = 1, g = e.length, h = 0; o > h; h++) {
                a = t[h],
                s = !1;
                for (var p = 0; g > p; p++)
                    a != e[p] || (s = !0);
                s || void 0 != a && (r = a.getRect(),
                r.middle_x = (r.left + r.right) / 2,
                r.middle_y = (r.top + r.bottom) / 2,
                d[l] = r,
                d[l].i = h,
                l++)
            }
            return d
        },
        flickerBackground: function(t) {
            var o = e.createNode("div", "background-flicker")
              , n = i(o)
              , a = this.getDesign()
              , r = a.pageScale
              , s = e.getTransformAttr(t.transform, "translate");
            n.css({
                width: parseFloat(this.pageWH.width) * r,
                height: parseFloat(this.pageWH.height) * r,
                position: "absolute",
                left: "0px",
                top: "0px",
                overflow: "hidden"
            });
            var d = new Image;
            d.src = window.imgsrc;
            var l = i(d);
            l.css({
                width: parseFloat(t.width) * r,
                height: parseFloat(t.height) * r,
                position: "absolute",
                left: parseFloat(s[0]) * r,
                top: parseFloat(s[1]) * r
            }),
            n.append(d);
            var g = this.getNode()
              , h = i(g);
            h.append(n),
            setTimeout(function() {
                n.detach()
            }, 500)
        },
        guideSetElementPosition: function(t, o) {
            for (var i, n = o[0].left - t.left, a = o[0].top - t.top, r = e.jsonLength(o), s = 0; r > s; s++)
                i = o[s],
                Math.abs(n) > Math.abs(i.left - t.left) && (n = i.left - t.left),
                Math.abs(n) > Math.abs(i.middle_x - t.left) && (n = i.middle_x - t.left),
                Math.abs(n) > Math.abs(i.right - t.left) && (n = i.left - t.left),
                3 == window.split && 0 == s && (Math.abs(n) > Math.abs(i.three_first - t.left) && (n = i.three_first - t.left),
                Math.abs(n) > Math.abs(i.three_secend - t.left) && (n = i.three_secend - t.left)),
                Math.abs(n) > Math.abs(i.left - t.middle_x) && (n = i.left - t.middle_x),
                Math.abs(n) > Math.abs(i.middle_x - t.middle_x) && (n = i.middle_x - t.middle_x),
                Math.abs(n) > Math.abs(i.right - t.middle_x) && (n = i.right - t.middle_x),
                3 == window.split && 0 == s && (Math.abs(n) > Math.abs(i.three_first - t.middle_x) && (n = i.three_first - t.middle_x),
                Math.abs(n) > Math.abs(i.three_secend - t.middle_x) && (n = i.three_secend - t.middle_x)),
                Math.abs(n) > Math.abs(i.left - t.right) && (n = i.left - t.right),
                Math.abs(n) > Math.abs(i.middle_x - t.right) && (n = i.middle_x - t.right),
                Math.abs(n) > Math.abs(i.right - t.right) && (n = i.right - t.right),
                3 == window.split && 0 == s && (Math.abs(n) > Math.abs(i.three_first - t.right) && (n = i.three_first - t.right),
                Math.abs(n) > Math.abs(i.three_secend - t.right) && (n = i.three_secend - t.right)),
                Math.abs(a) > Math.abs(i.top - t.top) && (a = i.top - t.top),
                Math.abs(a) > Math.abs(i.middle_y - t.top) && (a = i.middle_y - t.top),
                Math.abs(a) > Math.abs(i.bottom - t.top) && (a = i.bottom - t.top),
                Math.abs(a) > Math.abs(i.top - t.middle_y) && (a = i.top - t.middle_y),
                Math.abs(a) > Math.abs(i.top_middle_drag - t.middle_y) && (a = i.middle_y - t.middle_y),
                Math.abs(a) > Math.abs(i.bottom - t.middle_y) && (a = i.bottom - t.middle_y),
                Math.abs(a) > Math.abs(i.top - t.bottom) && (a = i.top - t.bottom),
                Math.abs(a) > Math.abs(i.middle_y - t.bottom) && (a = i.middle_y - t.bottom),
                Math.abs(a) > Math.abs(i.bottom - t.bottom) && (a = i.bottom - t.bottom);
            return Math.abs(n) <= 4 && (t.left = parseFloat(t.left) + n,
            t.middle_x = parseFloat(t.middle_x) + n,
            t.right = parseFloat(t.right) + n),
            Math.abs(a) <= 4 && (t.top = parseFloat(t.top) + a,
            t.middle_y = parseFloat(t.middle_y) + a,
            t.bottom = parseFloat(t.bottom) + a),
            t
        },
        guideShow: function(t, o) {
            var n = this.getRect();
            n.middle_x = (n.left + n.right) / 2,
            n.middle_y = (n.top + n.bottom) / 2;
            {
                var a, r = n.right - n.left, s = n.bottom - n.top, d = e.jsonLength(o), l = i("#div_design"), g = this._elements, h = g[t.i];
                i(this.getPageSvg())
            }
            t = this.guideSetElementPosition(t, o),
            i(".moveGuide").detach();
            for (var p = 0; p < i(".elementsSonEnter").size(); p++)
                h.getNode() != i(".elementsSonEnter").eq(p)[0] ? e.removeClass(i(".elementsSonEnter").eq(p)[0], "elementsSonEnter") : e.addClass(i(".elementsSonEnter").eq(p)[0], "elementsSonEnter");
            for (var f = 0; d > f; f++) {
                if (a = o[f],
                "false" != t.left_drag && (Math.round(t.left) == Math.round(a.left) || Math.round(t.left) == Math.round(a.middle_x) || Math.round(t.left) == Math.round(a.right))) {
                    var u, m, c = i("<div class='moveGuideV moveGuide'></div>"), _ = i("#div_design").offset().top;
                    a.top > t.bottom ? (u = (t.bottom - t.top + a.bottom - a.top) / 2 + (a.top - t.bottom),
                    m = (t.bottom + t.top) / 2 - _) : a.top < t.bottom && (u = (t.bottom - t.top + a.bottom - a.top) / 2 + (t.top - a.bottom),
                    m = (a.bottom + a.top) / 2 - _),
                    c.css({
                        width: "1px",
                        height: u,
                        position: "absolute"
                    }),
                    c.css(void 0 == a.i ? {
                        background: "url(" + i(".guidelineVImgR").attr("src") + ")",
                        height: s
                    } : {
                        background: "url(" + i(".guidelineVImg").attr("src") + ")",
                        top: m
                    }),
                    c.appendTo(l),
                    c.offset({
                        left: t.left
                    }),
                    t.left_drag = "false",
                    void 0 != a.i && g[a.i].showAnt()
                }
                if ("false" != t.middle_x_drag && (Math.round(t.middle_x) == Math.round(a.left) || Math.round(t.middle_x) == Math.round(a.middle_x) || Math.round(t.middle_x) == Math.round(a.right))) {
                    var u, m, c = i("<div class='moveGuideV moveGuide'></div>"), _ = i("#div_design").offset().top;
                    a.top > t.bottom ? (u = (t.bottom - t.top + a.bottom - a.top) / 2 + (a.top - t.bottom),
                    m = (t.bottom + t.top) / 2 - _) : a.top < t.bottom && (u = (t.bottom - t.top + a.bottom - a.top) / 2 + (t.top - a.bottom),
                    m = (a.bottom + a.top) / 2 - _),
                    c.css({
                        width: "1px",
                        height: u,
                        position: "absolute"
                    }),
                    c.css(void 0 == a.i ? {
                        background: "url(" + i(".guidelineVImgR").attr("src") + ")",
                        height: s
                    } : {
                        background: "url(" + i(".guidelineVImg").attr("src") + ")",
                        top: m
                    }),
                    c.appendTo(l),
                    c.offset({
                        left: t.middle_x
                    }),
                    t.middle_x_drag = "false",
                    void 0 != a.i && g[a.i].showAnt()
                }
                if ("false" != t.right_drag && (Math.round(t.right) == Math.round(a.left) || Math.round(t.right) == Math.round(a.middle_x) || Math.round(t.right) == Math.round(a.right))) {
                    var u, m, c = i("<div class='moveGuideV moveGuide'></div>"), _ = i("#div_design").offset().top;
                    a.top > t.bottom ? (u = (t.bottom - t.top + a.bottom - a.top) / 2 + (a.top - t.bottom),
                    m = (t.bottom - t.top) / 2 + t.top - _) : a.top < t.bottom && (u = (t.bottom - t.top + a.bottom - a.top) / 2 + (t.top - a.bottom),
                    m = (a.bottom + a.top) / 2 - _),
                    c.css({
                        width: "1px",
                        height: u,
                        position: "absolute"
                    }),
                    c.css(void 0 == a.i ? {
                        background: "url(" + i(".guidelineVImgR").attr("src") + ")",
                        height: s
                    } : {
                        background: "url(" + i(".guidelineVImg").attr("src") + ")",
                        top: m
                    }),
                    c.appendTo(l),
                    c.offset({
                        left: t.right
                    }),
                    t.right_drag = "false",
                    void 0 != a.i && g[a.i].showAnt()
                }
                if ("false" != t.top_drag && (Math.round(t.top) == Math.round(a.top) || Math.round(t.top) == Math.round(a.middle_y) || Math.round(t.top) == Math.round(a.bottom))) {
                    var v, b, c = i("<div class='moveGuideA moveGuide'></div>"), w = i("#div_design").offset().left;
                    t.left < a.right ? (v = (t.right - t.left + a.right - a.left) / 2 + (a.left - t.right),
                    b = (t.right + t.left) / 2 - w) : t.left > a.right && (v = (t.right - t.left + a.right - a.left) / 2 + (t.left - a.right),
                    b = (a.right + a.left) / 2 - w),
                    c.css({
                        width: v,
                        height: "1px",
                        position: "absolute"
                    }),
                    c.css(void 0 == a.i ? {
                        background: "url(" + i(".guidelineAImgR").attr("src") + ")",
                        width: r
                    } : {
                        background: "url(" + i(".guidelineAImg").attr("src") + ")",
                        left: b
                    }),
                    c.appendTo(l),
                    c.offset({
                        top: t.top
                    }),
                    t.top_drag = "false",
                    void 0 != a.i && g[a.i].showAnt()
                }
                if ("false" != t.middle_y_drag && (Math.round(t.middle_y) == Math.round(a.top) || Math.round(t.middle_y) == Math.round(a.middle_y) || Math.round(t.middle_y) == Math.round(a.bottom))) {
                    var v, b, c = i("<div class='moveGuideA moveGuide'></div>"), w = i("#div_design").offset().left;
                    t.left < a.right ? (v = (t.right - t.left + a.right - a.left) / 2 + (a.left - t.right),
                    b = (t.right + t.left) / 2 - w) : t.left > a.right && (v = (t.right - t.left + a.right - a.left) / 2 + (t.left - a.right),
                    b = (a.right + a.left) / 2 - w),
                    c.css({
                        width: v,
                        height: "1px",
                        position: "absolute"
                    }),
                    c.css(void 0 == a.i ? {
                        background: "url(" + i(".guidelineAImgR").attr("src") + ")",
                        width: r
                    } : {
                        background: "url(" + i(".guidelineAImg").attr("src") + ")",
                        left: b
                    }),
                    c.appendTo(l),
                    c.offset({
                        top: t.middle_y
                    }),
                    t.middle_y_drag = "false",
                    void 0 != a.i && g[a.i].showAnt()
                }
                if ("false" != t.bottom_drag && (Math.round(t.bottom) == Math.round(a.top) || Math.round(t.bottom) == Math.round(a.middle_y) || Math.round(t.bottom) == Math.round(a.bottom))) {
                    var v, b, c = i("<div class='moveGuideA moveGuide'></div>"), w = i("#div_design").offset().left;
                    t.left < a.right ? (v = (t.right - t.left + a.right - a.left) / 2 + (a.left - t.right),
                    b = (t.right + t.left) / 2 - w) : t.left > a.right && (v = (t.right - t.left + a.right - a.left) / 2 + (t.left - a.right),
                    b = (a.right + a.left) / 2 - w),
                    c.css({
                        width: v,
                        height: "1px",
                        position: "absolute"
                    }),
                    c.css(void 0 == a.i ? {
                        background: "url(" + i(".guidelineAImgR").attr("src") + ")",
                        width: r
                    } : {
                        background: "url(" + i(".guidelineAImg").attr("src") + ")",
                        left: b
                    }),
                    c.appendTo(l),
                    c.offset({
                        top: t.bottom
                    }),
                    t.bottom_drag = "false",
                    void 0 != a.i && g[a.i].showAnt()
                }
            }
            return t
        },
        changeElePosition: function(e, t, o) {
            return {
                left: e.left + t,
                right: e.right + t,
                top: e.top + o,
                bottom: e.bottom + o,
                middle_x: (e.left + e.right) / 2 + t,
                middle_y: (e.top + e.bottom) / 2 + o
            }
        },
        eleMoveUp: function(e, t) {
            var o = e.getNode()
              , n = i(o)
              , a = n.next();
            if (void 0 == a[0])
                return !1;
            a.after(n);
            var r = e.getIndex()
              , s = {
                index: r,
                element: r + 1
            };
            if (this.elements = s,
            !t) {
                var d = [{
                    page_num: this.getIndex(),
                    element_num: r + 1,
                    old_json: "",
                    now_json: "",
                    action: "moveup"
                }]
                  , l = this._owner_design;
                l.mementos = d
            }
        },
        eleMoveDown: function(e, t) {
            var o = e.getNode()
              , n = i(o)
              , a = n.prev();
            if (void 0 == a[0])
                return !1;
            a.before(n);
            var r = e.getIndex()
              , s = {
                index: r,
                element: r - 1
            };
            if (this.elements = s,
            !t) {
                var d = [{
                    page_num: this.getIndex(),
                    element_num: r - 1,
                    old_json: "",
                    now_json: "",
                    action: "movedown"
                }]
                  , l = this._owner_design;
                l.mementos = d
            }
        },
        eleCopyAndUndo: function(t) {
            var o;
            o = void 0 == t.ele ? JSON.parse(t.json) : t.ele.getNewJson();
            var i = (o["data-elem"],
            this._owner_design)
              , n = i.pageScale
              , a = JSON.parse(JSON.stringify(o))
              , r = e.getTransformAttr(a.transform, "translate")
              , s = e.getTransformAttr(a.transform, "rotate")
              , d = 20 / n;
            r[0] = parseFloat(r[0]) + d,
            r[1] = parseFloat(r[1]) + d,
            a.transform = e.setTransformAttr(a.transform, "translate", r),
            a.transform = e.setTransformAttr(a.transform, "rotate", s);
            var l = this.createElementAndUndo({
                json: a
            });
            return l
        },
        eleDelAndUndoByChangeBackground: function(e, t) {
            var o = e.getIndex()
              , i = this.getIndex()
              , n = this.getDesign();
            n.saveDesignAndUndo({
                obj: e,
                loc: "pages]" + i + "]elems]",
                key: o,
                value: e.getNewJson(),
                type: "3",
                action: "delMaterial",
                unshift: !0
            }, t),
            this.eleDel(e)
        },
        eleDelAndUndo: function(e, t, o) {
            var i = e.getIndex()
              , n = this.getIndex()
              , a = this.getDesign();
            return e.getPage() != this ? void this.nodeMousedown() : (a.saveDesignAndUndo({
                obj: e,
                loc: "pages]" + n + "]elems]",
                key: i,
                value: e.getNewJson(),
                type: "3",
                action: "delMaterial",
                unshift: o
            }, t),
            this.eleDel(e),
            void a.makePageThumb(this))
        },
        eleDel: function(e) {
            if (void 0 != e) {
                this.nodeMousedown(!0);
                var t = e.getNode()
                  , o = this.getPageSvg()
                  , i = e.getIndex();
                "svgLayout" == e._svg_type && this._svgLayoutNum--;
                try {
                    o.removeChild(t)
                } catch (n) {}
                var a = {
                    index: i
                };
                this.elements = a;
                {
                    this.getDesign()
                }
            }
        },
        eleDelOld: function(e, t, o) {
            if (void 0 != e) {
                this.nodeMousedown();
                var i = e.getNode()
                  , n = this.getPageSvg()
                  , a = e.getIndex();
                "svgLayout" == e._svg_type && this._svgLayoutNum--;
                var r = !1;
                "background" != e._element_type || o || (r = !0);
                var s = e.getJson()
                  , d = JSON.parse(JSON.stringify(s));
                n.removeChild(i);
                var l = {
                    index: a
                };
                if (this.elements = l,
                t) {
                    if (1 === t) {
                        var g = [{
                            page_num: this.getIndex(),
                            element_num: a,
                            old_json: d,
                            now_json: "",
                            action: "del",
                            drag: !0
                        }]
                          , h = this._owner_design;
                        h.mementos = g
                    } else if (2 === t) {
                        var g = [{
                            page_num: this.getIndex(),
                            element_num: a,
                            old_json: d,
                            now_json: "",
                            action: "del"
                        }];
                        return g
                    }
                } else {
                    var g = [{
                        page_num: this.getIndex(),
                        element_num: a,
                        old_json: d,
                        now_json: "",
                        action: "del"
                    }]
                      , h = this._owner_design;
                    h.mementos = g
                }
                e = null,
                1 == r && this.addWhiteBackground()
            }
        },
        addEles: function(t) {
            var o, i, n, a, r, s, d, l = this, g = t.length, h = this._owner_design, p = h.pageScale, f = [], u = {};
            u.id = "element_group_" + e.now();
            for (var m = 0; g > m; m++) {
                if (o = JSON.parse(t[m]),
                void 0 == o["data-elem"]) {
                    u.transform = o.transform;
                    break
                }
                i = e.getTransformAttr(o.transform, "translate"),
                n = e.getTransformAttr(o.transform, "rotate"),
                a = 20 / p,
                i[0] = parseFloat(i[0]) + a,
                i[1] = parseFloat(i[1]) + a,
                o.transform = e.setTransformAttr(o.transform, "translate", i),
                o.transform = e.setTransformAttr(o.transform, "rotate", n);
                var c = o["group-transform"];
                "" != c && void 0 != c && (s = e.getTransformAttr(c, "translate"),
                d = e.getTransformAttr(c, "rotate"),
                s[0] = parseFloat(s[0]) + a,
                s[1] = parseFloat(s[1]) + a,
                o["group-transform"] = e.setTransformAttr(c, "translate", s),
                o["group-transform"] = e.setTransformAttr(c, "rotate", d),
                o.group = u.id,
                o.transform = e.setTransformAttr(c, "translate", s)),
                r = l.createElementAndUndo({
                    json: o,
                    unshift: !0
                }),
                f.push(r)
            }
            if (u.unshift = !0,
            u.transform) {
                var _ = l.createElementGroupAndUndo(f, u);
                return _
            }
            return l._select_element = f,
            l.selectElementUp()
        },
        eleGroupDel: function(e) {
            this.nodeMousedown();
            var t = this.getPageSvg()
              , o = e.getNode();
            t.removeChild(o),
            this.element_groups = {
                index: e.id
            },
            e = null
        },
        getNewJson: function() {
            var e = this.getJson()
              , t = {
                width: this.width,
                height: this.height
            };
            e.width = parseFloat(t.width).toFixed(8).toString(),
            e.height = parseFloat(t.height).toFixed(8).toString(),
            e.elems = [],
            e.elegroups = {};
            for (var o = 0; o < this.elements.length; o++) {
                var i = this.elements[o];
                void 0 != i && (e.elems[o] = i.getNewJson())
            }
            var n = this.element_groups;
            for (var a in n) {
                var r = n[a];
                e.elegroups[a] = r.getNewJson()
            }
            return e
        },
        getBackgroundColor: function() {
            var e = this.elements
              , t = e[0];
            if (void 0 == t)
                return "#FFF";
            var o = t.getJson()
              , i = o["data-elem"];
            return "false" == i["data-key"] ? i["data-colors"][0] || "#FFF" : "#FFF"
        },
        selectElement: function(t, o, i, n) {
            var a, r, s = this.elements, d = s.length;
            this._select_element = [];
            for (var l = 0, g = 0; d > g; g++)
                if (a = s[g],
                !(void 0 == a || a.isBackground() || "true" == a.lock || a._group_drag && "true" == a._element_group.lock))
                    if (r = a.getRect(),
                    r.top > i || r.right < n || r.bottom < t || r.left > o)
                        a.hideAnt();
                    else {
                        if (a._group_drag) {
                            for (var h = !1, p = 0; p < this._select_element.length; p++)
                                this._select_element[p].id === a._element_group.id && (h = !0);
                            if (h)
                                continue;
                            this._select_element[l] = a._element_group
                        } else
                            this._select_element[l] = a;
                        e.hasClass(a.getNode(), "elementsSonEnter") || a.showAnt(),
                        l++
                    }
        },
        selectElementUp: function() {
            var e = this._select_element;
            if (1 == e.length)
                e[0].nodeClick();
            else if (e.length > 0)
                return this.createCircleSelect()
        },
        createCircleSelect: function() {
            var e = this._select_element;
            if (!(e.length < 0)) {
                var t = new h(this,e);
                return t
            }
        },
        createElementGroup: function(e, t) {
            if (this.nodeMousedown(),
            0 == e.length)
                return null;
            var o = new p(this,e,t);
            return this.element_groups = {
                index: o.id,
                element_group: o
            },
            o
        },
        createElementGroupAndUndo: function(e, t, o) {
            var i;
            void 0 != t && t.unshift && (i = t.unshift);
            for (var n, a = this.createElementGroup(e, t), r = this.getDesign(), s = [], d = 0; d < e.length; d++)
                n = e[d],
                s.push(n.getIndex());
            return r.saveDesignAndUndo({
                obj: a,
                loc: "pages]" + this.getIndex() + "]elegroups]",
                key: a.id,
                value: a.getJson(),
                type: "0",
                action: "addElementGroup",
                eles_index: s,
                unshift: i
            }, o),
            "noUndo" != o && a.setNewJson(),
            a
        },
        onloadTemplate: function(e, t) {
            var o = this._owner_design;
            this.clear();
            var i = this.getJson();
            i = e.pages[t];
            var a = i.elems
              , t = (this.getIndex(),
            0);
            if (void 0 != a[0] && "background" != a[0]["data-type"] || void 0 == a[0]) {
                var r = {
                    "data-type": "background",
                    "data-elem": {
                        filter: {
                            brightness: 0,
                            contrast: 0,
                            crossProcess: 0,
                            gaussianBlur: 0,
                            saturation: 0,
                            tint: 0
                        },
                        "data-key": "false",
                        width: this.width,
                        height: this.height,
                        opacity: "1",
                        "data-colors": {
                            0: "rgb(255, 255, 255)"
                        }
                    },
                    transform: "translate(0,0)",
                    reverse: ""
                };
                a.splice(0, 0, r)
            }
            if (a)
                for (var s in a) {
                    var d = a[s]
                      , l = n.BLEED_SIZE;
                    o.bleed && "false" != o.bleed && "true" != e.bleed && (d = o.jsonAddleftTop(a[s], l)),
                    o.bleed && "true" != o.bleed && "true" == e.bleed && (d = o.jsonAddleftTop(a[s], -l));
                    {
                        this.createElementAndUndo({
                            json: d,
                            unshift: !0
                        })
                    }
                }
            this._pop_drag = !1
        },
        compareElementPosition: function(t) {
            var o = t.getNewJson();
            if ("img" != t.dataType && "background" != t.dataType || "false" === o["data-elem"]["data-key"])
                return !1;
            var i, n = t.transform, a = e.getTransformAttr(n, "translate"), r = t.getShowWidth(), s = t.getShowHeight(), d = t.getRotate(), l = {
                top: parseFloat(a[1]),
                right: parseFloat(a[0]) + r,
                bottom: parseFloat(a[1]) + s,
                left: parseFloat(a[0])
            }, g = (t.getPage(),
            {
                width: this.width,
                height: this.height
            });
            i = e.coordinateRotate(0, 0, d, l.left + r / 2, l.top + s / 2);
            var h, p = !0, f = !0, u = !0, m = !0;
            return (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (p = !1),
            i = e.coordinateRotate(g.width, 0, d, l.left + r / 2, l.top + s / 2),
            (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (f = !1),
            i = e.coordinateRotate(g.width, g.height, d, l.left + r / 2, l.top + s / 2),
            (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (u = !1),
            i = e.coordinateRotate(0, g.height, d, l.left + r / 2, l.top + s / 2),
            (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (m = !1),
            h = p && f && u && m ? !0 : !1
        },
        pageBleed: function(t, o) {
            var i = this.elements;
            if (0 != i.length) {
                var a;
                if (i[0].isBackground()) {
                    a = 1;
                    var r;
                    if (r = t > 0 ? !0 : !1,
                    i[0].reseatBackgroundPosition(o * n.ZOOM_IN, o * n.ZOOM_IN, r),
                    i.length <= 1)
                        return
                } else
                    a = 0;
                for (var s, d = a; d < i.length; d++)
                    s = i[d],
                    s._group_drag || (s.addLeftTop(t * n.ZOOM_IN, t * n.ZOOM_IN, s.getNode()),
                    s.transform = {
                        value: e.transformScale(s.getTransform(), 1 / n.ZOOM_IN),
                        undo_drag: "noUndo"
                    });
                var l = this._element_groups;
                for (var g in l)
                    l[g].addLeftTop(t * n.ZOOM_IN, t * n.ZOOM_IN),
                    l[g].setNewJson()
            }
        },
        showBleedBorder: function() {
            var e = this.getDesign()
              , t = {
                width: this.width,
                height: this.height
            }
              , o = n.BLEED_SIZE
              , i = e.pageScale
              , a = i * o
              , r = 100 * (o / t.width)
              , s = 100 * (o / t.height);
            this.showBleedBorderByPrecent(r, s, a)
        },
        showBleedBorderByPrecent: function(e, t, o) {
            var n = i("#rightPanel");
            n.find(".bleed_top, .bleed_bottom").css("height", t + "%").show(),
            n.find(".bleed_right, .bleed_left").css({
                width: e + "%",
                height: 100 - 2 * t + "%",
                top: t + "%"
            }).show(),
            n.find(".bleed_ruler_top_left, .bleed_ruler_top_right").css("top", o + "px").show(),
            n.find(".bleed_ruler_right_top, .bleed_ruler_right_bottom").css("right", o + "px").show(),
            n.find(".bleed_ruler_bottom_right, .bleed_ruler_bottom_left").css("bottom", o + "px").show(),
            n.find(".bleed_ruler_left_top, .bleed_ruler_left_bottom").css("left", o + "px").show(),
            n.find(".bleed_line_top").css({
                top: o + "px",
                left: o + "px",
                width: 100 - 2 * e + "%"
            }).show(),
            n.find(".bleed_line_bottom").css({
                bottom: o + "px",
                left: o + "px",
                width: 100 - 2 * e + "%"
            }).show(),
            i(".three-second-line").css({
                left: (100 - 2 * e) / 3 * 2 + e + "%"
            }),
            i(".three-first-line").css({
                left: (100 - 2 * e) / 3 + e + "%"
            })
        },
        eleSeatRectSet: function() {
            for (var e = this._elements, t = 0; t < e.length; t++)
                e[t].seatRectSet()
        },
        addWhiteBackgroundAndUndo: function(e) {
            var t = this.width
              , o = this.height
              , i = {
                "data-type": "background",
                "data-elem": {
                    "data-key": "false",
                    width: t,
                    height: o,
                    opacity: 1,
                    "data-colors": {
                        0: "rgb(255, 255, 255)"
                    }
                },
                transform: "translate(0,0)"
            };
            this.createElementAndUndo({
                json: i,
                unshift: e
            })
        }
    },
    e.classExtend(_, o),
    _
});
;/*!/comp/design/toolbar/ElementEditbar.js*/
"use strict";
define("comp/design/toolbar/ElementEditbar", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/Widget", "comp/design/toolbar/toolbar_config", "comp/design/Toolbar", "libs/jquery/jquery.easing.1.3", "comp/design/toolbar/SvgFilter", "comp/design/design_config", "widget/pop/pop", "widget/vipExclusive/vipExclusive"], function(e, t, o, n, i, s, a, r, l, d, c) {
    function u() {
        var e = this;
        f.call(e)
    }
    function f() {
        var n = this
          , s = this.getNode()
          , a = t(s);
        a.on("mousedown", function(e) {
            e.stopPropagation()
        }),
        a.on("mouseenter", function() {
            window.elementEditBarEnter = !0
        }).on("mouseleave", function() {
            window.elementEditBarEnter = !1
        }),
        a.find(".ele-color").mousedown(function(e) {
            if ("block" == t("#texteventtarget").css("display")) {
                var o = n._owner_element;
                o.finishInput()
            }
            var i = t(this);
            n.editColorShow(e, i),
            e.stopPropagation()
        });
        var r = i.getEditColor();
        r.on("mousedown", ".edit-color-span", function(o) {
            return e.addBugTrackClick("e8"),
            t(this).hasClass("edit-color-span-nocolor") || t(this).hasClass("edit-color-span-pickup") ? (o.stopPropagation(),
            !1) : (n.setEleColor(o, t(this)),
            void o.stopPropagation())
        }),
        r.find(".edit-color-span").not(".edit-color-span-pickup").mouseenter(function(e) {
            if (t(this).hasClass("edit-color-span-nocolor"))
                return e.stopPropagation(),
                !1;
            var o = n._owner_element
              , i = t(this).css("background-color")
              , s = t(".element-edit-bar").find(".ele-color").index(t(".element-edit-bar").find(".ele-color.now-click"));
            "svg" == o._element_type ? o.previewColor(i, s) : o.previewColor(i)
        }),
        r.find(".edit-color-btn").mousedown(function(e) {
            return t(this).hasClass("now-click") ? (e.stopPropagation(),
            !1) : (r.find(".edit-color-btn").removeClass("now-click"),
            t(this).addClass("now-click"),
            t(this).hasClass("default-edit-color-btn") ? (r.find(".default-edit-color-wrap").css({
                top: "0px",
                opacity: "1"
            }),
            r.find(".team-edit-color-wrap").css({
                top: "222px",
                opacity: "0"
            })) : (r.find(".default-edit-color-wrap").css({
                top: "-222px",
                opacity: "0"
            }),
            r.find(".team-edit-color-wrap").css({
                top: "0px",
                opacity: "1"
            })),
            void e.stopPropagation())
        }),
        window.TEAM_ID > 0 && (r.css("width", "348px").find(".edit-color-btn-wrap").css("display", "inline-block"),
        t.ajax({
            url: "/team/getTeamBaseInfo.do",
            dataType: "json",
            type: "POST",
            data: {
                tid: window.TEAM_ID
            },
            success: function(e) {
                if (e.team) {
                    var t = e.team.colorValue
                      , o = r.find(".team-edit-color-wrap");
                    if (t.length > 0) {
                        t = t.split(",");
                        var n;
                        o.empty();
                        for (var i = 0; i < t.length; i++)
                            n = '<div class="edit-color-span" style="background-color:' + t[i] + '" title="' + t[i] + '"></div>',
                            o.append(n)
                    } else
                        o.find("a").attr("href", "/team/setup.html?id=" + window.TEAM_ID)
                }
            },
            error: function() {
                console.log("获取团队色值失败！")
            }
        })),
        r.find(".edit-color-span-pickup").mousedown(function(e) {
            if (0 != e.button)
                return !1;
            var n = t(this);
            n.mouseup(function() {
                n.off("mouseup"),
                o.colorPickupShow(n)
            }),
            e.stopPropagation()
        }),
        a.find("#text-family-list-warp").mousedown(function(o) {
            if (e.addBugTrackClick("e4"),
            "block" == t("#texteventtarget").css("display")) {
                var i = n._owner_element;
                i.finishInput()
            }
            n.fontFamilyWrapShow(o, t(this)),
            o.stopPropagation()
        }).parent().children("div").css("background-image", "url(" + window.font_family.font_family_img_url + ")");
        var d = i.getFontFamily()
          , u = d.find("#text-family-list");
        a.find(".text-select-up").click(function() {
            var e = u.find(".text-family-son");
            e.each(function(o) {
                t(this).hasClass("now-size") && (o > 0 ? e[o - 1].click() : e[e.length - 1].click())
            })
        }),
        a.find(".text-select-down").click(function() {
            var e = u.find(".text-family-son");
            e.each(function(o) {
                return t(this).hasClass("now-size") ? o < e.length - 1 ? (e[o + 1].click(),
                !1) : (e[0].click(),
                !1) : void 0
            })
        }),
        u.on("click", "li", function(e) {
            return t(this).hasClass("now-size") ? !1 : t(this).hasClass("text-family-group") ? !1 : t(this).find(".text-family-vip").length > 0 && !window.ISVIP && window.TEAM_ID <= 0 ? void c.show() : (n.setEleFontFamily(e, t(this)),
            n.fontHistorySet(e, t(this).clone()),
            void e.stopPropagation())
        }),
        u.on("mousewheel", function(e) {
            e.stopPropagation()
        });
        var f = d.find(".text-family-hidtory-font");
        f.on("click", "li", function(e) {
            n.setEleFontFamily(e, t(this)),
            e.stopPropagation()
        });
        var p = d.find("#text-family-history");
        p.on("click", ".text-family-back-top", function() {
            u.animate({
                scrollTop: "0px"
            }, 500)
        }),
        p.on("click", ".text-family-show-more", function() {
            var e = t(this)
              , o = e.parent().next();
            if (e.hasClass("now-click"))
                o.hide(),
                e.text("展开").removeClass("show-less").addClass("show-more"),
                e.removeClass("now-click");
            else {
                if (o.children("li").size() <= 0)
                    return !1;
                o.show(),
                e.text("收起").removeClass("show-more").addClass("show-less"),
                e.addClass("now-click")
            }
        });
        var h, w, m, g = d.find(".text-family-group"), v = d.find(".text-family-font-showing");
        u.scroll(function() {
            g.each(function() {
                return h = v.offset().top,
                w = t(this).offset().top - 15,
                h > w ? (m = t(this).children("span").html(),
                void v.children("span").html(m)) : void v.children("span").html(m)
            })
        }),
        a.find(".text-size input").mousedown(function(o) {
            if (e.addBugTrackClick("e5"),
            "block" == t("#texteventtarget").css("display")) {
                var i = n._owner_element;
                i.finishInput()
            }
            n.fontSizeWrapShow(o, t(this)),
            o.stopPropagation()
        });
        var _;
        _ = i.getFontSize("px" === window.DESIGN_ORIGINAL_UNIT ? 12 : 3),
        _.find("ul").children().mouseenter(function() {
            var e = n._owner_element
              , o = t(this).text();
            "px" != window.DESIGN_ORIGINAL_UNIT && (o = o / 72 * 300);
            var i = parseInt(o);
            e.previewFontSize(i)
        }).mousedown(function(e) {
            n.setEleFontSize(e, t(this)),
            e.stopPropagation()
        }),
        a.find("#text-size-input").keyup(function(o) {
            var i = n._owner_element;
            this.value = this.value.replace(/[^0-9-]+/, "");
            var s = parseInt(t(this).val());
            13 == o.keyCode && (0 / 0 != s ? (5 > s ? s = 5 : s > 2048 && (s = 2048),
            "px" != window.DESIGN_ORIGINAL_UNIT && (s = s / 72 * 300),
            i.previewFontSize(s),
            window.MEMENTO_ID = e.now(),
            i.setFontSize(s)) : t(this).val("")),
            o.stopPropagation()
        }),
        _.find("ul").on("mousewheel", function(e) {
            e.stopPropagation()
        }),
        a.find(".text-size-up").click(function() {
            var o = parseInt(t(this).siblings("#text-size-input").val())
              , i = n._owner_element;
            0 / 0 != o && (o += 1,
            t(this).siblings("#text-size-input").val(o),
            "px" != window.DESIGN_ORIGINAL_UNIT && (o = o / 72 * 300),
            window.MEMENTO_ID = e.now(),
            i.previewFontSize(o),
            i.setFontSize(o))
        }),
        a.find(".text-size-down").click(function() {
            var o = parseInt(t(this).siblings("#text-size-input").val())
              , i = n._owner_element;
            0 / 0 != o && (o > 6 ? o -= 1 : o = 5,
            t(this).siblings("#text-size-input").val(o),
            "px" != window.DESIGN_ORIGINAL_UNIT && (o = o / 72 * 300),
            window.MEMENTO_ID = e.now(),
            i.previewFontSize(o),
            i.setFontSize(o))
        }),
        a.find(".text-align-bar").mousedown(function(e) {
            if ("block" == t("#texteventtarget").css("display")) {
                var o = n._owner_element;
                o.finishInput()
            }
            n.textAlignShow(e, t(this)),
            e.stopPropagation()
        });
        var k = i.getFontAlign();
        k.find(".text-align-left").mousedown(function(o) {
            e.addBugTrackClick("e9"),
            n.setAlign(o, t(this)),
            o.stopPropagation()
        }),
        k.find(".text-align-center").mousedown(function(o) {
            e.addBugTrackClick("e9"),
            n.setAlign(o, t(this)),
            o.stopPropagation()
        }),
        k.find(".text-align-right").mousedown(function(o) {
            e.addBugTrackClick("e9"),
            n.setAlign(o, t(this)),
            o.stopPropagation()
        }),
        a.find(".text-style-bold").mousedown(function(o) {
            return e.addBugTrackClick("e10"),
            "block" == t("#texteventtarget").css("display") && n._owner_element.finishInput(),
            n.textBoldShow(o, t(this)),
            !1
        });
        var b = i.getBoldWrap();
        b.find("#bold-scroll").mousedown(function(e) {
            return n.boldMove(e, t(this)),
            !1
        }),
        b.find("#bold-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            0 > e ? (e = 0,
            t(this).val(0)) : e > 100 && (e = 100,
            t(this).val(100));
            var o = n._owner_element;
            e /= 100,
            o.previewBold(e);
            var i = 67 + 150 * e;
            b.find("#bold-scroll").css("left", i).attr("data-num", parseInt(100 * e))
        }),
        a.find(".text-style-i").mousedown(function(o) {
            e.addBugTrackClick("e10"),
            n.textItalic(o, t(this)),
            o.stopPropagation()
        }),
        a.find(".text-style-underline").mousedown(function(o) {
            e.addBugTrackClick("e10"),
            n.textDecoration(o, t(this)),
            o.stopPropagation()
        });
        var y = i.getEleMove();
        y.find(".ele-moveup").mousedown(function(o) {
            e.addBugTrackClick("e12");
            var i = t(this);
            return i.hasClass("no-click") ? !1 : (n.moveupMousedown(o, i),
            void o.stopPropagation())
        }),
        y.find(".ele-movedown").mousedown(function(o) {
            e.addBugTrackClick("e13");
            var i = t(this);
            return i.hasClass("no-click") ? !1 : (n.movedownMousedown(o, i),
            void o.stopPropagation())
        }),
        y.find(".moveabove").mousedown(function(e) {
            var o = t(this);
            n.movetoabove(e, o),
            e.stopPropagation()
        }),
        y.find(".movebottom").mousedown(function(e) {
            var o = t(this);
            n.movebottom(e, o),
            e.stopPropagation()
        }),
        a.find(".img-cut").mousedown(function(o) {
            e.addBugTrackClick("f5"),
            n.eleImgCutMousedown(o, t(this)),
            o.stopPropagation()
        }),
        a.find(".addcoll").mousedown(function(e) {
            return n.editcoll(e, t(this)),
            !1
        }),
        a.find(".img-change").mousedown(function() {
            var e = n._owner_element;
            if (window.ISLOGIN) {
                var e = n._owner_element
                  , i = (n._owner_design,
                e._owner_page);
                o.uploadMaterialAndChoose(function(t) {
                    if (1 == t.code) {
                        var o = JSON.parse(JSON.stringify(e._json));
                        if (t.w > t.h) {
                            var n = t.w / e._width;
                            if (t.h / n <= e._height)
                                o["data-elem"].width = e._width,
                                o["data-elem"].height = t.h / n;
                            else {
                                var s = t.h / e._height;
                                o["data-elem"].width = t.w / s,
                                o["data-elem"].height = e._height
                            }
                        } else {
                            var s = t.h / e._height;
                            if (t.w / s < e._width)
                                o["data-elem"].width = t.w / s,
                                o["data-elem"].height = e._height;
                            else {
                                var n = t.w / e._width;
                                o["data-elem"].width = e._width,
                                o["data-elem"].height = t.h / n
                            }
                        }
                        i.eleDelAndUndo(e),
                        o.transform = e._transform,
                        o["data-img-kind"] = t.dt,
                        o["data-elem"].id = t.mid,
                        delete o["data-elem"]["data-key"],
                        i.createElementAndUndo({
                            json: o,
                            unshift: !0
                        })
                    } else
                        console.log("换图图片无法正确加载")
                })
            }
            t("#leadingMenuBtn").click()
        }),
        a.find(".svg-tool").mousedown(function(e) {
            e.stopPropagation(),
            t(".modal-mini").show();
            var o = window.DESIGN_ORIGINAL_UNIT;
            t(".modal-mini .danweiH").text("高度(" + o + ")"),
            t(".modal-mini .danweiW").text("宽度(" + o + ")");
            var i = n._owner_element
              , s = i._height
              , a = s.toFixed(1)
              , r = i._width
              , l = r.toFixed(1)
              , d = n._owner_design
              , c = (d._owner_editDiv,
            d.pageScale);
            t(".width-input").val(Math.round(l * c)),
            t(".height-input").val(Math.round(a * c))
        }),
        a.find(".svg-tool").find(".width-input").bind("input propertychange", function() {
            var e = n._owner_element
              , o = e._height
              , i = o.toFixed(1)
              , s = e._width
              , a = s.toFixed(1)
              , r = a / i
              , l = n._owner_design
              , d = l._owner_editDiv
              , c = l.pageScale;
            0 == t(this).val() && t(this).val(1),
            t(this).val() >= 5e3 && t(this).val(5e3),
            "ry" != e._svg_change_kind ? (t(".height-input").val(Math.round(t(this).val() / r)),
            e.previewWH(t(this).val() / c, t(this).val() / r / c),
            d.resetEditDivPosition()) : (t(this).attr("data-change", "1"),
            d.resizeSetWidth(t(this).val()),
            d.resizeSetHeight(t(".height-input").val()),
            d.resetEditDivPosition())
        }),
        a.find(".svg-tool").find(".height-input").bind("input propertychange", function() {
            var e = n._owner_element
              , o = e._height
              , i = o.toFixed(1)
              , s = e._width
              , a = s.toFixed(1)
              , r = a / i
              , l = n._owner_design
              , d = l._owner_editDiv
              , c = l.pageScale;
            0 == t(this).val() && t(this).val(1),
            t(this).val() >= 5e3 && t(this).val(5e3),
            "ry" != e._svg_change_kind ? (t(".width-input").val(Math.round(t(this).val() * r)),
            e.previewWH(t(this).val() * r / c, t(this).val() / c),
            d.resetEditDivPosition()) : (t(this).attr("data-change", "1"),
            d.resizeSetHeight(t(this).val()),
            d.resizeSetWidth(t(".width-input").val()),
            d.resetEditDivPosition())
        }),
        a.find(".svg-tool").on("mousedown", ".addnum", function(e) {
            e.stopPropagation();
            var o, i = n._owner_element, s = i._height, a = s.toFixed(1), r = i._width, l = r.toFixed(1), d = l / a, c = n._owner_element, u = n._owner_design, f = u.pageScale, p = u._owner_editDiv;
            "ry" != c._svg_change_kind ? "1" == t(this).attr("data-type") ? (o = Math.round(t(this).siblings(".width-input").val()) + 1,
            t(this).siblings(".width-input").val(o),
            t(this).parents(".item").siblings(".item").find(".height-input").val(Math.round(o / d)),
            c.previewWH(o / f, o / d / f),
            p.resetEditDivPosition()) : (o = Math.round(t(this).siblings(".height-input").val()) + 1,
            t(this).siblings(".height-input").val(Math.round(o)),
            t(this).parents(".item").siblings(".item").find(".width-input").val(Math.round(o * d)),
            c.previewWH(o * d / f, o / f),
            p.resetEditDivPosition()) : "1" == t(this).attr("data-type") ? (o = Math.round(t(this).siblings(".width-input").val()) + 1,
            t(this).siblings(".width-input").val(o),
            t(".width-input").attr("data-change", "1"),
            p.resizeSetWidth(o),
            p.resetEditDivPosition()) : (o = Math.round(t(this).siblings(".height-input").val()) + 1,
            t(this).siblings(".height-input").val(o),
            t(".height-input").attr("data-change", "1"),
            p.resizeSetHeight(o),
            p.resetEditDivPosition())
        }),
        a.find(".svg-tool").on("mousedown", ".reducenum", function(e) {
            e.stopPropagation();
            var o, i = n._owner_element, s = i._height, a = s.toFixed(1), r = i._width, l = r.toFixed(1), d = l / a, c = n._owner_element, u = n._owner_design, f = u.pageScale, p = u._owner_editDiv;
            if ("ry" != c._svg_change_kind)
                if ("0" == t(this).attr("data-type")) {
                    var o = Math.round(t(this).siblings(".width-input").val()) - 1;
                    1 > o && (o = 1),
                    t(this).siblings(".width-input").val(o),
                    t(this).parents(".item").siblings(".item").find(".height-input").val(Math.round(o / d)),
                    c.previewWH(o / f, o / d / f),
                    p.resetEditDivPosition()
                } else {
                    var o = Math.round(t(this).siblings(".height-input").val()) - 1;
                    1 > o && (o = 1),
                    t(this).siblings(".height-input").val(Math.round(o)),
                    t(this).parents(".item").siblings(".item").find(".width-input").val(Math.round(o * d)),
                    c.previewWH(o * d / f, o / f),
                    p.resetEditDivPosition()
                }
            else if ("0" == t(this).attr("data-type")) {
                var o = Math.round(t(this).siblings(".width-input").val()) - 1;
                1 > o && (o = 1),
                t(this).siblings(".width-input").val(o),
                t(".width-input").attr("data-change", "1"),
                p.resizeSetWidth(o),
                p.resetEditDivPosition()
            } else {
                var o = Math.round(t(this).siblings(".height-input").val()) - 1;
                1 > o && (o = 1),
                t(this).siblings(".height-input").val(o),
                t(".height-input").attr("data-change", "1"),
                p.resizeSetHeight(o),
                p.resetEditDivPosition()
            }
        }),
        a.find(".svg-tool").on("mousedown", "button", function(o) {
            o.stopPropagation();
            var i, s, a = (t(".width-input").val(),
            t(".height-input").val(),
            n._owner_element);
            i = n._owner_design,
            s = i._owner_editDiv,
            window.MEMENTO_ID = e.now();
            {
                var r = n._owner_element;
                i.pageScale
            }
            "ry" == r._svg_change_kind ? (1 == t(".width-input").attr("data-change") && (r.resetPosition(),
            a.resetWidth(),
            r.transform = e.transformScale(r.getTransform(), 1 / l.ZOOM_IN),
            t(".width-input").attr("data-change", "0"),
            1 == t(".height-input").attr("data-change") && (window.MEMENTO_ID = e.now())),
            1 == t(".height-input").attr("data-change") && (t(".height-input").attr("data-change", "0"),
            window.mementoGoTwo = !0,
            r.resetPosition(),
            a.resetHeight(),
            r.transform = e.transformScale(r.getTransform(), 1 / l.ZOOM_IN),
            window.mementoGoTwo = !1)) : (r.resetPosition(),
            a.resetWH(),
            r.transform = e.transformScale(r.getTransform(), 1 / l.ZOOM_IN)),
            t(".size-modal").hide()
        }),
        a.find(".svg-tool").on("mousedown", ".size-modal", function(e) {
            e.stopPropagation()
        }),
        a.find(".svg-tool").on("mousedown", ".size-modal", function(e) {
            e.stopPropagation()
        }),
        a.find(".ele-copy").mousedown(function(o) {
            e.addBugTrackClick("e1");
            var i = t(this);
            n.eleCopyMousedown(o, i),
            o.stopPropagation()
        }),
        a.find(".ele-del").mousedown(function(o) {
            e.addBugTrackClick("e11");
            var i = t(this);
            n.eleDelMousedown(o, i),
            o.stopPropagation()
        }),
        a.find(".group-edit-split").mousedown(function(o) {
            if (t(this).hasClass("no-click"))
                return !1;
            e.addBugTrackClick("h2");
            var i = t(this);
            window.MEMENTO_ID = e.now(),
            n.groupSplit(o, i),
            o.stopPropagation()
        }),
        a.find(".group-edit-put").mousedown(function(e) {
            var o = t(this);
            n.groupPut(e, o),
            e.stopPropagation()
        });
        var C = i.getTextMenuMore();
        C.find(".text-more-up").mousedown(function(e) {
            var o = t(this);
            return n.moveupMousedown(e, o),
            !1
        }),
        C.find(".text-more-down").mousedown(function(e) {
            var o = t(this);
            return n.movedownMousedown(e, o),
            !1
        }),
        a.find(".ele-opacity").mousedown(function(o) {
            return e.addBugTrackClick("e14"),
            n.opacityWrapShow(o, t(this)),
            !1
        });
        var M = i.getOpacityWrap();
        M.find("#opacity-scroll").mousedown(function(e) {
            return n.opacityMove(e, t(this)),
            !1
        }),
        M.find("#opacity-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            0 > e ? (e = 0,
            t(this).val(0)) : e > 100 && (e = 100,
            t(this).val(100));
            var o = n._owner_element;
            o.previewOpacity((100 - e) / 100);
            var i = e / 100 * 160 + 67;
            i > 200 && (i -= 10),
            M.find("#opacity-scroll").css("left", i + "px").attr("data-num", e)
        }),
        a.find(".text-spacing").mousedown(function(e) {
            return n.textSpacingShow(e, t(this)),
            !1
        });
        var x = i.getTextSpaceWrap().find("#wspace-wrap");
        x.find("#wspace-scroll").mousedown(function(e) {
            return n.wspaceMove(e, t(this)),
            !1
        }),
        x.find("#wspace-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            if (e.indexOf("-") >= 0)
                var o = !0;
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            o && (e = 0 - e),
            -400 > e ? (e = -400,
            t(this).val(-400)) : e > 1600 && (e = 1600,
            t(this).val(1600));
            var i = n._owner_element;
            i.previewWspace(e);
            var s = (parseInt(e) + 400) / 2e3 * 150 + 67;
            x.find("#wspace-scroll").css("left", s).attr("data-num", e)
        });
        var I = i.getTextSpaceWrap().find("#vspace-wrap");
        I.find("#vspace-scroll").mousedown(function(e) {
            return n.vspaceMove(e, t(this)),
            !1
        }),
        I.find("#vspace-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            if (e.indexOf("-") >= 0)
                var o = !0;
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            o && (e = 0 - e),
            -400 > e ? (e = -400,
            t(this).val(-400)) : e > 1600 && (e = 1600,
            t(this).val(1600));
            var i = n._owner_element;
            i.previewVspace(e);
            var s = (parseInt(e) + 400) / 2e3 * 150 + 67;
            I.find("#vspace-scroll").css("left", s).attr("data-num", e)
        });
        var S = i.getShadowWrap();
        S.find("#shadow-scroll").mousedown(function(e) {
            n.shadowBlur(e, t(this))
        }),
        S.find("#shadow-juli-scroll").mousedown(function(e) {
            n.shadowOffset(e, t(this))
        }),
        S.find("#shadow-touming-scroll").mousedown(function(e) {
            n.shadowOpacity(e, t(this))
        }),
        S.find("#shadow-input").bind("input propertychange", function() {
            this.value = this.value.replace(/[^0-9-]+/, "");
            var e = t(this).val().toString();
            e = e.replace(/[^0-9]+/g, ""),
            e = Math.abs(parseInt(e)),
            0 > e ? (e = 0,
            t(this).val(0)) : e > 100 && (e = 100,
            t(this).val(100));
            var o = n._owner_element;
            o.previewShadow({
                blur: e
            });
            var i = parseInt(150 * e / 100) + 67;
            S.find("#shadow-scroll").css("left", i).attr("data-num", e),
            t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click()
        }),
        S.find("#shadow-juli-input").bind("input propertychange", function() {
            this.value = this.value.replace(/[^0-9-]+/, "");
            var e = t(this).val().toString();
            e = e.replace(/[^0-9]+/g, ""),
            e = Math.abs(parseInt(e)),
            0 > e ? (e = 0,
            t(this).val(0)) : e > 100 && (e = 100,
            t(this).val(100));
            var o = n._owner_element;
            o.previewShadow({
                offset: e * l.ZOOM_IN
            });
            var i = parseInt(150 * e / 100) + 67;
            S.find("#shadow-juli-scroll").css("left", i).attr("data-num", e),
            t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click()
        }),
        S.find("#shadow-touming-input").bind("input propertychange", function() {
            this.value = this.value.replace(/[^0-9-]+/, "");
            var e = t(this).val().toString();
            e = e.replace(/[^0-9]+/g, ""),
            e = Math.abs(parseInt(e)),
            0 > e ? (e = 0,
            t(this).val(0)) : e > 100 && (e = 100,
            t(this).val(100));
            var o = n._owner_element;
            o.previewShadow({
                opacity: (100 - e) / 100
            });
            var i = parseInt(150 * e / 100) + 67;
            S.find("#shadow-touming-scroll").css("left", i).attr("data-num", e),
            t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click()
        }),
        a.find(".ele-turn").mousedown(function(e) {
            return n.eleReverseShow(e, t(this)),
            !1
        }),
        a.find(".ele-move").mousedown(function(e) {
            return n.eleMoveShow(e, t(this)),
            !1
        }),
        a.find(".group-align").mousedown(function(e) {
            return n.groupAlignShow(e, t(this)),
            !1
        }),
        a.find(".group-distributed").mousedown(function(e) {
            return n.groupDistributedShow(e, t(this)),
            !1
        });
        var E = i.getEleReverse();
        E.find(".ele-turn-verticalReverse").mousedown(function(o) {
            return e.addBugTrackClick("e15"),
            window.MEMENTO_ID = e.now(),
            n.verticalReverse(o, t(this)),
            !1
        }),
        E.find(".ele-turn-horizontalReverse").mousedown(function(o) {
            return e.addBugTrackClick("e16"),
            window.MEMENTO_ID = e.now(),
            n.horizontalReverse(o, t(this)),
            !1
        }),
        a.find(".img-filter").mousedown(function(o) {
            e.addBugTrackClick("f3"),
            n.imgFilterShow(o, t(this)),
            o.stopPropagation()
        }),
        a.find(".img-set-background").mousedown(function(e) {
            n.imgChangeToBackground(e, t(this)),
            e.stopPropagation()
        });
        var N = i.getFilter();
        N.find(".filter-parameter-son-dot").mousedown(function(e) {
            n.filterDotMove(e, t(this)),
            e.stopPropagation()
        }),
        N.find(".filter-preset-son-div").click(function(e) {
            n.filterClick(e, t(this)),
            e.stopPropagation()
        });
        var T = i.getEleGroupAlign()
          , P = i.getEleGroupDistributed();
        T.on("click", "li", function(o) {
            window.MEMENTO_ID = e.now(),
            n.groupElementAlign(o, t(this)),
            o.stopPropagation()
        }),
        P.on("click", "li", function(o) {
            window.MEMENTO_ID = e.now(),
            n.groupElementAlign(o, t(this)),
            o.stopPropagation()
        }),
        a.find(".group-set").click(function(o) {
            e.addBugTrackClick("h1"),
            window.MEMENTO_ID = e.now(),
            n.setGroup(o, t(this)),
            o.stopPropagation()
        }),
        a.find(".ele-lock").click(function(o) {
            e.addBugTrackClick("e17"),
            window.MEMENTO_ID = e.now(),
            n.setLock(o, t(this)),
            o.stopPropagation()
        }),
        a.find(".ele-shadow").mousedown(function(o) {
            e.addBugTrackClick("shadow"),
            window.MEMENTO_ID = e.now(),
            n.shadowWrapShow(o, t(this)),
            o.stopPropagation()
        }),
        i.getShadowWrap().mouseleave(function() {}),
        i.getShadowWrap().find("#shadow-switch").click(function(o) {
            e.addBugTrackClick("shadowswitch"),
            t(this).hasClass("switch-off") ? (t(this).removeClass("switch-off"),
            t(this).addClass("switch-on"),
            n.setShadowShowFN("on")) : (t(this).removeClass("switch-on"),
            t(this).addClass("switch-off"),
            n.setShadowShowFN("off")),
            o.stopPropagation()
        });
        var F = window.localStorage.getItem("already_use_names") || "";
        F.indexOf("ele_lock") < 0 && a.find(".ele-lock-close").click(function() {
            a.find(".ele-lock-introduce-wrap").fadeOut(200),
            F += "...ele_lock",
            window.localStorage.setItem("already_use_names", F)
        })
    }
    var p = function(e) {
        s.call(this),
        this._owner_design = e,
        e._owner_elementEditbar = this,
        u.call(this)
    };
    return p.prototype = {
        constructor: p,
        createWidget: function() {
            return i.getElementEditbar()[0]
        },
        _owner_element: null,
        show: function(e) {
            t(".modal-mini").hide(),
            this._owner_element = e,
            "image/jpeg" == this._owner_element._img_kind && "true" != window.localStorage.filter && (t(".guide-wrap-filter").css("display", "block").animate({
                opacity: 1,
                top: "100px"
            }, 1e3),
            t(".guide-wrap-filter .guide-know").on("click", function() {
                t(".guide-wrap-filter").fadeOut("slow", function() {
                    var e = window.localStorage;
                    e.filter = !0
                })
            })),
            "img" != this._owner_element._dataType && "svgLayout" == this._owner_element._svg_type && "true" != window.localStorage.absorb && (t(".guide-wrap-adsorb").css("display", "block").animate({
                opacity: 1,
                top: "100px"
            }, 1e3),
            t(".guide-wrap-adsorb .guide-know").on("click", function() {
                t(".guide-wrap-adsorb").fadeOut("slow", function() {
                    var e = window.localStorage;
                    e.absorb = !0
                })
            }));
            var o, n = e._element_type;
            switch (n) {
            case "background":
                o = this.backgroundEditbarSet();
                break;
            case "img":
                o = this.imgEditbarSet();
                break;
            case "svg":
                o = this.svgEditbarSet();
                break;
            case "text":
                o = this.textEditbarSet();
                break;
            case "circleSelect":
                o = this.selectEditbarSet();
                break;
            case "elementGroup":
                o = this.groupEditbarSet();
                break;
            case "svgChart":
                o = this.chartEditbarSet();
                break;
            default:
                console.log("素材类型未定义")
            }
            var i = t(o);
            i.stop();
            var s = t("#rightPanel").width()
              , a = t("#leftPanel").outerWidth();
            if (1 == this._owner_element.personMaterial || "text" == this._owner_element._element_type || "elementGroup" == this._owner_element._element_type || "svgChart" == this._owner_element._element_type || "background" == this._owner_element._element_type)
                t(".addcoll").hide();
            else {
                t(".addcoll").show();
                var r = this._owner_element.imgId;
                if (0 == window.colledMaterial.length)
                    t(".addcoll").removeClass("cantclick");
                else
                    for (var l = 0; l < window.colledMaterial.length; l++)
                        -1 != t.inArray(r, window.colledMaterial) ? t(".addcoll").addClass("cantclick") : t(".addcoll").removeClass("cantclick")
            }
            i.css({
                width: s + "px",
                position: "fixed",
                display: "block",
                top: "10px",
                left: a + "px"
            }).appendTo(t("#rightPanel")).animate({
                top: "50px"
            }, 200, function() {
                var o = i.find(".ele-lock")
                  , n = null;
                "true" == e.lock ? (i.find(".ele-lock span").addClass("now-set"),
                i.find(".ele-del, .group-edit-split").addClass("no-click"),
                o.addClass("ele-lock-shake"),
                window.ELE_LOCK_REMOVECLASS = setTimeout(function() {
                    o.removeClass("ele-lock-shake")
                }, 1500),
                clearTimeout(n),
                t(".show-lock").show(),
                t(".show-lock").removeClass("lock-opacity"),
                n = setTimeout(function() {
                    t(".show-lock").hide()
                }, 1500),
                t(".show-lock").addClass("lock-opacity")) : (o.removeClass("ele-lock-shake"),
                i.find(".ele-lock span").removeClass("now-set"),
                i.find(".ele-del, .group-edit-split").removeClass("no-click"))
            }),
            this.moveBtnSet()
        },
        hideNode: function() {
            this.hideMoreMenu();
            var e = this.getNode()
              , o = t(e);
            o.stop(),
            t(e).animate({
                top: "10px"
            }, 200, function() {
                t(e).hide()
            });
            var n = this._owner_element;
            "block" == t(".size-modal").css("display") && n.resetElePosition(n.getNewJson()),
            this._owner_element = null
        },
        showInGroup: function(e) {
            this._owner_element = e;
            var o = e._element_type
              , n = this._owner_design;
            n._focus_element = e;
            var i;
            switch (o) {
            case "background":
                i = this.backgroundEditbarSet(!0);
                break;
            case "img":
                i = this.imgEditbarSet(!0);
                break;
            case "svg":
                i = this.svgEditbarSet(!0);
                break;
            case "text":
                i = this.textEditbarSet(!0);
                break;
            case "circleSelect":
                i = this.selectEditbarSet(!0);
                break;
            case "elementGroup":
                i = this.groupEditbarSet();
                break;
            case "svgChart":
                i = this.chartEditbarSet();
                break;
            default:
                console.log("素材类型未定义")
            }
            var s = t(i)
              , a = t("#rightPanel").width()
              , r = t("#leftPanel").outerWidth();
            s.css({
                width: a + "px",
                position: "fixed",
                display: "block",
                top: "10px",
                left: r + "px"
            }).appendTo(t("#rightPanel")).animate({
                top: "50px"
            }, 200, function() {}),
            this.moveBtnSet()
        },
        moveBtnSet: function() {
            var e = t(this.getNode())
              , o = i.getTextMenuMore()
              , n = this._owner_element;
            if (void 0 != n && "circleSelect" !== n._element_type) {
                var s = n.getPage()
                  , a = s.elements
                  , r = a.length
                  , l = n.getIndex();
                "elementGroup" === n._element_type && (l = n.getLastChildIndex());
                var d = 0
                  , c = 0;
                if (l == r - 1)
                    e.find(".ele-moveup").addClass("no-click"),
                    o.find(".text-more-up").addClass("no-click");
                else {
                    for (var u = !1, f = !1, p = l + 1; r > p; p++)
                        f = n.intersectEle(a[p]),
                        f && d++,
                        u = u || f;
                    u ? (e.find(".ele-moveup").removeClass("no-click"),
                    o.find(".text-more-up").removeClass("no-click")) : (e.find(".ele-moveup").addClass("no-click"),
                    o.find(".text-more-up").addClass("no-click"))
                }
                if ("elementGroup" === n._element_type && (l = n.getFirstChildIndex()),
                1 >= l)
                    e.find(".ele-movedown").addClass("no-click"),
                    o.find(".text-more-down").addClass("no-click");
                else {
                    for (var h = !1, w = !1, p = l - 1; p > 0; p--)
                        w = n.intersectEle(a[p]),
                        w && c++,
                        h = h || w;
                    h ? (e.find(".ele-movedown").removeClass("no-click"),
                    o.find(".text-more-down").removeClass("no-click")) : (e.find(".ele-movedown").addClass("no-click"),
                    o.find(".text-more-down").addClass("no-click"))
                }
                return {
                    sum: c + d,
                    num: c
                }
            }
        },
        chartEditbarSet: function(e) {
            var n = this.getNode()
              , i = t(n);
            i.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click"),
            i.children().filter(".ele-color-clone").detach(),
            i.children().filter(".ele-color-clone").detach(),
            i.children().filter(".ele-common").css("display", "block"),
            i.children().filter(".ele-turn ").css("display", "none"),
            i.children().filter(".svg-tool").css("display", "none");
            var s = this._owner_element;
            o.initChartBtn(s);
            var a = t("#chartMenuBtn");
            return a.hasClass("listBtnClick") || (t("#leftPanelContentWrap").css({
                top: -1 * t("#leftPanelWrap").getHeight() * t(".leftPanelMenuListBtn").index(a)
            }),
            a.addClass("listBtnClick").siblings().removeClass("listBtnClick"),
            t("#leftPanelMenuBorder").css({
                top: a.offset().top - 50
            })),
            e && i.children().filter(".group-no-show").css("display", "none"),
            this.getNode()
        },
        backgroundEditbarSet: function(e) {
            var o = t(this.getNode());
            o.children().removeClass("now-click").css("display", "none").filter("img-filter").removeClass("no-click"),
            o.children().filter(".img-filter, .ele-common").css("display", "block"),
            o.children().filter(".background-no-show").css("display", "none"),
            o.children().filter(".tool-text").detach();
            var n = t(this._owner_element.getNode());
            return void 0 == n.find("image").attr("href") && o.children().filter(".img-filter").addClass("no-click"),
            e && o.children().filter(".group-no-show").css("display", "none"),
            window.ISVIP || o.children().filter(".ele-opacity").css("display", "none"),
            this.getNode()
        },
        imgEditbarSet: function(e) {
            var o = this.getNode()
              , n = t(o);
            n.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click"),
            n.children().filter(".ele-color-clone").detach(),
            n.children().filter(".ele-common").css("display", "block"),
            n.children().filter(".svg-tool").css("display", "block"),
            n.children().filter(".img-set-background ").css("display", "block"),
            t(".panelArrow").hasClass("rightArrow") ? n.find(".img-filter").hide() : n.find(".img-filter").show();
            var i = this._owner_element
              , s = i.getJson();
            return ("false" == s["data-elem"]["data-key"] || "image/png" === i._img_kind) && n.children().filter(".img-filter").css("display", "none"),
            n.children().filter(".show").css("display", "block"),
            "image/png" === i._img_kind ? n.children().filter(".img-cut").css("display", "none") : n.children().filter(".img-cut").css("display", "block"),
            n.find(".img-change").css("display", "block"),
            e && n.children().filter(".group-no-show").css("display", "none"),
            this.getNode()
        },
        svgEditbarSet: function(o) {
            var n = this.getNode()
              , i = t(n);
            i.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click"),
            i.children().filter(".ele-common").css("display", "block"),
            i.children().filter(".svg-tool").css("display", "block"),
            i.children().filter(".addcoll").css("display", "block"),
            o && i.children().filter(".group-no-show").css("display", "none");
            var s = this._owner_element
              , a = s.getJson()
              , r = (a["data-elem"],
            t(s.getNode()));
            r.find("svg") && e.jsonLength(s.colors) > 0 && this.svgColorsSet();
            for (var l = r.find(".layoutImgWrap"), d = !1, c = 0; c < l.size(); c++)
                if (void 0 != l.eq(c).children().attr("data-old") && "" != l.eq(c).children().attr("data-old")) {
                    d = !0;
                    break
                }
            return d && (i.find(".img-filter").css("display", "block"),
            o || i.find(".img-cut").css("display", "block")),
            this.getNode()
        },
        textEditbarSet: function(e) {
            var o = (this.getNode(),
            t(this.getNode()));
            o.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click");
            var n = this._owner_element
              , i = n.getFontFocusColor();
            o.children(".ele-color").children().css("background", i),
            o.children().filter(".ele-color-clone").detach();
            var s = n.getFontFocusFamily();
            this.getFontFamilyPosition(s);
            var a = n.getFontFocusSize();
            return "px" != window.DESIGN_ORIGINAL_UNIT && (a = a / 300 * 72),
            o.find(".text-size input").val(parseInt(a)),
            o.children().filter(".text-edit-bar, .ele-common").css("display", "block"),
            e && o.children().filter(".group-no-show").css("display", "none"),
            "true" == n.italic ? o.find(".text-style-i span").addClass("now-set") : o.find(".text-style-i span").removeClass("now-set"),
            "true" == n.decoration ? o.find(".text-style-underline span").addClass("now-set") : o.find(".text-style-underline span").removeClass("now-set"),
            n.bold > 0 ? o.find(".text-style-bold span").addClass("now-set") : o.find(".text-style-bold span").removeClass("now-set"),
            this.getNode()
        },
        selectEditbarSet: function() {
            var e = this.getNode()
              , o = t(e);
            o.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click");
            this._owner_element;
            o.children().filter(".group-align-edit, .ele-lock, .ele-copy, .ele-del ,.ele-color").css("display", "block"),
            o.children().filter(".ele-color").children("span").css("background", "url('/img/static/colorpickupbg.png')"),
            o.children().filter(".ele-color-clone").detach();
            var n = this._owner_element;
            return n.group_inside ? (o.find(".group-set, .ele-lock, .ele-copy").hide(),
            o.find(".group-align").addClass("group-align-no-before")) : (o.find(".group-set, .ele-lock, .ele-copy").show(),
            o.find(".group-align").removeClass("group-align-no-before")),
            this.getNode()
        },
        groupEditbarSet: function() {
            var e = this.getNode()
              , o = t(e);
            o.children().removeClass("now-click").css("display", "none").filter(".group-edit-bar").css("display", "block"),
            o.children().filter(".ele-shadow").css("display", "none");
            var n = this._owner_element;
            return n._text_ele_loaded === n._text_ele_sum ? (o.children(".group-edit-split").css("display", "block"),
            void 0 != window.USERINFO && window.USERINFO.isGm ? o.children(".group-edit-put").show() : o.children(".group-edit-put").hide()) : (o.children(".group-edit-split").css("display", "none"),
            o.children(".group-edit-put").hide()),
            this.getNode()
        },
        getFontFamilyPosition: function(e, o) {
            var n, s = i.getFontFamily(), a = s.find("#text-family-list");
            if (a.children().each(function() {
                t(this).children().attr("data-alt") == e && (n = t(this))
            }),
            a.children(".now-size").removeClass("now-size"),
            void 0 != n) {
                n.addClass("now-size"),
                o && a.scrollTop(n.offset().top - o);
                var r = t(this.getNode());
                r.children(".text-family").children("div").css("background-position", n.children().css("background-position"))
            }
        },
        setEleFontFamily: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this
              , s = i.getNode()
              , a = (t(s),
            i._owner_element);
            window.MEMENTO_ID = e.now();
            var r = n.children().attr("data-alt");
            a.setFontFamilyAndUndo(r),
            i.getFontFamilyPosition(r),
            i.hideMoreMenu();
            var l;
            l = window.FONT_FAMILY[r] ? window.FONT_FAMILY[r].group_name : "旧字体";
            var d = "字体-" + l + "-" + r;
            e.addSomeMouseClick(d)
        },
        fontHistorySet: function(e, o) {
            if (0 != e.button)
                return !1;
            if (!o.hasClass("text-family-history-son")) {
                var n = i.getFontFamily()
                  , s = n.find(".text-family-hidtory-font");
                s.children().removeClass("now-size");
                var a = o.children().attr("data-index")
                  , r = !1;
                s.children().each(function() {
                    t(this).children().attr("data-index") == a && (r = !0)
                }),
                r || (s.children().size() > 2 && s.children().last().remove(),
                s.prepend(o)),
                s.children().addClass("text-family-history-son"),
                n.find(".text-family-btn").show()
            }
        },
        svgColorsSet: function() {
            var o = this.getNode()
              , n = t(o)
              , i = this._owner_element;
            n.find(".ele-color-clone").detach();
            var s = n.find(".ele-color")
              , a = i.colors;
            if (e.jsonLength(a) > 0) {
                s.css({
                    display: "block"
                }).children().css({
                    background: a["color-1"]
                });
                for (var r in a)
                    if ("color-1" != r) {
                        var l = s.clone(!0).addClass("ele-color-clone");
                        l.children().css({
                            background: a[r]
                        }),
                        n.find(".ele-color").last().after(l)
                    }
            } else
                s.css({
                    display: "none"
                })
        },
        moveupMousedown: function(t, o) {
            function n() {
                var t = i._owner_element
                  , o = t._owner_page;
                if (window.MEMENTO_ID = e.now(),
                "elementGroup" === t._element_type)
                    return void t.moveUp();
                for (var n, s, a = o.elements, r = a.length, l = t.getIndex(), d = l, c = l + 1; r > c; c++)
                    if (n = a[c],
                    s = t.intersectEle(a[c])) {
                        d = n._group_drag ? n._element_group.getLastChildIndex() : c;
                        break
                    }
                t.changeIndexAndUndo({
                    new_index: d
                });
                var u = i.moveBtnSet();
                u.before_num = u.sum - u.num,
                u.after_num = u.sum - (u.num - 1),
                u.num = u.sum - (u.num - 1),
                i.showDownUpLayout(u)
            }
            if (0 != t.button)
                return !1;
            var i = this;
            t.execute && n(),
            o.mouseup(function() {
                o.off("mouseup"),
                n()
            })
        },
        movedownMousedown: function(t, o) {
            function n() {
                var t = i._owner_element
                  , o = t._owner_page;
                if (window.MEMENTO_ID = e.now(),
                "elementGroup" === t._element_type)
                    return void t.moveDown();
                for (var n, s, a = o.elements, r = (a.length,
                t.getIndex()), l = r, d = r - 1; d > 0; d--)
                    if (n = a[d],
                    s = t.intersectEle(a[d])) {
                        l = n._group_drag ? n._element_group.getFirstChildIndex() : d;
                        break
                    }
                0 == l && "background" == a[0]._element_type && (l = 1),
                t.changeIndexAndUndo({
                    new_index: l
                });
                var c = i.moveBtnSet();
                c.before_num = c.sum - (c.num + 1),
                c.after_num = c.sum - c.num,
                c.num = c.sum - (c.num + 1),
                i.showDownUpLayout(c)
            }
            if (0 != t.button)
                return !1;
            var i = this;
            t.execute && n(),
            o.mouseup(function() {
                o.off("mouseup"),
                n()
            })
        },
        movetoabove: function(t, o) {
            function n() {
                var t = i._owner_element
                  , o = t._owner_page;
                window.MEMENTO_ID = e.now();
                var n = o.elements
                  , s = n.length;
                t.changeIndexAndUndo({
                    new_index: s - 1
                })
            }
            if (0 != t.button)
                return !1;
            var i = this;
            t.execute && n(),
            o.mouseup(function() {
                o.off("mouseup"),
                n()
            })
        },
        movebottom: function(t, o) {
            function n() {
                {
                    var t = i._owner_element;
                    t._owner_page
                }
                window.MEMENTO_ID = e.now(),
                t.changeIndexAndUndo({
                    new_index: 1
                })
            }
            if (0 != t.button)
                return !1;
            var i = this;
            t.execute && n(),
            o.mouseup(function() {
                o.off("mouseup"),
                n()
            })
        },
        showDownUpLayout: function(o) {
            t(".down-up-layout").detach();
            var n = document.getElementById("edit-div")
              , i = n.getBoundingClientRect()
              , s = i.top
              , a = i.right
              , r = e.createNode("ul", "down-up-layout");
            r.addEventListener("animationend", function(e) {
                e.target == r && document.querySelector("body").removeChild(this)
            });
            var l;
            r.style.top = s + "px",
            r.style.left = a + 10 + "px",
            document.querySelector("body").appendChild(r);
            for (var d = 0; d <= o.sum; d++)
                l = e.createNode("li", "down-up-layout-li"),
                d == o.num && t(l).addClass("down-up-layout-li-now"),
                d == o.before_num && t(l).addClass("down-up-layout-li-before"),
                d == o.after_num && t(l).addClass("down-up-layout-li-after"),
                r.appendChild(l)
        },
        eleImgCutMousedown: function(t, o) {
            if (0 != t.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup");
                var t = n._owner_element
                  , i = t._owner_page;
                i.nodeMousedown(),
                "img" == t.dataType ? (window.MEMENTO_ID = e.now(),
                t.cutOut()) : t.nodeDblclick()
            })
        },
        editcoll: function(e, o) {
            var n = this;
            o.mouseup(function() {
                for (var e = n._owner_element, i = e.imgId, s = 0; s < window.colledMaterial.length; s++)
                    window.colledMaterial[s] == i && d.back({
                        str: "你已经收藏过该模板",
                        kind: "success"
                    });
                t.ajax({
                    url: "/material/collectMaterial.do",
                    dataType: "json",
                    type: "POST",
                    data: {
                        id: i
                    },
                    success: function(e) {
                        1 == e.code && (d.back({
                            str: "收藏成功,已添加至我的收藏",
                            kind: "success"
                        }),
                        window.colledMaterial.push(i),
                        o.addClass("cantclick"))
                    },
                    error: function() {}
                })
            })
        },
        eleCopyMousedown: function(t, o) {
            if (e.addBugTrackClick("e1"),
            0 != t.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup"),
                window.MEMENTO_ID = e.now();
                var i = n._owner_design
                  , s = i.getCurPage()
                  , a = n._owner_element;
                if (s.nodeMousedown(),
                a._elements)
                    return void a.copy(t);
                var r = s.eleCopyAndUndo({
                    ele: a
                });
                r.nodeClick()
            })
        },
        eleDelMousedown: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this
              , s = i._owner_element;
            if ("true" == s.lock) {
                t("#edit-resize-br").removeClass("edit-resize-lock-enlarge");
                var a = t(i.getNode())
                  , r = a.find(".ele-lock");
                return t("#edit-resize-br").hasClass("edit-resize-lock-shake") || (t("#edit-resize-br").addClass("edit-resize-lock-shake"),
                r.addClass("ele-lock-shake"),
                window.ELE_LOCK_REMOVECLASS = setTimeout(function() {
                    t("#edit-resize-br").removeClass("edit-resize-lock-shake"),
                    r.removeClass("ele-lock-shake")
                }, 1500)),
                !1
            }
            n.mouseup(function() {
                n.off("mouseup");
                var t = i._owner_design
                  , o = t.getCurPage();
                return o.nodeMousedown(),
                window.MEMENTO_ID = e.now(),
                s._elements ? void s.removeAndUndo() : void ("background" === s.dataType ? (o.eleDelAndUndo(s),
                o.addWhiteBackgroundAndUndo(!0)) : o.eleDelAndUndo(s))
            })
        },
        groupSplit: function(e) {
            if (0 != e.button)
                return !1;
            {
                var t = this
                  , o = t._owner_element;
                o._elements,
                o.id
            }
            o.groupSplitAndUndo(),
            o = null
        },
        groupPut: function(e) {
            if (0 != e.button)
                return !1;
            var t = this
              , o = t._owner_element;
            o.groupPut()
        },
        hideMoreMenu: function() {
            var n = this.getNode()
              , i = t(n)
              , s = this._owner_element;
            if (null != s) {
                {
                    var a = s.getJson()
                      , r = s.colors;
                    a["data-elem"]
                }
                if ("block" == t("#edit-color").css("display") || "block" == t("#color-pickup").attr("data-block")) {
                    var l = t(".element-edit-bar").find(".ele-color").index(t(".element-edit-bar").find(".ele-color.now-click"));
                    "block" == t(".ss-function-colorPicker").attr("data-block") && (o.colorPickupHide(t("#edit-color").find(".edit-color-span-pickup"), s),
                    r = s.colors),
                    "svg" == s._element_type ? s.previewColor(r["color-" + (l + 1)], l) : "circleSelect" == s._element_type ? s.resetColor() : s.previewColor(r)
                }
                if ("block" == t("#text-size-bar").css("display") && s.previewFontSize(s.fontSize),
                "block" == t("#box-shadow-wrap").css("display")) {
                    var d = {};
                    d.blur = parseInt(t("#shadow-scroll").attr("data-num")) / 10,
                    d.offset = parseInt(t("#shadow-juli-scroll").attr("data-num")) / 10 * 2,
                    d.opacity = parseInt(t("#shadow-touming-scroll").attr("data-num")),
                    d.show = t("#shadow-switch").hasClass("switch-off") ? !1 : !0,
                    d.opacity = 1 - d.opacity / 100,
                    s.setShadow(d)
                }
                if ("block" == t("#opacity-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setOpacity(s.getOpacity())),
                "block" == t("#bold-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setBold(t("#bold-scroll").attr("data-num") / 100)),
                "block" == t("#wspace-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setWspace(t("#wspace-scroll").attr("data-num"))),
                "block" == t("#vspace-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setVspace(t("#vspace-scroll").attr("data-num"))),
                "block" == t("#text-spacing-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setWspace(t("#wspace-scroll").attr("data-num")),
                s.setVspace(t("#vspace-scroll").attr("data-num"))),
                0 != parseInt(t("#leftPanel").css("left"))) {
                    t("#leftPanel").stop(),
                    t("#leftPanel").animate({
                        left: "0px"
                    }, 300),
                    t(".panelArrowWrap").show();
                    var c = parseInt(t("#filter-parameter-num-brightness").text())
                      , u = parseInt(t("#filter-parameter-num-contrast").text())
                      , f = parseInt(t("#filter-parameter-num-saturation").text())
                      , p = parseInt(t("#filter-parameter-num-tint").text())
                      , h = parseInt(t("#filter-parameter-num-gaussianblur").text())
                      , w = parseInt(t("#filter-parameter-num-crossprocess").text())
                      , m = {
                        brightness: c,
                        contrast: u,
                        crossProcess: w,
                        gaussianBlur: h,
                        saturation: f,
                        tint: p
                    };
                    window.MEMENTO_ID = e.now(),
                    s.setFilter(m)
                }
                i.children(".now-click").removeClass("now-click"),
                t(".text-size input").removeClass("now-click"),
                t(".edit-more-drop").css("display", "none"),
                t("#text-spacing-wrap").css("display", "none")
            }
        },
        editColorShow: function(e, n) {
            if (0 != e.button)
                return !1;
            var s = this;
            n.mouseup(function() {
                if (n.off("mouseup"),
                n.hasClass("now-click"))
                    s.hideMoreMenu();
                else {
                    s.hideMoreMenu(),
                    n.siblings(".now-click").removeClass("now-click"),
                    n.addClass("now-click");
                    var e = (s._owner_element,
                    i.getEditColor())
                      , a = n.offset().left - 10
                      , r = n.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    })
                }
                o.colorBtnSet()
            })
        },
        fontFamilyWrapShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    o.removeClass("now-click"),
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.siblings(".now-click").removeClass("now-click"),
                    o.addClass("now-click");
                    var e = n._owner_element
                      , s = i.getFontFamily()
                      , a = s.find("#text-family-history")
                      , r = e.getFontFocusFamily()
                      , l = o.offset().top + 34;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar"));
                    var d = parseFloat(a.height());
                    l += d,
                    n.getFontFamilyPosition(r, l),
                    s.find("#text-family-list").css("height", s.height() - s.find("#text-family-history").height() + "px")
                }
            })
        },
        fontSizeWrapShow: function(e, o) {
            if (0 != e.button)
                return !1;
            {
                var n = this
                  , s = this._owner_design;
                s.pageScale
            }
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    o.removeClass("now-click"),
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var e = n._owner_element
                      , s = i.getFontSize(11)
                      , a = e.getFontFocusSize();
                    "px" != window.DESIGN_ORIGINAL_UNIT && (a = a / 300 * 72);
                    var r = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar"));
                    var l;
                    s.find("ul").children().each(function() {
                        t(this).removeClass("now-size"),
                        t(this).text() == parseInt(a) && (l = t(this))
                    }),
                    l.addClass("now-size"),
                    s.find("ul").scrollTop(l.offset().top - r)
                }
            })
        },
        textAlignShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup");
                var e = i.getFontAlign();
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.siblings(".now-click").removeClass("now-click"),
                    o.addClass("now-click");
                    var s = o.offset().left - 57
                      , a = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: s
                    })
                }
                var r = n._owner_element.getAlign();
                e.children().removeClass("now-click"),
                "right" == r ? e.find(".text-align-right").addClass("now-click") : "center" == r ? e.find(".text-align-center").addClass("now-click") : e.find(".text-align-left").addClass("now-click")
            })
        },
        setAlign: function(o, n) {
            if (0 != o.button)
                return !1;
            if (n.hasClass("now-click"))
                return !1;
            var i = this
              , s = n.attr("class");
            switch (s) {
            case "text-align-left":
                s = "left";
                break;
            case "text-align-center":
                s = "center";
                break;
            case "text-align-right":
                s = "right"
            }
            n.mouseup(function() {
                var o = t(this);
                o.parent().siblings(".text-align-bar").find("span").removeClass().addClass(o.hasClass("text-align-left") ? "ad-text-left" : o.hasClass("text-align-center") ? "ad-text-center" : "ad-text-right"),
                o.off("mouseup"),
                t("#text-align-bar").children(".now-click").removeClass("now-click"),
                o.addClass("now-click");
                var n = i._owner_element;
                window.MEMENTO_ID = e.now(),
                n.setAlign(s)
            })
        },
        eleReverseShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleReverse()
                      , a = o.offset().left - 26
                      , r = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    })
                }
            })
        },
        eleMoveShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleMove()
                      , a = o.offset().left - 26
                      , r = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    })
                }
            })
        },
        groupAlignShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleGroupAlign()
                      , a = o.offset().left - 26
                      , r = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    })
                }
            })
        },
        groupDistributedShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleGroupDistributed()
                      , a = o.offset().left - 26
                      , r = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    })
                }
            })
        },
        textStyleShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                var s = i.getFontStyle();
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.siblings(".now-click").removeClass("now-click"),
                    o.addClass("now-click");
                    var a = o.offset().left - 43
                      , r = o.offset().top + 45;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    })
                }
                var e = n._owner_element;
                "true" == e.italic ? s.find(".text-style-i").addClass("now-click") : s.find(".text-style-i").removeClass("now-click"),
                "true" == e.decoration ? s.find(".text-style-underline").addClass("now-click") : s.find(".text-style-underline").removeClass("now-click")
            })
        },
        textBoldShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var e = i.getBoldWrap()
                      , s = o.offset().left - 130
                      , a = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: s
                    }),
                    n.getBold()
                }
            })
        },
        boldMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#bold-back").offset().left;
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setBold(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setBold: function(e, t) {
            var o = (e - 67) / 150 * 100;
            t.attr("data-num", parseInt(o)),
            t.next().val(parseInt(o));
            var n = this._owner_element;
            n.previewBold(o / 100)
        },
        getBold: function() {
            var e = this._owner_element
              , o = e.bold || 0
              , n = 67 + 150 * o;
            t("#bold-scroll").css("left", n).attr("data-num", parseInt(100 * o)),
            t("#bold-input").val(parseInt(100 * o))
        },
        textItalic: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this;
            n.children().hasClass("now-set") ? n.children().removeClass("now-set") : n.children().addClass("now-set"),
            n.mouseup(function() {
                t(this).off("mouseup");
                var o = i._owner_element;
                "block" == t("#texteventtarget").css("display") && o.finishInput(),
                window.MEMENTO_ID = e.now(),
                o.setItalic()
            })
        },
        textDecoration: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this;
            n.children().hasClass("now-set") ? n.children().removeClass("now-set") : n.children().addClass("now-set"),
            n.mouseup(function() {
                t(this).off("mouseup");
                var o = i._owner_element;
                "block" == t("#texteventtarget").css("display") && o.finishInput(),
                window.MEMENTO_ID = e.now(),
                o.setDecoration(),
                i.hideMoreMenu()
            })
        },
        setEleFontSize: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this;
            n.mouseup(function() {
                n.off("mouseup");
                var o = i.getNode()
                  , s = t(o)
                  , a = i._owner_element
                  , r = n.html();
                s.find(".text-size input").val(r),
                "px" != window.DESIGN_ORIGINAL_UNIT && (r = r / 72 * 300),
                window.MEMENTO_ID = e.now(),
                a.setFontSize(r),
                i.hideMoreMenu()
            })
        },
        setEleColor: function(n, i) {
            if (0 != n.button)
                return !1;
            var s = this;
            i.mouseup(function() {
                i.off("mouseup");
                var n = s.getNode()
                  , a = (t(n),
                s._owner_element)
                  , r = t(".element-edit-bar").find(".ele-color").index(t(".element-edit-bar").find(".ele-color.now-click"))
                  , l = i.css("background-color");
                window.MEMENTO_ID = e.now(),
                a.setColor(l, r),
                t(".element-edit-bar").find(".ele-color.now-click").children().css("background-color", l),
                "block" == t(".ss-function-colorPicker").attr("data-block") && o.colorPickupHide(t(".edit-color-span-pickup.now-click"), a, !0),
                s.hideMoreMenu()
            })
        },
        opacityWrapShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click"),
                    "block" == t("#texteventtarget").css("display") && n._owner_element.finishInput();
                    var e = i.getOpacityWrap()
                      , s = n.getNode()
                      , a = (t(s),
                    o.offset().left - 122 - 30)
                      , r = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    }),
                    n.getOpacity()
                }
            })
        },
        shadowWrapShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup");
                n._owner_element;
                if (o.hasClass("now-click"))
                    o.removeClass("now-click"),
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var e = i.getShadowWrap();
                    e.find(".edit-more-drop").css("display", "block");
                    var s = o.offset().left - 220
                      , a = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: s
                    })
                }
                n.getShadowVal()
            })
        },
        getShadowVal: function() {
            var e = this._owner_element
              , o = e.shadow
              , n = parseInt(10 * o.blur)
              , i = parseInt(100 * o.opacity)
              , s = 10 * o.offset / 2
              , a = e.shadow.show || !1
              , r = parseInt(1.5 * n) + 67
              , l = parseInt(1.5 * s) + 67
              , d = parseInt(1.5 * (100 - i)) + 67;
            t("#shadow-scroll").css("left", r).attr("data-num", n),
            t("#shadow-juli-scroll").css("left", l).attr("data-num", s),
            t("#shadow-touming-scroll").css("left", d).attr("data-num", 100 - i),
            document.getElementById("shadow-switch").className = a ? "switch-on" : "switch-off",
            t("#shadow-input").val(n),
            t("#shadow-juli-input").val(s),
            t("#shadow-touming-input").val(100 - i)
        },
        textSpacingShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click"),
                    "block" == t("#texteventtarget").css("display") && n._owner_element.finishInput();
                    var e = i.getTextSpaceWrap()
                      , s = n.getNode()
                      , a = (t(s),
                    o.offset().left - 130)
                      , r = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: a
                    }).children("div").css("display", "block"),
                    n.getWspace(),
                    n.getVspace()
                }
            })
        },
        opacityMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#opacity-back").offset().left;
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setOpacity(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setOpacity: function(e, o) {
            var n = 100 - (e - 67) / 150 * 100;
            o.attr("data-num", parseInt(100 - n)),
            t("#opacity-input").val(parseInt(100 - n));
            var i = this._owner_element;
            i.previewOpacity(n / 100)
        },
        getOpacity: function() {
            var e = this._owner_element
              , o = e.opacity || 0
              , n = 67 + 150 * (1 - o);
            t("#opacity-scroll").css("left", n).attr("data-num", parseInt(100 * (1 - o))),
            t("#opacity-input").val(parseInt(100 * (1 - o)))
        },
        wspaceMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#wspace-back").offset().left
              , s = n._owner_element;
            s.setVspace(t("#vspace-scroll").attr("data-num")),
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setWspace(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setWspace: function(e, o) {
            var n = (e - 67) / 150 * 2e3 - 400;
            o.attr("data-num", parseInt(n)),
            t("#wspace-input").val(parseInt(n));
            var i = this._owner_element;
            i.previewWspace(n)
        },
        getWspace: function() {
            var e = this._owner_element
              , o = e.wspace || 0
              , n = (parseInt(o) + 400) / 2e3 * 150 + 67;
            t("#wspace-scroll").css("left", n).attr("data-num", o),
            t("#wspace-input").val(parseInt(o))
        },
        vspaceMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#vspace-back").offset().left
              , s = n._owner_element;
            s.setWspace(t("#wspace-scroll").attr("data-num")),
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setVspace(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setVspace: function(e, o) {
            var n = (e - 67) / 150 * 2e3 - 400;
            o.attr("data-num", parseInt(n)),
            t("#vspace-input").val(parseInt(n));
            var i = this._owner_element;
            i.previewVspace(n)
        },
        getVspace: function() {
            var e = this._owner_element
              , o = e.vspace || 0
              , n = (parseInt(o) + 400) / 2e3 * 150 + 67;
            t("#vspace-scroll").css("left", n).attr("data-num", o),
            t("#vspace-input").val(parseInt(o))
        },
        verticalReverse: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = this;
            t.mouseup(function() {
                t.off("mouseup");
                var e = o._owner_design
                  , n = (e.getCurPage(),
                o._owner_element);
                n.setVerticalReverse();
                var i = e._owner_editDiv;
                i.resetEditDivPosition()
            })
        },
        horizontalReverse: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = this;
            t.mouseup(function() {
                t.off("mouseup");
                var e = o._owner_design
                  , n = (e.getCurPage(),
                o._owner_element);
                n.setHorizontalReverse();
                var i = e._owner_editDiv;
                i.resetEditDivPosition()
            })
        },
        shadowBlur: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#shadow-back").offset().left
              , s = n._owner_element
              , a = 0;
            t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click(),
            t(document).mousemove(function(e) {
                var n = e.pageX
                  , r = n - i + 67;
                r > 217 && (r = 217),
                67 > r && (r = 67),
                o.css({
                    left: r
                });
                var d = r;
                a = parseInt((d - 67) / 150 * 100),
                o.attr("data-num", a),
                t("#shadow-input").val(a),
                s.previewShadow({
                    blur: a / 10 * l.ZOOM_IN
                })
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        shadowOffset: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#shadow-juli-back").offset().left
              , s = n._owner_element
              , a = 0;
            t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click(),
            t(document).mousemove(function(e) {
                var n = e.pageX
                  , r = n - i + 67;
                r > 217 && (r = 217),
                67 > r && (r = 67),
                o.css({
                    left: r
                });
                var d = r
                  , c = 100 - (d - 67) / 150 * 100;
                a = parseInt(100 - c),
                o.attr("data-num", parseInt(a)),
                t("#shadow-juli-input").val(parseInt(a)),
                s.previewShadow({
                    offset: a / 5 * l.ZOOM_IN
                })
            }).mouseup(function() {
                t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click(),
                t(this).off("mousemove").off("mouseup")
            })
        },
        shadowOpacity: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#shadow-touming-back").offset().left
              , s = n._owner_element
              , a = 0;
            t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click(),
            t(document).mousemove(function(e) {
                var n = e.pageX
                  , r = n - i + 67;
                r > 217 && (r = 217),
                67 > r && (r = 67),
                o.css({
                    left: r
                });
                var l = r
                  , d = 100 - (l - 67) / 150 * 100;
                a = parseInt(100 - d),
                o.attr("data-num", parseInt(a)),
                t("#shadow-touming-input").val(parseInt(a)),
                s.previewShadow({
                    opacity: (100 - a) / 100
                })
            }).mouseup(function() {
                t("#shadow-switch").hasClass("switch-off") && t("#shadow-switch").click(),
                t(this).off("mousemove").off("mouseup")
            })
        },
        setShadowShowFN: function(e) {
            var t = this._owner_element;
            t.previewShadowShow(e)
        },
        imgFilterShow: function(e, o) {
            if (0 != e.button)
                return !1;
            o.hasClass("now-click") ? t(".panelArrowWrap").show() : t(".panelArrowWrap").hide();
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var e, i, s = n._owner_element, a = s.getImgNode(), r = a.getBBox(), l = r.width, d = r.height;
                    l > d ? (i = 56,
                    e = 56 * (l / d)) : (e = 56,
                    i = 56 * (d / l));
                    for (var c = 0; c < t(".filter-preset-son-div").size(); c++)
                        t(".filter-preset-son-div").find("image").attr("width", e),
                        t(".filter-preset-son-div").find("image").attr("height", i),
                        t(".filter-preset-son-div").find("image").attr("xlink:href", a.getAttribute("href") || a.getAttribute("xlink:href"));
                    t("#leftPanel").stop(),
                    t("#leftPanel").animate({
                        left: -t("#leftToolbarWrap").getWidth()
                    }, 300);
                    var u = s.filter;
                    for (var c in u)
                        n.setFilterPosition(u[c], c)
                }
            })
        },
        filterDotMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = o.prev().offset().left
              , s = n._owner_element
              , a = o.attr("data-filter")
              , r = parseInt(o.attr("data-max"))
              , l = parseInt(o.attr("data-min"));
            t(document).mousemove(function(e) {
                var t = e.pageX - i;
                0 >= t && (t = 0),
                t >= 269 && (t = 269),
                o.css("left", t);
                var n = parseInt((r - l) / 269 * t + l, "10");
                s.filterMove(n, a),
                o.parent().find(".filter-parameter-son-num").text(n)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        filterClick: function(e, t) {
            var o = this._owner_element
              , n = parseInt(t.attr("data-brightness"))
              , i = parseInt(t.attr("data-contrast"))
              , s = parseInt(t.attr("data-saturation"))
              , a = parseInt(t.attr("data-tint"))
              , r = parseInt(t.attr("data-gaussianblur"))
              , l = parseInt(t.attr("data-crossprocess"));
            "NAN" !== n && (this.setFilterPosition(n, "brightness"),
            o.filterMove(n, "brightness")),
            "NAN" !== i && (this.setFilterPosition(i, "contrast"),
            o.filterMove(i, "contrast")),
            "NAN" !== l && (this.setFilterPosition(l, "crossProcess"),
            o.filterMove(l, "crossProcess")),
            "NAN" !== r && (this.setFilterPosition(r, "gaussianBlur"),
            o.filterMove(r, "gaussianBlur")),
            "NAN" !== s && (this.setFilterPosition(s, "saturation"),
            o.filterMove(s, "saturation")),
            "NAN" !== a && (this.setFilterPosition(a, "tint"),
            o.filterMove(a, "tint"))
        },
        setFilterPosition: function(e, o) {
            var n = t("#filter-dot-" + o)
              , i = parseInt(n.attr("data-max"))
              , s = parseInt(n.attr("data-min"))
              , a = (e - s) / ((i - s) / 269);
            n.css("left", a),
            n.parent().find(".filter-parameter-son-num").text(e)
        },
        imgChangeToBackground: function(t, o) {
            if (0 != t.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup");
                var t = n._owner_element
                  , i = t.getPage();
                i.nodeMousedown(),
                window.MEMENTO_ID = e.now(),
                t.changeSizeByPage(),
                t.imgChangeToBackground(),
                t.setLock(),
                t.nodeClick()
            })
        },
        groupElementAlign: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = this._owner_element
              , n = t.attr("data-align");
            "bottom" == n ? o.groupAlignBottom() : "vertical-middle" == n ? o.groupAlignVerticalMiddle() : "top" == n ? o.groupAlignTop() : "right" == n ? o.groupAlignRight() : "standard-middle" == n ? o.groupAlignStandardlMiddle() : "left" == n ? o.groupAlignLeft() : "vertical-auto" == n ? o.groupAlignVerticalAuto() : "standard-auto" == n && o.groupAlignStandardAuto()
        },
        setGroup: function(e) {
            if (0 != e.button)
                return !1;
            for (var t, o = this._owner_design, n = o.getCurPage(), i = this._owner_element, s = i._elements, a = s.length, r = n.createElementGroupAndUndo(s), l = (n.getIndex(),
            s[a - 1].getIndex()), d = 1, c = a - 2; c >= 0; c--)
                t = s[c],
                t.getIndex() != l - d && t.changeIndexAndUndoForCreateGroup({
                    new_index: l - d
                }),
                d++;
            r.nodeClick()
        },
        setLock: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = (window.localStorage.getItem("already_use_names") || "",
            this._owner_design)
              , n = o._owner_editDiv;
            t.children().hasClass("now-set") ? (t.children().removeClass("now-set"),
            t.parent().find(".ele-del, .group-edit-split").removeClass("no-click"),
            n.setUnLock()) : (t.children().addClass("now-set"),
            t.parent().find(".ele-del, .group-edit-split").addClass("no-click"),
            n.setLock());
            var i = this._owner_element;
            return i._elements ? void i.groupSetLock() : void i.setLock()
        }
    },
    e.classExtend(p, s),
    p
});
;/*!/comp/design/toolbar/EditDiv.js*/
"use strict";
define("comp/design/toolbar/EditDiv", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/toolbar/toolbar_config", "comp/design/Toolbar", "libs/jquery/jquery.transit.min", "comp/design/design_config"], function(e, t, i, o, s, n, r) {
    function d() {
        {
            var e = this;
            e._owner_design
        }
        a.call(e)
    }
    function a() {
        var i = this
          , o = i.getNode()
          , s = t(o);
        window.addEventListener ? (o.addEventListener("mousedown", function(e) {
            t(".materialInfoClose").mousedown(),
            i.nodeMousedown(e),
            window.SPACE_KEY_DOWN || e.stopPropagation()
        }, !1),
        o.addEventListener("click", function(e) {
            return t(o).hasClass("edit-div-clone") ? !1 : (i.nodeClick(e),
            void e.stopPropagation())
        }, !1),
        o.addEventListener("dblclick", function(e) {
            return t(o).hasClass("edit-div-clone") ? !1 : (i.nodeDblclick(e),
            void e.stopPropagation())
        }, !1)) : window.attachEvent && (o.attachEvent("onmousedown", function(e) {
            t(".materialInfoClose").mousedown(),
            i.nodeMousedown(e),
            window.SPACE_KEY_DOWN || e.stopPropagation()
        }),
        o.attachEvent("onclick", function(e) {
            return t(o).hasClass("edit-div-clone") ? !1 : (i.nodeClick(e),
            void e.stopPropagation())
        }),
        o.attachEvent("ondblclick", function(e) {
            return t(o).hasClass("edit-div-clone") ? !1 : (i.nodeDblclick(e),
            void e.stopPropagation())
        })),
        s.find("#edit-rotate").mousedown(function(t) {
            return e.addBugTrackClick("e3"),
            i.rotateMousedown(t),
            !1
        }),
        s.find(".edit-resize-middle").mousedown(function(e) {
            return i.resizeMousedown(e, this),
            !1
        }),
        s.find(".edit-resize").mousedown(function(e) {
            return i.resizeMousedown(e, this),
            !1
        })
    }
    function l(e, i) {
        if (0 != e.button)
            return !1;
        var o = e.pageX
          , s = e.pageY
          , n = t(".select_element").css({
            width: "0px",
            height: "0px"
        }).offset({
            left: o,
            top: s
        })
          , r = i._owner_design
          , d = r.getCurPage();
        t(document).mousemove(function(e) {
            var t = e.pageX - o
              , i = e.pageY - s
              , r = o
              , a = s;
            0 > t && (r = e.pageX,
            t = -t),
            0 > i && (a = e.pageY,
            i = -i),
            n.css({
                width: t + 1,
                height: i + 1,
                display: "block"
            }).offset({
                left: r,
                top: a
            }),
            d.selectElement(a, r + t, a + i, r)
        }).mouseup(function() {
            t(this).off("mouseup").off("mousemove"),
            n.css("display", "none"),
            d.selectElementUp()
        })
    }
    var c = function(e) {
        var t = this;
        s.call(t),
        t._owner_design = e,
        e._owner_editDiv = t,
        d.call(t)
    };
    return c.prototype = {
        constructor: c,
        createWidget: function() {
            return o.getEditDiv()[0]
        },
        _owner_design: null,
        _owner_element: null,
        _move_drag: !1,
        start_lt: {
            left: 0,
            top: 0
        },
        across_clone: {
            dom: null,
            x: 0,
            y: 0
        },
        start_transform: {
            left: 0,
            top: 0
        },
        show: function(e) {
            this._owner_element = e;
            {
                var i = this._owner_design;
                i.pages[0],
                this._owner_element
            }
            i._focus_element = e;
            var o = t(this.getNode())
              , s = e.getWidth()
              , n = e.getHeight()
              , r = e.getLeft()
              , d = e.getTop()
              , a = e.getRotate();
            if (o.css({
                width: s + 1,
                height: n + 1,
                display: "block"
            }).appendTo(t("#rightPanel")).css({
                rotate: a
            }).offset({
                left: r,
                top: d
            }).find("#edit-rotate").css("display", "block"),
            o.find(".edit-resize").css("display", "block"),
            o.find(".edit-resize-middle").css("display", "block"),
            e.hideAnt(),
            o.find("#edit-img-cutout").css("display", "none"),
            "text" == e._element_type)
                o.find(".edit-resize-middle").css("display", "none"),
                o.find(".edit-resize-rl").css("display", "block");
            else if ("img" == e._element_type || "background" == e._element_type || "svgChart" == e._element_type)
                o.find(".edit-resize-middle").css("display", "none");
            else if ("svg" == e._element_type) {
                var l = e.getNode()
                  , c = t(l)
                  , g = e._svg_change_kind
                  , h = c.find("svg").children()[0];
                if (void 0 != g) {
                    "hx" == g ? o.find(".edit-resize-tb").css("display", "none") : "zx" == g ? o.find(".edit-resize-rl").css("display", "none") : "ry" == g || "hx_def" == g || "hs" == g || o.find(".edit-resize-middle").css("display", "none"),
                    "svgLayout" == e._svg_type && void 0 == e.cutwidth && o.find(".edit-resize-middle").css("display", "none");
                    var f = h.getAttribute("class");
                    "line" == f && o.find(".edit-resize").css("display", "none")
                } else
                    o.find(".edit-resize-middle").css("display", "none")
            }
            "true" == e.lock ? this.setLock() : this.setUnLock(),
            this.resizeCursorSet()
        },
        setLock: function() {
            var e = t(this.getNode());
            e.find(".edit-resize-middle").addClass("edit-resize-no-click"),
            e.find("#edit-resize-br").addClass("edit-resize-lock").attr("title", "点击解锁"),
            e.find("#edit-rotate").addClass("edit-rotate-lock")
        },
        setUnLock: function() {
            t("#edit-div").css("display", "block");
            var e = t(this.getNode());
            e.find(".edit-resize-middle").removeClass("edit-resize-no-click"),
            e.find("#edit-resize-br").removeClass("edit-resize-lock").removeAttr("title"),
            e.find("#edit-rotate").removeClass("edit-rotate-lock"),
            e.find(".edit-resize-lock-enlarge").removeClass("edit-resize-lock-enlarge"),
            e.find(".edit-resize-lock-shake").removeClass("edit-resize-lock-shake"),
            t(".element-edit-bar").find(".ele-lock").removeClass("ele-lock-shake")
        },
        showByCircle: function(e) {
            this._owner_element = e;
            var i = this._owner_design;
            i._focus_element = e;
            var o = t(this.getNode())
              , s = e.getRect();
            if (void 0 != s) {
                var n = s.right - s.left
                  , r = s.bottom - s.top
                  , d = s.left
                  , a = s.top;
                o.css({
                    width: n + 1,
                    height: r + 1,
                    display: "block",
                    rotate: "0deg"
                }).appendTo(t("#rightPanel")).offset({
                    left: d,
                    top: a
                }).find("#edit-rotate").css("display", "none"),
                o.find(".edit-resize-middle").css("display", "none"),
                o.find("#edit-img-cutout").css("display", "none"),
                o.find(".edit-resize").removeClass("edit-resize-lock"),
                this.resizeCursorSet()
            }
        },
        showByGroup: function(e) {
            this._owner_element = e;
            var i = this._owner_design;
            i._focus_element = e;
            var o = e.getRect()
              , s = e.getWidth()
              , n = e.getHeight()
              , r = e.getRotate()
              , d = o.left
              , a = o.top
              , l = t(this.getNode());
            this.setGroupEdit(),
            l.css({
                width: s + 1,
                height: n + 1,
                display: "block",
                rotate: r + "deg"
            }).appendTo(t("#rightPanel")).offset({
                left: d,
                top: a
            }),
            l.find(".edit-resize-middle").css("display", "none"),
            l.find("#edit-img-cutout").css("display", "none"),
            "true" == e.lock ? this.setLock() : this.setUnLock(),
            this.resizeCursorSet()
        },
        setGroupEdit: function() {
            var e = this._owner_element
              , i = t(this.getNode());
            e._text_ele_sum === e._text_ele_loaded ? (i.find("#edit-rotate").css("display", "block"),
            i.find(".edit-resize").css("display", "block")) : (i.find("#edit-rotate").css("display", "none"),
            i.find(".edit-resize").css("display", "none"))
        },
        showInGroup: function(e) {
            var i = t(this.getNode()).clone();
            i.children().detach();
            var o = e.getWidth()
              , s = e.getHeight()
              , n = (e.getRotate(),
            e.getRect())
              , r = n.left
              , d = n.top;
            i.addClass("editdiv-clone").css({
                width: o + 1,
                height: s + 1,
                display: "block",
                rotate: e.getRotateFormNode() + "deg"
            }).appendTo(t("#rightPanel")).offset({
                left: r,
                top: d
            });
            for (var a = this._owner_element._elements, l = 0; l < a.length; l++)
                a[l].hideAnt();
            "text" == e._element_type && i.addClass("editdiv-clone-text"),
            i.mousedown(function() {
                return !1
            })
        },
        resizeCursorSet: function() {
            var e = t(this.getNode());
            this.resizeCursor(e.find("#edit-resize-br")),
            this.resizeCursor(e.find("#edit-resize-r")),
            this.resizeCursor(e.find("#edit-resize-b"))
        },
        svgLayoutShow: function(e) {
            this._owner_element = e;
            var i = this._owner_design
              , o = i.pages[0]
              , s = this._owner_element
              , n = i._owner_elementEditbar
              , r = n.getNode();
            r.style.display = "none",
            i._focus_element = e;
            var d = (e._layout_index,
            t(this.getNode()))
              , a = e.getSvgImageRect()
              , l = e.getShowSvgImageBox()
              , c = i.pageScale
              , g = e.getSvgScale()
              , h = a.top
              , f = a.left
              , u = l.height * g * c
              , p = l.width * g * c
              , m = e.getRotate();
            d.css({
                width: p + 1,
                height: u + 1,
                display: "block"
            }).css({
                rotate: m,
                zIndex: 19998
            }).offset({
                left: f,
                top: h
            }).find("#edit-rotate").css("display", "none"),
            d.find(".edit-resize-middle").css("display", "none"),
            d.find("#edit-img-cutout").css("display", "none"),
            t(".edit-div-clone").size() > 0 ? t(".edit-div-clone").before(d) : d.appendTo(t("#rightPanel"));
            t(e.getNode());
            if (this.createSvgLayoutWrite(),
            0 == t(".edit-div-clone").size() && "cut1" == e.getJson()["data-elem"].id)
                t(".edit-div-clone").detach(),
                this.createSvgCut(e);
            else if ("cut1" != e.getJson()["data-elem"].id) {
                var _ = document.createElement("div");
                _.classList.add("edit-div-mask");
                var v = t(_);
                v.css({
                    width: "100%",
                    height: "100%",
                    position: "fixed",
                    left: "0px",
                    top: "0px",
                    zIndex: 19997
                }),
                v.mousedown(function() {
                    return !1
                }),
                0 === t(".edit-div-mask").length && v.appendTo(t("body")),
                d.find("#edit-img-cutout").css("display", "block"),
                d.find("#edit-img-cutout-confirm").click(function() {
                    return s.setLayout(),
                    window._Svg_Cut_isEdit_flag = !1,
                    o.nodeMousedown(),
                    t(".edit-div-mask").remove(),
                    !1
                }),
                d.find("#edit-img-cutout-cancel").click(function() {
                    return s.cancelSvgLayout(s.getNewJson()["data-elem"]["data-xhref-imgs"]),
                    window._Svg_Cut_isEdit_flag = !1,
                    o.nodeMousedown(),
                    t(".edit-div-mask").remove(),
                    !1
                })
            }
        },
        createSvgCut: function(e) {
            var i = this
              , o = i._owner_design
              , s = o.pages[0]
              , n = i._owner_element;
            o._focus_element = e,
            window._Svg_Cut_isEdit_flag = !0;
            var r = t(this.getNode()).clone();
            t(this.getNode()).find("#edit-img-cutout").css("display", "none"),
            r.mousedown(function(e) {
                return i.nodeMousedown(e),
                !1
            }),
            r.find(".edit-resize-middle").mousedown(function(e) {
                return i.resizeMousedown(e, this),
                !1
            }),
            r.find("#edit-img-cutout-confirm").click(function() {
                return n.setLayout(),
                window._Svg_Cut_isEdit_flag = !1,
                s.nodeMousedown(),
                t(".edit-div-mask").remove(),
                !1
            }),
            r.find("#edit-img-cutout-cancel").click(function() {
                return n.cancelSvgLayout(n.getNewJson()["data-elem"]["data-xhref-imgs"]),
                window._Svg_Cut_isEdit_flag = !1,
                s.nodeMousedown(),
                t(".edit-div-mask").remove(),
                !1
            });
            var d = e.getWidth()
              , a = e.getHeight()
              , l = e.getLeft()
              , c = e.getTop()
              , g = e.getRotate();
            r.css({
                width: d + 1,
                height: a + 1,
                display: "block",
                cursor: "move",
                zIndex: 19998
            }).appendTo(t("#rightPanel")).css({
                rotate: g
            }).offset({
                left: l,
                top: c
            }).addClass("edit-div-clone"),
            r.find(".edit-resize").css("display", "none"),
            r.find(".edit-resize-middle").css("display", "block");
            var h = document.createElement("div");
            h.classList.add("edit-div-mask");
            var f = t(h);
            f.css({
                width: "100%",
                height: "100%",
                position: "fixed",
                left: "0px",
                top: "0px",
                zIndex: 19997
            }),
            f.mousedown(function() {
                return !1
            }),
            0 === t(".edit-div-mask").length && f.appendTo(t("body")),
            r.find("#edit-img-cutout").css("display", "block")
        },
        createSvgLayoutWrite: function() {
            t(".edit-div-write-wrap").remove();
            var i = this._owner_element
              , o = t(i.getNode())
              , s = this._owner_design
              , n = i.getSvgImageRect()
              , d = i.getSvgImageBox()
              , a = i.getSvgImageSrc()
              , l = s.pageScale
              , c = i.getSvgScale()
              , g = d.height * c * l
              , h = d.width * c * l
              , f = e.createSvgNode("g")
              , u = (t(f),
            e.createSvgNode("image"))
              , p = h / l
              , m = g / l;
            u.setAttribute("width", p),
            u.setAttribute("height", m),
            u.href.baseVal = a,
            f.appendChild(u),
            f.setAttribute("class", "edit-div-write-wrap");
            var _ = i.getJson()
              , v = _.transform
              , w = e.getTransformAttr(v, "rotate")
              , y = e.setTransformAttr("", "rotate", w);
            y = e.transformScale(y, r.ZOOM_IN),
            f.setAttribute("opacity", "0.6"),
            f.setAttribute("transform", y),
            o.before(t(f));
            var z = f.getBoundingClientRect()
              , b = (n.left - z.left) / l
              , k = (n.top - z.top) / l
              , S = [b, k];
            y = e.setTransformAttr(y, "translate", S),
            y = e.setTransformAttr(y, "rotate", w),
            f.setAttribute("transform", e.transformScale(y, r.ZOOM_IN))
        },
        svgLayoutImageMove: function(t, i) {
            var o = this._owner_design
              , s = this._owner_element
              , n = s.getRotate()
              , r = o.pageScale
              , d = s.getSvgScale()
              , a = e.coordinateRotate(t, i, n)
              , l = a.x / r / d
              , c = a.y / r / d;
            return s.setSvgImageLT(l, c),
            s.getSvgImageRect()
        },
        nodeMousedown: function(i) {
            if (!window.SPACE_KEY_DOWN) {
                if (0 != i.button)
                    return !1;
                "true" == this._owner_element.lock && t("#edit-resize-br").removeClass("edit-resize-lock-enlarge edit-resize-lock-shake");
                var o = this
                  , s = o._owner_design
                  , n = s._owner_elementEditbar;
                if (t(".editdiv-clone").size() > 0) {
                    t(".editdiv-clone").hasClass("editdiv-clone-text") && s._focus_element.finishInput(this._owner_element),
                    t(".editdiv-clone").detach(),
                    s._focus_element = this._owner_element,
                    n.show(this._owner_element);
                    for (var d = this._owner_element._elements, a = 0; a < d.length; a++)
                        d[a].showAnt()
                }
                n.hideMoreMenu();
                var c = s.getCurPage()
                  , g = n.getNode()
                  , h = i.pageX
                  , f = i.pageY
                  , u = h
                  , p = f
                  , m = t(o.getNode())
                  , _ = o._owner_element
                  , v = !1;
                t(".edit-div-write-wrap").size() > 0 && ("none" == g.style.display,
                v = !0);
                var d, w = _.getRect(), y = {
                    left: w.left,
                    right: w.right,
                    top: w.top,
                    bottom: w.bottom,
                    middle_x: (w.left + w.right) / 2,
                    middle_y: (w.top + w.bottom) / 2
                };
                if ("circleSelect" == _._element_type || "elementGroup" == _._element_type) {
                    d = _._elements;
                    var z = {};
                    z.left = y.left,
                    z.top = y.top
                } else {
                    d = [_];
                    var b = _.getTranslateLeftTop()
                }
                {
                    var k, S, C = c.elementsPositionNotThis(d), x = s.pageScale;
                    t(".element-edit-bar").find(".ele-lock")
                }
                t(document).mousemove(function(i) {
                    if ("true" == o._owner_element.lock)
                        return o.getNode().style.display = "none",
                        t(this).off("mousemove"),
                        l(i, o),
                        !1;
                    var s = i.pageX
                      , n = i.pageY
                      , d = s - h
                      , a = n - f;
                    if (v) {
                        var g = o.svgLayoutImageMove(d, a);
                        m.offset({
                            top: g.top,
                            left: g.left
                        }),
                        o.createSvgLayoutWrite(),
                        h = s,
                        f = n
                    } else {
                        k = c.changeElePosition(y, d, a),
                        k.i = _.getIndex(),
                        S = c.guideShow(k, C);
                        var g;
                        "circleSelect" == _._element_type || "elementGroup" == _._element_type ? (g = _.addLeftTop((S.left - z.left) * r.ZOOM_IN, (S.top - z.top) * r.ZOOM_IN),
                        z.left = S.left,
                        z.top = S.top) : g = _.setLeftTop([b[0] + (S.left - y.left) / x * r.ZOOM_IN, b[1] + (S.top - y.top) / x * r.ZOOM_IN]),
                        m.offset({
                            top: g.top,
                            left: g.left
                        })
                    }
                    Math.abs(s - u) < 2 && Math.abs(n - p) < 2 ? o._move_drag = !1 : (o._move_drag = !0,
                    _.setMoveOpacity(!0));
                    var w, M;
                    if ("elementGroup" == _._element_type || "circleSelect" == _._element_type) {
                        var N = _.getTranslateLeftTop();
                        w = parseInt(N[0]),
                        M = parseInt(N[1])
                    } else if ("svgChart" == _._element_type || "text" == _._element_type) {
                        var N = _.getPosition();
                        w = parseInt(N[0]),
                        M = parseInt(N[1])
                    } else
                        w = parseInt(e.getTransformAttr(_.getTransform(), "translate")[0] / r.ZOOM_IN),
                        M = parseInt(e.getTransformAttr(_.getTransform(), "translate")[1] / r.ZOOM_IN);
                    t("#edit-data").text(w + "," + M).fadeIn(250)
                }).mouseup(function() {
                    _.setMoveOpacity(!1);
                    for (var i = 0; i < t(".elementsSonEnter").size(); i++)
                        e.removeClass(t(".elementsSonEnter").eq(i)[0], "elementsSonEnter");
                    t("#edit-data").fadeOut(250),
                    t(this).off("mousemove").off("mouseup"),
                    t(".moveGuide").detach();
                    var s = _.overstepPageDel();
                    if (s)
                        return !1;
                    if (window.MEMENTO_ID = e.now(),
                    o._move_drag) {
                        "circleSelect" == _._element_type || "elementGroup" == _._element_type ? _.setNewJson() : v || (_.transform = e.transformScale(_.getTransform(), 1 / r.ZOOM_IN));
                        var n = o._owner_design
                          , d = n._owner_elementEditbar;
                        d.moveBtnSet()
                    }
                })
            }
        },
        nodeClick: function(t) {
            if (this._move_drag)
                return void (this._move_drag = !1);
            for (var i, o, s, n, r, d, a, l, c, g, h, f, u, p, m, _, v, w = this._owner_element, y = w.getIndex(), z = w._owner_page, b = z.getRect(), k = z._owner_design, S = k.pageScale, C = z.elements, x = t.pageX, M = t.pageY, N = C.length - 1; N > y; N--)
                if (w = C[N],
                i = w.getRect(),
                o = w.getShowBox(),
                g = w.getShowTranslateLeftTop(),
                h = parseFloat(g[0]),
                f = parseFloat(g[1]),
                p = o.x + h,
                _ = p + o.width,
                m = o.y + f,
                v = m + o.height,
                d = x - b.left,
                a = M - b.top,
                l = (p + o.width / 2) * S,
                c = (m + o.height / 2) * S,
                u = e.coordinateRotate(d, a, parseFloat(w.getRotate()), l, c),
                n = u.x / S,
                r = u.y / S,
                v > r && r > m && _ > n && n > p) {
                    s = N;
                    break
                }
            s && (w._group_drag ? w._element_group.nodeClick() : w.nodeClick())
        },
        resizeCursor: function(e) {
            var t = this._owner_element
              , i = t.getRect()
              , o = i.left + i.width / 2
              , s = i.top + i.height / 2
              , n = e.offset().left + e.getWidth() / 2
              , r = e.offset().top + e.getHeight() / 2
              , d = 15;
            "edit-resize-br" == e.attr("id") && (d = 1),
            n > o && (r > s && e.css("cursor", "se-resize"),
            s > r && e.css("cursor", "ne-resize")),
            o > n && (r > s && e.css("cursor", "sw-resize"),
            s > r && e.css("cursor", "nw-resize")),
            Math.abs(r - s) / Math.abs(n - o) < Math.tan(d * Math.PI / 180) && (n > o && e.css("cursor", "e-resize"),
            o > n && e.css("cursor", "w-resize")),
            Math.abs(r - s) / Math.abs(n - o) > Math.tan((90 - d) * Math.PI / 180) && (r > s && e.css("cursor", "s-resize"),
            s > r && e.css("cursor", "n-resize"))
        },
        rotateMousedown: function(i) {
            if (0 != i.button)
                return !1;
            var o = this
              , s = o._owner_element;
            if ("true" == s.lock)
                return !1;
            s._focus_drag && s.finishInput();
            var n = o._owner_design
              , d = n._owner_elementEditbar;
            t(".editdiv-clone").size() > 0 && (t(".editdiv-clone").hasClass("editdiv-clone-text") && n._focus_element.finishInput(s),
            n._focus_element = s,
            t(".editdiv-clone").detach());
            var a = t(o.getNode())
              , l = s.getRect()
              , c = l.width
              , g = l.height
              , h = l.left
              , f = l.top
              , u = h + c / 2
              , p = f + g / 2
              , m = d.getNode();
            "block" === m.style.display && (m.style.display = "none");
            var _;
            t(document).mousemove(function(e) {
                var i = e.pageX
                  , n = e.pageY
                  , r = i - u
                  , d = n - p
                  , l = Math.abs(r)
                  , c = Math.abs(d);
                _ = o.rotatedeg(r, d, l, c),
                s.setRotate(_),
                a.css({
                    rotate: _
                });
                var g = o.getRotateTextNode();
                t(g).text(parseInt(_) + "°").css({
                    display: "block",
                    rotate: 360 - _
                })
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup");
                var i = o.getRotateTextNode();
                i.style.display = "none",
                window.MEMENTO_ID = e.now(),
                "circleSelect" == s._element_type || "elementGroup" == s._element_type ? s.setNewJson() : s.transform = e.transformScale(s.getTransform(), 1 / r.ZOOM_IN),
                o.resizeCursorSet(),
                d.show(s)
            })
        },
        checkImgCover: function(t, i) {
            var o, s = t.getJson(), n = s.transform, r = e.getTransformAttr(n, "translate"), d = t.getShowWidth(), a = t.getShowHeight(), l = {
                top: parseFloat(r[1]),
                right: parseFloat(r[0]) + d,
                bottom: parseFloat(r[1]) + a,
                left: parseFloat(r[0])
            }, c = t._owner_page, g = {
                width: c.width,
                height: c.height
            };
            return o = e.coordinateRotate(0, 0, i, g.width / 2, g.height / 2),
            o.x < l.left || o.x > l.right || o.y < l.top || o.y > l.bottom ? !1 : (o = e.coordinateRotate(g.width, 0, i, g.width / 2, g.height / 2),
            o.x < l.left || o.x > l.right || o.y < l.top || o.y > l.bottom ? !1 : (o = e.coordinateRotate(g.width, g.height, i, g.width / 2, g.height / 2),
            o.x < l.left || o.x > l.right || o.y < l.top || o.y > l.bottom ? !1 : (o = e.coordinateRotate(0, g.height, i, g.width / 2, g.height / 2),
            o.x < l.left || o.x > l.right || o.y < l.top || o.y > l.bottom ? !1 : !0)))
        },
        getRotateTextNode: function() {
            return document.getElementById("edit-rotate-text")
        },
        rotatedeg: function(e, t, i, o) {
            var s, n = 180 * Math.atan(i / o) / Math.PI, r = 5;
            return 0 >= e && 0 > t ? (s = 180 - n,
            s > 135 - r && 135 + r > s ? s = 135 : 90 + r > s ? s = 90 : s > 180 - r && (s = 180)) : e > 0 && 0 >= t ? (s = 180 + n,
            s > 225 - r && 225 + r > s ? s = 225 : 180 + r > s ? s = 180 : s > 270 - r && (s = 270)) : e >= 0 && t > 0 ? (s = 360 - n,
            s > 315 - r && 315 + r > s ? s = 315 : 270 + r > s ? s = 270 : s > 360 - r && (s = 360)) : (s = n,
            s > 45 - r && 45 + r > s ? s = 45 : 0 + r > s ? s = 0 : s > 90 - r && (s = 90)),
            s
        },
        nodeDblclick: function(e) {
            var t = this._owner_element;
            "elementGroup" == t._element_type ? t.groupMousePosition(e) : t.nodeDblclick(e)
        },
        resetHeight: function(e) {
            var i = this.getNode()
              , o = t(i);
            t(".editdiv-clone").size() > 0 && (i = t(".editdiv-clone")[0],
            o = t(".editdiv-clone"));
            var s = i.getBoundingClientRect()
              , n = s.left
              , r = s.top;
            i.style.height = e + "px",
            o.offset({
                left: n,
                top: r
            })
        },
        getWHLT: function(e) {
            var i = this.getNode();
            if (void 0 != e && t(e).parent().hasClass("edit-div-clone")) {
                var o = t(".edit-div-clone")[0];
                return {
                    width: parseFloat(o.style.width) - 1,
                    height: parseFloat(o.style.height) - 1,
                    left: parseFloat(o.style.left),
                    top: parseFloat(o.style.top)
                }
            }
            return {
                width: parseFloat(i.style.width) - 1,
                height: parseFloat(i.style.height) - 1,
                left: parseFloat(i.style.left),
                top: parseFloat(i.style.top)
            }
        },
        resizeMousedown: function(i, o) {
            if (0 != i.button)
                return !1;
            var s = this
              , n = s.getNode()
              , d = (t(n),
            s._owner_element)
              , a = s._owner_design
              , l = a._owner_elementEditbar;
            if ("true" == d.lock)
                return s.setUnLock(),
                l.setLock(i, t(".ele-lock")),
                !1;
            d._focus_drag && d.finishInput(),
            t(".editdiv-clone").size() > 0 && (t(".editdiv-clone").hasClass("editdiv-clone-text") && a._focus_element.finishInput(d),
            a._focus_element = d,
            t(".editdiv-clone").detach());
            var c = s.getWHLT(o);
            l.hideMoreMenu();
            var g = l.getNode()
              , h = t(o);
            h.addClass("resize-hover");
            var f = s.resizeNode(o)
              , u = t(f)
              , p = {
                dom: u,
                x: u.offset().left + u.getWidth() / 2,
                y: u.offset().top + u.getHeight() / 2
            }
              , m = Math.atan(c.height / c.width)
              , _ = {
                x: h.offset().left + h.getWidth() / 2,
                y: h.offset().top + h.getHeight() / 2,
                sin: Math.sin(m),
                cos: Math.cos(m)
            }
              , v = (_.y - p.y) / (_.x - p.x)
              , w = -1 / v
              , y = {
                a: v,
                b: p.y - v * p.x,
                a2: w,
                b2: _.y - w * _.x
            }
              , z = p.x * w + y.b2;
            y.drag = z > p.y;
            var b = !1;
            return t(".edit-div-write-wrap").size() > 0 && ("none" == g.style.display,
            b = !0),
            t(document).mousemove(function(e) {
                s._move_drag = !0;
                var i = e.pageX
                  , n = e.pageY
                  , r = Math.sqrt(y.a * y.a + 1)
                  , a = Math.abs(y.a * i - n + y.b)
                  , l = a / r
                  , g = Math.sqrt((i - _.x) * (i - _.x) + (n - _.y) * (n - _.y))
                  , h = Math.sqrt(g * g - l * l);
                _.x - p.x == 0 && (h = Math.abs(n - _.y));
                var f = h
                  , u = h;
                p.dom.hasClass("edit-resize") && (f = h * _.cos,
                u = h * _.sin);
                var m = f + c.width
                  , v = u + c.height
                  , w = i * y.a2 + y.b2;
                y.drag ? w > n && (m = c.width - f,
                v = c.height - u) : (n > w && (m = c.width - f,
                v = c.height - u),
                isNaN(w) && (p.x > _.x ? i > _.x && (m = c.width - f,
                v = c.height - u) : i < _.x && (m = c.width - f,
                v = c.height - u))),
                b && !t(o).parent().hasClass("edit-div-clone") ? s.resizeSetSvgLayoutWH(m, v) : p.dom.hasClass("edit-resize-rl") ? s.resizeSetWidth(m) : p.dom.hasClass("edit-resize-tb") ? s.resizeSetHeight(v) : p.dom.hasClass("edit-resize") && s.resizeSetWH(m, v),
                t("#edit-data").text(parseInt(d.getShowWidth()) + "," + parseInt(d.getShowHeight())).fadeIn(250),
                t(".size-modal").hide()
            }).mouseup(function() {
                s.resizeCursorSet(),
                t("#edit-data").fadeOut(250),
                t(this).off("mousemove").off("mouseup"),
                h.removeClass("resize-hover"),
                window.MEMENTO_ID = e.now(),
                b && !t(o).parent().hasClass("edit-div-clone") || (d.resetPosition(),
                p.dom.hasClass("edit-resize-rl") ? d.resetWidth() : p.dom.hasClass("edit-resize-tb") ? d.resetHeight() : p.dom.hasClass("edit-resize") && d.resetWH(),
                "elementGroup" !== d._element_type && "circleSelect" !== d._element_type && (d.transform = e.transformScale(d.getTransform(), 1 / r.ZOOM_IN),
                d.seatRectSet()))
            }),
            !1
        },
        resizeNode: function(e) {
            var i, o = e.getAttribute("id"), s = t(e);
            switch (o) {
            case "edit-resize-tl":
                i = s.siblings("#edit-resize-br");
                break;
            case "edit-resize-tr":
                i = s.siblings("#edit-resize-bl");
                break;
            case "edit-resize-bl":
                i = s.siblings("#edit-resize-tr");
                break;
            case "edit-resize-br":
                i = s.siblings("#edit-resize-tl");
                break;
            case "edit-resize-r":
                i = s.siblings("#edit-resize-l");
                break;
            case "edit-resize-l":
                i = s.siblings("#edit-resize-r");
                break;
            case "edit-resize-t":
                i = s.siblings("#edit-resize-b");
                break;
            case "edit-resize-b":
                i = s.siblings("#edit-resize-t");
                break;
            default:
                console.log("放大缩小按钮定位出错")
            }
            return i
        },
        resetEditDivPosition: function() {
            var e = this._owner_element
              , i = e.getLeft()
              , o = e.getTop()
              , s = e.getWidth()
              , n = e.getHeight()
              , r = this.getNode()
              , d = t(r);
            t(".edit-div-clone").size() > 0 ? t(".edit-div-clone").css({
                width: s + 1,
                height: n + 1
            }).offset({
                left: i,
                top: o
            }) : d.css({
                width: s + 1,
                height: n + 1
            }).offset({
                left: i,
                top: o
            });
            this._owner_design
        },
        resizeSetWidth: function(e) {
            1 > e && (e = 1);
            var t = this._owner_design
              , i = t.pageScale
              , o = this._owner_element;
            o.previewWidth(e / i),
            this.resetEditDivPosition()
        },
        resizeSetHeight: function(e) {
            1 > e && (e = 1);
            var t = this._owner_design
              , i = t.pageScale
              , o = this._owner_element;
            o.previewHeight(e / i),
            this.resetEditDivPosition()
        },
        resizeSetWH: function(e, t) {
            var i = e / t;
            t > e ? 1 > e && (e = 1,
            t = e / i) : 1 > t && (t = 1,
            e = t * i);
            var o = this._owner_design
              , s = o.pageScale
              , n = this._owner_element;
            n.previewWH(e / s, t / s),
            this.resetEditDivPosition()
        },
        resizeSetSvgLayoutWH: function(e, t) {
            var i = this._owner_design
              , o = this._owner_element
              , s = i.pageScale;
            o.previewSvgLayoutWH(e / s, t / s),
            this.svgLayoutShow(o)
        }
    },
    e.classExtend(c, s),
    c
});
;/*!/comp/design/widgets/PageList.js*/
"use strict";
define("comp/design/widgets/PageList", ["comp/b", "comp/design/widgets/DataWidget", "widget/pop/pop", "comp/design/design_config", "widget/logreg/logreg", "comp/design/Chuangkit", "comp/config/global_config"], function(e, i, a, t, s, n, r) {
    function g() {
        var e = this;
        o.call(e),
        e.websocketInit(),
        e.loadPage(),
        d.call(e),
        e.getWideList().children(".page-li").eq(0).click()
    }
    function o() {
        var e = this
          , i = e._owner_design;
        e._pages = i.pages;
        var a = e._pages;
        e._height = a[0]._height / a[0]._width * e._width,
        e.pageThumbList = window.PAGE_THUMB_LIST,
        e.pageClickTime = (new Date).getTime()
    }
    function d() {
        var e = this
          , i = e._owner_design
          , a = e.getNode()
          , t = $(a);
        t.find("#pagelist-switch").mousedown(function(e) {
            if (!e.button) {
                var a = $(this).parent();
                "54px" == a.css("right") ? ($(this).removeClass("rightArrow").addClass("leftArrow"),
                a.css("right", "160px")) : ($(this).removeClass("leftArrow").addClass("rightArrow"),
                a.css("right", "54px"));
                var t = i._owner_pageList;
                t.changePageShow()
            }
        }),
        e.getWideList().on("click", "li", function() {
            function a() {
                setTimeout(function() {
                    i.setPageShow(parseInt(n))
                }, 100)
            }
            var t = $(this)
              , s = e.getWideList().find(".now-click").attr("data-index");
            if (void 0 == s && (s = 0),
            t.hasClass("page-add")) {
                if (e.pageAdd(s),
                !window.DESIGN_CHANGE_DRAG)
                    return;
                return void (window.DESIGN_CHANGE_DRAG = !1)
            }
            if (t.find(".no-click").hasClass("now-set"))
                return !1;
            if (!t.hasClass("now-click")) {
                var n = $(this).attr("data-index");
                if (e.setPageNotClick(parseInt(n), a),
                t.addClass("now-click").siblings().removeClass("now-click"),
                e.getStraitList().children("li").eq(n).addClass("now-click").siblings().removeClass("now-click"),
                window.DESIGN_CHANGE_DRAG) {
                    window.DESIGN_CHANGE_DRAG = !1;
                    var r = (new Date).getTime();
                    r - e.pageClickTime > 1e3,
                    e.pageClickTime = r
                }
            }
        }),
        e.getWideList().on("click", ".copy-icon", function() {
            var i = ($(this),
            parseInt($(this).parent().attr("data-index")));
            return e.pageCopy(parseInt(i)),
            !1
        }),
        e.getWideList().on("click", ".del-icon", function() {
            if (!(i.getPageSum() < 2)) {
                var a = ($(this),
                parseInt($(this).parent().attr("data-index")));
                return e.pageDel(a),
                !1
            }
        }),
        e.getStraitList().on("click", "li", function() {
            function a() {
                setTimeout(function() {
                    i.setPageShow(parseInt(n))
                }, 100)
            }
            var t = $(this)
              , s = e.getWideList().find(".now-click").attr("data-index");
            if (void 0 == s && (s = 0),
            t.hasClass("page-add")) {
                if (e.pageAdd(s),
                !window.DESIGN_CHANGE_DRAG)
                    return;
                return void (window.DESIGN_CHANGE_DRAG = !1)
            }
            if (t.find(".no-click").hasClass("now-set"))
                return !1;
            if (!t.hasClass("now-click")) {
                var n = $(this).attr("data-index");
                if (e.setPageNotClick(parseInt(n), a),
                t.addClass("now-click").siblings().removeClass("now-click"),
                e.getWideList().children("li").eq(n).addClass("now-click").siblings().removeClass("now-click"),
                window.DESIGN_CHANGE_DRAG) {
                    window.DESIGN_CHANGE_DRAG = !1;
                    var r = (new Date).getTime();
                    r - e.pageClickTime > 1e3,
                    e.pageClickTime = r
                }
            }
        }),
        e.getStraitList().on("click", ".copy-icon-wrap", function() {
            var i = $(this);
            if (!i.parent().hasClass("open"))
                return e.getStraitList().find(".open").removeClass("open"),
                i.parent().addClass("open"),
                !1;
            var a = parseInt($(this).parent().parent().attr("data-index"));
            return e.pageCopy(parseInt(a)),
            !1
        }),
        e.getStraitList().on("click", ".del-icon-wrap", function() {
            if (!(i.getPageSum() < 2)) {
                var a = ($(this),
                parseInt($(this).parent().parent().attr("data-index")));
                return e.pageDel(a),
                !1
            }
        });
        var s, n = e.getNode();
        n.on("dragstart", ".page-li", function(e) {
            var i = $(this);
            if (!i.find(".no-click").hasClass("now-set"))
                return s = $(this),
                e.stopPropagation(),
                !0
        }),
        n.on("dragenter", ".page-li", function(e) {
            $(e.target);
            return $(this).addClass("drag-enter").siblings().removeClass("drag-enter"),
            e.stopPropagation(),
            !0
        }),
        n.on("dragover", ".page-li", function(e) {
            return e.preventDefault(),
            !0
        }),
        n.on("dragleave", ".page-li", function(e) {
            return e.preventDefault(),
            !0
        }),
        n.on("dragend", ".page-li", function(e) {
            return e.preventDefault(),
            !1
        }),
        n.on("drop", ".page-li", function(a) {
            a.stopPropagation(),
            a.preventDefault();
            var t = parseInt(s.attr("data-index"))
              , n = parseInt($(this).attr("data-index"))
              , r = i.pages
              , g = r[t]._owner_pageEditbar;
            if ($(this).removeClass("drag-enter"),
            t != n) {
                if (n > t) {
                    {
                        var o = e.pageThumbList.splice(t, 1);
                        JSON.parse(JSON.stringify(o))
                    }
                    return e.pageThumbList.splice(n, 0, o[0]),
                    e.setPageThumbList(),
                    g.pageMoveTo(n, !0),
                    !0
                }
                var o = e.pageThumbList.splice(t, 1);
                return e.pageThumbList.splice(n + 1, 0, o[0]),
                e.setPageThumbList(),
                g.pageMoveTo(n + 1, !0),
                !0
            }
        }),
        n.on("mousedown", function(e) {
            e.stopPropagation()
        })
    }
    var l = function(e) {
        var a = this;
        i.call(a),
        a._owner_design = e,
        e._owner_pageList = a,
        g.call(a)
    };
    return l.prototype = {
        constructor: l,
        pageClickTime: 0,
        _pages: null,
        _width: 136,
        _height: null,
        _wideList: !0,
        pageThumbList: [],
        updateSvgMakingList: [],
        ws: null,
        updatePageWaitList: [],
        createWidget: function() {
            var e = $("#pageList");
            return e.append($('<div id="page-switch" class="panelArrowWrap1" style="right: 160px;"><div id="pagelist-switch" class="page-panelArrow leftArrow"></div> </div>')),
            e
        },
        getWideList: function() {
            var e = this
              , i = e.getNode()
              , a = $(i);
            return a.find(".wide-list .page-list")
        },
        getStraitList: function() {
            var e = this
              , i = e.getNode()
              , a = $(i);
            return a.find(".strait-list .page-list")
        },
        pageAdd: function(e) {
            var i = this._owner_design
              , t = (i.pages,
            i.getPageSum())
              , s = i.getCurPage()
              , n = s._owner_pageEditbar;
            if (t >= window.MAX_PAGE)
                return void a.back({
                    str: "页数达到上限",
                    kind: "warning"
                });
            e = parseInt(e);
            var r = {
                requestTime: {},
                thumbnailsUpdateTime: {
                    time: 0
                },
                pageNo: e + 1,
                pageId: parseInt(1e4 * Math.random()),
                taskId: "",
                thumbnailsUrl: ""
            };
            this.pageThumbList.splice(e + 1, 0, r),
            this.setPageThumbList(),
            n.pageAdd(),
            this.savePageThumb()
        },
        pageCopy: function(e) {
            var i = this
              , t = i._owner_design
              , s = t.getPageSum()
              , n = t.pages
              , r = n[e]
              , g = r._owner_pageEditbar;
            return s + 1 >= window.MAX_PAGE && a.back({
                str: "页数达到上限",
                kind: "warning"
            }),
            s >= window.MAX_PAGE ? void a.back({
                str: "页数达到上限",
                kind: "warning"
            }) : (i.pageThumbList.splice(e + 1, 0, JSON.parse(JSON.stringify(i.pageThumbList[e]))),
            i.pageThumbList[e + 1].pageId = parseInt(1e4 * Math.random()),
            i.pageThumbList[e + 1].taskId = "",
            i.setPageThumbList(),
            i.savePageThumb(),
            g.pageCopy(e),
            void i.setPageList())
        },
        pageDel: function(i) {
            var t = this
              , s = t._owner_design
              , n = s.pages
              , r = n[i];
            a.confirm({
                str: "删除页面后当前画布会消失哦！",
                yes: "继续删除",
                successfun: function() {
                    t.pageThumbList.splice(i, 1),
                    t.setPageThumbList(),
                    t.savePageThumb(),
                    window.MEMENTO_ID = e.now(),
                    s.setPageScale(),
                    s.removePageAndUndo(r);
                    {
                        var a = t.getNode();
                        $(a)
                    }
                    t.getWideList().children("li").eq(i).remove(),
                    t.getStraitList().children("li").eq(i).remove(),
                    t.setPageList();
                    var n = i > 0 ? i - 1 : 0;
                    t.getWideList().children("li").eq(n).click(),
                    t.getStraitList().children("li").eq(n).click()
                }
            })
        },
        setPageList: function() {
            for (var e = this, i = e.getWideList().children("li"), a = e.getStraitList().children("li"), t = i.size(), s = 0; t > s; s++)
                i.eq(s).attr("data-index", s),
                i.eq(s).find(".page-no").text(s + 1),
                a.eq(s).attr("data-index", s),
                a.eq(s).find(".page-no").text(s + 1)
        },
        setPageThumbList: function() {
            for (var e = this.pageThumbList, i = 0; i < e.length; i++)
                e[i].pageNo = i
        },
        movePage: function(e, i) {
            var a = this
              , t = a.getWideList()
              , s = t.children(".page-li").eq(e)
              , n = a.getStraitList()
              , r = n.children(".page-li").eq(e);
            i > e ? (n.children(".page-li").eq(i).after(r),
            t.children(".page-li").eq(i).after(s)) : (n.children(".page-li").eq(i).before(r),
            t.children(".page-li").eq(i).before(s)),
            a.setPageList(),
            a.savePageThumb(),
            a.getNode().hasClass("strait-list-wrap") ? r.click() : s.click()
        },
        changePageShow: function() {
            var e = this
              , i = e.getNode();
            i.hasClass("strait-list-wrap") ? (i.removeClass("strait-list-wrap"),
            $(".customerServiceBtn").css("right", "170px")) : (i.addClass("strait-list-wrap"),
            $(".customerServiceBtn").css("right", "66px"))
        },
        changePageWh: function() {
            var e = this
              , i = e._pages;
            e._height = i[0]._height / i[0]._width * e._width,
            e.loadPage()
        },
        setPageNotClick: function(e, i) {
            var a = this
              , t = a.getWideList()
              , s = a.getStraitList();
            t.find(".no-click").addClass("now-set").show(),
            s.find(".no-click").addClass("now-set").show(),
            t.find(".no-click").addClass("now-set").eq(e).hide(),
            s.find(".no-click").addClass("now-set").eq(e).hide(),
            i()
        },
        setPageClick: function() {
            var e = this;
            e.getWideList().find(".no-click").removeClass("now-set").hide(),
            e.getStraitList().find(".no-click").removeClass("now-set").hide()
        },
        loadPage: function() {
            var e, i, a, t, s = this, n = s._pages, r = s.getWideList().find(".page-add"), g = s.getStraitList().find(".page-add");
            s.getWideList().find(".page-li").remove(),
            s.getStraitList().find(".page-li").remove();
            for (var o = 0; o < n.length; o++) {
                a = s.pageThumbList[o],
                t = a.thumbnailsUrl + "@136w_100Q_1x.jpg?v=" + a.thumbnailsUpdateTime.time,
                e = $('<li id="pageThumb' + a.pageId + '" class="page-li" draggable="true" data-index="' + o + '" style="height:' + (s._height + 12) + 'px"><div class="page-content"><img class="img-loading" width="100%" height="100%" src=""></div><span class="copy-icon" title="复制此页"></span><span class="del-icon" title="删除此页"></span><span class="page-no">' + (o + 1) + '</span><div class="no-click"></div></li>');
                var d = new Image;
                d.alt = o,
                d.onload = function() {
                    var e = $(this).attr("alt");
                    s.getWideList().find(".page-li").eq(e).find("img").attr("src", $(this).attr("src")).removeClass("img-loading")
                }
                ,
                d.src = t,
                r.before(e),
                i = $('<li class="page-li" draggable="true" data-index="' + o + '"><div class="page-operate"><span class="copy-icon-wrap operate-item" title="复制此页"><span class="copy-icon operate-icon"></span></span><span class="del-icon-wrap operate-item" title="删除此页"><span class="del-icon operate-icon"></span></span></div><p class="page-no">' + (o + 1) + '</p><div class="no-click"></div></li>'),
                g.before(i)
            }
            s._owner_design
        },
        updateWaitPages: function() {
            for (var e = this.updatePageWaitList.length, i = 0; e > i; i++)
                this.updatePage(this.updatePageWaitList.pop())
        },
        updatePage: function(e) {
            return
        },
        savePageThumb: function() {
            if (window.ISEXIST) {
                for (var e = this, i = e.pageThumbList.length, t = [], n = [], r = 0; i > r; r++)
                    t.push(e.pageThumbList[r].thumbnailsUrl),
                    n.push(e.pageThumbList[r].taskId);
                var g = t.join(",");
                $.ajax({
                    url: "/design/setThumbnails.do",
                    type: "POST",
                    dataType: "json",
                    data: {
                        d: window.DESIGN_ID,
                        tid: window.TEAM_ID > 0 ? window.TEAM_ID : 0,
                        urls: g,
                        ids: n.join(",")
                    },
                    success: function(i) {
                        var t = i.code;
                        if (-2 == t)
                            s.show();
                        else if (0 >= t)
                            a.back({
                                str: "保存画布缩略图出错！",
                                kind: "warning"
                            });
                        else if (1 == t)
                            for (var n = i.taskIds, r = 0; r < n.length; r++)
                                e.pageThumbList[r].taskId = n[r]
                    },
                    error: function() {
                        console.log("保存设计画布缩略图地址error!")
                    }
                })
            }
        },
        updatePageNode: function(e, i) {
            for (var a, t, s = this, n = new Image, r = s.pageThumbList, g = 0; g < r.length; g++)
                r[g].pageId == e && (a = r[g].thumbnailsUrl,
                t = g);
            if (a = a + "@136w_100Q_1x.jpg?v=" + (new Date).getTime(),
            n.src = a,
            n.onload = function() {
                $("#pageThumb" + e).find("img").attr("src", a).removeClass("img-loading")
            }
            ,
            i) {
                var o = this._owner_design;
                o._owner_designEditbar.updateThumbOpen(t)
            }
        },
        addPage: function(e, i, a) {
            var t = this
              , s = t.getWideList().children("li").eq(i)
              , n = t.getStraitList().children("li").eq(i)
              , r = t.pageThumbList[i]
              , g = $('<li id="pageThumb' + r.pageId + '" class="page-li" draggable="true" data-index="' + i + '" style="height:' + (t._height + 12) + 'px"><div class="page-content"><img class="img-loading" width="100%" height="100%" src=""></div><span class="copy-icon" title="复制此页"></span><span class="del-icon" title="删除此页"></span><span class="page-no">' + (i + 1) + '</span><div class="no-click"></div></li>');
            s.before(g);
            var o = r.thumbnailsUrl + "@136w_100Q_1x.jpg?v=" + (new Date).getTime()
              , d = new Image;
            d.alt = i,
            d.onload = function() {
                var e = $(this).attr("alt");
                t.getWideList().find(".page-li").eq(e).find("img").attr("src", o).removeClass("img-loading")
            }
            ,
            d.src = o;
            var l = $('<li class="page-li" draggable="true" data-index="' + i + '"><div class="page-operate"><span class="copy-icon-wrap operate-item" title="复制此页"><span class="copy-icon operate-icon"></span></span><span class="del-icon-wrap operate-item" title="删除此页"><span class="del-icon operate-icon"></span></span></div><p class="page-no">' + (i + 1) + "</p></li>");
            n.before(l),
            t.setPageList(),
            a || ("block" === $(".wide-list").css("display") ? g.click() : l.click())
        },
        websocketInit: function() {
            var e = this
              , i = new WebSocket(r.WEBSOCKETDOMAIN + "/ws/design.ws?d=" + window.DESIGN_ID + "&tid=" + window.TEAM_ID);
            e.ws = i,
            i.onopen = function() {
                setInterval(function() {
                    i.send("ckt")
                }, 1e4)
            }
            ,
            i.onmessage = function(a) {
                var t = JSON.parse(a.data);
                if (2 == t.reptype)
                    for (var s = t.params.pageId, n = t.params.thumbnailUrl, r = e.pageThumbList, g = 0; g < r.length; g++)
                        if (r[g].pageId == s) {
                            if (r[g].taskId = t.params.taskId,
                            window.TEMPLATE_PAGE_THUMB_NO == t.params.pageNo)
                                window.TEMPLATE_PAGE_THUMB_NO = null,
                                r[g].making = !1;
                            else if (r[g].thumbnailsUrl = n,
                            e.updatePageNode(r[g].pageId, !0),
                            r[g].svg) {
                                var t = {
                                    reqtype: 1,
                                    params: {
                                        pn: r[g].pageNo,
                                        pid: r[g].pageId,
                                        content: r[g].svg
                                    }
                                };
                                t = JSON.stringify(t),
                                t = t.replace(/NS1\:/g, ""),
                                r[g].making = !0,
                                r[g].svg = null,
                                i.send(t)
                            } else
                                r[g].making = !1;
                            break
                        }
            }
            ,
            i.onerror = function() {
                console.log("websocket 生成画布缩略图 error！")
            }
        },
        makePageThumbWS: function(e) {
            var i = this
              , a = i.ws
              , t = i.pageThumbList;
            if (1 == a.OPEN) {
                for (var s = 0; s < t.length; s++)
                    if (t[s].pageId == e.pageId) {
                        if (t[s].making)
                            t[s].pageNo = e.pageNo,
                            t[s].svg = e.svg;
                        else if (1 == a.readyState) {
                            var n = {
                                reqtype: 1,
                                params: {
                                    pn: e.pageNo,
                                    pid: e.pageId,
                                    content: e.svg
                                }
                            };
                            n = JSON.stringify(n),
                            n = n.replace(/NS1\:/g, ""),
                            t[s].making = !0,
                            t[s].svg = null,
                            a.send(n)
                        }
                        break
                    }
            } else
                for (var s = 0; s < t.length; s++)
                    t[s].pageId == e.pageId && (t[s].svg = e.svg,
                    t[s].pageNo = e.pageNo)
        }
    },
    e.classExtend(l, i),
    l
});
;/*!/comp/design/toolbar/DesignEditbar.js*/
"use strict";
define("comp/design/toolbar/DesignEditbar", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/Widget", "comp/design/toolbar/toolbar_config", "comp/design/Toolbar", "comp/design/widgets/Page", "comp/design/widgets/Design", "libs/jquery/jquery.qrcode.min", "libs/jquery/jPages", "libs/jquery/jquery.zeroclipboard", "comp/design/design_config", "widget/pop/pop", "widget/cooperative/cooperative", "widget/logreg/logreg", "libs/clipboard.min"], function(e, i, t, n, a, s, o, d, r, c, l, p, h, g, u, w) {
    function f() {
        var e = this;
        e.show(),
        _.call(e),
        m.call(e),
        D.call(e)
    }
    function _() {
        var e = this
          , t = e._owner_design;
        e._min_scale = t._minPageScale,
        e._max_scale = t._maxPageScale,
        e._change_scale = (e._max_scale - e._min_scale) / 10;
        var n = t.pages[0];
        (n.width > 1e4 || n.height > 1e4) && (e._change_scale = (e._max_scale - e._min_scale) / 20),
        e._now_scale = t.pageScale;
        var a = t.pageScale
          , s = i(e.getNode()[2]);
        s.find(".design-scale-num").children().html(parseInt(100 * a) + "%")
    }
    function m() {
        var n = this
          , s = n._owner_design
          , o = s.getCurPage()
          , d = i(n.getNode()[0])
          , r = i(n.getNode()[1])
          , c = i(n.getNode()[2]);
        window.ISEXIST || i(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .design_size_move, .design_change_sence, .print-design").addClass("design-no-click"),
        r.find(".design_copy").mousedown(function(t) {
            if (e.addSomeMouseClick("上方-复制设计"),
            i(this).hasClass("design-no-click"))
                return !1;
            if (0 != t.button)
                return !1;
            o.nodeMousedown();
            var a = {
                designId: window.DESIGN_ID
            };
            window.TEAM_ID > 0 && (a.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (a.c = !0),
            i.ajax({
                url: "/design/copyDesign.do",
                type: "post",
                dataType: "json",
                data: a,
                success: function(e) {
                    var t, a = e.newDesignIds;
                    t = window.TEAM_ID > 0 ? "&tid=" + window.TEAM_ID : "",
                    window.open("/mod/design/design.html?d=" + a[0] + t),
                    n.popHide(i(".pop-wrap"))
                }
            })
        }),
        r.find(".design_open").mousedown(function(i) {
            return 0 != i.button ? !1 : (window.open("/designmanage"),
            void e.addSomeMouseClick("上方-打开设计"))
        }),
        r.find(".design_size_move").mousedown(function(t) {
            if (e.addSomeMouseClick("上方-调整尺寸"),
            i(this).hasClass("design-no-click"))
                return !1;
            if (0 != t.button)
                return !1;
            var a = n._owner_design
              , s = a.getCurPage();
            s.nodeMousedown();
            var o = i('<div class="change-page-mask" style="z-index: 10002; width: 100%;height: 100%;top: 0px; left: 0px;position: absolute;background-color: rgba(0,0,0,.3)"></div>');
            i("body").append(o),
            o.click(function() {
                i(".new-size-cancel").trigger("click")
            });
            var d = i("#changePageSize")
              , r = (i("#rightPanel").outerWidth() - i("#pageList").outerWidth()) / 2;
            return d.css("left", r + "px"),
            "true" == a.bleed ? (a.hideBleed(),
            d.attr("data-bleed-on", "true")) : d.attr("data-bleed-on", "false"),
            d.find(".width-size").val(parseInt(window.DESIGN_ORIGINAL_WIDTH)).attr({
                "data-old": window.DESIGN_WIDTH,
                "data-old-unit": window.DESIGN_ORIGINAL_WIDTH
            }),
            d.find(".height-size").val(parseInt(window.DESIGN_ORIGINAL_HEIGHT)).attr({
                "data-old": window.DESIGN_HEIGHT,
                "data-old-unit": window.DESIGN_ORIGINAL_HEIGHT
            }),
            a.setPageScale(),
            d.fadeIn(200),
            i(".page-on-focus").find(".page_size").fadeIn(200),
            d.addClass("now-set"),
            !1
        }),
        S.call(n),
        r.find(".design_change_sence").mousedown(function(t) {
            if (e.addSomeMouseClick("上方-智能场景变换"),
            0 != t.button)
                return !1;
            if (i(this).hasClass("design-no-click"))
                return !1;
            var s = a.getChangesence();
            return window.ISVIP || window.TEAM_ID > 0 ? (s.find(".sure-but").removeClass("notVipMember").html("确认调整"),
            s.find(".jion-vip").css("display", "none")) : s.find(".sure-but").addClass("notVipMember").html("升级成为VIP会员"),
            n.popShow(s, {}),
            !1
        }),
        r.find(".design_set").mousedown(function(i) {
            if (e.addSomeMouseClick("上方-置入设计"),
            0 != i.button)
                return !1;
            var t = a.getMydesign();
            return n.popShow(t, {}),
            Y(n, !0),
            !1
        }),
        r.find(".design_save").mousedown(function(i) {
            return e.addBugTrackClick("d1"),
            0 != i.button ? !1 : (o.nodeMousedown(),
            void t.saveDesign(!0))
        }),
        y.call(n),
        d.find(".ppt-show").mousedown(function(e) {
            return i(this).hasClass("design-no-click") ? !1 : 0 != e.button ? !1 : (t.saveDesign(),
            void window.open("/h/show.html?d=" + DESIGN_ID))
        }),
        d.find(".page-list-design").mousedown(function() {
            var e = s._owner_pageList;
            e.changePageShow()
        }),
        i("#design_title").children().change(function() {
            var e = i("#design_title").children().val()
              , t = /[\/\/\\:*?"<>\/|]/g;
            t.test(e) && (h.back({
                str: '设计名不能包括以下任何字符 \\ / : * ? " < > |',
                kind: "warning"
            }),
            e = e.replace(t, ""),
            console.log(e)),
            i("#design_title").children().val(e),
            s.saveDesignTitle(e)
        }),
        c.find(".design-scale-add").mousedown(function(i) {
            if (e.addSomeMouseClick("画布-放大"),
            e.addBugTrackClick("a7"),
            0 != i.button)
                return !1;
            o.nodeMousedown();
            var t = s.pageScale + n._change_scale;
            return n.changeDesignScale(t, !0),
            !1
        }),
        c.find(".design-scale-sub").mousedown(function(i) {
            if (e.addSomeMouseClick("画布-缩小"),
            e.addBugTrackClick("a7"),
            0 != i.button)
                return !1;
            o.nodeMousedown();
            var t = s.pageScale - n._change_scale;
            return n.changeDesignScale(t, !0),
            !1
        }),
        c.find(".design-scale-one").mousedown(function(i) {
            if (e.addBugTrackClick("a8"),
            0 != i.button)
                return !1;
            o.nodeMousedown(),
            e.addSomeMouseClick("画布-实际大小");
            var t = 1;
            return n.changeDesignScale(t, !0),
            !1
        }),
        c.find(".design-scale-screen").mousedown(function(i) {
            if (e.addBugTrackClick("a8"),
            0 != i.button)
                return !1;
            o.nodeMousedown(),
            e.addSomeMouseClick("画布-合适大小");
            var t = n._now_scale;
            return n.changeDesignScale(t),
            !1
        });
        for (var l = i("#pageScaleWrap"), p = window.DESIGN_WIDTH, w = window.DESIGN_HEIGHT, f = p / w; p * w > 1e4; )
            p -= 10,
            w = 1 / f * p;
        l.find(".page-thumb").attr({
            "data-width": p,
            "data-height": w
        }).on("mousedown", function(e) {
            e.stopPropagation()
        }),
        l.on("mousedown", ".scale-switch", function(e) {
            var t = i(this);
            t.hasClass("thumb-close") ? (t.removeClass("thumb-close"),
            l.find(".page-thumb").css({
                width: "0px",
                height: "0px",
                padding: "0px"
            })) : (t.addClass("thumb-close"),
            n.pageThumbOpen()),
            e.stopPropagation()
        }),
        n.pageThumbOpen(),
        l.find(".page-area").on("mousedown", function(e) {
            var t = (i(this),
            e.pageX)
              , a = e.pageY;
            s.getCurPage().nodeMousedown();
            var o = i("#pageScaleWrap").find(".page-area")
              , d = {
                top: o.offset().top,
                right: o.offset().left + o.innerWidth(),
                bottom: o.offset().top + o.innerHeight(),
                left: o.offset().left
            }
              , r = i("#pageScaleWrap").find(".page-thumb")
              , c = {
                top: r.offset().top,
                right: r.offset().left + r.outerWidth() - 4,
                bottom: r.offset().top + r.outerHeight() - 4,
                left: r.offset().left
            }
              , l = i(".page-on-focus")
              , p = {
                top: l.offset().top,
                left: l.offset().left
            };
            e.stopPropagation(),
            i(document).mousemove(function(e) {
                var i, s, r = e.pageX, l = e.pageY, h = r - t, g = l - a, u = {
                    top: d.top + g,
                    right: d.right + h,
                    bottom: d.bottom + g,
                    left: d.left + h
                };
                i = u.top <= c.top ? c.top : u.top,
                u.bottom >= c.bottom && (i = c.bottom - o.innerHeight()),
                s = u.left <= c.left ? c.left : u.left,
                u.right >= c.right && (s = c.right - o.innerWidth()),
                o.offset({
                    left: s,
                    top: i
                }),
                n.setPagePosition(p, {
                    y: i - d.top,
                    x: s - d.left
                }),
                e.stopPropagation()
            }).mouseup(function() {
                i(this).off("mousemove").off("mouseup")
            })
        }),
        d.find(".set-team-cooperate").click(function() {
            g.show(window.DESIGN_ID, window.TEAM_ID)
        }),
        d.find(".set-team-template").mousedown(function(n) {
            if (window.TEAM_ID <= 0 || i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-设置为团队模板"),
            0 != n.button)
                return !1;
            o.nodeMousedown(),
            t.saveDesign();
            var a = {
                ids: DESIGN_ID,
                tid: window.TEAM_ID
            };
            window.COOPERATE_DESIGN && (a.c = !0),
            i.ajax({
                url: "/designtemplate/setAsTeamTemplate.do",
                type: "POST",
                dataType: "json",
                data: a,
                error: function() {
                    h.back({
                        str: "设置团队模版失败！",
                        kind: "warning"
                    })
                },
                success: function(e) {
                    var i = e.code;
                    h.back(1 == i ? {
                        str: "设置团队模版成功！",
                        kind: "success"
                    } : {
                        str: "设置团队模版失败！",
                        kind: "warning"
                    })
                }
            })
        }),
        i("#designTitle").find(".undo").mousedown(function(i) {
            return e.addSomeMouseClick("上方-撤销"),
            e.addBugTrackClick("b1"),
            0 != i.button ? !1 : (o.nodeMousedown(),
            void s.undoMemento())
        }),
        i("#designTitle").find(".redo").mousedown(function(i) {
            return e.addSomeMouseClick("上方-撤销"),
            e.addBugTrackClick("b2"),
            0 != i.button ? !1 : (o.nodeMousedown(),
            void s.redoMemento())
        }),
        d.find(".download-design").mousedown(function(s) {
            if (i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-下载"),
            0 != s.button)
                return !1;
            if (o.nodeMousedown(),
            i(".design-click").size() > 0)
                return n.popHide(i(".pop-wrap")),
                !1;
            var d = i(this);
            d.addClass("design-click"),
            t.saveDesign();
            var r = a.getDownload();
            n.popShow(r, {})
        }),
        d.find(".quit-design").mousedown(function() {
            window.location.href = "/dc.html"
        }),
        L.call(n),
        d.find(".share-design").click(function() {
            return i(this).hasClass("design-no-click") ? (i(this).find("ul").hide(),
            !1) : void i(this).find("ul").toggle(200)
        }),
        d.find(".share-design-li").mousedown(function(s) {
            if (i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-分享"),
            0 != s.button)
                return !1;
            if (o.nodeMousedown(),
            i(".design-click").size() > 0)
                return n.popHide(i(".pop-wrap")),
                !1;
            var d = i(this);
            d.parent().hide(),
            i(".share-design").addClass("design-click"),
            t.saveDesign();
            var r = {
                d: window.DESIGN_ID,
                udspk: 0
            };
            window.TEAM_ID > 0 && (r.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (r.c = !0),
            i.ajax({
                url: "/design/getDesignV3.do",
                type: "POST",
                dataType: "json",
                data: r,
                error: function() {
                    window.clearInterval(n._download_rate),
                    W(),
                    alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")分享失败。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
                },
                success: function(e) {
                    if (1 == e.shareState || 3 == e.shareState) {
                        var t = e.shareState;
                        e.state = 3,
                        K(e, n, t)
                    } else if (2 == e.shareState || 4 == e.shareState) {
                        var t = e.shareState;
                        e.state = 3;
                        var s = a.getShareTitle();
                        s.find(".password_zone").children("input").val(e.sharePwd),
                        K(e, n, t)
                    } else {
                        var o = a.getShareTitle();
                        o.find(".share_box").css("display", "block"),
                        o.find(".success_share_box, .private_share_box, .private_share_failed").css("display", "none"),
                        o.find(".design_name").removeClass("design_name_tips");
                        var s = a.getShareTitle();
                        s.find(".design_name").val(i("#design_title").children().val()),
                        n.popShow(o, {})
                    }
                }
            })
        }),
        d.find(".print-design").mousedown(function(e) {
            if (i(this).hasClass("design-no-click"))
                return !1;
            if (0 != e.button)
                return !1;
            if (o.nodeMousedown(),
            i(".design-click").size() > 0)
                return n.popHide(i(".pop-wrap")),
                !1;
            t.saveDesign();
            var a = {
                d: window.DESIGN_ID,
                type: 13
            };
            window.TEAM_ID > 0 && (a.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (a.c = !0),
            i.ajax({
                url: "/design/addMakeImageTask.do",
                type: "POST",
                dataType: "json",
                data: a,
                success: function(e) {
                    var i = e.code;
                    1 == i ? (n.waitPopShow(),
                    n.blackShow(),
                    v.call(n)) : -4 == i ? u.show() : h.back({
                        str: "生成设计缩略图出错！",
                        kind: "error"
                    })
                },
                error: function() {
                    console.log("添加生成设计缩略图任务错误!")
                }
            })
        }),
        d.find(".active-design-li").mousedown(function(s) {
            if (i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-参加活动"),
            0 != s.button)
                return !1;
            if (o.nodeMousedown(),
            i(".design-click").size() > 0)
                return n.popHide(i(".pop-wrap")),
                !1;
            var d = i(this);
            d.parent().hide(),
            i(".share-design").addClass("design-click"),
            t.saveDesign(),
            i.ajax({
                url: "/activity/isJoined.do",
                type: "POST",
                dataType: "json",
                data: {
                    designId: window.DESIGN_ID
                },
                error: function() {
                    window.clearInterval(n._download_rate),
                    W(),
                    alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")参加活动失败。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
                },
                success: function(e) {
                    var i = a.getActive()
                      , t = i.find(".publish")
                      , s = i.find(".publish-success");
                    0 == e.code ? (t.hide(),
                    s.show(),
                    s.find(".link-input").val(window.location.origin + "/activecenter/share?workId=" + e.workId),
                    s.find(".open-link").attr("href", window.location.origin + "/activecenter/share?workId=" + e.workId),
                    s.find(".already-join").attr("href", "/activecenter/active?id=" + e.activityId),
                    n.popShow(i, {})) : 1 == e.code ? (s.hide(),
                    t.show(),
                    t.find(".name-input").val(""),
                    t.find(".description-input").val(""),
                    t.find(".selected-active-title").text("").attr("data-active", ""),
                    n.popShow(i, {})) : h.back({
                        str: "查询是是否已参加活动失败！",
                        kind: "error"
                    })
                }
            })
        }),
        Q.call(n),
        R.call(n),
        k.call(n),
        I.call(n)
    }
    function v() {
        var e = this
          , t = {
            d: window.DESIGN_ID,
            type: 13
        };
        window.TEAM_ID > 0 && (t.tid = window.TEAM_ID),
        window.COOPERATE_DESIGN && (t.c = !0),
        i.ajax({
            url: "/design/getMakeImageState.do",
            type: "POST",
            dataType: "json",
            data: t,
            success: function(t) {
                if (t.code < 0)
                    return void h.back({
                        str: "生成设计缩略图出错！",
                        kind: "error"
                    });
                if (t.state > 3)
                    return void h.back({
                        str: "生成设计缩略图出错！",
                        kind: "error"
                    });
                if (3 == t.state) {
                    i(".black-main").fadeOut(100),
                    W();
                    var n = a.getGoToPrint();
                    return void h.dialog(n[0])
                }
                setTimeout(function() {
                    v.call(e)
                }, 2e3)
            },
            error: function() {
                console.log("获取去印刷生成设计缩略图状态失败！")
            }
        })
    }
    function I() {
        var e = a.getGoToPrint();
        e.find(".cancel").click(function() {
            h.dialogHide()
        }),
        e.find(".confirm").attr("href", "/orderdetails?d=" + window.DESIGN_ID)
    }
    function k() {
        var e = this
          , t = a.getConfirm();
        t.find(".confirm-false").click(function() {
            t.css("display", "none"),
            i(".pop-wrap").css("z-index", "20000")
        }),
        t.find(".confirm-true").click(function() {
            t.css("display", "none"),
            e.confirmTrue()
        })
    }
    function D() {
        i(".design_present_size").html("当前尺寸为 ： " + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT).attr("title", "当前尺寸为 ： " + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT);
        var e = a.getCanvasSize();
        e.find(".old_size").children("span").html(window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT + "&nbsp;&nbsp;( 宽 * 高 )"),
        e.find(".unit_count").text(window.DESIGN_ORIGINAL_UNIT);
        var t = a.getChangesence();
        t.find(".old-sence").children("span").html(DESIGN_KIND_TITLE + "&nbsp;&nbsp;" + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT + "&nbsp;&nbsp;( 宽 * 高 )"),
        t.find(".sence-input").html(DESIGN_KIND_TITLE + " " + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT),
        t.find(".sence-input").attr("data-width", parseFloat(window.DESIGN_ORIGINAL_WIDTH) + window.DESIGN_ORIGINAL_UNIT),
        t.find(".sence-input").attr("data-height", parseFloat(window.DESIGN_ORIGINAL_HEIGHT) + window.DESIGN_ORIGINAL_UNIT),
        t.find(".sence-input").attr("data-title", DESIGN_KIND_TITLE),
        t.find(".sence-input").attr("data-id", KIND_ID),
        0 == t.find(".design_kind_list").children(".design_kind_li").size() && b.call(this)
    }
    function b() {
        var e = this
          , t = a.getChangesence()
          , n = t.find(".design_kind_list");
        i.ajax({
            url: "/home/getDesignType.do",
            dataType: "json",
            type: "POST",
            success: function(i) {
                var t = i.result;
                e._design_kind = t;
                var a = t.length;
                window.DESIGN_PRINT_KIND_LIST = [];
                for (var s = 0; a > s; s++) {
                    var o = t[s]
                      , d = '<li class="design_kind_title">' + o.pKindName + "</li>";
                    n.append(d);
                    for (var r = o.designKind, c = r.length, l = 0; c > l; l++) {
                        var p = r[l]
                          , h = '<li class="design_kind_li" data-title="' + p.kindTitle + '" data-width="' + p.kindWidth + '" data-height="' + p.kindHeight + '" data-id="' + p.kindId + '">' + p.kindTitle + " " + p.kindWidth + " * " + p.kindHeight + "</li>";
                        n.append(h),
                        p.isPrint && window.DESIGN_PRINT_KIND_LIST.push(p.kindId)
                    }
                }
                var g = '<li class="design_kind_li custom_kind_li" data-title="自定义">自定义</li>';
                n.append(g)
            },
            error: function() {
                console.log("返回designkind失败")
            }
        })
    }
    function S() {
        var e = this;
        i(".page_size_top, .page_size_bottom");
        var t = i("#changePageSize");
        t.on("mousedown", function(e) {
            e.stopPropagation()
        }),
        t.on("click", ".new-size-cancel", function() {
            t.fadeOut(200),
            i(".page_size").fadeOut(200),
            i(".change-page-mask").remove()
        }),
        t.on("keyup", ".new-size", function() {
            {
                var e = i(this);
                e.val()
            }
        });
        var n, a, s, o;
        "cm" == window.DESIGN_ORIGINAL_UNIT ? (n = 1,
        a = (.3937008 * n * 300).toFixed(8),
        s = 200,
        o = 200) : "mm" == window.DESIGN_ORIGINAL_UNIT ? (n = 10,
        a = (.3937008 * n * 30).toFixed(8),
        s = 2e3,
        o = 2e3) : (n = 40,
        a = n,
        s = 1e4,
        o = 25e3),
        t.on("click", ".new-size-confirm", function() {
            function a() {
                e._owner_design.changePageWH(d, r),
                window.DESIGN_ORIGINAL_WIDTH = c + window.DESIGN_ORIGINAL_UNIT,
                window.DESIGN_ORIGINAL_HEIGHT = l + window.DESIGN_ORIGINAL_UNIT,
                t.fadeOut(200),
                D.call(e),
                i(".preview-page-all").each(function() {
                    i(this).remove()
                }),
                i(".page_preview").css("display", "none"),
                h.back({
                    str: "尺寸调整成功"
                }),
                e._owner_design.clearMemento(),
                t.removeClass("now-set"),
                i(".page_size").fadeOut(200),
                e.reseatPageThumb();
                var n = i("#pageScaleWrap").find(".scale-switch");
                n.hasClass("thumb-close") && n.trigger("mousedown"),
                "true" == t.attr("data-bleed-on") && e._owner_design.showBleed(),
                e._owner_design._owner_pageList.changePageWh(),
                i(".change-page-mask").remove()
            }
            var d, r, c = parseFloat(t.find(".width-size").val()), l = parseFloat(t.find(".height-size").val());
            "cm" == window.DESIGN_ORIGINAL_UNIT ? (d = (.3937008 * c * 300).toFixed(8),
            r = (.3937008 * l * 300).toFixed(8)) : "mm" == window.DESIGN_ORIGINAL_UNIT ? (d = (.3937008 * c * 30).toFixed(8),
            r = (.3937008 * l * 30).toFixed(8)) : (d = c,
            r = l);
            var p = !1
              , g = !1;
            if (isNaN(c) || "" == c || parseInt(c) < n || parseInt(c) > s ? t.find(".width-size").addClass("warning") : (t.find(".width-size").removeClass("warning"),
            p = !0),
            isNaN(l) || "" == l || parseInt(l) < n || parseInt(l) > o ? t.find(".height-size").addClass("warning") : (t.find(".height-size").removeClass("warning"),
            g = !0),
            p && g)
                if (c < parseInt(window.DESIGN_WIDTH) || l < parseInt(window.DESIGN_HEIGHT)) {
                    var u = {
                        str: '新尺寸小于原尺寸，将对画布进行裁剪，超出画布的元素将<span style="color:red">丢失</span>，并且将会<span style="color:red">清空撤销步骤</span>，是否继续尺寸调整',
                        successfun: a
                    };
                    h.confirm(u)
                } else {
                    var u = {
                        str: '调整尺寸后不能撤销，将会<span style="color:red">清空撤销步骤</span>，是否继续调整尺寸',
                        successfun: a
                    };
                    h.confirm(u)
                }
            else
                h.back({
                    str: "宽高只能为数字，并且最大为" + s + "*" + o + "，最小为" + n + "*" + n,
                    kind: "warning"
                })
        });
        var d = i(".page_size_bottom_btn");
        d.on("mousedown", function(t) {
            t.stopPropagation(),
            i(this).addClass("show_num");
            var n, s, r, c = t.pageY, l = e._owner_design, p = l.pageScale, h = l.getCurPage(), g = i(h.getNode()), u = window.DESIGN_HEIGHT * p, w = 0;
            i(document).mousemove(function(e) {
                if (++w,
                !(3 > w)) {
                    if (w = 0,
                    s = e.pageY,
                    n = s - c,
                    r = u + n,
                    a >= r / p)
                        return !1;
                    if (r / p >= o)
                        return !1;
                    g.css("height", r + "px"),
                    r /= p,
                    window.DESIGN_HEIGHT = r,
                    l.changePageWH(window.DESIGN_WIDTH, r)
                }
            }).mouseup(function() {
                i(this).off("mousemove").off("mouseup"),
                d.removeClass("show_num"),
                setTimeout(function() {}, 1e3),
                l._owner_pageList.changePageWh()
            })
        })
    }
    function y() {
        var n = this
          , s = a.getCanvasSize();
        s.find(".close-button").click(function() {
            n.popHide(s)
        });
        var o = a.getChangesence();
        o.find(".close-but").click(function() {
            n.popHide(i(".pop-wrap"))
        });
        var d = a.getMydesign();
        d.find(".close-but").click(function() {
            n.popHide(i(".pop-wrap"))
        }),
        d.on("click", ".accross_list_get_vip", function(e) {
            e.stopPropagation()
        }),
        d.on("click", ".accross_list", function() {
            var t = i(this);
            if (t.hasClass("no-click") || t.hasClass("now-click")) {
                d.animate({
                    left: "+=150px"
                }, {
                    easing: "easeOutQuint"
                });
                var s = a.getMyDesignPage();
                return s.animate({
                    left: "+=150px",
                    opacity: "0"
                }, {
                    easing: "easeOutQuint",
                    complete: function() {
                        i(this).css("display", "none")
                    }
                }),
                i(".accross_list").removeClass("no-click"),
                void i(".accross_list").removeClass("now-click")
            }
            if (t.hasClass("multipage_show_li")) {
                i(".accross_list").not(this).each(function() {
                    i(this).addClass("no-click")
                }),
                t.addClass("now-click"),
                T(t);
                var s = a.getMyDesignPage();
                return d.animate({
                    left: "-=150px"
                }, {
                    easing: "easeOutQuint"
                }),
                s.css({
                    left: parseFloat(d.css("left")) + d.width() + 20,
                    top: parseFloat(d.css("top")),
                    display: "block",
                    opacity: "0"
                }),
                s.appendTo("body"),
                void s.animate({
                    left: "-=150px",
                    opacity: "1"
                }, {
                    easing: "easeOutQuint"
                })
            }
            window.MEMENTO_ID = e.now();
            var o = i(this).attr("data-id");
            C(n, o, 0),
            n.popHide(d)
        }),
        d.on("click", ".pic_list", function() {
            N(n)
        }),
        d.on("click", ".word_li", function() {
            var e = i(this);
            i(".word_li.now-click").removeClass("now-click"),
            e.addClass("now-click");
            var t = e.text();
            i(".pic_list").text(t),
            "none" == i(".list_word").css("display") ? i(".list_word").show() : i(".list_word").hide(),
            Y(n, !0),
            A()
        }),
        d.on("click", ".sort_new", function() {
            var e = i(this);
            G(n, e)
        }),
        d.on("click", ".sort_list", function() {
            "none" == i(".sort_word").css("display") ? i(".sort_word").show() : i(".sort_word").hide()
        }),
        d.on("click", ".sort_li", function() {
            var e = i(this);
            P(n, e)
        }),
        d.on("click", ".file_top", function() {
            var e = i(".file_content_all");
            "block" == e.css("display") ? (e.hide(),
            i(".file_tips").hide()) : (e.show(),
            M())
        }),
        d.on("click", ".file_create", function() {
            var e = i(this);
            O(n, e)
        }),
        d.on("click", ".file_creates", function() {
            var e = i(this);
            O(n, e)
        });
        var o = a.getChangesence();
        o.click(function() {
            var e = o.find(".design_kind_list");
            o.find(".sence-input").removeClass("now-click"),
            e.css("display", "none")
        }),
        o.find(".sence-input").click(function() {
            var e = i(this)
              , t = o.find(".design_kind_list");
            return e.hasClass("now-click") ? (t.css("display", "none"),
            e.removeClass("now-click")) : (t.css("display", "block"),
            e.addClass("now-click")),
            !1
        }),
        o.on("click", ".design_kind_li", function() {
            var e = i(this)
              , t = o.find(".design_kind_list")
              , n = o.find(".sence-input");
            t.css("display", "none");
            var a = e.html();
            if (n.html(a),
            n.removeClass("now-click"),
            e.hasClass("custom_kind_li"))
                return o.find(".size-count").css("display", "block"),
                o.find(".size_instrution").css("display", "block"),
                o.css("height", "435px"),
                n.removeAttr("data-width"),
                n.removeAttr("data-height"),
                n.attr("data-id", "127"),
                n.attr("data-title", "自定义px"),
                !1;
            o.find(".size-count").css("display", "none"),
            o.find(".size_instrution").css("display", "none"),
            o.css("height", "325px");
            var s = e.attr("data-width")
              , d = e.attr("data-height")
              , r = e.attr("data-id")
              , c = e.attr("data-title");
            return n.attr("data-width", s),
            n.attr("data-height", d),
            n.attr("data-id", r),
            n.attr("data-title", c),
            !1
        }),
        o.find(".download-checkbox").click(function() {
            var e = i(this);
            e.toggleClass("download-checkbox-click")
        }),
        o.find(".sure-but").click(function() {
            if (i(this).hasClass("notVipMember"))
                return window.open("/price?p=1"),
                e.addSomeMouseClick("上方-智能变换会员入口"),
                !1;
            var a = o.find(".download-checkbox")
              , s = !1;
            a.hasClass("download-checkbox-click") && (s = !0);
            var d = parseInt(DESIGN_WIDTH)
              , r = parseInt(DESIGN_HEIGHT)
              , c = o.find(".sence-input")
              , l = c.attr("data-width") || o.find(".wd_count").val()
              , g = c.attr("data-height") || o.find(".ht_count").val()
              , u = c.attr("data-id") || 127
              , w = c.attr("data-title");
            i(".preview-page-all").each(function() {
                i(this).remove()
            }),
            i(".page_preview").find(".page-edit-bar-text").text("开启预览"),
            6 != u && 4 != u && 20 != u ? i(".page_preview").css("display", "none") : (i(".page_preview").css("display", "block"),
            i(".page_preview").removeClass("preview-showing no-click"));
            var f = !0
              , _ = !0;
            if (127 == u && (isNaN(l) || "" == l || parseInt(l) < 40 || parseInt(l) > 5e3 ? (o.find(".wd_count").addClass("design_name_tips"),
            f = !1) : f = !0,
            isNaN(g) || "" == g || parseInt(g) < 40 || parseInt(g) > 5e3 ? (o.find(".ht_count").addClass("design_name_tips"),
            f = !1) : _ = !0),
            !f || !_)
                return alert("宽高只能为数字，并且最大为5000"),
                !1;
            o.find(".wd_count").removeClass("design_name_tips"),
            o.find(".ht_count").removeClass("design_name_tips"),
            window.DESIGN_ORIGINAL_WIDTH = l,
            window.DESIGN_ORIGINAL_HEIGHT = g;
            var m = /cm/
              , v = /mm/;
            if (l.match(m) ? (l = (.3937008 * parseFloat(l) * 300).toFixed(8),
            g = (.3937008 * parseFloat(g) * 300).toFixed(8),
            window.DESIGN_ORIGINAL_UNIT = "cm") : l.match(v) ? (l = (.3937008 * parseFloat(l) * 30).toFixed(8),
            g = (.3937008 * parseFloat(g) * 30).toFixed(8),
            window.DESIGN_ORIGINAL_UNIT = "mm") : (l = parseFloat(l).toFixed(8),
            g = parseFloat(g).toFixed(8),
            window.DESIGN_ORIGINAL_UNIT = "px"),
            d == parseInt(l) && r == parseInt(g))
                n.popHide(o);
            else {
                var I = n._owner_design;
                n.popConfirm("变换后不能撤销，将会<span style='color:red'>清空撤销步骤</span>，是否继续变换场景", function() {
                    var e = {
                        designId: DESIGN_ID,
                        kindId: u
                    };
                    window.TEAM_ID > 0 && (e.tid = window.TEAM_ID),
                    window.COOPERATE_DESIGN && (e.c = !0),
                    i.ajax({
                        url: "/design/updateKindIdOfDesign.do",
                        dataType: "json",
                        type: "POST",
                        data: e,
                        success: function() {
                            I.changeDesignKind(l, g),
                            window.KIND_ID = u;
                            for (var e = !1, a = 0; a < window.DESIGN_PRINT_KIND_LIST.length; a++)
                                if (window.DESIGN_PRINT_KIND_LIST[a] == u) {
                                    e = !0;
                                    break
                                }
                            e ? i(".print-design").show() : i(".print-design").hide(),
                            window.DESIGN_KIND_TITLE = w,
                            n.popHide(o),
                            D.call(n),
                            i("#templateShow").children(".templateLi").remove(),
                            i("#collectionTemplate").children(".templateLi").remove(),
                            i("#templateShow").children(".nohaveTipsTemplate").remove(),
                            t.queryTemplate({
                                pageNo: 1,
                                pageSize: p.MATERIAL_PAGE_SIZE,
                                secondKindId: KIND_ID,
                                timeOrder: 1
                            }, "templateShow"),
                            h.back({
                                str: "场景变化成功"
                            }),
                            I.clearMemento()
                        },
                        error: function() {
                            console.log("更改分类错误")
                        }
                    })
                })
            }
        });
        var r = a.getMyDesignPage();
        r.on("click", ".sence-change-page-thumb", function() {
            var e = i(this).attr("data-id")
              , t = i(this).attr("data-index");
            C(n, e, t),
            n.popHide(i(".pop-wrap"))
        })
    }
    function T(e) {
        var i = a.getMyDesignPage()
          , t = e.find(".accross_list_title").html()
          , n = e.attr("data-id")
          , s = e.attr("data-size");
        i.find(".sence-change-page-title").html(t + " ( " + s + "页 )"),
        i.find(".sence-change-page-thumb-wrap").children().detach();
        for (var o = e.find(".accross_list_img").attr("src").split("@")[0], d = e.find(".accross_list_img").width(), r = e.find(".accross_list_img").height(), c = 0; s > c; c++) {
            var l;
            l = 0 == c ? o + "@230w_100Q_1x.jpg" : o + "_" + c + "@230w_100Q_1x.jpg";
            var p = '<li style="width:' + d + "px;height:" + r + 'px" data-id="' + n + '" data-index="' + c + '" class="sence-change-page-thumb"><img src="' + l + '" alt="" style="width:' + d + "px;height:" + r + 'px"><div class="sence-change-page-thumb-hover"></div></li>';
            i.find(".sence-change-page-thumb-wrap").append(p)
        }
    }
    function C(e, t, n) {
        var a = e._owner_design
          , s = {
            d: t
        };
        window.TEAM_ID > 0 && (s.tid = window.TEAM_ID),
        i.ajax({
            url: "/design/getDesignV3.do",
            type: "POST",
            dataType: "json",
            data: s,
            error: function() {
                alert("参数错误")
            },
            success: function(i) {
                (1 == i.loginTimeOut || "权限不足" == i.error) && alert("权限不足");
                var t = i.design_json;
                e._owner_design.postingDesign(t, {
                    i: n,
                    page: a.getCurPage()
                }),
                h.back({
                    str: "置入我的设计成功"
                })
            }
        })
    }
    function E(e, t) {
        var n = {
            d: DESIGN_ID,
            type: e
        };
        window.TEAM_ID > 0 && (n.tid = window.TEAM_ID),
        window.COOPERATE_DESIGN && (n.c = !0),
        n.resultType = i(".sure_download_phone").hasClass("no-click") ? 1 : 0,
        i.ajax({
            url: "/design/getMakeImageState.do",
            type: "POST",
            dataType: "json",
            data: n,
            error: function() {
                window.clearInterval(t._download_rate),
                W(),
                alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成遇到特殊问题。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
            },
            success: function(e) {
                j(e, t, n.type)
            }
        })
    }
    function N(e) {
        "none" == i(".list_word").css("display") ? i(".list_word").show() : i(".list_word").hide(),
        x(e)
    }
    function x(e) {
        for (var t = e._design_kind, n = t.length, a = 0; n > a; a++)
            for (var s = t[a].designKind, o = s.length, d = 0; o > d; d++) {
                var r = s[d]
                  , c = '<li class="word_li" data-id="' + r.kindId + '">' + r.kindTitle + "</li>";
                i(".list_word").append(c)
            }
    }
    function G(e, t) {
        i(".pic_list").attr("data-id");
        t.children(".reflush").hasClass("reflush_click") ? t.children(".reflush").removeClass("reflush_click") : t.children(".reflush").addClass("reflush_click"),
        Y(e, !0)
    }
    function P(e, t) {
        var n = t.text();
        i(".sort_list").text(n),
        i(".sort_li.now-click").removeClass("now-click"),
        i(".sort_word").hide(),
        t.addClass("now-click"),
        Y(e, !0),
        A()
    }
    function M() {
        i.ajax({
            url: "/design/queryUserFolders.do",
            dataType: "json",
            type: "POST",
            success: function(e) {
                null == e.folderList ? ($ = [],
                H()) : ($ = e.folderList,
                H())
            }
        })
    }
    function H() {
        if (i(".file_create").detach(),
        0 == $.length)
            ;
        else
            for (var e = $.length, t = 0; e > t; t++) {
                var n = $[t]
                  , a = '<div class="file_create" data-id="' + n.folder_id + '"><span class="file_close"></span><span class="file_designer">' + n.folder_name + '</span><span class="write"></span><span class="delete_file"></span><span class="file_size">' + n.design_count + "</span></div>";
                i(".file_content_all").append(a)
            }
    }
    function O(e, t) {
        i(".file_creates .now-file").removeClass("now-file"),
        t.addClass("now-file");
        var n = t.children(".file_designer").text();
        t.parents(".file_content_all").siblings(".file_designer").text(n);
        var a = t.children(".file_size").text();
        t.parents(".file_content_all").siblings(".file_size").text(a),
        Y(e, !0),
        A()
    }
    function A() {
        i(".accross_list_all").children().detach(),
        i("#page_list").removeAttr("data-page-no"),
        i("#page_list").children().detach()
    }
    function j(e, t, n) {
        var s = e;
        if (-1 == s.code)
            return window.clearInterval(t._download_rate),
            z(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”参数错误“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (-2 == s.code)
            return window.clearInterval(t._download_rate),
            z(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”权限不足“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (-3 == s.code)
            return window.clearInterval(t._download_rate),
            z(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”图片类型错误“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (-4 == s.code)
            return window.clearInterval(t._download_rate),
            z(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”登录超时“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (4 == s.state)
            return window.clearInterval(t._download_rate),
            z(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”超时“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (5 == s.state || 6 == s.state)
            return window.clearInterval(t._download_rate),
            z(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成遇到特殊问题。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (3 == s.state) {
            window.clearInterval(t._download_rate);
            var o = s.url;
            if (i(".sure_download_phone").hasClass("no-click")) {
                i("#download-wait, .black-main").fadeOut(200);
                var d = a.getDownloadPhone()
                  , r = e.token;
                o = window.location.protocol + "//" + window.location.hostname + "/download?did=" + window.DESIGN_ID + "&type=" + n + "&token=" + r,
                d.find(".download-text").text("使用微信扫一扫，扫码下载"),
                d.find(".qrcode").empty().qrcode({
                    width: 166,
                    height: 166,
                    correctLevel: 0,
                    text: o
                }),
                t.popShow(d, {}),
                clearTimeout(window.PHONE_DOWNLOAD_DESIGN_CLOCK),
                window.PHONE_DOWNLOAD_DESIGN_CLOCK = setTimeout(function() {
                    d.find(".download-text").text("二维码已过期，请重新下载")
                }, 1e3 * e.exp)
            } else
                z(),
                i("#f").attr("src", o)
        } else if (1 == s.state || 2 == s.state) {
            var c = a.getDownloadWait();
            4 == n ? c.find(".download-wait-title").html("如页数/内容较多生成时间会较长(10min左右)").next().show().text("请耐心等待...") : c.find(".download-wait-title").html("设计生成中...").next().show().text("请稍等1分钟左右")
        }
    }
    function z() {
        var e = a.getDownloadWait();
        e.animate({
            top: (i(window).getHeight() - e.getHeight()) / 2 - 20,
            opacity: 0
        }, {
            easing: "easeOutQuint",
            complete: function() {
                i(this).css("display", "none"),
                i(".black-main").css("display", "none")
            }
        })
    }
    function W() {
        var e = a.getThumbWait();
        e.animate({
            top: (i(window).getHeight() - e.getHeight()) / 2 - 20,
            opacity: 0
        }, {
            easing: "easeOutQuint",
            complete: function() {
                i(this).css("display", "none"),
                i(".black-main").css("display", "none")
            }
        })
    }
    function L() {
        var t = this
          , n = a.getDownload()
          , s = n.find(".download-pdf")
          , o = {
            name: "design_page_download_pdf",
            element: s[0],
            position_left: 83,
            position_top: 6,
            color: "#07AEFC"
        };
        h.pointOut(o),
        n.find(".closeBtn").click(function() {
            t.popHide(n)
        });
        var d = a.getDownloadPhone();
        d.find(".closeBtn").click(function() {
            t.popHide(d)
        }),
        n.find(".download-checkbox").mousedown(function() {
            var e = i(this);
            e.parent().find(".download-checkbox-click").removeClass("download-checkbox-click"),
            e.addClass("download-checkbox-click")
        }),
        n.find(".download-radio").mousedown(function() {
            var e = i(this);
            e.parent().find(".download-radio-click").removeClass("download-radio-click"),
            e.addClass("download-radio-click")
        }),
        n.find(".sure_download, .sure_download_phone").click(function() {
            i(".sure_download, .sure_download_phone").removeClass("no-click"),
            i(this).addClass("no-click");
            var s = {
                d: DESIGN_ID,
                type: 0
            };
            if ("block" == i(".download-img-content").css("display")) {
                var o = i(".quality").find(".download-checkbox-click").attr("data-quality")
                  , d = i(".type").find(".download-radio-click").attr("data-type");
                s.type = 5,
                1 == d && (s.jpg = 1),
                (window.ISVIP || window.TEAM_ID > 0) && (s.opa = 1);
                var r = i(".split").find(".download-radio-click").attr("data-split");
                s.join = r;
                var c = i(".choose_page").find(".download-radio-click").attr("data-page");
                if (2 == c) {
                    var l = i(".download-img-content").find(".select_box").val()
                      , p = t.testPageNum(l);
                    if ("false" == p)
                        return alert("非法字符，或者页码超过最大值"),
                        !1;
                    s.range = p
                }
            }
            if ("block" == i(".download-pdf-content").css("display")) {
                var o = i(".download-pdf").find(".download-checkbox-click").attr("data-quality")
                  , d = i(".type_pdf").find(".download-radio-click").attr("data-type");
                s.type = 3 == o ? 3 : 6;
                var c = i(".choose_pdf").find(".download-radio-click").attr("data-page");
                if (2 == c) {
                    var l = i(".download-pdf-content").find(".select_box").val()
                      , p = t.testPageNum(l);
                    if ("false" == p)
                        return alert("非法字符，或者页码超过最大值"),
                        !1;
                    s.range = p
                }
            }
            if ("block" == i(".download-ppt-content").css("display")) {
                var d = i(".type_ppt").find(".download-radio-click").attr("data-type");
                4 == d && (s.type = 4);
                var c = i(".choose_ppt").find(".download-radio-click").attr("data-page");
                if (2 == c) {
                    var l = i(".download-ppt-content").find(".select_box").val()
                      , p = t.testPageNum(l);
                    if ("false" == p)
                        return alert("非法字符，或者页码超过最大值"),
                        !1;
                    s.range = p
                }
            }
            var h = a.getDownloadWait();
            window.ISVIP ? h.find(".download-wait-title").html("尊敬的VIP用户，<br />您的设计将会优先生成。").next().hide() : h.find(".download-wait-title").html("设计生成排队中...").next().html("PS：加入VIP可以免去排队时间优先生成哦~"),
            t.downloadWaitShow(),
            1 == s.jpg ? 2 == s.type ? (e.addBugTrackClick("c1"),
            e.addSomeMouseClick("下载-jpg-标准"),
            1 == s.join ? e.addSomeMouseClick("下载-jpg-标准-无缝") : 2 == s.join) : 5 == s.type && (e.addBugTrackClick("c1"),
            e.addSomeMouseClick("下载-jpg-高清"),
            1 == s.join ? e.addSomeMouseClick("下载-jpg-高清-无缝") : 2 == s.join) : 2 == s.type ? (e.addBugTrackClick("c2"),
            e.addSomeMouseClick("下载-png-标准"),
            2 == s.join && e.addSomeMouseClick("下载-png-标准-有缝")) : 5 == s.type ? (e.addBugTrackClick("c2"),
            e.addSomeMouseClick("下载-png-高清"),
            2 == s.join && e.addSomeMouseClick(" 下载-png-高清-有缝")) : 3 == s.type ? (e.addBugTrackClick("c3"),
            e.addSomeMouseClick("下载-pdf-标准")) : 6 == s.type ? (e.addBugTrackClick("c4"),
            e.addSomeMouseClick("下载-pdf-印刷")) : 4 == s.type && (e.addBugTrackClick("c5"),
            e.addSomeMouseClick("下载-ppt")),
            window.TEAM_ID > 0 && (s.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (s.c = !0),
            i.ajax({
                url: "/design/addMakeImageTask.do",
                type: "POST",
                dataType: "json",
                data: s,
                success: function() {
                    t._download_rate = setInterval(function() {
                        E(s.type, t)
                    }, 3e3),
                    i(".download-design").removeClass("design-click"),
                    n.css("display", "none")
                }
            })
        }),
        n.find(".content-wrap-title").click(function() {
            var e = i(this);
            if (e.hasClass("content-wrap-title-click"))
                return !1;
            if (i(".content-wrap-title-click").removeClass("content-wrap-title-click"),
            e.addClass("content-wrap-title-click"),
            i(".download-content").css("display", "none"),
            e.hasClass("download-img"))
                i(".download_list").css("height", "340px"),
                n.find(".sure_download_phone").show(),
                n.find(".download-ppt-tips").hide();
            else if (e.hasClass("download-pdf")) {
                i(".download_list").css("height", "242px");
                var t = e.find(".point-out-circle");
                if (t.length > 0) {
                    var t = t[0];
                    h.pointOutHide(t)
                }
                n.find(".sure_download_phone").hide(),
                n.find(".download-ppt-tips").hide()
            } else
                i(".download_list").css("height", "152px"),
                n.find(".sure_download_phone").hide(),
                n.find(".download-ppt-tips").show();
            e.children("ul").css("display", "block")
        });
        var r = a.getDownloadPhone();
        r.find(".return-btn").click(function() {
            i("#download_phone, .black-main").fadeOut(200),
            t.popShow(n, {})
        })
    }
    function Q() {
        function e() {
            var t = {
                d: window.DESIGN_ID,
                type: 12
            };
            window.TEAM_ID > 0 && (t.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (t.c = !0),
            i.ajax({
                url: "/design/getMakeImageState.do",
                type: "POST",
                dataType: "json",
                data: t,
                error: function() {
                    W(),
                    h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "error"
                    })
                },
                success: function(t) {
                    var n = t.state
                      , a = t.code;
                    if (1 == a)
                        if (3 == n)
                            i("#thumb-wait").fadeOut(),
                            r.popShow(s, {});
                        else {
                            if (n > 3)
                                return W(),
                                void h.back({
                                    str: "发布分享作品失败，请稍后重试！",
                                    kind: "error"
                                });
                            n >= 0 && setTimeout(function() {
                                e()
                            }, 3e3)
                        }
                    else
                        -4 == a ? (W(),
                        u.show()) : (W(),
                        h.back({
                            str: "发布分享作品失败，请稍后重试！",
                            kind: "error"
                        }))
                }
            })
        }
        function t(e) {
            i.ajax({
                url: "/activity/list.do",
                type: "POST",
                dataType: "json",
                data: {
                    pageNo: 1,
                    pageSize: 100
                },
                success: function(n) {
                    var a = n.code
                      , s = o.find(".active-list");
                    if (0 == a)
                        s.empty();
                    else if (1 == a) {
                        for (var d = n.page.recordData, r = 0; r < d.length; r++) {
                            for (var c = d[r].designKinds, l = !1, p = 0; p < c.length; p++)
                                c[p].kindId == window.KIND_ID && (l = !0);
                            var h = new Date(d[r].end).getTime()
                              , g = (new Date).getTime();
                            g > h && (l = !1);
                            var u = i('<li data-active="' + d[r].activityId + '">' + d[r].activityName + "</li>");
                            l || u.addClass("no-click"),
                            s.append(u)
                        }
                        e < n.page.pageTotal && t(e++)
                    }
                },
                error: function() {
                    h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "error"
                    })
                }
            })
        }
        var n = {
            shareHref: "",
            shareTitle: "创客贴活动",
            thumbnail: "http://eyuankupub.oss-cn-beijing.aliyuncs.com/sys/weixinorcode.png",
            thunbnailweibo: "",
            desc: "我参加了本次活动，快来给点赞！我和奖品就差个你了～",
            summary: "我参加了本次活动，快来给点赞！我和奖品就差个你了～",
            Qzonedesc: "",
            contentMate: "utf-8",
            QzoneShareHref: "",
            site: "创客贴www.chuangkit.com"
        }
          , s = a.getActive()
          , o = s.find(".publish")
          , d = s.find(".publish-success")
          , r = this;
        s.on("click", ".closeBtn", function() {
            r.popHide(s)
        }),
        d.on("click", ".social-icon", function() {
            n.shareHref = d.find(".link-input").val();
            var e = i(this);
            if (e.hasClass("weixin")) {
                var t = a.getActiveWeixinShare();
                t.find(".active-weixin-qrcode").empty().qrcode({
                    width: 160,
                    height: 160,
                    correctLevel: 0,
                    text: n.shareHref
                }),
                r.popHide(s),
                r.popShow(t, {})
            } else if (e.hasClass("qq")) {
                var o = "http://connect.qq.com/widget/shareqq/index.html?url=" + n.shareHref + "&title=" + n.shareTitle + "&site=" + n.site + "&summary=" + n.summary + "&pics=" + n.thumbnail + "&desc=" + n.Qzonedesc;
                window.open(o)
            } else if (e.hasClass("weibo")) {
                var o = "http://service.weibo.com/share/share.php?url=" + n.shareHref + "&content=" + n.contentMate + "&title=" + n.desc + "&pic=" + n.thumbnailweibo + "&appkey=3818167868";
                window.open(o)
            }
        }),
        o.on("keyup", ".name-input", function() {
            var e = i(this).val().length;
            i(this).next().text(e + "/20")
        }),
        o.on("click", ".selected-active", function() {
            o.find(".active-list").toggle(100)
        }),
        o.on("click", ".active-list li", function() {
            var e = i(this);
            return e.hasClass("no-click") ? !1 : void o.find(".selected-active-title").text(e.text()).attr("data-active", e.attr("data-active"))
        }),
        d.find(".link-input").mouseenter(function() {
            i(this).focus().select()
        });
        var c = d.find(".copy-btn")
          , l = new w(c[0]);
        l.on("success", function() {
            c.text("复制成功").css("color", "#27c383")
        }),
        l.on("error", function() {
            h.back({
                str: "复制失败，请手动复制链接到剪贴板。",
                kind: "warning"
            })
        }),
        o.on("click", ".join-now", function() {
            var t = o.find(".name-input").val()
              , n = o.find(".description-input").val()
              , a = o.find(".selected-active-title").attr("data-active");
            return t.length <= 0 ? (h.back({
                str: "请填写作品名称！",
                kind: "warning"
            }),
            !1) : n.length <= 0 ? (h.back({
                str: "请填写作品描述！",
                kind: "warning"
            }),
            !1) : a.length <= 0 ? (h.back({
                str: "请选择要参加的活动！",
                kind: "warning"
            }),
            !1) : void i.ajax({
                url: "/activity/publishWork.do",
                type: "POST",
                dataType: "json",
                data: {
                    workName: t,
                    workDesc: n,
                    designId: window.DESIGN_ID,
                    aid: a
                },
                success: function(i) {
                    var t = i.code;
                    1 == t ? (d.find(".link-input").val(window.location.origin + "/activecenter/share?workId=" + i.workId),
                    d.find(".open-link").attr("href", window.location.origin + "/activecenter/share?workId=" + i.workId),
                    d.find(".already-join").attr("href", "/activecenter/active?id=" + a + "&order=0&pageNo=1"),
                    o.hide().next().show(),
                    s.hide(),
                    r.waitPopShow(),
                    e()) : 3 == t ? u.show() : h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "warning"
                    })
                },
                error: function() {
                    h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "error"
                    })
                }
            })
        }),
        t(1)
    }
    function R() {
        var t = a.getShareTitle()
          , n = this;
        t.find(".design_name").val(i("#design_title").children().val()),
        t.find(".publick_share_button, .private_share_button").click(function() {
            if (i(this).hasClass("not-share"))
                return !1;
            var a = i(this).attr("shareType");
            if (2 == a && (e.addSomeMouseClick("私密分享"),
            0 == window.ISVIP && window.TEAM_ID <= 0))
                return i(".get_vip_btn").click(function() {
                    e.addSomeMouseClick("私密分享-会员入口")
                }),
                t.find(".share_box").css("display", "none"),
                t.find(".private_share_failed").css({
                    display: "block"
                }).animate({
                    opacity: 1
                }, {
                    easing: "easeOutQuint"
                }),
                void i(".share").css({
                    top: "-=100px"
                });
            if (1 == a && e.addSomeMouseClick("公开分享"),
            "" == i(".design_name").val())
                i(".design_name").addClass("design_name_tips");
            else {
                var s = i(".design_name").val();
                i("#design_title").children().val(s);
                var o = n._owner_design;
                o.saveDesignTitle(s),
                i(".design_name").removeClass("design_name_tips");
                var d;
                i(".select_share").hasClass("select_share_click") ? (d = 1,
                e.addSomeMouseClick("分享-设计改动")) : d = 0;
                var r = "";
                n.waitPopShow();
                var c = {
                    d: DESIGN_ID,
                    ty: a,
                    a: d,
                    ti: s,
                    de: r
                };
                window.TEAM_ID > 0 && (c.tid = window.TEAM_ID),
                window.COOPERATE_DESIGN && (c.c = !0),
                i.ajax({
                    url: "/share/makeShareV3.do",
                    type: "POST",
                    dataType: "json",
                    data: c,
                    success: function(e) {
                        n._download_rate = setInterval(function() {
                            B(d, n, a)
                        }, 3e3),
                        2 == a && e.p && t.find(".password_zone").children("input").val(e.p),
                        t.css("display", "none")
                    }
                })
            }
        });
        var s = t.find("#copyLink")
          , o = new l(s);
        o.on("copy", function(i) {
            var n = t.find("#public_share_link").val();
            i.clipboardData.setData("text/plain", n),
            s.children("p").text("复制成功").css("color", "#27c383"),
            e.addSomeMouseClick("公开分享-复制链接")
        });
        var d = t.find(".password_copy_btn")
          , r = new l(d);
        r.on("copy", function(i) {
            var n = t.find("#private_share_link").val()
              , a = t.find("#private_share_password").val()
              , s = "链接: " + n + " 密码: " + a;
            i.clipboardData.setData("text/plain", s),
            t.find(".copy_link_success").show(),
            e.addSomeMouseClick("私密分享-复制链接密码")
        });
        var c = l.state();
        (1 == c.flash.disabled || null == c.flash.disabled) && (d.click(function() {
            alert("复制失败，请手动复制链接到剪贴板。")
        }),
        s.click(function() {
            alert("复制失败，请手动复制链接到剪贴板。")
        })),
        t.find("#public_share_link, #private_share_link").mouseenter(function() {
            i(this).focus().select()
        }),
        t.find(".share_button_question").mouseenter(function() {
            i(this).next().css("display", "block")
        }).mouseleave(function() {
            i(this).next().css("display", "none")
        }),
        t.find(".mail_send").click(function() {
            if ("" != i(this).prev().children("input").val() && /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(i(this).prev().children("input").val())) {
                e.addSomeMouseClick("分享-发送"),
                i(this).prev().children("input").removeClass("design_name_tips");
                var t = i(this).prev().children("input").val()
                  , a = (i(".link_address").children().val(),
                {
                    email: t,
                    designId: DESIGN_ID
                });
                window.TEAM_ID > 0 && (a.tid = window.TEAM_ID),
                window.COOPERATE_DESIGN && (a.c = !0),
                i.ajax({
                    url: "/design/shareDesignByEmail.do",
                    type: "POST",
                    dataType: "json",
                    data: a,
                    error: function() {},
                    success: function() {
                        alert("发送成功"),
                        n.popHide(i(".pop-wrap"))
                    }
                })
            } else
                i(this).prev().children("input").addClass("design_name_tips")
        }),
        t.find(".closeBtn").click(function() {
            n.popHide(t),
            t.find(".copy_link_success").hide(),
            s.children("p").text("复制链接").css("color", "#515151")
        }),
        t.find(".stop_share").click(function() {
            e.addSomeMouseClick("分享-停止分享");
            var t = {
                d: DESIGN_ID,
                ty: 0
            };
            window.TEAM_ID > 0 && (t.tid = window.TEAM_ID),
            i.ajax({
                url: "/share/makeShareV3.do",
                type: "POST",
                dataType: "json",
                data: t,
                error: function() {
                    window.clearInterval(n._download_rate),
                    W(),
                    alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")取消分享失败。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
                },
                success: function() {
                    i(".success_share_box").hide(),
                    i(".private_share_box").hide(),
                    i(".private_share_failed").hide(),
                    i(".share_box").show(),
                    i(".share").css({
                        top: "+=100px"
                    })
                }
            })
        }),
        t.find(".select_share").click(function() {
            i(this).hasClass("select_share_click") ? i(this).removeClass("select_share_click") : i(this).addClass("select_share_click")
        });
        a.getShare();
        t.find(".same_zone").click(function() {
            if (i(this).hasClass("not-share"))
                return !1;
            var t;
            return i(this).hasClass("zone_qq") ? (t = "Qzone",
            e.addSomeMouseClick("分享-qq空间")) : i(this).hasClass("zone_qqfriend") ? (t = "qq",
            e.addSomeMouseClick("分享-qq")) : i(this).hasClass("zone_weibo") ? (t = "weibo",
            e.addSomeMouseClick("分享-微博")) : i(this).hasClass("zone_renren") ? (t = "renren",
            e.addSomeMouseClick("分享-人人")) : (t = "weixin",
            e.addSomeMouseClick("分享-微信")),
            F(t, n),
            !1
        }),
        t.find(".public_share_edit").click(function() {
            i(this).hasClass("select_share_edit") ? q(window.DESIGN_ID, 1, i(this)) : q(window.DESIGN_ID, 3, i(this))
        }),
        t.find(".private_share_edit").click(function() {
            i(this).hasClass("select_share_edit") ? q(window.DESIGN_ID, 2, i(this)) : q(window.DESIGN_ID, 4, i(this))
        })
    }
    function q(e, t, n) {
        i.ajax({
            url: "/share/updatePublishState.do",
            type: "POST",
            dataType: "json",
            data: {
                d: e,
                s: t
            },
            success: function(e) {
                1 == e.code ? 1 == t || 2 == t ? n.removeClass("select_share_edit") : n.addClass("select_share_edit") : -2 == e.code ? u.show() : h.back({
                    str: "更新分享状态错误！",
                    kind: "warning"
                })
            },
            error: function() {
                h.back({
                    str: "更新分享状态错误！",
                    kind: "warning"
                })
            }
        })
    }
    function F(e, t) {
        if ("weixin" == e) {
            t.popHide(i(".share"), !0);
            var n = a.getShareYes();
            n.appendTo("body").css({
                top: function() {
                    return "weixin" == e ? (i(window).getHeight() - 260) / 2 + 20 : (i(window).getHeight() - 110) / 2 + 20
                }(),
                left: (i(window).getWidth() - n.getWidth()) / 2,
                display: "block"
            }).animate({
                top: function() {
                    return "weixin" == e ? (i(window).getHeight() - 260) / 2 : (i(window).getHeight() - 110) / 2
                }(),
                opacity: 1
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    n.find(".share-yes-content").text("生成缩略图成功，请扫描下面二维码"),
                    n.css({
                        height: "260px"
                    }),
                    n.find(".share-yes-btn").css("display", "none"),
                    n.find(".share-yes-img").css("display", "block"),
                    n.find(".share-yes-img").children().detach(),
                    n.find(".share-yes-img").qrcode({
                        width: 160,
                        height: 160,
                        correctLevel: 0,
                        text: t.shareConfig.shareHref
                    })
                }
            })
        } else
            window.open(t.shareFun()[e])
    }
    function B(e, t, n) {
        var a = {
            d: DESIGN_ID,
            a: e
        };
        window.TEAM_ID > 0 && (a.tid = window.TEAM_ID),
        window.COOPERATE_DESIGN && (a.c = !0),
        i.ajax({
            url: "/share/getMakeShareImageStatus.do",
            type: "POST",
            dataType: "json",
            data: a,
            error: function() {
                window.clearInterval(t._download_rate),
                W(),
                alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成遇到特殊问题。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
            },
            success: function(e) {
                K(e, t, n)
            }
        })
    }
    function K(e, t, n) {
        if (3 == e.state) {
            window.clearInterval(t._download_rate);
            var s;
            s = void 0 == e.url ? e.imgurl : e.url,
            s = s + "?" + Date.parse(new Date),
            t.shareConfig.shareHref = "http://www.chuangkit.com/mod/share/share.html?d=" + DESIGN_ID,
            t.shareConfig.thumbnailweibo = "https:" + s + "||" + t.shareConfig.thumbnail,
            t.shareConfig.QzoneShareHref = "http://www.chuangkit.com/mod/share/share.html?d%3D" + DESIGN_ID;
            var o = i("#design_title").children("input").val();
            t.shareConfig.shareTitle = o;
            var d = a.getThumbWait();
            d.animate({
                top: (i(window).getHeight() - d.getHeight()) / 2 - 20,
                opacity: 0
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    i(this).css("display", "none")
                }
            }),
            1 == n || 3 == n ? V(t, n) : (2 == n || 4 == n) && U(t, n)
        }
    }
    function V(e, t) {
        var n = a.getShareTitle();
        n.find(".share_box").css("display", "none"),
        n.find(".success_share_box").css("display", "block"),
        e.popShow(n, {}),
        i(".design_title").children().val(i(".design_name").val()),
        i(".link_address").children().val("www.chuangkit.com/mod/share/share.html?d=" + DESIGN_ID),
        3 == t || 4 == t ? n.find(".public_share_edit").addClass("select_share_edit") : n.find(".public_share_edit").removeClass("select_share_edit")
    }
    function U(e, t) {
        var n = a.getShareTitle();
        n.find(".share_box").css("display", "none"),
        n.find(".private_share_box").css("display", "block"),
        e.popShow(n, {}),
        i(".design_title").children().val(i(".design_name").val()),
        i(".link_address").children().val("www.chuangkit.com/mod/share/share.html?d=" + DESIGN_ID),
        4 == t && n.find(".private_share_edit").addClass("select_share_edit")
    }
    function Y(t, n) {
        null != t._myDesign_ajax && "pending" == t._myDesign_ajax.promise().state() && t._myDesign_ajax.abort();
        var s = a.getMydesign()
          , o = s.find(".file_content_all").find(".now-file").attr("data-id")
          , d = s.find(".list_word").find(".now-click").attr("data-id")
          , r = {
            page_drag: n,
            page_no: 1,
            page_size: 15,
            folder_id: o,
            kind_id: d
        };
        r.time_order = s.find(".reflush").hasClass("reflush_click") ? "创建日期" == s.find(".sort_list").text() ? 3 : 1 : "创建日期" == s.find(".sort_list").text() ? 0 : 2,
        window.TEAM_ID > 0 && (r.tid = window.TEAM_ID),
        t._myDesign_ajax = i.ajax({
            url: "/design/queryUserDesigns.do",
            dataType: "json",
            data: r,
            success: function(n) {
                if (r.page_drag) {
                    var a = n.totalCount
                      , s = Math.ceil(a / r.page_size);
                    if (0 >= s)
                        return void i(".accross_list_all").hide().next().show();
                    i(".accross_list_all").show().next().hide();
                    var o = !1;
                    Z(s, function() {
                        r.page_no = i("#page_num_list").attr("data-page-no"),
                        i(".accross_list_all").children(".accross_list").detach(),
                        Y(t, o)
                    })
                }
                i(".accross_list_all").children().remove();
                for (var d, c, l, p, h, g, u, w, f, _, m, v, I, k, D, b = n.list.length, S = [0, 0, 0], y = 0; b > y; y++)
                    d = n.list[y],
                    c = d.lastThumbTime,
                    l = d.imgUrl + "@230w.src?v=" + c,
                    p = parseInt(d.design_width),
                    h = parseInt(d.design_height),
                    g = h / p * 240,
                    I = e.htmlUtil(d.designTitle, !0),
                    k = d.createTime,
                    D = d.designId,
                    "" == I && (I = "默认标题"),
                    u = e.arrMin(S).min,
                    f = e.arrMin(S).num,
                    _ = u + 20,
                    S[f] = _ + g + 70,
                    m = 250 * f,
                    v = '<li class="accross_list" style="top:' + _ + "px;left:" + m + 'px" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + g + 'px"><div class="accross_list_hover" style="height:' + g + 'px"></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>",
                    !window.ISVIP && window.TEAM_ID <= 0 && (v = '<li class="accross_list" style="top:' + _ + "px;left:" + m + 'px" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + g + 'px"><div class="accross_list_get_vip" style="height:' + g + 'px"><span>此功能为VIP会员专享，<br><a href="/price?p=1" target="_blank">点此升级VIP会员</a>后方可使用</span></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>"),
                    d.designPageCount > 1 && (v = '<li class="accross_list multipage_show_li" style="top:' + _ + "px;left:" + m + 'px" data-size="' + d.designPageCount + '" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + g + 'px"><div class="accross_list_hover accross_list_hover_page" style="height:' + g + 'px"></div><div class="multipage_show"></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>",
                    !window.ISVIP && window.TEAM_ID <= 0 && (v = '<li class="accross_list multipage_show_li" style="top:' + _ + "px;left:" + m + 'px" data-size="' + d.designPageCount + '" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + g + 'px"><div class="accross_list_get_vip" style="height:' + g + 'px"><span>此功能为VIP会员专享，<br><a href="/price?p=1" target="_blank">点此升级VIP会员</a>后方可使用</span></div><div class="multipage_show"></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>")),
                    i(".accross_list_all").append(v),
                    w = e.arrMax(S).max,
                    i(".accross_list_all").height(w)
            },
            error: function() {
                console.log("取得用户设计出错")
            }
        })
    }
    function Z(e, t) {
        i("#page_num_list").children().remove(),
        i("#page_num_list").jPages({
            page_num: e,
            ajaxFunction: t
        })
    }
    var X = function(e) {
        var i = this;
        s.call(i),
        i._owner_design = e,
        e._owner_designEditbar = i,
        f.call(i)
    };
    return X.prototype = {
        constructor: X,
        _owner_design: null,
        _download_rate: null,
        _min_scale: null,
        _max_scale: null,
        _change_scale: null,
        _now_scale: null,
        _myDesign_ajax: null,
        _design_kind: null,
        createWidget: function() {
            return a.getDesignEditbar()
        },
        show: function() {
            var e = this._owner_design;
            document.body.appendChild(this.getNode()[0]),
            document.getElementById("designTitle").appendChild(this.getNode()[1]),
            e._wrap.appendChild(this.getNode()[2])
        },
        changeDesignScale: function(e, t) {
            var n = this._owner_design
              , a = e;
            e > this._max_scale ? a = this._max_scale : e < this._min_scale && (a = this._min_scale),
            n.setPageScale(a),
            i(".preview-page-all").css("transform", "scale(" + a + ")");
            var s = n.getCurPage()
              , o = s._owner_pageEditbar;
            o.setEditbarStyle();
            s.getNode();
            if ("true" == n.bleed && t)
                for (var d = n.pages, r = 0; r < d.length; r++)
                    d[r].showBleedBorder();
            this.setPageArea()
        },
        reseatPageThumb: function() {
            for (var e = window.DESIGN_WIDTH, t = window.DESIGN_HEIGHT, n = e / t; e * t > 1e4; )
                e -= 10,
                t = 1 / n * e;
            var a = i("#pageScaleWrap");
            a.find(".page-thumb").attr({
                "data-width": e,
                "data-height": t
            })
        },
        updateThumbOpen: function(e) {
            var t = this
              , n = i("#pageThumbImg");
            n.addClass("img-loading");
            var a = t._owner_design
              , s = a._owner_pageList
              , o = s.pageThumbList[e].thumbnailsUrl;
            o = o + "@136w_100Q_1x.jpg?v=" + (new Date).getTime();
            var d = new Image;
            d.onload = function() {
                n.attr("src", o).removeClass("img-loading")
            }
            ,
            d.src = o
        },
        pageThumbOpen: function() {
            var e = this
              , t = e._owner_design
              , n = (t._owner_pageList,
            t.getCurPage(),
            i("#pageScaleWrap").find(".page-thumb"))
              , a = parseFloat(n.attr("data-width"))
              , s = parseFloat(n.attr("data-height"));
            n.css({
                width: a + 20 + 20 + "px",
                height: s + 20 + 20 + "px",
                padding: "20px"
            }).find(".page-thumb-content").css({
                width: a + "px",
                height: s + "px"
            }),
            setTimeout(function() {
                e.setPageArea()
            }, 400)
        },
        setPageArea: function() {
            var e = this
              , t = e._owner_design
              , n = t.getCurPage()
              , a = i("#pageScaleWrap").find(".page-thumb")
              , s = parseFloat(a.attr("data-width"))
              , o = (parseFloat(a.attr("data-height")),
            i("#rightPanel").width() - i("#pageList").width())
              , d = i("#rightPanel").height()
              , r = i(n.getNode())
              , c = r.width()
              , l = r.height()
              , p = s / c * o
              , h = s / c * d;
            p > a.outerWidth() && (p = a.outerWidth()),
            h > a.outerHeight() && (h = a.outerHeight());
            var g = i("#rightPanel").offset().top
              , u = i("#rightPanel").offset().left
              , w = r.offset().top
              , f = r.offset().left
              , _ = w - g
              , m = f - u
              , v = i("#pageScaleWrap").find(".page-svg").height()
              , I = v / l;
            _ = 0 - _ * I,
            m = 0 - m * I,
            -20 > _ && (_ = -20),
            -20 > m && (m = -20),
            a.find(".page-area").css({
                width: p + "px",
                height: h + "px",
                top: _ + "px",
                left: m + "px"
            })
        },
        getPageChangePosition: function(e, t, n) {
            if ("0px" != i(".page-thumb").css("width")) {
                var a, s, o = this, d = o._owner_design, r = d.getCurPage(), c = i(r.getNode()), l = i("#pageScaleWrap").find(".page-svg").height(), p = c.height() / l, h = i("#pageScaleWrap").find(".page-thumb"), g = {
                    top: h.offset().top,
                    right: h.offset().left + h.outerWidth() - 4,
                    bottom: h.offset().top + h.outerHeight() - 4,
                    left: h.offset().left
                }, u = {
                    top: t.top - n.y / p,
                    right: t.right - n.x / p,
                    bottom: t.bottom - n.y / p,
                    left: t.left - n.x / p
                }, w = i("#pageScaleWrap").find(".page-area");
                a = u.top <= g.top ? g.top : u.top,
                u.bottom >= g.bottom && (a = g.bottom - w.innerHeight()),
                s = u.left <= g.left ? g.left : u.left,
                u.right >= g.right && (s = g.right - w.innerWidth()),
                w.offset({
                    left: s,
                    top: a
                }),
                o.setPagePosition(e, {
                    y: a - t.top,
                    x: s - t.left
                })
            }
        },
        setPagePosition: function(e, t) {
            var n = this
              , a = n._owner_design
              , s = i(a.getNode())
              , o = (i("#rightPanel").offset(),
            i("#pageScaleWrap").find(".page-svg").height())
              , d = a.getCurPage()
              , r = i(d.getNode())
              , c = r.height() / o;
            s.offset({
                top: e.top - t.y * c,
                left: e.left - t.x * c
            })
        },
        shareConfig: {
            shareHref: "http://www.chuangkit.com/share/shareCallback.do?designId=",
            shareTitle: "戳我就变射鸡师",
            thumbnail: "http://eyuankupub.oss-cn-beijing.aliyuncs.com/sys/weixinorcode.png",
            thunbnailweibo: "",
            desc: "快来看我在@创客贴（www.chuangkit.com）设计的美图吧！这里有海量免费的素材和模板，只要会用鼠标托拉拽，就可以用几分钟的时间，免费在线设计出心仪的图片啦！什么海报、朋友圈封面、PPT、名片都能轻松搞定！学生党、微商、运营小编、社交达人们快来和我一起分享你的设计",
            summary: "快来看我在创客贴www.chuangkit.com设计的美图吧！这里有海量免费的素材和模板，只要托拉拽就可以免费在线设计出心仪的图片啦！",
            Qzonedesc: "这里有海量免费的素材和模板，只要会用鼠标托拉拽，就可以用几分钟的时间轻松搞定海报、朋友圈封面、PPT、名片！学生党、微商、运营小编、社交达人们快来和我一起分享你的设计和创意吧！创客贴——设计从未如此简单有趣。",
            contentMate: "utf-8",
            QzoneShareHref: "",
            site: "创客贴www.chuangkit.com"
        },
        shareFun: function() {
            return {
                weibo: "http://service.weibo.com/share/share.php?url=" + this.shareConfig.shareHref + "&content=" + this.shareConfig.contentMate + "&title=" + this.shareConfig.desc + "&pic=" + this.shareConfig.thumbnailweibo + "&appkey=3818167868",
                qq: "http://connect.qq.com/widget/shareqq/index.html?url=" + this.shareConfig.shareHref + "&title=" + this.shareConfig.shareTitle + "&site=" + this.shareConfig.site + "&summary=" + this.shareConfig.summary + "&pics=" + this.shareConfig.thumbnail + "&desc=" + this.shareConfig.Qzonedesc,
                Qzone: "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=" + this.shareConfig.QzoneShareHref + "&title=" + this.shareConfig.shareTitle + "&pics=" + this.shareConfig.thumbnailweibo + "&desc=" + this.shareConfig.Qzonedesc + "&summary=" + this.shareConfig.summary,
                renren: "http://widget.renren.com/dialog/share?srcUrl=" + this.shareConfig.shareHref + "&resourceUrl=" + this.shareConfig.shareHref + "&title=" + this.shareConfig.shareTitle + "&description=" + this.shareConfig.summary + "&pic=" + this.shareConfig.thumbnail + "&message=" + this.shareConfig.Qzonedesc
            }
        },
        confirmTrue: e.noop(),
        popConfirm: function(e, t) {
            var n = a.getConfirm();
            n.find(".confirm-string").html(e);
            var s = "body";
            n.appendTo(s);
            var o = i("body").getWidth()
              , d = i("body").getHeight()
              , r = n.getWidth()
              , c = n.getHeight()
              , l = (o - r) / 2
              , p = (d - c) / 2;
            n.css({
                display: "block",
                left: l,
                top: p,
                opacity: "1"
            }),
            i(".pop-wrap").css({
                "z-index": "10000"
            }),
            this.confirmTrue = t
        },
        popShow: function(e, t) {
            var n = i("body").getWidth()
              , a = i("body").getHeight()
              , s = "body";
            void 0 != t.pop_wrap && (s = t.pop_wrap),
            e.appendTo(s);
            var o = e.getWidth()
              , d = e.getHeight()
              , r = (n - o) / 2
              , c = (a - d) / 2;
            void 0 != t.change_top && (c += parseFloat(t.change_top)),
            void 0 != t.top && (c = t.top),
            void 0 != t.left && (r = t.left);
            var l = 80;
            void 0 != t.initial_top && (l = t.initial_top),
            e.css({
                display: "block",
                left: r,
                top: c - l,
                "z-index": "20000"
            }),
            this.blackShow(),
            e.animate({
                top: c,
                opacity: 1
            }, {
                easing: "easeOutQuint"
            })
        },
        popHide: function(e, t) {
            i(".share-design").removeClass("design-click"),
            i(".download-design").removeClass("design-click"),
            i(".design_file").css("z-index", "10004"),
            e.stop(),
            t || i(".black-main").animate({
                opacity: 0
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    i(this).detach()
                }
            }),
            e.animate({
                top: "80px",
                opacity: 0
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    e.css("display", "none")
                }
            })
        },
        waitPopShow: function() {
            var e = a.getThumbWait();
            e.find(".thumb-text").text("正在生成，请耐心等待1分钟左右..."),
            e.appendTo("body");
            var t = e.getWidth()
              , n = e.getHeight()
              , s = i("body").getWidth()
              , o = i("body").getHeight()
              , d = (s - t) / 2
              , r = (o - n) / 2;
            e.css({
                top: r + 20,
                left: d,
                display: "block",
                opacity: 0
            }).animate({
                top: r,
                opacity: 1
            })
        },
        downloadWaitShow: function() {
            var e = a.getDownloadWait();
            e.appendTo("body");
            var t = e.getWidth()
              , n = e.getHeight()
              , s = i("body").getWidth()
              , o = i("body").getHeight()
              , d = (s - t) / 2
              , r = (o - n) / 2;
            e.css({
                top: r + 20,
                left: d,
                display: "block",
                opacity: 0
            }).animate({
                top: r,
                opacity: .8
            })
        },
        blackShow: function() {
            var e = this
              , t = i('<div class="black-main"></div>');
            t.css({
                width: i("body").getWidth(),
                height: i("body").getHeight(),
                top: 0,
                left: 0
            }).appendTo("body").animate({
                opacity: 1
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    i(this).click(function() {
                        return "block" == i("#thumb-wait").css("display") || "block" == i(".confirm-container").css("display") || "block" == i("#download-wait").css("display") ? !1 : void e.popHide(i(".pop-wrap"))
                    })
                }
            })
        },
        testPageNum: function(e) {
            for (var i = this._owner_design, t = i.getPageSum(), e = e.replace(/\s+/g, ","), n = e.split(","), a = 0; a < n.length; a++)
                if (/^\d+\-\d+$/.test(n[a])) {
                    for (var s = n[a].split("-"), o = 0; o < s.length; o++)
                        if (isNaN(s[o]) || parseFloat(s[o]) > t)
                            return "false"
                } else if (isNaN(n[a]) || parseFloat(n[a]) > t)
                    return "false";
            return e
        }
    },
    e.classExtend(X, s),
    X;
    var $
});
;/*!/comp/design/widgets/Design.js*/
"use strict";
define("comp/design/widgets/Design", ["comp/b", "components/jquery/jquery", "comp/design/Chuangkit", "comp/design/widgets/DataWidget", "comp/design/widgets/Page", "comp/design/design_config", "comp/design/toolbar/ElementEditbar", "comp/design/toolbar/EditDiv", "comp/design/toolbar/toolbar_config", "comp/design/toolbar/SvgFilter", "widget/logreg/logreg", "widget/pop/pop", "comp/design/widgets/ElementGroup", "comp/design/widgets/PageList", "compapi/api/toolbar/DesignEditbar", "comp/ziyun/toolbar/DesignEditbar", "comp/design/toolbar/DesignEditbar"], function(e, n, t, a, i, o, s, d, l, r, g, h, p, c) {
    function u() {
        var e = this;
        e._wrap = e.getNode().parentNode,
        _.call(e),
        e._bleed = e.getJson().bleed
    }
    function _() {
        var n = this;
        e.dataBinding({
            obj: n,
            prop_name: "bleed",
            getFun: e.$noop,
            setFun: function(e) {
                var t = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                t = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: n,
                    loc: "",
                    key: "bleed",
                    value: a,
                    type: "0",
                    action: "changeDesign"
                }, t)
            }
        })
    }
    function f() {
        n(".onload-black").animate({
            opacity: "0"
        }, function() {
            n(".onload-black").css("display", "none"),
            n(".login-first").css("display", "block")
        }),
        n(".second-element-edit-bar").css({
            top: n(".page").eq(0).offset().top,
            left: n(".page").eq(0).offset().left - 150
        }),
        n(".second-page-edit-bar").css({
            top: n(".page_menu").eq(0).offset().top - 170,
            left: n(".page_menu").eq(0).offset().left - 30
        }),
        n(".second-undo-edit-bar").css({
            top: 0,
            left: n(".undo").offset().left - 30
        }),
        window.api || n(".third-title").css({
            top: 0,
            left: n(".design_title").offset().left - 150
        })
    }
    var v = function(e) {
        window.DESIGN_MAKING = !0,
        document.ondragstart = function() {
            return !1
        }
        ;
        var i;
        i = require(window.api ? "compapi/api/toolbar/DesignEditbar" : window.ziyun ? "comp/ziyun/toolbar/DesignEditbar" : "comp/design/toolbar/DesignEditbar");
        var o = this;
        o.options = n.extend(!0, {}, o.options, e),
        a.call(o, o.options.design_json),
        u.call(o);
        var l = new r(this);
        this._svg_filter = l;
        var g, h = o.options.design_json.pages;
        if (h)
            for (var p in h)
                g = o.createPage(h[p]),
                g.pageHide();
        "1.0.2" != window.DESIGN_VERSION && (t.saveJsonAttr = {
            data: {
                loc: "",
                cont: [{
                    type: 0,
                    key: "v",
                    val: "1.0.2",
                    cLoc: ""
                }]
            },
            obj: null
        },
        window.DESIGN_VERSION = "1.0.2");
        for (var _ = (this.pageScale,
        new i(o),
        new s(o),
        new d(o),
        o.getPageSum()), v = 0; _ > v; v++)
            window.PAGE_THUMB_NAILS[v] ? (null == window.PAGE_THUMB_NAILS[v].thumbnailsUpdateTime && (window.PAGE_THUMB_NAILS[v].thumbnailsUpdateTime = {
                time: 0
            }),
            window.PAGE_THUMB_NAILS[v].pageId = parseInt(1e4 * Math.random()),
            window.PAGE_THUMB_NAILS[v].pageNo = v,
            window.PAGE_THUMB_NAILS[v].taskId = window.PAGE_THUMB_NAILS[v].thumbnailsTaskId,
            window.PAGE_THUMB_LIST.push(window.PAGE_THUMB_NAILS[v])) : window.PAGE_THUMB_LIST.push({
                requestTime: {},
                thumbnailsUpdateTime: {
                    time: -1
                },
                pageNo: v,
                pageId: parseInt(1e4 * Math.random()),
                taskId: "",
                thumbnailsUrl: ""
            });
        new c(o);
        f(),
        void 0 != o.pages[0] && o.pages[0].nodeMouseenter(),
        "px" == window.DESIGN_ORIGINAL_UNIT || n(".page-bleed").hasClass("page-bleed-showing") || void 0 != o.options.design_json.bleed || (n(".page-bleed").eq(0).mousedown(),
        o._mementos = []),
        window.DESIGN_MAKING = !1
    };
    return v.prototype = {
        constructor: v,
        _json: {},
        options: {
            id: null,
            design_json: {
                title: "默认标题"
            }
        },
        createWidget: function() {
            var e = document.getElementById(this.options.id);
            return e
        },
        _owner_designEditbar: null,
        _owner_elementEditbar: null,
        _owner_editDiv: null,
        _svg_filter: null,
        _focus_element: null,
        _focus_page: null,
        _bleed: "",
        _pages: [],
        set pages(e) {
            void 0 == e.page ? this._pages.splice(e.index, 1) : this._pages.splice(e.index, 0, e.page)
        },
        get pages() {
            return this._pages
        },
        _pageScale: 0,
        set pageScale(e) {
            0 === e ? this.setPageScale() : this._pageScale = e
        },
        get pageScale() {
            return 0 === this._pageScale && (this.pageScale = 0),
            this._pageScale
        },
        _minPageScale: 0,
        _maxPageScale: 0,
        createPage: function(e, n) {
            var t;
            return t = void 0 != n ? new i(this,e,n) : new i(this,e)
        },
        insertPage: function(e, n) {
            var t;
            return t = void 0 != n ? new i(this,e,n) : new i(this,e),
            t.nodeMousedown(),
            this.setPageScale(this.pageScale),
            t
        },
        insertPageAndUndo: function(e, n, t) {
            var a = this.insertPage(e, n);
            return this.saveDesignAndUndo({
                obj: a,
                loc: "pages]",
                key: a.getIndex(),
                value: JSON.parse(JSON.stringify(e)),
                type: "0",
                action: "addPage"
            }, t),
            this._owner_pageList.addPage(a, n),
            a
        },
        setPageShow: function(e) {
            n("#div_design").children(".page").eq(e).addClass("page-on-focus").show().siblings().removeClass("page-on-focus").hide();
            var t = this.pages;
            t[e].nodeMouseenter();
            for (var a = 0; a < t.length; a++)
                a != e && t[a].pageHide();
            t[e].pageShow(),
            this._owner_designEditbar.updateThumbOpen(e)
        },
        addPage: function(e, n) {
            void 0 == n && (n = this.getPageSum());
            var t = {
                index: n,
                page: e
            };
            this.pages = t
        },
        getPageSum: function() {
            var e = this.pages.length;
            return e
        },
        changeDesignKind: function(e, n) {
            for (var t = this, a = t.getNewJson(), i = JSON.stringify(a), o = this.pages, s = o.length, d = 0; s > d; d++)
                this.postingDesign(i, {
                    i: d,
                    drag: !0,
                    width: e,
                    height: n
                });
            this.changePageWH(e, n)
        },
        changePageWH: function(t, a) {
            for (var i = this.pages, s = this, d = 0; d < i.length; d++) {
                i[d].width = {
                    value: t,
                    undo_drag: "noUndo"
                },
                i[d].height = {
                    value: a,
                    undo_drag: "noUndo"
                };
                var l = i[d]._elements[0];
                if (void 0 != l && "background" === l._element_type) {
                    var r, g, h = this.pageScale, p = l.getWidth() / h, c = l.getHeight() / h;
                    p / t > c / a ? (r = a * (p / c),
                    g = a,
                    l.previewWH(r, g)) : (r = t,
                    g = t * (c / p),
                    l.previewWH(r, g));
                    {
                        l.getJson()
                    }
                    l.setLeftTop([(t - r) / 2 * o.ZOOM_IN, (a - g) / 2 * o.ZOOM_IN]),
                    l.resetWH(),
                    l.transform = e.transformScale(l.getTransform(), 1 / o.ZOOM_IN)
                }
                i[d].setSvgViewBox()
            }
            window.DESIGN_WIDTH = t,
            window.DESIGN_HEIGHT = a,
            s.resteDesignOriginWH(),
            this.setPageScale();
            var h = this.pageScale;
            n(".design-scale-num").children().html(parseInt(100 * h) + "%")
        },
        resteDesignOriginWH: function() {
            "cm" == window.DESIGN_ORIGINAL_UNIT ? (window.DESIGN_SHOW_WIDTH = (window.DESIGN_WIDTH / 300 / .3937008).toFixed(8),
            window.DESIGN_SHOW_HEIGHT = (window.DESIGN_HEIGHT / 300 / .3937008).toFixed(8)) : "mm" == window.DESIGN_ORIGINAL_UNIT ? (window.DESIGN_SHOW_WIDTH = (window.DESIGN_WIDTH / 30 / .3937008).toFixed(8),
            window.DESIGN_SHOW_HEIGHT = (window.DESIGN_HEIGHT / 30 / .3937008).toFixed(8)) : (window.DESIGN_SHOW_WIDTH = window.DESIGN_WIDTH,
            window.DESIGN_SHOW_HEIGHT = window.DESIGN_HEIGHT);
            var e = n("#changePageSize");
            e.hasClass("now-set") && (e.find(".width-size").val(parseInt(window.DESIGN_SHOW_WIDTH)),
            e.find(".height-size").val(parseInt(window.DESIGN_SHOW_HEIGHT)),
            n(".page_size_bottom_btn").find(".page_size_bottom_num").text(parseInt(window.DESIGN_ORIGINAL_HEIGHT)))
        },
        postingDesign: function(e, n) {
            var t = n.page || this.pages[n.i];
            t.clear(),
            e = this.suitJson(e, n)
        },
        suitJson: function(e, n) {
            e = JSON.parse(e);
            for (var t = e.pages, a = parseFloat(t[n.i].width), i = parseFloat(t[n.i].height), o = n.page || this.pages[n.i], s = {
                width: o.width,
                height: o.height
            }, d = n.width || s.width, l = n.height || s.height, r = d / a, g = l / i, h = Math.min(r, g), p = t[n.i].elems, c = p.length, u = 0; c > u; u++) {
                var _ = this.suitEleJson(p[u], h, d, l, a, i);
                "text" == _["data-type"] && (_["data-elem"].paragraphs = []),
                o.createElementAndUndo({
                    json: _,
                    unshift: !0
                })
            }
        },
        suitEleJson: function(n, t, a, i, o, s) {
            var d = n.transform
              , l = e.getTransformAttr(d, "translate")
              , r = [];
            r[0] = parseFloat(l[0]) / o * a,
            r[1] = parseFloat(l[1]) / s * i,
            d = e.setTransformAttr(d, "translate", r);
            var g = e.getTransformAttr(d, "rotate");
            if (0 != g[0]) {
                var h = [];
                h[0] = g[0],
                h[1] = parseFloat(g[1]) / o * a,
                h[2] = parseFloat(g[2]) / s * i,
                d = e.setTransformAttr(d, "rotate", h)
            }
            n.transform = d;
            var p = n["data-elem"]
              , o = p.width
              , s = p.height
              , c = p["font-size"];
            p.width = o * t,
            p.height = s * t;
            var u = n["data-type"];
            return "text" == u && (p["font-size"] = c * t),
            "background" == u && ("false" != p["data-key"] ? (o / a > s / i ? (o = i * (o / s),
            s = i) : (s = a * (s / o),
            o = a),
            d = "translate(" + (a - o) / 2 + "," + (i - s) / 2 + ")") : (o = a,
            s = i,
            d = "translate(0,0)"),
            p.width = o,
            p.height = s,
            n.transform = d),
            n
        },
        setPageScale: function(e) {
            var t = this.getCurPage()
              , a = n(t.getNode())
              , i = n(this.getNode())
              , s = n(this._wrap)
              , d = n("#pageScaleWrap");
            if (void 0 == e) {
                var l, r, g, h = this._wrap.offsetWidth - n(".page-list-wrap").width(), p = this._wrap.offsetHeight, c = o.DESIGN_BLANK, u = h - c.left - c.right - 60, _ = p - c.top - c.bottom;
                e = 1,
                l = t.width,
                r = t.height,
                g = l / r,
                r / _ > l / u ? (r = _,
                l = r * g) : (l = u,
                r = l / g),
                e = r / t.height,
                this._minPageScale = e / 4 > 1 ? 1 : e / 4,
                this._maxPageScale = 1 > 4 * e ? 1 : 4 * e,
                this._scaleArea = (this._maxPageScale - this._minPageScale) / 50,
                this._initPageScale = e,
                this.pageScale = e,
                this.setPagePosition();
                var f = s.offset();
                i.offset({
                    top: f.top + p / 2 - a.height() / 2,
                    left: f.left + h / 2 - a.width() / 2
                }),
                d.fadeOut(300)
            } else {
                var v = a.width()
                  , w = a.height()
                  , m = i.offset();
                this.pageScale = e,
                this.setPagePosition();
                var x = m.top + (w - a.height()) / 2
                  , I = m.left + (v - a.width()) / 2;
                if (i.offset({
                    top: x,
                    left: I
                }),
                e > this._initPageScale) {
                    if (d.fadeIn(300),
                    d.find(".scale-switch").hasClass("thumb-close")) {
                        var S = this._owner_designEditbar;
                        S.setPageArea()
                    }
                } else
                    d.fadeOut(300)
            }
            n(".design-scale-num").children("div").text(parseInt(100 * e) + "%")
        },
        setPageScaleMouseWheel: function(e, t) {
            var a, i, o = this.getCurPage(), s = (n(o.getNode()),
            n(this.getNode())), d = n(this._wrap), l = this._wrap.offsetWidth - n(".page-list-wrap").width(), r = this._wrap.offsetHeight, g = d.offset(), h = ({
                top: g.top,
                right: g.left + l,
                bottom: g.top + r,
                left: g.left
            },
            t.clientX), p = t.clientY, c = s.offset(), u = n(".page").width(), _ = n(".page").height(), f = (c.left - h) / u, v = (c.top - p) / _, w = this.pageScale, m = u / w * e, x = _ / w * e;
            this.pageScale = e,
            this.setPagePosition(),
            a = m > .6 * l ? c.left + (m - u) * f : (l - m) / 2 + n("#rightPanel").offset().left,
            i = x > .6 * r ? c.top + (x - _) * v : (r - x) / 2 + n("#rightPanel").offset().top,
            s.offset({
                top: i,
                left: a
            }),
            n(".design-scale-num").children("div").text(parseInt(100 * e) + "%");
            var I = n("#pageScaleWrap");
            if (e > this._initPageScale) {
                if (I.fadeIn(300),
                I.find(".scale-switch").hasClass("thumb-close")) {
                    var S = this._owner_designEditbar;
                    S.setPageArea()
                }
            } else
                I.fadeOut(300)
        },
        setPagePosition: function() {
            for (var e, n = this.pages, t = n.length, a = 0; t > a; a++)
                e = n[a],
                e.setShowWH(this.pageScale, a),
                e.eleSeatRectSet()
        },
        getCurPage: function() {
            return null == this._focus_page ? this.pages[0] : this._focus_page
        },
        removePageAndUndo: function(e, n) {
            var t, a;
            e.constructor == i ? (a = e,
            t = e.getIndex()) : (t = e,
            a = this.pages[t]);
            var o = a.getDesign();
            o.saveDesignAndUndo({
                obj: a,
                loc: "pages]",
                key: t,
                value: a.getNewJson(),
                type: "3",
                action: "delPage"
            }, n),
            this.removePage(e);
            var s = this.pages
              , d = s[0]._owner_pageEditbar;
            d.setBtnState()
        },
        removePage: function(e) {
            var n, t;
            e.constructor == i ? (t = e,
            n = e.getIndex()) : (n = e,
            t = this.pages[n]);
            var a = {
                index: n
            }
              , o = this.getNode()
              , s = t.getNode();
            o.removeChild(s),
            this.pages = a,
            t = null,
            this.setPageScale(this.pageScale),
            n - 1 >= 0 ? this.pages[n - 1].nodeMouseenter() : this.pages[n].nodeMouseenter()
        },
        nodeMousedown: function() {
            var e = this.getCurPage();
            e.nodeMousedown()
        },
        pageEnterCheek: function(e, t) {
            var a, i, o, s, d, l = this.pages, r = (l.length,
            this.pageScale), g = {
                width: l[0].width,
                height: l[0].height
            }, h = this.getCurPage();
            return a = n(l[h.getIndex()].getNode()),
            i = a.offset().top,
            d = a.offset().left,
            s = i + g.height * r,
            o = d + g.width * r,
            s > t && t > i && o > e && e > d ? h.getIndex() : -1
        },
        _mementos: [],
        set mementos(e) {
            if (void 0 != e) {
                var n = this._mementos
                  , t = n.length;
                e.redo_drag || this.clearReMemento(),
                t > 0 && n[t - 1][0].memento_id === e[0].memento_id ? e[0].unshift_drag ? n[t - 1].unshift(e[0]) : "addElementGroup" === n[t - 1][0].action && "moveIndex" === e[0].action ? n[t - 1].splice(1, 0, e[0]) : n[t - 1].push(e[0]) : n.push(e)
            }
        },
        get mementos() {
            var e = this._mementos
              , n = e.pop();
            return this.remementos = n,
            n
        },
        clearMemento: function() {
            this._mementos = []
        },
        _remementos: [],
        set remementos(e) {
            if (void 0 != e) {
                var n = this._remementos;
                n.push(e)
            }
        },
        get remementos() {
            var e = this._remementos
              , n = e.pop();
            return void 0 == n ? void 0 : (n.redo_drag = !0,
            this.mementos = n,
            n)
        },
        clearReMemento: function() {
            this._remementos = []
        },
        redoMemento: function() {
            var e = this.remementos;
            if (void 0 != e) {
                var n, t, a, i, o, s, d, l, r, g, h = e.length, p = [], c = 0;
                window.undo = !0;
                for (var u = [], _ = !1, f = !1, v = h, w = 0, m = 0; h > m; m++)
                    if ("addMaterial" == e[m].action && (f = !0),
                    "delMaterial" == e[m].action && f && 0 == w && (w = m),
                    "delElementGroup" === e[m].action) {
                        u = e[m],
                        _ = !0;
                        break
                    }
                h = w,
                0 != u.length && this.pages[u.page_index]._element_groups[u.ele_index].groupSplitAndUndo("noUndo"),
                u = [];
                var x = !1;
                void 0 != e[1] && "change" === e[1].action && "background" === e[1].new_value && "img" === e[1].old_value && (x = !0);
                for (var I = v - 1; I >= w; I--)
                    if (n = e[I],
                    t = n.action,
                    a = n.key,
                    i = n.new_value,
                    o = n.page_index,
                    d = n.ele_index,
                    s = this.pages[o],
                    "delElementGroup" !== t)
                        if ("change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            if (_ && "group-transform" === a || x && "data-type" === a)
                                continue;
                            l.undoValue({
                                key: a,
                                val: i
                            })
                        } else if ("addMaterial" === t)
                            l = s.createElementAndUndo({
                                json: i,
                                index: d
                            }, "noUndo");
                        else if ("delMaterial" === t) {
                            if (x)
                                continue;
                            l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++
                        } else if ("moveIndex" === t) {
                            if (x)
                                continue;
                            g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo")
                        } else if ("delPage" === t)
                            this.removePageAndUndo(s, "noUndo");
                        else if ("addPage" === t)
                            this.insertPageAndUndo(i, o, "noUndo");
                        else if ("addElementGroup" === t)
                            u = n;
                        else if ("delElementGroup" === t)
                            ;
                        else if ("groupmovedown" === t)
                            l = s._element_groups[d],
                            l.moveDown("noUndo");
                        else if ("groupmoveup" === t)
                            l = s._element_groups[d],
                            l.moveUp("noUndo");
                        else if ("changeElementGroup" === t) {
                            if (c > 0)
                                continue;
                            if (l = s._element_groups[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: i
                            })
                        } else
                            "changeDesign" === t ? this.undoBleed(i) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageUp("noUndo")) : "pageMoveTo" === t && (s = this.pages[n.page_index],
                            s._owner_pageEditbar.pageMoveTo(n.new_index, "noUndo")));
                if (0 != w)
                    for (var S = h - 1; S >= 0; S--)
                        if (n = e[S],
                        t = n.action,
                        a = n.key,
                        i = n.new_value,
                        o = n.page_index,
                        d = n.ele_index,
                        s = this.pages[o],
                        "change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            if (_ && "group-transform" === a || x && "data-type" === a)
                                continue;
                            l.undoValue({
                                key: a,
                                val: i
                            })
                        } else if ("addMaterial" === t)
                            l = s.createElementAndUndo({
                                json: i,
                                index: d
                            }, "noUndo");
                        else if ("delMaterial" === t) {
                            if (x)
                                continue;
                            l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++
                        } else if ("moveIndex" === t) {
                            if (x)
                                continue;
                            g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo")
                        } else if ("delPage" === t)
                            this.removePageAndUndo(s, "noUndo");
                        else if ("addPage" === t)
                            this.insertPageAndUndo(i, o, "noUndo");
                        else if ("addElementGroup" === t)
                            u = n;
                        else if ("delElementGroup" === t)
                            ;
                        else if ("groupmovedown" === t)
                            l = s._element_groups[d],
                            l.moveDown("noUndo");
                        else if ("groupmoveup" === t)
                            l = s._element_groups[d],
                            l.moveUp("noUndo");
                        else if ("changeElementGroup" === t) {
                            if (c > 0)
                                continue;
                            if (l = s._element_groups[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: i
                            })
                        } else
                            "changeDesign" === t ? this.undoBleed(i) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageUp("noUndo")) : "pageMoveTo" === t && (s = this.pages[n.page_index],
                            s._owner_pageEditbar.pageMoveTo(n.new_index, "noUndo")));
                else
                    for (var m = 0; h > m; m++)
                        if (n = e[m],
                        t = n.action,
                        a = n.key,
                        i = n.new_value,
                        o = n.page_index,
                        d = n.ele_index,
                        s = this.pages[o],
                        "change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            if (_ && "group-transform" === a || x && "data-type" === a)
                                continue;
                            l.undoValue({
                                key: a,
                                val: i
                            })
                        } else if ("addMaterial" === t)
                            l = s.createElementAndUndo({
                                json: i,
                                index: d
                            }, "noUndo");
                        else if ("delMaterial" === t) {
                            if (x)
                                continue;
                            l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++
                        } else if ("moveIndex" === t) {
                            if (x)
                                continue;
                            g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo")
                        } else if ("delPage" === t)
                            this.removePageAndUndo(s, "noUndo");
                        else if ("addPage" === t)
                            this.insertPageAndUndo(i, o, "noUndo");
                        else if ("addElementGroup" === t)
                            u = n;
                        else if ("delElementGroup" === t)
                            ;
                        else if ("groupmovedown" === t)
                            l = s._element_groups[d],
                            l.moveDown("noUndo");
                        else if ("groupmoveup" === t)
                            l = s._element_groups[d],
                            l.moveUp("noUndo");
                        else if ("changeElementGroup" === t) {
                            if (c > 0)
                                continue;
                            if (l = s._element_groups[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: i
                            })
                        } else
                            "changeDesign" === t ? this.undoBleed(i) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageUp("noUndo")) : "pageMoveTo" === t && (s = this.pages[n.page_index],
                            s._owner_pageEditbar.pageMoveTo(n.new_index, "noUndo")));
                if (0 != u.length) {
                    for (var E = u.eles_index, b = u.eles_index.length, I = 0; b > I; I++)
                        p.push(s.elements[E[I]]);
                    var i = u.new_value
                      , o = u.page_index
                      , d = u.ele_index
                      , s = this.pages[o]
                      , U = s.createElementGroupAndUndo(p, {
                        id: d,
                        transform: i.transform
                    }, "noUndo");
                    p = [],
                    U.nodeClick()
                }
                if (x)
                    for (var m = 3; m >= 0; m--)
                        if (n = e[m],
                        t = n.action,
                        a = n.key,
                        i = n.new_value,
                        o = n.page_index,
                        d = n.ele_index,
                        s = this.pages[o],
                        "change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: i
                            })
                        } else
                            "delMaterial" === t ? (l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++) : "moveIndex" === t && (g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo"));
                window.undo = !1
            }
        },
        undoMemento: function() {
            var e = this.mementos;
            if (void 0 != e) {
                var n, t, a, i, o, s, d, l, r, g, h = e.length, p = [], p = [], c = 0;
                window.undo = !0;
                for (var u = 0; h > u; u++)
                    if (n = e[u],
                    t = n.action,
                    a = n.key,
                    i = n.old_value,
                    o = n.page_index,
                    d = n.ele_index,
                    s = this.pages[o],
                    "change" === t) {
                        if (l = s.elements[d],
                        void 0 == l)
                            continue;
                        l.undoValue({
                            key: a,
                            val: i
                        })
                    } else if ("addMaterial" === t)
                        l = s.elements[d],
                        s.eleDelAndUndo(l, "noUndo"),
                        c++;
                    else if ("delMaterial" === t)
                        l = s.createElementAndUndo({
                            json: i,
                            index: d
                        }, "noUndo");
                    else if ("moveIndex" === t)
                        g = n.new_index,
                        l = s.elements[g],
                        r = n.ele_index,
                        l.changeIndexAndUndo({
                            new_index: r
                        }, "noUndo");
                    else if ("delPage" === t)
                        this.insertPageAndUndo(i, o, "noUndo");
                    else if ("addPage" === t)
                        this.removePageAndUndo(s, "noUndo");
                    else if ("addElementGroup" === t)
                        l = s._element_groups[d],
                        l.groupSplitAndUndo("noUndo");
                    else if ("delElementGroup" === t) {
                        for (var _ = n.eles_index, f = n.eles_index.length, v = 0; f > v; v++)
                            p.push(s.elements[_[v]]);
                        s.createElementGroupAndUndo(p, {
                            id: d,
                            transform: i.transform
                        }, "noUndo"),
                        p = []
                    } else if ("groupmovedown" === t)
                        l = s._element_groups[d],
                        l.moveUp("noUndo");
                    else if ("groupmoveup" === t)
                        l = s._element_groups[d],
                        l.moveDown("noUndo");
                    else if ("changeElementGroup" === t) {
                        if (c > 0)
                            continue;
                        if (l = s._element_groups[d],
                        void 0 == l)
                            continue;
                        l.undoValue({
                            key: a,
                            val: i
                        })
                    } else
                        "changeDesign" === t ? this.undoBleed(i) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                        s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t ? (s = this.pages[n.new_index],
                        s._owner_pageEditbar.pageUp("noUndo")) : "pageMoveTo" === t && (s = this.pages[n.new_index],
                        s._owner_pageEditbar.pageMoveTo(n.page_index, "noUndo")));
                n.mementoGoTwo && this.undoMemento(),
                window.undo = !1
            }
        },
        undoBleed: function(e) {
            this.bleed = {
                value: e,
                undo_drag: "noUndo"
            },
            "false" === e ? this.hideBleed() : this.showBleed()
        },
        saveDesignTitle: function(e) {
            var n = this;
            n.saveDesignAndUndo({
                obj: n,
                loc: "",
                key: "title",
                value: e,
                type: "0",
                action: "changeDesign"
            }, "noUndo")
        },
        getNewJson: function() {
            var e = this.getJson();
            e.pages = [];
            var t = n(".design_title").children("input");
            e.title = "" == t.val() ? "默认标题" : t.val(),
            e.v = "1.0.2";
            for (var a = 0; a < this.pages.length; a++) {
                var i = this.pages[a];
                e.pages[a] = i.getNewJson()
            }
            return e
        },
        _saveDrag: "saved",
        _saveTimer: null,
        saveDesignAndUndo: function(n, a) {
            var o = n.obj
              , s = n.key
              , d = n.value
              , l = n.loc
              , r = n.type
              , g = n.cLoc || ""
              , h = n.action
              , c = n.tidx
              , u = n.unshift;
            a = a || "save";
            var _, f, w;
            o instanceof i ? (_ = o,
            f = o.getIndex(),
            w = 0) : o instanceof v || (_ = o.getPage(),
            f = _.getIndex(),
            w = o.getIndex(),
            o instanceof p && (w = o.id)),
            void 0 != _ && (_._pop_drag = !0),
            "moveIndex" === h && (w = s);
            var m = [{
                type: r,
                key: s,
                val: d,
                cLoc: g,
                tidx: c
            }];
            if (-1 != w) {
                "delMaterial" === h ? m[0].val = "" : "delPage" === h && (m[0].val = ""),
                "delMaterial" === h && (m[0].val = "");
                var x = {
                    loc: l,
                    cont: m
                };
                if (t.saveJsonAttr = {
                    data: x,
                    obj: o
                },
                "delPage" != h && "pageMoveTo" !== h) {
                    var _ = this.getCurPage();
                    if ("delMaterial" !== h && "delElementGroup" != h && this.makePageThumb(_),
                    "noUndo" !== a) {
                        var I = [{
                            page_index: f,
                            ele_index: w,
                            memento_id: window.MEMENTO_ID,
                            action: h,
                            unshift_drag: u,
                            eles_index: n.eles_index,
                            new_value: d
                        }];
                        window.mementoGoTwo && (I[0].mementoGoTwo = !0),
                        "addMaterial" === h || ("delMaterial" === h ? I[0].old_value = d : "moveIndex" === h ? I[0].new_index = n.tidx : "change" === h ? (I[0].key = s,
                        I[0].old_value = "object" == typeof o[s] ? JSON.parse(JSON.stringify(o[s])) : o[s],
                        "data-colors" === s && (I[0].old_value = JSON.parse(JSON.stringify(o.colors))),
                        "data-xhref-imgs" === s && (I[0].old_value = JSON.parse(JSON.stringify(o.xhrefImgs))),
                        "group-transform" === s && (I[0].old_value = JSON.parse(JSON.stringify(o.groupTransform))),
                        "fill" === s && (I[0].old_value = o.colors),
                        "font-size" === s && (I[0].old_value = o.fontSize),
                        "font-family" === s && (I[0].old_value = o.fontFamily),
                        "data-align" === s && (I[0].old_value = o.fontAlign),
                        "data-bold" === s && (I[0].old_value = o.bold),
                        "data-italic" === s && (I[0].old_value = o.italic),
                        "data-decoration" === s && (I[0].old_value = o.decoration),
                        "data-type" === s && (I[0].old_value = o.dataType),
                        "cut-width" === s && (I[0].old_value = o.cutwidth),
                        "cut-height" === s && (I[0].old_value = o.cutheight),
                        "repeat-width" === s && (I[0].old_value = o.repeatwidth),
                        "real-width" === s && (I[0].old_value = o.realWidth),
                        "real-height" === s && (I[0].old_value = o.realHeight),
                        "chart-data" === s && (I[0].old_value = e.deepClone(o.data)),
                        "chart-colors" === s && (I[0].old_value = e.deepClone(o.colors)),
                        "chart-kind" === s && (I[0].old_value = o.kind),
                        "chart-title" === s && (I[0].old_value = o.title),
                        "chart-titleShow" === s && (I[0].old_value = o.titleShow),
                        "chart-titleColor" === s && (I[0].old_value = o.titleColor),
                        "chart-titlePosition" === s && (I[0].old_value = o.titlePosition),
                        "chart-axisShow" === s && (I[0].old_value = o.axisShow),
                        "chart-axisTitleShow" === s && (I[0].old_value = o.axisTitleShow),
                        "chart-xAxisTitle" === s && (I[0].old_value = o.xAxisTitle),
                        "chart-yAxisTitle" === s && (I[0].old_value = o.yAxisTitle),
                        "chart-yAxisNumMin" === s && (I[0].old_value = o.yAxisNumMin),
                        "chart-yAxisNumMax" === s && (I[0].old_value = o.xAxisNumMax),
                        "chart-gridShow" === s && (I[0].old_value = o.gridShow),
                        "chart-legendShow" === s && (I[0].old_value = o.legendShow)) : "addPage" === h || ("delPage" === h ? I[0].old_value = d : "delElementGroup" === h ? I[0].old_value = d : "changeElementGroup" === h ? (I[0].key = s,
                        I[0].old_value = o[s]) : "changeDesign" === h ? (I[0].key = s,
                        I[0].old_value = this.bleed) : ("pageMoveUp" === h || "pageMoveDown" === h || "pageMoveTo" === h) && (I[0].new_index = n.tidx,
                        I[0].page_index = n.key))),
                        this.mementos = I
                    }
                }
            }
        },
        makePageThumb: function(e) {
            var t = e.getIndex()
              , a = n(e.getPageSvg()).clone();
            a.find(".ant-path").remove(),
            a.find("image").each(function() {
                var e = n(this)
                  , t = e.attr("href");
                void 0 != t && (t = "http:" + t,
                e.attr("href", t))
            }),
            a.find(".layoutImgWrap").each(function() {
                var e = n(this)
                  , t = e.children().attr("xlink:href");
                void 0 != t && (/http/.test(t) || (t = "http:" + t),
                e.children().attr("xlink:href", t))
            }),
            a.attr({
                version: "1.1",
                xmlns: "http://www.w3.org/2000/svg",
                "xmlns:xlink": "http://www.w3.org/1999/xlink"
            });
            var i = a[0].outerHTML;
            i = i.replace(/\&nbsp/g, " ");
            var o = this._owner_pageList;
            o.makePageThumbWS({
                pageNo: t,
                pageId: o.pageThumbList[t].pageId,
                svg: i
            })
        },
        saveDesignOld: function(e) {
            {
                var t = this;
                t.getJson()
            }
            t._saveDrag = "will save",
            n(".ppt-show").addClass("design-no-click"),
            window.api && !e && n(".download-design").addClass("design-no-click"),
            clearTimeout(t._saveTimer),
            e || (t._saveTimer = setTimeout(function() {}, 2e3))
        },
        saveDesignAjax: function() {
            var t = this;
            t._saveDrag = "saveing";
            var a = l.getDownload().find(".sure_download")
              , i = l.getShareTitle().find(".publick_share_button");
            if (a.addClass("not-download"),
            i.addClass("not-share"),
            window.ISLOGIN) {
                var o = t.getNewJson();
                n(".save-design .span_img").animate({
                    left: "-56px"
                }, {
                    easing: "swing"
                }),
                n(".save-design .span_text").animate({
                    left: "-30px"
                }, {
                    easing: "swing"
                }),
                n(".save-design .saving_text").animate({
                    left: "17px"
                }, {
                    easing: "swing",
                    complete: function() {
                        var s = new FormData;
                        s.append("json", JSON.stringify(o)),
                        s.append("k", KIND_ID),
                        s.append("d", DESIGN_ID),
                        s.append("kt", KIND_TITLE),
                        s.append("t", TEMPLATE_ID),
                        s.append("w", KIND_WIDTH),
                        s.append("h", KIND_HEIGHT),
                        s.append("sec", DESIGN_SEC),
                        s.append("dt", n(".design_title").children().val());
                        var d = function() {
                            return null == IS_ET ? 0 : IS_ET
                        }();
                        s.append("et", d),
                        s.append("mp", window.MAX_PAGE),
                        n.ajax({
                            url: "/design/saveDesignV2.do",
                            type: "POST",
                            dataType: "json",
                            data: s,
                            cache: !1,
                            contentType: !1,
                            processData: !1,
                            error: function() {
                                e.addSomeMouseClick("设计-保存失败"),
                                alert("设计保存失败，请尝试刷新当前页面。您还可以加入创客贴qq服务群，群号133818453（已满），538351505。或拨打创客贴服务热线：400-871-8211。")
                            },
                            success: function(e) {
                                var o;
                                if (clearTimeout(o),
                                e.LoginTimeOut === !0) {
                                    n("#onloadDesign").removeAttr("data-asdf"),
                                    n("#loginBackground").show(),
                                    n("#toLogin").trigger("click"),
                                    n(".share-design").hide(),
                                    n(".download-design").hide(),
                                    n(".save-design").hide();
                                    var s = n('<div id="afterLogin"><div id="afterLoginCanDownload">当前用户仅供设计体验，注册后可进行分享、保存与下载等更多功能<span style="margin-left:18px" class="register-btn">注册</span>or<span class="login-btn">登录</span></div></div>');
                                    s.find("span").on("click", function() {
                                        n("#div_design").mousedown();
                                        var e = n(this);
                                        n.ajax({
                                            url: "/user/getUserInfo.do",
                                            dataType: "json",
                                            type: "POST",
                                            success: function(t) {
                                                t.LoginTimeOut ? "login-btn" === e.attr("class") ? g.show() : (g.show(),
                                                n("#logreg-register-btn").trigger("click")) : t.isLogin && (n("#afterLoginCanDownload").detach(),
                                                n(".share-design").show(),
                                                n(".download-design").show(),
                                                n(".save-design").show(),
                                                window.ISLOGIN = !0)
                                            },
                                            error: function() {
                                                "login-btn" === e.attr("class") ? g.show() : (g.show(),
                                                n("#logreg-register-btn").trigger("click"))
                                            }
                                        })
                                    }),
                                    s.appendTo(n("#designTitle"))
                                } else
                                    t._saveDrag = "saved",
                                    a.removeClass("not-download"),
                                    i.removeClass("not-share"),
                                    DESIGN_ID = e.designId,
                                    KIND_TITLE = null,
                                    DESIGN_SEC = null;
                                n(".save-design").addClass("saved-design"),
                                n(".save-design .span_img").animate({
                                    left: "18px"
                                }, {
                                    easing: "swing"
                                }),
                                n(".save-design .span_text").text("成功").animate({
                                    left: "44px"
                                }, {
                                    easing: "swing"
                                }),
                                n(".ppt-show").removeClass("design-no-click"),
                                window.api && n(".download-design").removeClass("design-no-click"),
                                n(".save-design .saving_text").animate({
                                    left: "90px"
                                }, {
                                    easing: "swing",
                                    complete: function() {
                                        o = setTimeout(function() {
                                            n(".save-design").removeClass("saved-design"),
                                            n(".save-design .span_text").html("保存")
                                        }, 500)
                                    }
                                }),
                                "" != e.error && void 0 != e.error && (alert("保存异常"),
                                location.href = "/h/dc.html")
                            }
                        })
                    }
                })
            }
        },
        jsonAddleftTop: function(n, t) {
            if ("background" == n["data-type"]) {
                var a = this.getCurPage();
                if (0 == n["data-elem"]["data-key"])
                    n["data-elem"].width = a.width,
                    n["data-elem"].height = a.height;
                else {
                    var i = n["data-elem"].width
                      , o = n["data-elem"].height
                      , s = i / o;
                    i / a.width > o / a.height ? (o = a.height,
                    i = o * s) : (i = a.width,
                    o = i / s),
                    n["data-elem"].width = i,
                    n["data-elem"].height = o
                }
            } else {
                var d = n.transform
                  , l = e.getTransformAttr(d, "translate")
                  , r = e.getTransformAttr(d, "rotate");
                l[0] = parseFloat(l[0]) + parseFloat(t),
                l[1] = parseFloat(l[1]) + parseFloat(t),
                d = e.setTransformAttr(d, "translate", l),
                d = e.setTransformAttr(d, "rotate", r),
                n.transform = d
            }
            return n
        },
        showBleed: function() {
            var e = this.pages
              , n = {
                width: e[0].width,
                height: e[0].height
            }
              , t = o.BLEED_SIZE
              , a = parseFloat(n.width) + 2 * t
              , i = parseFloat(n.height) + 2 * t;
            this.changePageWH(a, i);
            for (var s = this.pageScale, d = s * t, l = 100 * (t / a), r = 100 * (t / i), g = 0; g < e.length; g++)
                e[g].pageBleed(d, t),
                e[g].showBleedBorderByPrecent(l, r, d)
        },
        hideBleed: function() {
            for (var e = this.pages, t = {
                width: e[0].width,
                height: e[0].height
            }, a = parseFloat(o.BLEED_SIZE), i = this.pageScale, s = i * a, d = 0; d < e.length; d++)
                e[d].pageBleed(-s, a);
            var l = parseFloat(t.width) - 2 * a
              , r = parseFloat(t.height) - 2 * a;
            this.changePageWH(l, r),
            n("#rightPanel").find(".bleed_border").hide(),
            n("#rightPanel").find(".bleed_ruler").hide(),
            n("#rightPanel").find(".bleed_line").hide(),
            n(".three-second-line").css({
                left: 100 / 3 * 2 + "%"
            }),
            n(".three-first-line").css({
                left: 100 / 3 + "%"
            })
        }
    },
    e.classExtend(v, a),
    v
});
;/*!/comp/design/Base.js*/
define("comp/design/Base", ["comp/design/Chuangkit"], function(t) {
    var n = function(n) {
        t.extendOptions(this, n)
    };
    return n.prototype = {
        constructor: n,
        _jq_object: null,
        options: {
            id: ""
        },
        setJqObject: function(t) {
            return this._jq_object = t,
            this
        },
        getJqObject: function() {
            return this._jq_object
        }
    },
    n
});
;/*!/comp/design/chart/Chart.js*/
define("comp/design/chart/Chart", ["components/jquery/jquery"], function() {
    var n = function() {};
    return n.prototype = {},
    n
});
;/*!/comp/design/chart/Histogram.js*/
define("comp/design/chart/Histogram", ["require", "exports", "module"], function() {});
;/*!/comp/design/requirejs/text.js*/
define("comp/design/requirejs/text", ["module"], function(e) {
    "use strict";
    var n, t, r, o, i, a = ["Msxml2.XMLHTTP", "Microsoft.XMLHTTP", "Msxml2.XMLHTTP.4.0"], s = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im, u = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im, c = "undefined" != typeof location && location.href, l = c && location.protocol && location.protocol.replace(/\:/, ""), f = c && location.hostname, p = c && (location.port || void 0), d = {}, v = e.config && e.config() || {};
    return n = {
        version: "2.0.12",
        strip: function(e) {
            if (e) {
                e = e.replace(s, "");
                var n = e.match(u);
                n && (e = n[1])
            } else
                e = "";
            return e
        },
        jsEscape: function(e) {
            return e.replace(/(['\\])/g, "\\$1").replace(/[\f]/g, "\\f").replace(/[\b]/g, "\\b").replace(/[\n]/g, "\\n").replace(/[\t]/g, "\\t").replace(/[\r]/g, "\\r").replace(/[\u2028]/g, "\\u2028").replace(/[\u2029]/g, "\\u2029")
        },
        createXhr: v.createXhr || function() {
            var e, n, t;
            if ("undefined" != typeof XMLHttpRequest)
                return new XMLHttpRequest;
            if ("undefined" != typeof ActiveXObject)
                for (n = 0; 3 > n; n += 1) {
                    t = a[n];
                    try {
                        e = new ActiveXObject(t)
                    } catch (r) {}
                    if (e) {
                        a = [t];
                        break
                    }
                }
            return e
        }
        ,
        parseName: function(e) {
            var n, t, r, o = !1, i = e.indexOf("."), a = 0 === e.indexOf("./") || 0 === e.indexOf("../");
            return -1 !== i && (!a || i > 1) ? (n = e.substring(0, i),
            t = e.substring(i + 1, e.length)) : n = e,
            r = t || n,
            i = r.indexOf("!"),
            -1 !== i && (o = "strip" === r.substring(i + 1),
            r = r.substring(0, i),
            t ? t = r : n = r),
            {
                moduleName: n,
                ext: t,
                strip: o
            }
        },
        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,
        useXhr: function(e, t, r, o) {
            var i, a, s, u = n.xdRegExp.exec(e);
            return u ? (i = u[2],
            a = u[3],
            a = a.split(":"),
            s = a[1],
            a = a[0],
            !(i && i !== t || a && a.toLowerCase() !== r.toLowerCase() || (s || a) && s !== o)) : !0
        },
        finishLoad: function(e, t, r, o) {
            r = t ? n.strip(r) : r,
            v.isBuild && (d[e] = r),
            o(r)
        },
        load: function(e, t, r, o) {
            if (o && o.isBuild && !o.inlineText)
                return void r();
            v.isBuild = o && o.isBuild;
            var i = n.parseName(e)
              , a = i.moduleName + (i.ext ? "." + i.ext : "")
              , s = t.toUrl(a)
              , u = v.useXhr || n.useXhr;
            return 0 === s.indexOf("empty:") ? void r() : void (!c || u(s, l, f, p) ? n.get(s, function(t) {
                n.finishLoad(e, i.strip, t, r)
            }, function(e) {
                r.error && r.error(e)
            }) : t([a], function(e) {
                n.finishLoad(i.moduleName + "." + i.ext, i.strip, e, r)
            }))
        },
        write: function(e, t, r) {
            if (d.hasOwnProperty(t)) {
                var o = n.jsEscape(d[t]);
                r.asModule(e + "!" + t, "define(function () { return '" + o + "';});\n")
            }
        },
        writeFile: function(e, t, r, o, i) {
            var a = n.parseName(t)
              , s = a.ext ? "." + a.ext : ""
              , u = a.moduleName + s
              , c = r.toUrl(a.moduleName + s) + ".js";
            n.load(u, r, function() {
                var t = function(e) {
                    return o(c, e)
                };
                t.asModule = function(e, n) {
                    return o.asModule(e, c, n)
                }
                ,
                n.write(e, u, t, i)
            }, i)
        }
    },
    "node" === v.env || !v.env && "undefined" != typeof process && process.versions && process.versions.node && !process.versions["node-webkit"] ? (t = require.nodeRequire("fs"),
    n.get = function(e, n, r) {
        try {
            var o = t.readFileSync(e, "utf8");
            0 === o.indexOf("﻿") && (o = o.substring(1)),
            n(o)
        } catch (i) {
            r && r(i)
        }
    }
    ) : "xhr" === v.env || !v.env && n.createXhr() ? n.get = function(e, t, r, o) {
        var i, a = n.createXhr();
        if (a.open("GET", e, !0),
        o)
            for (i in o)
                o.hasOwnProperty(i) && a.setRequestHeader(i.toLowerCase(), o[i]);
        v.onXhr && v.onXhr(a, e),
        a.onreadystatechange = function() {
            var n, o;
            4 === a.readyState && (n = a.status || 0,
            n > 399 && 600 > n ? (o = new Error(e + " HTTP status: " + n),
            o.xhr = a,
            r && r(o)) : t(a.responseText),
            v.onXhrComplete && v.onXhrComplete(a, e))
        }
        ,
        a.send(null)
    }
    : "rhino" === v.env || !v.env && "undefined" != typeof Packages && "undefined" != typeof java ? n.get = function(e, n) {
        var t, r, o = "utf-8", i = new java.io.File(e), a = java.lang.System.getProperty("line.separator"), s = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),o)), u = "";
        try {
            for (t = new java.lang.StringBuffer,
            r = s.readLine(),
            r && r.length() && 65279 === r.charAt(0) && (r = r.substring(1)),
            null !== r && t.append(r); null !== (r = s.readLine()); )
                t.append(a),
                t.append(r);
            u = String(t.toString())
        } finally {
            s.close()
        }
        n(u)
    }
    : ("xpconnect" === v.env || !v.env && "undefined" != typeof Components && Components.classes && Components.interfaces) && (r = Components.classes,
    o = Components.interfaces,
    Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),
    i = "@mozilla.org/windows-registry-key;1"in r,
    n.get = function(e, n) {
        var t, a, s, u = {};
        i && (e = e.replace(/\//g, "\\")),
        s = new FileUtils.File(e);
        try {
            t = r["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),
            t.init(s, 1, 0, !1),
            a = r["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),
            a.init(t, "utf-8", t.available(), o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),
            a.readString(t.available(), u),
            a.close(),
            t.close(),
            n(u.value)
        } catch (c) {
            throw new Error((s && s.path || "") + ": " + c)
        }
    }
    ),
    n
});
;/*!/comp/design/toolbar/scrollbar.js*/
!function(n) {
    "function" == typeof define && define.amd ? define("comp/design/toolbar/scrollbar", [], n) : n()
}(function() {
    function n() {}
    n.prototype = {}
});
;/*!/comp/design/toolbar/ShowBorder.js*/
define("comp/design/toolbar/ShowBorder", ["components/jquery/jquery", "comp/design/Chuangkit", "comp/design/toolbar/toolbar_config", "comp/design/Toolbar", "libs/jquery/jquery.transit.min"], function(e, t, o, i) {
    function s() {}
    var l = function(e, t) {
        i.call(this, t),
        s.call(this),
        this._owner_design = e
    };
    return l.prototype = {
        constructor: l,
        options: {},
        _owner_design: null,
        eleMsg: {
            eleP: {
                x: "",
                y: ""
            },
            eleS: {
                w: "",
                h: ""
            },
            eleR: ""
        },
        eleToAdd: '<div class="parentDiv"><div class="h" id="left"></div><div class="w" id="top"></div><div class="h" id="right"></div><div class="w" id="bottom"></div></div>',
        createWidget: function() {
            return o.getEditDiv()
        },
        getEleMessage: function(e) {
            return this.eleMsg.eleR = e.css("rotate"),
            this.eleMsg.eleS.w = e.width(),
            this.eleMsg.eleS.h = e.height(),
            this.eleMsg.eleP.y = e.offset().top,
            this.eleMsg.eleP.x = e.offset().left,
            this.eleMsg
        },
        setEleStyle: function(t) {
            var o = this.getEleMessage(t)
              , i = o.eleS.w
              , s = o.eleS.h
              , l = o.eleP.x
              , n = o.eleP.y
              , r = o.eleR;
            e(".parentDiv").css({
                width: i,
                height: s,
                rotate: r,
                position: "relative"
            }).offset({
                top: n,
                left: l
            }),
            e(".h").css({
                height: s,
                "background-color": "#646464",
                position: "absolute",
                width: "1px"
            }),
            e(".w").css({
                width: i,
                "background-color": "#646464",
                position: "absolute",
                height: "1px"
            }),
            e("#left").css({
                top: 0,
                left: 0
            }),
            e("#top").css({
                top: 0,
                left: 0
            }),
            e("#right").css({
                right: 0,
                top: 0
            }),
            e("#bottom").css({
                bottom: 0,
                left: 0
            })
        },
        addEleToPage: function(t) {
            e(".element_wrap").prepend(this.eleToAdd),
            this.setEleStyle(t)
        },
        removeShowBorder: function() {
            e(".parentDiv").remove()
        }
    },
    t.extend(l, i),
    l
});
;/*!/comp/design/widgets/ChartKind.js*/
define("comp/design/widgets/ChartKind", ["require", "components/jquery/jquery"], function() {
    var t = function(t) {
        this._owner_design = t
    };
    return t.prototype = {
        constructor: t,
        _owner_design: null,
        _titleSize: 0,
        _moreSize: 0,
        createSvg: function(t) {
            var e = t.width
              , r = t.height
              , i = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            return i.setAttribute("x", "0px"),
            i.setAttribute("y", "0px"),
            i.setAttribute("version", "1.1"),
            i.setAttribute("xmlns", "http://www.w3.org/2000/svg"),
            i.setAttribute("xmlns:xlink", "http://www.w3.org/1999/xlink"),
            i.setAttribute("viewBox", "0 0 " + e + " " + r),
            i.setAttribute("xml:space", "preserve"),
            i
        },
        createTitle: function(t) {
            if (null == t.chartTitle)
                return null;
            var e = t.width
              , r = t.height
              , i = document.createElementNS("http://www.w3.org/2000/svg", "text");
            i.setAttribute("text-anchor", "middle");
            var n, s;
            s = "top" == t.chartTitlePosition ? 22 : r - 5,
            n = e / 2,
            i.setAttribute("x", n),
            i.setAttribute("y", s),
            i.setAttribute("fill", "#808284"),
            i.setAttribute("font-size", this._titleSize),
            i.setAttribute("class", "svgChartTitle"),
            i.setAttribute("style", "display:none");
            var o = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            return o.innerHTML = t.chartTitle,
            i.appendChild(o),
            i
        },
        createXAxis: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "path");
            return t.setAttribute("fill", "none"),
            t.setAttribute("stroke", "#000000"),
            t.setAttribute("d", "M60,400.5L460,400.5"),
            t.setAttribute("class", "svgXAxis"),
            t
        },
        createYAxisGrid: function() {},
        legendShow: function(t) {
            var e, r, i = t.legend, n = t.legend_width, s = t.chartColors, o = t.width, l = t.height, a = i.length;
            r = "bottom" == t.chartTitlePosition ? l - 60 : l - 10;
            for (var u, h = 0, c = document.createElementNS("http://www.w3.org/2000/svg", "g"), g = 0; a > g; g++)
                for (e = (o - n[g]) / 2 + 10; h < i[g] + 1; h++) {
                    var w = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    w.setAttribute("y", r - 20 * (a - g)),
                    $test_text.html(data[h + 1][0]);
                    var p = $("#test_text").getWidth() * this_scale;
                    u = 1 == s.length ? s[0] : s[h],
                    w.setAttribute("x", e),
                    w.setAttribute("width", legend_color_block),
                    w.setAttribute("height", legend_color_block),
                    w.setAttribute("fill", u),
                    w.setAttribute("class", "legendColor"),
                    c.appendChild(w);
                    var d = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    d.setAttribute("text-anchor", "start"),
                    d.setAttribute("x", e + legend_color_block + color_space),
                    d.setAttribute("y", r - 20 * (a - g) + 12),
                    d.setAttribute("fill", "#808284"),
                    d.setAttribute("font-size", "14px"),
                    d.setAttribute("class", "legendText");
                    var m = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                    m.innerHTML = data[h + 1][0],
                    d.appendChild(m),
                    c.appendChild(d),
                    e = e + legend_color_block + p + legend_space + color_space
                }
        },
        getWrapHeight: function(t, e) {
            var r = t.height / e
              , i = r - 10
              , n = r - 70;
            i = "top" == t.chartTitlePosition ? r - 10 : r - 60,
            null == t.chartTitle && (i = r = 10,
            n = r - 20),
            i -= t.legend_height,
            n -= t.legend_height
        },
        getMaxNum: function(t) {
            for (var e = t.data, r = 0, i = e.length, n = 0, s = 1; i > s && (null != e[s][1] && "" != e[s][1]); s++)
                n++,
                r = Math.max(r, parseFloat(e[s][1]));
            if (10 >= r)
                return {
                    max_num: r,
                    space_num: 1,
                    rlength: n
                };
            var o, l = r.toString(), a = l.length, u = l[0], h = l[0];
            if (5 > u && 9 >= h) {
                var c = 5 * parseInt((u + h) / 5) * Math.pow(10, a - 2);
                r > c && (c = (5 * parseInt((u + h) / 5) + 5) * Math.pow(10, a - 2)),
                o = {
                    max_num: c,
                    space_num: 5 * Math.pow(10, a - 2)
                }
            } else {
                var c = parseInt(u) * Math.pow(10, a - 1);
                r > c && (c = (parseInt(u) + 1) * Math.pow(10, a - 1)),
                o = {
                    max_num: c,
                    space_num: Math.pow(10, a - 1)
                }
            }
            return o.rlength = n,
            o
        },
        getFontSize: function(t) {
            this._titleSize = .02 * t,
            this._moreSize = .01 * t
        }
    },
    t
});
;/*!/compapi/design/Base.js*/
define("compapi/design/Base", ["comp/design/Chuangkit"], function(t) {
    var n = function(n) {
        t.extendOptions(this, n)
    };
    return n.prototype = {
        constructor: n,
        _jq_object: null,
        options: {
            id: ""
        },
        setJqObject: function(t) {
            return this._jq_object = t,
            this
        },
        getJqObject: function() {
            return this._jq_object
        }
    },
    n
});
;/*!/compapi/design/chart/Chart.js*/
define("compapi/design/chart/Chart", ["components/jquery/jquery"], function() {
    var n = function() {};
    return n.prototype = {},
    n
});
;/*!/compapi/design/design_config.js*/
define("compapi/design/design_config", [], {
    DESIGN_BLANK: {
        left: 50,
        right: 150,
        top: 50,
        bottom: 50
    },
    BLEED_SIZE: parseFloat(23.622048).toFixed(8),
    MAX_PAGE_NUM: 30,
    MATERIAL_PAGE_SIZE: 10,
    ANXID: "texteventtarget",
    ANXIDCOPY: "texteventtarget-clone",
    FONTLOCALHOST: "/fonts/fontWoff/",
    PAGE_EDITBAR_CHANGE_HEIGHT: "250",
    PAGE_EDITBAR_CHANGE_MARGIN: "330",
    FONT_FAMILY_DEFAULT: "Microsoft YaHei",
    FONTFAMILY: {
        "Abril Fatface": "Abril Fatface.woff",
        "Alegreya SC": "Alegreya SC.woff",
        Allura: "Allura.woff",
        "Aria Slab": "Aria Slab.woff",
        "Arial Rounded MT Bold": "Arial Rounded MT Bold.woff",
        Arvo: "Arvo.woff",
        "Black Ops One": "Black Ops One.woff",
        "BradleyHandITCTT-Bold": "Bradleyhand-Bold.woff",
        "BradleyhandITCTT-Bold": "Bradleyhand-Bold.woff",
        "Broadway BT": "Broadway BT.woff",
        "BroadwayBT-Regular": "Broadway BT.woff",
        CabinSketch: "CabinSketch.woff",
        "Cinzel-Bold": "Cinzel-Bold.woff",
        "Comic Sans MS": "Comic Sans MS.woff",
        ComicSansMS: "Comic Sans MS.woff",
        DroidSerif: "Droidserif-Regular.woff",
        Elegante: "Elegante.woff",
        GingerPeachy: "GingerPeachy.woff",
        GlaserSteD: "Glasersted-Regular.woff",
        Graduate: "Graduate.woff",
        "IM FELL Double Pica": "IM FELL Double Pica.woff",
        "Myanmar Sangam MN": "Myanmar Sangam MN.woff",
        Unica: "Unica.woff",
        "微软雅黑": "weiruanyahei.woff",
        "方正彩云简体": "fzcaiyunjianti.woff",
        "方正超粗黑简体": "fzchaocuheijianti.woff",
        "方正大黑简体": "fzdaheijianti.woff",
        "方正行楷简体": "fzxingkaijianti.woff",
        "方正剪纸简体": "fzjianzhijianti.woff",
        "方正楷体简体": "fzkaitijianti.woff",
        "方正隶书简体": "fzlishujianti.woff",
        "方正美黑简体": "fzmeiheijianti.woff",
        "方正书宋简体": "fzshusongjianti.woff",
        "方正舒体简体": "fzshutijianti.woff",
        "方正宋黑简体": "fzsongheijianti.woff",
        "方正宋一简体": "fzsongyijianti.woff",
        "方正魏碑简体": "fzweibeijianti.woff",
        "方正细等线简体": "fzxidengxianjianti.woff",
        "方正细黑一简体": "fzxiheijianti.woff",
        "方正细圆简体": "fzxiyuanjianti.woff",
        "方正小标宋简体": "fzxiaobiaosongjianti.woff",
        "方正姚体简体": "fzyaotijianti.woff",
        "方正中等线简体": "fzzhongdengxianjianti.woff",
        "方正综艺简体": "fzzongyijianti.woff",
        "大侦探": "dazhentan.woff",
        "喵想细黑朱古力体": "mxxhzglt.woff",
        "奇思_奔跑吧电影": "qsbpbdy.woff",
        "奇思黑体恐怖医院体": "qshtkbyyt.woff",
        "奇思黑体小丑体": "qshtxct.woff",
        "奇思源黑": "qsyh.woff",
        "字体管家仿宋": "ztgjfangsong.woff",
        "字体管家楷体": "ztgjkaiti.woff",
        "字体管家黑体": "ztgjheiti.woff",
        "字体管家细圆": "ztgjxihei.woff",
        "站酷高端黑": "zkgdh.woff",
        "站酷快乐体": "zkklt.woff",
        "AmaticSC-Regular": "Amaticsc-Regular.woff",
        Amaranth: "Amaranth-Regular.woff",
        Anton: "Anton-Regular.woff",
        ArialNarrow: "Arialnarrow-Regular.woff",
        ArialMT: "Arial-Regular.woff",
        BanglaSangamMN: "Banglasangammn-Regular.woff",
        Calibri: "Calibri-Regular.woff",
        "DINcondensed-Bold": "Dincondensed-Bold.woff",
        "Economica-Regular": "Economica-Regular.woff",
        EngraversMT: "Engraversmt-Regular.woff",
        Gruppo: "Gruppo-Regular.woff",
        Helvetica: "Helvetica-Regular.woff",
        "JosefinSans-Bold": "Josefinsans-Bold.woff",
        "JuliusSansOne-Regular": "Juliussansone-Regular.woff",
        "Lowanoldstyle-Black": "Lowanoldstyle-Black.woff",
        OratorStd: "Oratorstd-Medium.woff",
        "Quicksand-Regular": "Quicksand-Regular.woff",
        Didot: "Didot.woff",
        "Bickham Script Pro": "BickhamScriptPro-Regular.woff",
        Bauhaus: "Bauhaus.woff",
        "Antenna-Light": "Antenna-Light.woff",
        "方正剪纸简体": "fzjz.woff",
        "方正细圆简体": "fzxy.woff",
        "方正综艺简体": "fzzy.woff",
        "汉真广标": "hzgb.woff",
        "迷你简长艺": "changyi.woff",
        "迷你简超粗黑": "chaocuhei.woff",
        "迷你简粗宋": "cusong.woff",
        "迷你简大黑": "dahei.woff",
        "迷你简方叠体": "fangdieti.woff",
        "迷你简黑体": "heiti.woff",
        "迷你简家书": "jiashu.woff",
        "迷你简菱心": "lingxin.woff",
        "迷你简美黑": "meihei.woff",
        "迷你简平黑": "pinghei.woff",
        "迷你简特细等线": "txdx.woff",
        "迷你简细等线": "xidengxian.woff",
        "迷你简细行楷": "xixingkai.woff",
        "迷你简细黑": "xihei.woff",
        "迷你简细倩": "xiqian.woff",
        "迷你简细圆": "xiyuan.woff",
        "迷你简小标宋": "xiaobiaosong.woff",
        "迷你简小隶书": "xiaolishu.woff",
        "迷你简新舒体": "xinshuti.woff",
        "迷你简丫丫": "yaya.woff",
        "迷你简姚体": "yaoti.woff",
        "迷你简艺黑": "yihei.woff",
        "迷你简硬笔行书": "ybxs.woff",
        "迷你简幼线": "youxian.woff",
        "迷你简稚艺": "zhiyi.woff",
        "迷你简中倩": "zhongqian.woff",
        "迷你简准圆": "zhunyuan.woff",
        "迷你简综艺": "zongyi.woff",
        "时尚中黑简体": "sszh.woff",
        "宋体": "songti.woff",
        "造字工房映力黑规体": "zzgfylhg.woff",
        "新蒂黑板报体": "xdhbb.woff",
        "迷你简中等线": "mnjzdx.woff",
        "迷你简楷体": "mnjkt.woff",
        "迷你简北魏楷书": "mnjbwks.woff",
        "李旭科书法": "lxksf.woff"
    }
});
;/*!/compapi/design/toolbar/toolbar_config.js*/
define("compapi/design/toolbar/toolbar_config", ["compapi/b", "components/jquery/jquery", "libs/requirejs/plugins/text!/compapi/design/toolbar/toolbar_config.htm", "compapi/design/design_config"], function(e, t, r) {
    var n = t(r).filter(function() {
        return 1 === this.nodeType
    });
    return {
        getDesignEditbar: function() {
            var e = n.filter(".design-bar");
            return 1 == KIND_ID || 39 == KIND_ID ? e.find(".ppt-show").css("display", "block") : e.find(".ppt-show").css("display", "none"),
            [e[0], e[1], e[2]]
        },
        getElementEditbar: function() {
            var e = n.filter(".element-edit-bar");
            return e
        },
        getPageEditbar: function() {
            var e = n.filter(".page-edit-bar").clone();
            return "true" == window.localStorage.preview_new && e.find(".page_preview").removeClass("new-function"),
            e.find(".page-copy").find(".page-edit-bar-text").html("复制页面</ br>最多" + MAX_PAGE + "页"),
            e.find(".page-add").find(".page-edit-bar-text").html("添加新页</ br>最多" + MAX_PAGE + "页"),
            e[0]
        },
        getPagePreview: function() {
            if (6 == KIND_ID) {
                var e = n.filter(".preview_accross_bar").clone()[0];
                return e
            }
            if (4 == KIND_ID) {
                var e = n.filter(".preview-wechat-moments-container").clone()[0];
                return e
            }
            if (20 == KIND_ID) {
                var e = n.filter(".preview_max_bar").clone()[0];
                return e
            }
        },
        getMultiElementBar: function() {
            var e = n.filter(".multi-element-bar");
            return e
        },
        getFontSizeSet: function() {
            var e = n.filter(".fontSizeSet");
            return e
        },
        getFontSize: function(e) {
            var r, i = n.filter("#text-size-bar"), a = i.children("ul");
            if (a.children().size() < 1)
                for (var o = e; 2048 >= o; o++)
                    r = '<li class="text-size-son">' + o + "</li>",
                    t(r).appendTo(a);
            return i
        },
        getFontFamily: function() {
            var e = n.filter("#text-family-bar")
              , r = e.find("#text-family-list");
            0 != window.font_family.font_family_list.length && r.children().detach();
            for (var i, a, o, l, f = window.font_family.font_family_list, u = 0; u < f.length; u++) {
                a = '<li class="text-family-group"><span class="text-family-group-text small_font">' + f[u].kindName + "</span></li>",
                r.append(a),
                o = f[u].fonts;
                for (var c = 0; c < o.length; c++)
                    if (!o[c].fontIsExpired) {
                        if (o[c].fontNeedsVip) {
                            if (window.api || window.ziyun)
                                continue;
                            l = '<span class="text-family-vip"></span>'
                        } else
                            l = "";
                        i = '<li class="text-family-son"><div data-index="' + o[c].fontImgIndex + '" data-alt="' + o[c].fontFamily + '" style="background-position:0px -' + 17 * o[c].fontImgIndex + 'px"></div>' + l + "</li>",
                        r.append(i)
                    }
            }
            var s = window.font_family.font_family_img_url;
            return t(".text-family-son div").css("background-image", "url(" + s + ")"),
            window.font_family.font_family_list = [],
            e
        },
        getFontAlign: function() {
            var e = n.filter("#text-align-bar");
            return e
        },
        getEleReverse: function() {
            var e = n.filter("#ele-turn-bar");
            return e
        },
        getEleMove: function() {
            var e = n.filter("#ele-move-bar");
            return e
        },
        getEleGroupAlign: function() {
            var e = n.filter("#group-align-bar");
            return e
        },
        getEleGroupDistributed: function() {
            var e = n.filter("#group-distributed-bar");
            return e
        },
        getOpacityWrap: function() {
            var e = n.filter("#opacity-wrap");
            return e
        },
        getBoldWrap: function() {
            var e = n.filter("#bold-wrap");
            return e
        },
        getTextSpaceWrap: function() {
            var e = n.filter("#text-spacing-wrap");
            return e
        },
        getColorWrap: function() {
            var e = n.filter(".colorWrap");
            return e
        },
        getEditDiv: function() {
            var e = n.filter("#edit-div");
            return e
        },
        getEditColor: function() {
            var e = n.filter("#edit-color");
            return e
        },
        getDownload: function() {
            var e = n.filter("#download");
            return (1 == KIND_ID || 39 == KIND_ID) && e.find(".download-ppt").css("display", "block"),
            e
        },
        getDownloadPhone: function() {
            var e = n.filter("#download_phone");
            return e
        },
        getUploadPhone: function() {
            var e = n.filter("#upload_phone");
            return e
        },
        getActive: function() {
            var e = n.filter(".active");
            return e
        },
        getActiveWeixinShare: function() {
            var e = n.filter(".active-weixin-share");
            return e
        },
        getShare: function() {
            var e = n.filter(".public_share_box");
            return e
        },
        getShareTitle: function() {
            var e = n.filter(".share");
            return e
        },
        getSharebox: function() {
            var e = n.filter(".share_box");
            return e
        },
        getThumbWait: function() {
            var e = n.filter("#thumb-wait");
            return e
        },
        getDownloadWait: function() {
            var e = n.filter("#download-wait");
            return e
        },
        getShareYes: function() {
            var e = n.filter("#share-yes");
            return e
        },
        getConfirm: function() {
            var e = n.filter(".confirm-container");
            return e
        },
        getFilter: function() {
            var e = n.filter(".filter-wrap");
            return e.appendTo(t("#leftToolbarWrap")),
            e
        },
        getTextMenuMore: function() {
            var e = n.filter("#edit-menu-more");
            return e.children().css("display", "block"),
            e
        },
        getMenuMore: function() {
            var e = n.filter("#edit-menu-more");
            return e.children().css("display", "block"),
            e.find(".text-menu-more").css("display", "none"),
            e
        },
        getElementGroup: function() {
            var e = n.filter(".elementGroup").clone();
            return e
        },
        getPreviewAccross: function() {
            var e = n.filter(".preview_accross_bar");
            return e
        },
        getPreviewMax: function() {
            var e = n.filter(".preview_max_bar");
            return e
        },
        getCanvasSize: function() {
            var e = n.filter(".canvas-adjustment");
            return e
        },
        getChangesence: function() {
            var e = n.filter(".sence-change");
            return e
        },
        getChangeVipsence: function() {
            var e = n.filter(".sence-change-vip");
            return e
        },
        getChangeTips: function() {
            var e = n.filter(".sence_tips_success");
            return e
        },
        getMydesign: function() {
            var e = n.filter("#myDesign_content");
            return e
        },
        getMyDesignPage: function() {
            var e = n.filter(".myDesign-content-page");
            return e
        },
        getTemplateModal: function() {
            var e = n.filter("#bigTpl");
            return e
        }
    }
});
;/*!/compapi/design/Chuangkit.js*/
"use strict";
define("compapi/design/Chuangkit", ["comp/config/global_config", "components/jquery/jquery", "compapi/b", "libs/jquery/jquery.mousewheel", "libs/webuploader/webuploader", "libs/jquery/minicolors/jquery.minicolors", "libs/handsontable/handsontable.full.min", "comp/design/design_config", "libs/jquery/jquery.transit.min", "widget/logreg/logreg", "widget/pop/pop", "compapi/design/toolbar/toolbar_config", "widget/vipExclusive/vipExclusive", "libs/crypto-js", "libs/colorpicker/colorpicker"], function(e, a, t, i, o, r, n, l, s, d, c, p, f, h, u) {
    function g() {
        var e = localStorage.color;
        if (void 0 != e)
            for (var t = e.split(","), i = t.length, o = 0; i > o; o++)
                a("#edit-color").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor"),
                a("#backColorPreinstall").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor")
    }
    function m() {
        a("#design_title>input").focus(function() {
            var e = a(this);
            0 == e.val().length && (e.val(""),
            e.attr("placeholder", ""))
        }).blur(function() {
            a(this).attr("placeholder", "点击设置作品标题")
        })
    }
    function _(e, i) {
        var o = a(this)
          , r = La._owner_design;
        if (a(".panelArrow").hasClass("rightArrow") && a(".panelArrow").click(),
        "chartMenuBtn" == o.attr("id")) {
            var n = r._focus_element;
            null != n && "svgChart" == n._element_type ? e.initChartBtn(n) : (r.nodeMousedown(i),
            e.initChartBtn(null))
        } else
            r.nodeMousedown(i);
        var s = a(".leftPanelMenuListBtn").index(this);
        if (0 == s && (E(),
        N(i)),
        1 == s && (t.addSomeMouseClick("左侧-图案按钮"),
        N(i)),
        3 == s && (t.addSomeMouseClick("左侧-文字按钮"),
        1 == a("#fontMaterialShow").attr("data-index"))) {
            var c = {
                pageNo: 1,
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 133
            };
            e.queryMaterial(e._ajax_url.queryMaterial, c, [0, 0, 0], "fontMaterialShow")
        }
        if (4 == s) {
            t.addSomeMouseClick("左侧-模板按钮");
            var p;
            if (window.TEAM_ID > 0) {
                if (p = "teamTemplate",
                1 == a("#teamTemplate").attr("data-index")) {
                    var c = {
                        pageNo: 1,
                        pageSize: e._ajax_page_size,
                        sort: 0,
                        tid: window.TEAM_ID,
                        skid: KIND_ID
                    };
                    e.queryTemplate(c, p)
                }
            } else if (p = "templateShow",
            1 == a("#templateShow").attr("data-index")) {
                var c = {
                    pageNo: 1,
                    pageSize: l.MATERIAL_PAGE_SIZE,
                    secondKindId: KIND_ID,
                    stickOrder: 1
                };
                e.queryTemplate(c, p)
            }
        }
        if (6 == s && a(".folder").not(".folder-add").size() <= 2) {
            if (window.VIP_EXPIRED) {
                var f = window.localStorage.getItem("vip_end_tip_in_design_page_folder");
                "false" != f && (a(".vip-end-wrap").show(),
                a(".vip-end-wrap-again-sign").click(function() {
                    a(this).hasClass("vip-end-sign-checked") ? (a(this).removeClass("vip-end-sign-checked"),
                    window.localStorage.setItem("vip_end_tip_in_design_page_folder", "true")) : (a(this).addClass("vip-end-sign-checked"),
                    window.localStorage.setItem("vip_end_tip_in_design_page_folder", "false"))
                }),
                a(".vip-end-donate-later").click(function() {
                    a(".vip-end-wrap").hide()
                }))
            }
            if (!window.ISLOGIN)
                return d.show(),
                !1;
            pa(e),
            Aa(),
            window.TEAM_ID > 0 && (Da(e),
            Ka()),
            a(".folder_wrap").find(".folder-define").click()
        }
        if (5 == s && (t.addSomeMouseClick("左侧-背景按钮"),
        1 == a("#backImgChooseWrap").attr("data-index"))) {
            var c = {
                pageNo: 1,
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 2
            };
            e.queryMaterial(e._ajax_url.queryMaterial, c, [0, 0, 0], "backImgChooseWrap")
        }
        if (-324 == parseInt(a("#leftPanelWrap").css("left")) && a("#leftPanelWrap").css({
            left: 0
        }),
        a(this).hasClass("listBtnClick"))
            return !1;
        a(".leftPanelMenuBorder").stop();
        var h = a(this).offset().top - 50;
        a(".listBtnClick").removeClass("listBtnClick"),
        a(this).addClass("listBtnClick"),
        a("#leftPanelMenuBorder").css({
            top: h
        }),
        a("#leftPanelContentWrap").css({
            top: -1 * a("#leftPanelWrap").getHeight() * s
        })
    }
    function v(e) {
        var t = a(this)
          , i = e._owner_design
          , o = 400;
        if (a(".page-edit-bar").fadeOut(100),
        t.hasClass("leftArrow")) {
            var r = document.body.clientWidth - 54;
            a(".element-edit-bar").css({
                left: "54px",
                width: r + "px"
            }),
            a("#rightPanel").animate({
                left: "54px",
                width: r + "px"
            }, o),
            a("#leftToolbarWrap, #leftPanelNoClick").hide(),
            a("#multipageWrap, #leftPanelWrap").animate({
                width: "0px"
            }, o),
            a("#leftPanel").animate({
                width: "54px"
            }, o, function() {
                a(".page-edit-bar").fadeIn(100)
            }),
            i.setPageScale(void 0, r),
            t.removeClass("leftArrow").addClass("rightArrow");
            var n = i.getCurPage();
            n.nodeMousedown()
        } else {
            var r = document.body.clientWidth - 378;
            a(".element-edit-bar").css({
                left: "378px",
                width: r + "px"
            }),
            a("#rightPanel").animate({
                left: "378px",
                width: r + "px"
            }, o),
            a("#multipageWrap, #leftPanelWrap").animate({
                width: "324px"
            }, o),
            a("#leftPanel").animate({
                width: "378px"
            }, o, function() {
                a("#leftToolbarWrap").show(),
                a(".page-edit-bar").fadeIn(100)
            }),
            i.setPageScale(void 0, r),
            t.removeClass("rightArrow").addClass("leftArrow");
            var n = i.getCurPage();
            n.nodeMousedown()
        }
    }
    function w(e, t) {
        if (!e._kind_click_drag) {
            var i = a(this);
            if (!window.ISLOGIN && -1 == i.attr("data-kind"))
                return d.show(),
                !1;
            N(t),
            e._kind_click_drag = !0;
            var o = a("#materialWrap")
              , r = a(".materialShow .secondKindWrap");
            if (0 == r.find(".point-out-circle").length) {
                var n = {
                    name: "secondKindWrap",
                    element: r[0],
                    position_left: 83,
                    position_top: -1
                };
                c.pointOut(n)
            }
            if (a(".secondKindUl").css("display", "none"),
            i.hasClass("materialKindClick") || i.hasClass("materialKindNoClick"))
                o.stop(),
                "pending" == e._query_ajax.promise().state() && e._query_ajax.abort(),
                a("#meterialSecondKindListWrap").animate({
                    height: 0
                }, "fast", function() {
                    a(this).css("display", "none")
                }),
                o.animate({
                    height: 0
                }, "fast", function() {
                    a(this).css("display", "none"),
                    a(".materialKindClick").removeClass("materialKindClick"),
                    a(".materialKindNoClick").removeClass("materialKindNoClick"),
                    a(".materialShowOpen").removeClass("materialShowOpen"),
                    a("#materialWrap").children(".nohaveTipsTemplate").detach(),
                    e._kind_click_drag = !1
                }),
                a(".materialKind").css({
                    "margin-top": "15px"
                });
            else {
                i.addClass("materialKindClick"),
                a(".materialKind").not(this).each(function() {
                    a(this).addClass("materialKindNoClick")
                });
                var s = a(".materialKind").index(this)
                  , p = i.attr("data-kind")
                  , f = [0, 0, 0];
                2 == p ? (a(".materialShow").addClass("xifuShow"),
                a("#secondKindWrap").css({
                    top: "30px"
                }),
                f = [20, 20, 20]) : (a(".materialShow").removeClass("xifuShow"),
                a("#secondKindWrap").css({
                    top: "14px"
                })),
                6 == p ? (f = [100, 0, 0],
                a(".go-to-upload").show().removeClass("second-kind-go-to-upload")) : a(".go-to-upload").hide(),
                e.materialSecondKindListShow.call(e, s, i);
                var h = i.offset().top + i.getHeight() + 20 - a("#materialKindList").offset().top + 60;
                h += a("#meterialSecondKindListWrap").outerHeight(),
                o.attr("data-firstid", p).removeAttr("data-secondid").children(".chooseMaterialLi").detach(),
                o.css({
                    top: h,
                    display: "block"
                }).attr({
                    "data-height": 150
                }).animate({
                    height: 150
                }, 300, function() {
                    if (o.children(".onloadMaterial").css("display", "block"),
                    a(".secondKindUl").children().detach(),
                    a("#secondKindWrap").children("div").html("全部"),
                    e.searchMaterialSecondKind(s),
                    -1 != p) {
                        var t = {
                            firstKindId: p,
                            pageNo: 1,
                            pageSize: l.MATERIAL_PAGE_SIZE
                        };
                        e.queryMaterial(e._ajax_url.queryMaterial, t, f, "materialWrap")
                    } else {
                        var t = {
                            pageNo: 1,
                            pageSize: l.MATERIAL_PAGE_SIZE
                        };
                        e.queryMaterial(e._ajax_url.queryCollMaterial, t, f, "materialWrap")
                    }
                    e._kind_click_drag = !1
                });
                for (var u = s + 3 - s % 3, g = u + 3; g > u; u++) {
                    var m = a(".materialKind").eq(u);
                    m.css("margin-top", 255)
                }
            }
        }
    }
    function k(e, t) {
        N(t);
        var i = a(this);
        a("#secondKindWrap").children("div").html(i.attr("data-name"));
        var o = a("#materialWrap");
        o.children(".chooseMaterialLi").detach(),
        o.children(".nohaveTipsTemplate").detach();
        var r = l.MATERIAL_PAGE_SIZE
          , n = {
            pageNo: 1,
            pageSize: r
        };
        a(".meterialSecondKindList").find(".secondKindListClick").removeClass("secondKindListClick");
        var s;
        "全部" == i.attr("data-name") ? (s = i.attr("data-firstid"),
        -1 == s ? n.type = 0 : n.firstKindId = i.attr("data-firstid"),
        o.removeAttr("data-secondid"),
        a(".meterialSecondKindList").find(".secondKindList").eq(0).addClass("secondKindListClick")) : (s = i.attr("data-firstid"),
        -1 == s ? n.type = i.attr("data-secondid") : n.secondKindId = i.attr("data-secondid"),
        o.attr("data-secondid", i.attr("data-secondid")),
        a(".meterialSecondKindList").find(".secondKindList[data-secondid=" + n.secondKindId + "]").addClass("secondKindListClick"));
        var d = [0, 0, 0];
        return 6 == a(".materialKindClick").attr("data-kind") && (d = [100, 0, 0],
        a(".go-to-upload").addClass("second-kind-go-to-upload")),
        2 == a(".materialKindClick").attr("data-kind") && (d = [20, 20, 20]),
        o.css({
            height: 150
        }).attr({
            "data-height": 150
        }).animate({
            height: 150
        }),
        a("#materialContent").animate({
            scrollTop: a(".materialKindClick").offset().top - a("#materialKindList").offset().top
        }, function() {
            -1 == s ? e.queryMaterial(e._ajax_url.queryCollMaterial, n, d, "materialWrap") : e.queryMaterial(e._ajax_url.queryMaterial, n, d, "materialWrap")
        }),
        t.stopPropagation(),
        !1
    }
    function y() {
        N(),
        a(this).addClass("secondKindListMoreClick").text("收起更多分类");
        var e = a("#meterialSecondKindListWrap")
          , t = e.find(".meterialSecondKindList")
          , i = t.outerHeight()
          , o = parseInt(t.attr("data-height-change"));
        t.css({
            height: i + o + "px"
        });
        var r = a("#materialWrap").css("top")
          , n = parseFloat(r) + o;
        a("#materialWrap").animate({
            top: n + "px"
        }, 300)
    }
    function C() {
        N(),
        a(this).removeClass("secondKindListMoreClick").text("展开更多分类");
        var e = a("#meterialSecondKindListWrap")
          , t = e.find(".meterialSecondKindList")
          , i = t.outerHeight()
          , o = parseInt(t.attr("data-height-change"));
        e.find(".meterialSecondKindList").css("height", i - o + "px");
        var r = a("#materialWrap").css("top")
          , n = parseFloat(r) - o;
        a("#materialWrap").animate({
            top: n + "px"
        }, 300)
    }
    function T(e) {
        var t = a("#materialSearch")
          , i = t.parent();
        if (t.offset().top <= 100 ? (a("#searchKeyWord").css({
            width: "50%",
            left: "25%"
        }).offset({
            top: 115
        }),
        a("#searchMaterialup").css({
            scale: 1
        }).offset({
            top: 115
        })) : (a("#searchKeyWord").css({
            width: "100%",
            left: "0px",
            top: "14px"
        }),
        a("#searchMaterialup").css({
            top: "14px",
            scale: 0
        })),
        t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var o = i.offset().top + i.height() + 60
          , r = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , n = Math.max(r[0], r[1], r[2]);
        if (n += t.offset().top,
        o > n && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                word: t.attr("data-key")
            }
              , d = t.find("#searchKeyWord").attr("data-type");
            d > 0 && (s.ct = d),
            t.height(t.getHeight() + 50),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.searchMaterial, s, r, "materialSearch")
        }
    }
    function I(e) {
        if ("block" == a("#materialWrap").css("display") && (a("#materialWrap").offset().top <= 100 ? (a("#secondKindWrap").css({
            opacity: "1",
            display: "block"
        }).offset({
            top: 115
        }),
        a(".secondKindLi").css({
            width: 140
        }),
        a("#materialup").css({
            scale: 1
        }).offset({
            top: 115
        })) : (a("#secondKindWrap").css({
            opacity: "0",
            display: "none"
        }),
        a("#secondKindWrap").css(a("#materialWrap").hasClass("xifuShow") ? {
            top: "30px"
        } : {
            top: "14px"
        }),
        a(".secondKindLi").css({
            width: 280
        }),
        a("#materialup").css({
            top: "14px",
            scale: 0
        }))),
        "block" == a("#materialWrap").css("display")) {
            var t = a("#materialWrap")
              , i = t.parent();
            if (t.children(".nohaveTipsTemplate").size() > 0)
                return void (e._kind_click_drag = !1);
            var o = i.offset().top + i.height() + 60
              , r = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
              , n = Math.max(r[0], r[1], r[2]);
            if (n += t.offset().top,
            o > n && !e._kind_click_drag) {
                e._kind_click_drag = !0;
                var s = {
                    pageNo: t.attr("data-index"),
                    pageSize: l.MATERIAL_PAGE_SIZE
                }
                  , d = t.attr("data-secondid")
                  , c = t.attr("data-firstid");
                void 0 != d && "" != d ? -1 == c ? s.type = d : s.secondKindId = d : -1 == c ? s.type = 0 : s.firstKindId = c,
                t.height(t.getHeight() + 50),
                t.children(".onloadMaterial").css("display", "block");
                for (var p = a(".materialKindClick").index(".materialKind"), f = p + 3 - p % 3, h = f + 3; h > f; f++) {
                    var u = a(".materialKind").eq(f);
                    u.css("margin-top", 15 + t.getHeight() + 20)
                }
                e.queryMaterial(e._ajax_url.queryMaterial, s, r, "materialWrap")
            }
        }
    }
    function M(e) {
        var t = a("#fontMaterialShow")
          , i = t.parent();
        if (t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var o = i.offset().top + i.height() + 60
          , r = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , n = Math.max(r[0], r[1], r[2]);
        if (n += t.offset().top,
        o > n && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 133
            };
            t.height(t.getHeight() + 50),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.queryMaterial, s, r, "fontMaterialShow")
        }
    }
    function x(e) {
        var t = a("#backImgChooseWrap")
          , i = t.parent();
        if (t.children(".nohaveTipsTemplate").size() > 0)
            return e._kind_click_drag = !1,
            void console.log("滚动加载完毕，无素材了，滚动已解锁");
        var o = i.offset().top + i.height() + 60
          , r = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , n = Math.max(r[0], r[1], r[2]);
        if (n += t.offset().top,
        o > n && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: 2
            };
            t.height(t.getHeight() + 50),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.queryMaterial, s, r, "backImgChooseWrap")
        }
    }
    function b(e) {
        var t = a("#leadingMaterialWrap")
          , i = t.parent();
        if (t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var o = i.offset().top + i.height() + 60
          , r = [parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))]
          , n = Math.max(r[0], r[1], r[2]);
        if (n += t.offset().top,
        o > n && !e._kind_click_drag) {
            e._kind_click_drag = !0;
            var s = {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE
            };
            t.height(t.getHeight()),
            t.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(e._ajax_url.queryMaterialsInFolder, s, r, "leadingMaterialWrap")
        }
    }
    function S(e) {
        var t, i, o = a("#templateContentKind").find(".templateKindBtnClick").index();
        if (0 == o ? (t = a("#templateShow"),
        i = "templateShow") : 1 == o ? (t = a("#collectionTemplate"),
        i = "collectionTemplate") : (t = a("#teamTemplate"),
        i = "teamTemplate"),
        t.children(".nohaveTipsTemplate").size() > 0)
            return void (e._kind_click_drag = !1);
        var r = a("#templateContent");
        if (r.getHeight() - t.offset().top + r.offset().top >= t.height() - 30 && !e._kind_click_drag) {
            var n = ([parseFloat(t.attr("data-a")), parseFloat(t.attr("data-b")), parseFloat(t.attr("data-c"))],
            {
                pageNo: t.attr("data-index"),
                pageSize: l.MATERIAL_PAGE_SIZE,
                secondKindId: KIND_ID
            });
            0 == o ? n.stickOrder = 1 : 1 == o ? n = {
                pageNo: 1,
                pageSize: e._ajax_page_size,
                fid: -1,
                kindId: KIND_ID,
                sort: 0,
                type: 2
            } : 2 == o && (n.timeOrder = 1,
            n.tid = window.TEAM_ID),
            t.children(".onloadTemplate").appendTo(t),
            t.children(".onloadTemplate").css("display", "block"),
            e.queryTemplate(n, i)
        }
    }
    function A(e, i) {
        N(),
        a("#leftPanelWrap").find("#clear_search_material").show();
        var o;
        a(this).hasClass("search_material_his_li") ? (o = a(this).text(),
        a("#leftPanelInput").val(o)) : o = a("#leftPanelInput").val();
        var o = t.htmlUtil(o, !0);
        if (0 == o.length)
            return !1;
        if (window.localStorage) {
            var r = window.localStorage.getItem("search_material_history");
            if (null == r || void 0 == r)
                r = o;
            else {
                for (var n, s = r.split(","), d = 0; d < s.length; d++)
                    if (s[d] == o) {
                        n = !0;
                        break
                    }
                if (n || (r = o + "," + r),
                s = r.split(","),
                s.length > 19) {
                    var c = r.lastIndexOf(",");
                    r = r.substring(0, c)
                }
            }
            window.localStorage.setItem("search_material_history", r)
        }
        a("#materialSearch").children(".chooseMaterialLi").detach(),
        a("#searchKeyWord").css({
            width: "100%",
            left: "0px",
            top: "14px"
        }),
        a("#searchMaterialup").css({
            top: "14px",
            scale: 0
        }),
        a("#materialSearch").children(".nohaveTipsTemplate").detach(),
        a("#materialSearch").children(".onloadMaterial").css("display", "block"),
        a("#materialSearch").attr("data-key", o),
        a("#materialSearch").height(150),
        null != e._query_ajax && "pending" == e._query_ajax.promise().state() && e._query_ajax.abort();
        var p = {
            pageNo: 1,
            pageSize: l.MATERIAL_PAGE_SIZE,
            word: o
        }
          , i = a("#materialSearch").find("#searchKeyWord").attr("data-type");
        i > 0 && (p.ct = i),
        e.queryMaterial(e._ajax_url.searchMaterial, p, [50, 50, 50], "materialSearch"),
        a("#searchKeyWord").css("display", "block").attr("title", o).find("#searchKeyWordType").html(o),
        a("#materialSearch").show(),
        a("#search_material_history_wrap").hide()
    }
    function E() {
        if (window.localStorage) {
            var e = window.localStorage.getItem("search_material_history");
            if (null != e || void 0 != e) {
                if (e.length > 0) {
                    e = e.split(",");
                    var t = a("#leftPanelWrap").find(".search_material_his_list");
                    t.children("li").remove();
                    for (var i, o = 0; o < e.length; o++)
                        0 != e[o].length && (i = '<li class="search_material_his_li">' + e[o] + "</li>",
                        t.append(i))
                }
            } else
                a("#leftPanelWrap").find("#search_material_history_wrap").hide()
        }
    }
    function D(e, t) {
        if (0 != t.button && !t.isTrigger)
            return !1;
        N(t);
        var i = a(this);
        if (!(i.hasClass("move_chooseMaterialLi") || i.hasClass("move_chooseMaterialLi_click") || i.hasClass("img_uploading"))) {
            var o = e._owner_design
              , r = o.getCurPage();
            o.nodeMousedown(t);
            var n = (r.getNode(),
            i.hasClass("imgMaterial"))
              , l = i.hasClass("backgroundMaterial");
            if (r._svgLayoutNum > 0 && n && !l) {
                r.svgLayoutWrapCreate();
                var s = {
                    drag: !1,
                    index: 0,
                    imgIndex: 0
                }
            }
            var d = t.pageX
              , c = t.pageY
              , p = d
              , f = c
              , h = -1
              , u = i.createClone(e).appendTo("body");
            u.find(".materialInfoIcon").detach(),
            u.find(".materialCollIcon").detach();
            var g = !1
              , m = !1;
            i.parent().hasClass("leadingMaterialWrap") && (m = !0,
            a("#personMaterialDel").css("display", "block"));
            var _ = u.width()
              , v = u.height()
              , w = _ / v
              , k = u.width()
              , y = u.height()
              , C = a(".page").width()
              , T = a(".page").height();
            _ = 300,
            _ > C && (_ = C),
            v = _ / w,
            v > T && (v = T,
            _ = v * w);
            var I = (k - _) / 2
              , M = (y - v) / 2;
            a(document).mousemove(function(e) {
                var a = e.pageX
                  , t = e.pageY
                  , m = a - d
                  , w = t - c;
                "none" == u.css("display") && (u.css({
                    left: parseFloat(u.css("left")) + I,
                    top: parseFloat(u.css("top")) + M
                }),
                u.css({
                    width: _,
                    height: v
                })),
                "block" == u.css("display"),
                u.css({
                    top: "+=" + w + "px",
                    left: "+=" + m + "px",
                    display: "block"
                }),
                h = o.pageEnterCheek(a, t),
                r._svgLayoutNum > 0 && n && !l && r.svgLayoutEnter(s, u),
                d = a,
                c = t,
                i.css("visibility", "hidden"),
                (d - p > 1 || c - f > 1) && (g = !0)
            }).mouseup(function() {
                a("#personMaterialDel").css("display", "none"),
                r._svgLayoutNum > 0 && n && !l && r.svgLayoutWrapRemove(s, u),
                -1 == h || void 0 != s && 0 != s.drag || O.call(u, h, e),
                g || (h = r.getIndex(),
                O.call(u, h, e, !0)),
                i.css("visibility", "visible"),
                u.detach(),
                a(this).off("mousemove").off("mouseup")
            })
        }
    }
    function K(e) {
        var t = a(this)
          , i = t.parent()
          , o = i.attr("data-nickname")
          , r = i.attr("data-keywords")
          , n = parseFloat(i.css("top"))
          , l = parseFloat(i.css("left"))
          , s = parseFloat(i.css("width"))
          , d = parseFloat(i.css("height"))
          , c = i.parent().find(".materialInfoWrap")
          , p = i.parent();
        c.css({
            "padding-top": "7px",
            height: "auto",
            opacity: "1",
            top: n + d - 7 + "px"
        }),
        c.find(".materialTail").css({
            left: l + s / 2 - 5 + "px"
        }),
        (void 0 == o || "" == o) && (o = "创客贴"),
        c.find("#materialCreatorID").text(o),
        c.find("#materialKeywords").text(r),
        t.parent().siblings("li").addClass("meterialInfoShow"),
        p.find(".materialInfoIcon").hide(),
        p.attr("data-material-info", "show");
        var f = document.body.clientHeight
          , h = c.offset().top
          , u = c.outerHeight();
        if (h > f - u) {
            var g = h - (f - u)
              , m = a("#materialContent").scrollTop();
            a("#materialContent").animate({
                scrollTop: m + g + "px"
            }, 300)
        }
        e.stopPropagation()
    }
    function N(e) {
        "show" == a("#materialWrap").attr("data-material-info") && P(a("#materialWrap")),
        "show" == a("#materialSearch").attr("data-material-info") && P(a("#materialSearch")),
        e && e.stopPropagation()
    }
    function P(e) {
        e.find(".materialInfoWrap").css({
            opacity: "0"
        }),
        setTimeout(function() {
            e.find(".materialInfoWrap").css({
                height: "0px",
                "padding-top": "0px"
            })
        }, 300),
        e.children().removeClass("meterialInfoShow"),
        e.find(".materialInfoIcon").show(),
        e.attr("data-material-info", "hide")
    }
    function L() {
        if (!window.ISLOGIN)
            return d.show(),
            !1;
        var e = a(this)
          , t = e.parent().attr("data-id");
        a.ajax(e.hasClass("colled") ? {
            url: "/material/deleteCollectMaterial.do",
            dataType: "json",
            type: "POST",
            data: {
                id: t
            },
            success: function(a) {
                1 == a.code && (e.removeClass("colled"),
                e.attr("title", "收藏素材"),
                Pa())
            },
            error: function() {}
        } : {
            url: "/material/collectMaterial.do",
            dataType: "json",
            type: "POST",
            data: {
                id: t
            },
            success: function(a) {
                1 == a.code && (e.addClass("colled"),
                e.attr("title", "取消收藏"),
                Pa())
            },
            error: function() {}
        })
    }
    function O(e, i, o) {
        var r = a(this)
          , n = i._owner_design
          , l = n.pageScale
          , s = n.pages[e]
          , d = (a(s.getNode()),
        {
            "data-type": function() {
                return r.hasClass("imgMaterial") && !r.hasClass("backgroundMaterial") ? "img" : r.hasClass("svgMaterial") && !r.hasClass("backgroundMaterial") ? "svgImage" : r.hasClass("backgroundMaterial") ? "background" : r.hasClass("groupMaterial") ? "元素类型未定义" : (console.log("元素类型未定义"),
                "元素类型未定义")
            }(),
            "data-img-kind": r.attr("data-type"),
            "data-elem": {
                id: r.children().attr("data-id"),
                "data-key": r.children().attr("alt"),
                width: r.getWidth() / l,
                height: r.getHeight() / l,
                opacity: 1
            },
            transform: F.call(this, i, o, "eles")
        });
        r.hasClass("imgMaterial") && r.hasClass("backgroundMaterial") && (d["data-elem"].lock = "true"),
        window.imgsrc = r.children().attr("src"),
        window.MEMENTO_ID = t.now(),
        "background" == d["data-type"] && (s.eleDelAndUndo(s.elements[0]),
        B.call(this, i, o, d),
        s.flickerBackground({
            transform: d.transform,
            width: d["data-elem"].width,
            height: d["data-elem"].height,
            "img-key": d["data-elem"]["data-key"]
        }));
        var c;
        if (r.hasClass("groupMaterial")) {
            var p = {
                transform: d.transform
            };
            c = s.addElementGroup({
                width: d["data-elem"].width,
                height: d["data-elem"].height,
                json: p,
                fileurl: r.children().attr("fileurl")
            })
        } else
            c = s.createElementAndUndo({
                json: d,
                unshift: !0
            }),
            c.nodeClick()
    }
    function j(e) {
        var i = a(this)
          , o = e._owner_design
          , r = o.getCurPage()
          , n = o.pageScale
          , l = i.children().getWidth() / n
          , s = i.children().getHeight() / n
          , d = i.children().attr("data-family")
          , c = parseFloat(i.children().css("font-size")) / n
          , p = ([parseFloat(e.getFontWH("默", c, d).width), parseFloat(e.getFontWH("认", c, d).width), parseFloat(e.getFontWH("标", c, d).width), parseFloat(e.getFontWH("题", c, d).width)],
        {
            "data-type": "text",
            html: "双击修改",
            "data-elem": {
                width: l,
                height: s,
                "font-size": c,
                "font-family": d,
                fill: "#000",
                wspace: 0,
                "data-align": "center"
            },
            transform: F.call(a(this).children(), e, !0, "text"),
            v: "1.0.1"
        });
        window.MEMENTO_ID = t.now();
        var f = r.createElementAndUndo({
            json: p
        });
        f.nodeClick()
    }
    function W(e) {
        var i = a(this)
          , o = e._owner_design
          , r = o.getCurPage()
          , n = o.pageScale
          , l = i.children().getWidth() / n
          , s = i.children().getHeight() / n
          , d = i.attr("data-family")
          , c = i.attr("data-size")
          , p = i.attr("data-color")
          , f = i.attr("data-space")
          , h = i.attr("data-style")
          , u = "false"
          , g = "false"
          , m = 0
          , _ = "";
        if (null != h && h.length > 0)
            for (var v = h.split(","), w = 0; w < v.length; w++)
                2 == v[w] ? (u = "true",
                _ += "font-style: italic;") : 3 == v[w] ? (g = "true",
                _ += "text-decoration: underline;") : (v[w] = v[w].split("-"),
                m = v[w][1] / 100);
        var k = ([parseFloat(e.getFontWH("默", c, d).width), parseFloat(e.getFontWH("认", c, d).width), parseFloat(e.getFontWH("标", c, d).width), parseFloat(e.getFontWH("题", c, d).width)],
        {
            "data-type": "text",
            html: "双击修改",
            "data-elem": {
                width: l,
                height: s,
                "font-size": c,
                "font-family": d,
                fill: p,
                wspace: f,
                "data-bold": m,
                "data-italic": u,
                "data-decoration": g
            },
            transform: F.call(a(this).children(), e, !0, "text")
        });
        window.MEMENTO_ID = t.now();
        var y = r.createElementAndUndo({
            json: k
        });
        y.nodeClick()
    }
    function F(e, t) {
        var i, o, r = a(this), n = e._owner_design, l = n.pageScale, s = n.getCurPage(), d = a(s.getNode()), c = s.width, p = s.height, f = r.getWidth() / l, h = r.getHeight() / l;
        return t ? (i = (c - f) / 2,
        o = (p - h) / 2) : (i = (r.offset().left - d.offset().left) / l,
        o = (r.offset().top - d.offset().top) / l),
        "translate(" + i + "," + o + ")"
    }
    function B(e, t, i) {
        var o = a(this)
          , r = e._owner_design
          , n = r.pageScale
          , l = r.getCurPage()
          , s = (a(l.getNode()),
        l.width)
          , d = l.height
          , c = o.getWidth() / n
          , p = o.getHeight() / n
          , f = i["data-elem"];
        c / s > p / d ? (f.height = d,
        f.width = d * (c / p)) : (f.width = s,
        f.height = s * (p / c)),
        i.transform = "translate(" + (s - f.width) / 2 + "," + (d - f.height) / 2 + ")"
    }
    function q(e) {
        var t = this.value
          , i = document.getElementById(l.ANXIDCOPY);
        i.value = t;
        var o = e._owner_design
          , r = o._owner_editDiv
          , n = i.scrollHeight;
        r.resetHeight(n);
        var s = this.getBoundingClientRect()
          , d = s.left
          , c = s.top;
        this.style.height = n + "px",
        a(this).offset({
            left: d,
            top: c
        })
    }
    function H(e, i) {
        var o = a(this);
        if (o.hasClass("edit-color-span-nocolor"))
            return !1;
        t.addBugTrackClick("n1");
        var r = e._owner_design;
        r.nodeMousedown(i),
        o.siblings().filter(".now-click").removeClass("now-click"),
        o.addClass("now-click");
        var n = o.css("background-color");
        R(n, e)
    }
    function U() {
        var e = a(this);
        if (!e.hasClass("fontKindBtnClick")) {
            var t = e.parent();
            a(".fontKindBtn").removeClass("fontKindBtnClick"),
            e.addClass("fontKindBtnClick"),
            1 == t.attr("data-drag") ? (a("#fontAddUl").css({
                left: "-100%",
                opacity: "0"
            }),
            a("#teamfontAddUl").css({
                left: "0%",
                opacity: "1"
            }),
            t.attr("data-drag", 2)) : (a("#fontAddUl").css({
                left: "0%",
                opacity: "1"
            }),
            a("#teamfontAddUl").css({
                left: "100%",
                opacity: "0"
            }),
            t.attr("data-drag", 1))
        }
    }
    function z() {
        var e = a(this);
        if (!e.hasClass("backgroundColorClick")) {
            var t = e.parent();
            a(".backgroundColorClick").removeClass("backgroundColorClick"),
            e.addClass("backgroundColorClick"),
            1 == t.attr("data-drag") ? (a("#backColorPreinstall").css({
                left: "-288px",
                opacity: "0"
            }),
            a("#backColorTeaminstall").css({
                left: "0px",
                opacity: "1"
            }),
            t.attr("data-drag", 2)) : (a("#backColorPreinstall").css({
                left: "0px",
                opacity: "1"
            }),
            a("#backColorTeaminstall").css({
                left: "288px",
                opacity: "0"
            }),
            t.attr("data-drag", 1))
        }
    }
    function G() {
        var e = a(this);
        if (!e.hasClass("folderKindClick")) {
            a(".folderClick").size() > 0 && a(".folderClick").click();
            var t = e.parent();
            a(".folderKindClick").removeClass("folderKindClick"),
            e.addClass("folderKindClick"),
            1 == t.attr("data-drag") ? (a(".folder_wrap").css({
                left: "-100%",
                opacity: "0"
            }),
            a(".team_folder_wrap").css({
                left: "0%",
                opacity: "1"
            }),
            t.attr("data-drag", 2)) : (a(".folder_wrap").css({
                left: "0%",
                opacity: "1"
            }),
            a(".team_folder_wrap").css({
                left: "100%",
                opacity: "0"
            }),
            t.attr("data-drag", 1))
        }
    }
    function R(e, i, o) {
        var r = i._owner_design
          , n = r.getCurPage()
          , l = n.getPageSvg()
          , s = a(l)
          , d = n.elements;
        if (s.find(".backgroundSon").size() > 0)
            if (o)
                d[0].previewBackgroundColor(e);
            else {
                window.MEMENTO_ID = t.now(),
                n.eleDelAndUndo(d[0]);
                var c = n.width
                  , p = n.height
                  , f = {
                    "data-type": "background",
                    "data-elem": {
                        "data-key": "false",
                        width: c,
                        height: p,
                        opacity: 1,
                        "data-colors": {
                            0: e
                        }
                    },
                    transform: "translate(0,0)"
                };
                n.createElementAndUndo({
                    json: f,
                    index: 0,
                    unshift: !0
                })
            }
        else {
            var c = n.width
              , p = n.height;
            window.MEMENTO_ID = t.now();
            var f = {
                "data-type": "background",
                "data-elem": {
                    "data-key": "false",
                    width: c,
                    height: p,
                    opacity: 1,
                    "data-colors": {
                        0: e
                    }
                },
                transform: "translate(0,0)"
            };
            n.createElementAndUndo({
                json: f
            })
        }
        s.parent().hasClass("design-page-background-transparent") && s.parent().removeClass("design-page-background-transparent")
    }
    function J() {
        var e = a(".color-input").val()
          , i = localStorage.color;
        if (void 0 == i)
            i = "" + e;
        else {
            for (var o = i.split(","), r = o.length, n = 0; r > n; n++)
                if (t.colorRgb(o[n]) == t.colorRgb(e))
                    return;
            o.length >= 6 ? (o.pop(),
            o.splice(0, 0, e)) : o.splice(0, 0, e),
            i = o.join(",")
        }
        localStorage.color = i,
        La.colorBtnSet()
    }
    function Y(e, a) {
        e instanceof Array ? (e = e.join("haogetedingzhiling"),
        e = "elementGroup" === a ? "e" + e : "c" + e,
        localStorage.eleJson = e) : localStorage.eleJson = JSON.stringify(e)
    }
    function X() {
        return localStorage.eleJson
    }
    function Z(e, t) {
        if (0 != e.button)
            return !1;
        var i = e.pageX
          , o = e.pageY
          , r = a(".select_element").css({
            width: "0px",
            height: "0px"
        }).offset({
            left: i,
            top: o
        })
          , n = t._owner_design
          , l = n.getCurPage();
        a(document).mousemove(function(e) {
            var a = e.pageX - i
              , t = e.pageY - o
              , n = i
              , s = o;
            0 > a && (n = e.pageX,
            a = -a),
            0 > t && (s = e.pageY,
            t = -t),
            r.css({
                width: a + 1,
                height: t + 1,
                display: "block"
            }).offset({
                left: n,
                top: s
            }),
            l.selectElement(s, n + a, s + t, n)
        }).mouseup(function() {
            a(this).off("mouseup").off("mousemove"),
            r.css("display", "none"),
            l.selectElementUp()
        })
    }
    function V(e) {
        var i = a(this);
        if (!i.hasClass("templateKindBtnClick")) {
            var o = i.parent();
            a(".templateKindBtnClick").removeClass("templateKindBtnClick"),
            i.addClass("templateKindBtnClick");
            var r = i.index()
              , n = o.attr("data-drag")
              , l = a(".templateShow");
            if (n > r ? (l.eq(n).css({
                left: "100%",
                opacity: "0"
            }),
            l.eq(r).css({
                left: "0%",
                opacity: "1"
            }),
            o.attr("data-drag", r)) : (l.eq(n).css({
                left: "-100%",
                opacity: "0"
            }),
            l.eq(r).css({
                left: "0%",
                opacity: "1"
            }),
            o.attr("data-drag", r)),
            0 == r) {
                if (t.addSomeMouseClick("左侧-推荐模板"),
                0 == a("#templateShow").children(".templateLi").size() && 0 == a("#templateShow").children(".nohaveTipsTemplate").size()) {
                    var s = {
                        pageNo: 1,
                        pageSize: e._ajax_page_size,
                        isShowMyCollectedTemplates: 0,
                        secondKindId: KIND_ID,
                        stickOrder: 1
                    };
                    e.queryTemplate(s, "templateShow")
                }
            } else if (1 == r) {
                if (t.addSomeMouseClick("左侧-我的收藏"),
                t.addBugTrackClick("k2"),
                0 == a("#collectionTemplate").children(".templateLi").size() && 0 == a("#collectionTemplate").children(".nohaveTipsTemplate").size()) {
                    var s = {
                        pageNo: 1,
                        pageSize: e._ajax_page_size,
                        fid: -1,
                        kindId: KIND_ID,
                        sort: 0,
                        type: 2
                    };
                    e.queryTemplate(s, "collectionTemplate")
                }
            } else if (2 == r && 0 == a("#teamTemplate").children(".templateLi").size() && 0 == a("#teamTemplate").children(".nohaveTipsTemplate").size()) {
                var s = {
                    pageNo: 1,
                    pageSize: e._ajax_page_size,
                    sort: 0,
                    tid: window.TEAM_ID,
                    skid: KIND_ID
                };
                e.queryTemplate(s, "teamTemplate")
            }
        }
    }
    function $(e) {
        function i() {
            _.nodeMousedown();
            var e = o.attr("alt")
              , i = 0;
            o.hasClass("multipageSon") && (i = a(".multipageSon").index(o));
            var r = {};
            window.TEAM_ID > 0 && ("teamTemplate" == o.parent().attr("id") || o.parent().hasClass("teamTemplate")) ? (r.tid = window.TEAM_ID,
            r.tt = e) : r.t = e,
            a.ajax({
                url: "/designtemplate/getTemplateContent.do",
                type: "POST",
                dataType: "json",
                data: r,
                error: function() {
                    console.log("加载json失败")
                },
                success: function(e) {
                    window.MEMENTO_ID = t.now();
                    var a = JSON.parse(na(e.j));
                    _.onloadTemplate(a, i)
                }
            })
        }
        var o = a(this)
          , r = a(this).attr("data-price")
          , n = a(this).attr("data-own")
          , l = a(this).attr("data-vip")
          , s = a(this).attr("alt");
        if (r > 0 && "true" != n && (!(window.TEAM_ID > 0 || window.ISVIP) || "1" != l))
            return Q(s, a(this)),
            !1;
        if (o.hasClass("multipage")) {
            a("#multipage_total").attr("data-id", o.find("img").attr("alt"));
            var d = parseFloat(KIND_HEIGHT) / parseFloat(KIND_WIDTH) * 280
              , p = parseInt(o.attr("data-size"))
              , f = o.find("img").attr("data-src");
            a("#multipageContent").children().detach(),
            a("#multipageContent").height(p * (d + 18));
            for (var h = 0; p > h; h++) {
                var u;
                u = 0 == h ? f : f + "_" + h;
                var g;
                g = a(void 0 == f ? '<div alt="' + o.attr("alt") + '" class="templateMaking multipageSon" style="line-height:140px">缩略图正在生成中...</div>' : '<div class="multipageSon" style="height:' + d + 'px" alt="' + o.attr("alt") + '"><img width="100%" height="100%" draggable="false" alt="' + o.attr("alt") + '" src="' + u + '@290w_100Q_1x.jpg" /></div>'),
                g.appendTo(a("#multipageContent"))
            }
            window.TEAM_ID > 0 && "teamTemplate" == o.parent().attr("id") ? a("#multipageContent").addClass("teamTemplate") : a("#multipageContent").removeClass("teamTemplate"),
            a("#leftPanelWrap").css({
                left: "-324px"
            })
        } else {
            var m = e._owner_design
              , _ = m.getCurPage();
            1 != _.elements.length && _._pop_drag ? c.confirm({
                str: "使用模板后，将会覆盖掉此画布上的所有现有内容哦",
                yes: "覆盖",
                no: "不覆盖",
                successfun: function() {
                    i()
                }
            }) : i()
        }
    }
    function Q(e, t) {
        a.ajax({
            url: "/designtemplate/hasBoughtTemplate.do",
            dataType: "json",
            type: "POST",
            data: {
                t: e
            },
            success: function(e) {
                var a = e.code;
                1 == a ? (t.attr("data-own", "true"),
                t.click()) : 0 == a ? (t.attr("data-own", "false"),
                ea(t)) : 2 == a ? (t.attr("data-own", "false"),
                ea(t)) : -2 == a ? (c.dialogHide(),
                d.show()) : (c.back({
                    str: "获取模版失败！",
                    kind: "warning"
                }),
                console.log("查询用户是否购买某个模板 错误！code:" + a))
            },
            error: function() {
                c.back({
                    str: "获取模版失败！",
                    kind: "warning"
                }),
                console.log("查询用户是否购买某个模板 error！")
            }
        })
    }
    function ea(e) {
        {
            var a = p.getTemplateModal().find("#tplShow").clone()
              , t = e.attr("data-price")
              , t = parseInt(t) / 100
              , i = e.attr("data-vip");
            e.attr("data-own")
        }
        "1" == i && (a.find("#vipFreeTag").show(),
        window.ISVIP || a.find(".joinVipText").show()),
        a.find(".share_wrap").children(".price_text").text(t + "元"),
        a.find(".pay-template-wrap").find(".template-price span").text("¥" + t + "元"),
        a.find("#qr_pay_money").text(t + "元"),
        a.find(".userBalance").text(parseFloat(window.USERINFO.vmAmount) / 100),
        window.USERINFO.vmAmount < t ? a.find(".template-select-list div").eq(0).addClass("balance-not-enough").removeClass("select-way").next().addClass("select-way") : a.find(".template-select-list div").eq(0).addClass("select-way");
        var o = e.attr("data-kind")
          , r = e.attr("data-view")
          , n = e.attr("data-collect")
          , l = e.attr("data-title")
          , s = e.attr("data-pageNum");
        a.find("#collect_materialTitle").text(l),
        a.find("#materialTypeTips").text(o),
        a.find("#numViewPeople").text(r),
        "true" == n ? a.find(".share_wrap").find(".heart_icon").addClass("active") : a.find(".share_wrap").find(".heart_icon").removeClass("active"),
        1 >= s && a.find(".previewTo").hide();
        var d = e.attr("alt")
          , f = e.find("img").attr("src");
        f && f.length > 17 && (f = f.substring(0, f.length - 17) + "@690w_600h"),
        a.find("#imgMaterial").attr({
            "data-materialid": d,
            src: f,
            "data-page-num": s,
            "data-index": 1
        });
        var h = e.width()
          , u = e.height();
        if (h > u) {
            var g = 690 * u / h
              , m = (600 - g) / 2;
            a.find("#imgMaterial").css({
                top: m,
                left: "0",
                width: "690px",
                height: g
            })
        } else {
            var _ = 600 * h / u
              , v = (690 - _) / 2;
            a.find("#imgMaterial").css({
                left: v,
                top: "0",
                height: "600px",
                width: _
            })
        }
        return c.dialog(a),
        aa(a, e),
        !1
    }
    function aa(e, t) {
        var i = e.find(".buy-template-wrap");
        i.on("click", ".share_icon", function() {
            a(this).hasClass("active") ? a(this).removeClass("active") : a(this).addClass("active")
        }),
        i.on("click", "#useNow", function() {
            return a(".buy-template-wrap").animate({
                opacity: "0"
            }, 600),
            a(".pay-template-wrap").animate({
                left: "0%",
                opacity: "1"
            }, 600),
            !1
        });
        var o = e.find(".pay-template-wrap");
        o.on("click", ".template-pay-way", function() {
            if (a(this).addClass("select-way").siblings().removeClass("select-way"),
            0 == a(this).attr("data-num") && a(this).hasClass("balance-not-enough") ? (a("#template_buy").fadeOut(300),
            a("#template_depost").fadeIn(300)) : "block" == a("#template_depost").css("display") && (a("#template_depost").fadeOut(300),
            a("#template_buy").fadeIn(300)),
            1 == a(this).attr("data-num")) {
                var i = t.attr("alt");
                e.find("#template_buy").hide(),
                e.find("#template_buy_alipay").show(),
                e.find("#template_buy_alipay").hasClass("no-click") && ta(i, 1, t)
            } else
                e.find("#template_buy").show(),
                e.find("#template_buy_alipay").hide()
        }),
        o.on("click", "#template_depost", function() {
            a(this).parent().siblings(".closeBtnCross").click(),
            payment.show()
        }),
        o.on("click", "#template_buy", function() {
            var e = t.attr("alt")
              , a = o.find(".select-way").attr("data-num");
            ta(e, a, t)
        }),
        e.find(".pay-qr-wrap").on("click", "#template_back", function() {
            a(".pay-qr-wrap").animate({
                opacity: "0",
                left: "100%"
            }, 600),
            a(".pay-template-wrap").animate({
                opacity: "1"
            }, 600)
        }),
        e.find("#leftTplShow").on("click", ".previewTo", function() {
            var i = a(this).attr("id")
              , o = e.find("#imgMaterial").attr("src")
              , r = t.attr("data-pageNum")
              , n = parseInt(o.split("_thumb_")[1] || 0);
            "preToLeft" === i ? 0 == n ? n = r - 1 : n -= 1 : n == r - 1 ? n = 0 : n += 1,
            0 == n ? e.find("#imgMaterial").attr("src", o.split("_thumb")[0] + "_thumb") : e.find("#imgMaterial").attr("src", o.split("_thumb")[0] + "_thumb_" + n)
        });
        var r, n;
        e.find(".scrollToBig").on("click", function() {
            var a, t = e.find("#imgMaterial").width(), i = e.find("#imgMaterial").height();
            return r = 0,
            n = 0,
            690 == t ? (afterToBigImgWidth = 600 * t / i,
            e.find("#imgMaterial").css({
                width: afterToBigImgWidth,
                height: "600px",
                left: "0",
                top: "0"
            }),
            e.find(".scrollToBig").hide(),
            void e.find("#scrollToSmall").show()) : 600 == i ? (a = 690 * i / t,
            e.find("#imgMaterial").css({
                width: "690px",
                height: a,
                top: "0",
                left: "0"
            }),
            e.find(".scrollToBig").hide(),
            void e.find("#scrollToSmall").show()) : void 0
        }),
        e.find("#scrollToSmall").on("click", function() {
            var t, i, o = a("#imgMaterial").width(), l = a("#imgMaterial").height();
            if (o > l) {
                i = 690 * l / o;
                var s = (600 - i) / 2;
                e.find("#imgMaterial").css({
                    top: s,
                    left: 0,
                    width: "690px",
                    height: i
                }),
                r = 0,
                n = s,
                e.find("#scrollToSmall").hide(),
                e.find(".scrollToBig").show()
            } else {
                t = 600 * o / l;
                var d = (690 - t) / 2;
                e.find("#imgMaterial").css({
                    top: "0",
                    left: d,
                    width: t,
                    height: "600px"
                }),
                r = d,
                n = 0,
                e.find("#scrollToSmall").hide(),
                e.find(".scrollToBig").show()
            }
        });
        var l, s, d = !1;
        e.find("#imgMaterial").mousedown(function(t) {
            return 0 != t.button ? !1 : (d = !0,
            l = t.pageX,
            s = t.pageY,
            void a(document).mousemove(function(a) {
                if (d) {
                    var t = a.pageX
                      , i = a.pageY
                      , o = t - l
                      , r = i - s;
                    e.find("#imgMaterial").css({
                        left: "+=" + o,
                        top: "+=" + r
                    }),
                    l = t,
                    s = i
                }
            }).mouseup(function() {
                d = !1,
                a(document).off("mousemove").off("mouseup")
            }))
        }),
        e.find(".share_wrap").on("click", ".heart_icon", function() {
            var e = t.attr("alt")
              , i = a(this);
            a.ajax(i.hasClass("active") ? {
                url: "/home/delUserTemplateCollection.do",
                type: "post",
                dataType: "json",
                data: {
                    templateId: e
                },
                success: function(e) {
                    e.result && i.removeClass("active")
                },
                error: function() {
                    console.log("取消收藏 error!")
                }
            } : {
                url: "/home/addUserTemplateCollection.do",
                type: "POST",
                dataType: "json",
                data: {
                    templateId: e
                },
                success: function(e) {
                    e.result ? i.addClass("active") : (c.back({
                        str: "模版收藏失败！",
                        kind: "warning"
                    }),
                    console.log("收藏失败 code:" + e.code))
                },
                error: function() {
                    console.log("收藏失败 error")
                }
            })
        })
    }
    function ta(e, t, i) {
        var o = {
            t: e,
            pt: t
        };
        0 == t && (o.ub = 1,
        o.pt = 1),
        a.ajax({
            url: "/pay/getDesignTplPayUrl.do",
            dataType: "json",
            type: "POST",
            data: o,
            success: function(e) {
                var o = e.code;
                0 == t && 2 == o ? (i.attr("data-own", "true"),
                ia(i)) : 1 == o ? 1 == t ? (a("#template_buy_alipay").removeClass("no-click").attr("href", e.payUrl),
                window.GET_PAY_STATE_CLOCK = setTimeout(function() {
                    oa(e.bill_serial_no, t, i)
                }, 5e3)) : 2 == t && (a(".pay-qr-wrap").find(".qr-img").empty().qrcode({
                    width: 120,
                    height: 120,
                    correctLevel: 0,
                    text: e.payUrl
                }),
                a(".pay-template-wra").animate({
                    opacity: "0"
                }, 600),
                a(".pay-qr-wrap").animate({
                    opacity: "1",
                    left: "0%"
                }, 600),
                window.GET_PAY_STATE_CLOCK = setTimeout(function() {
                    oa(e.bill_serial_no, t, i)
                }, 5e3)) : -2 == o ? (a(".closeBtnCross").click(),
                d.show()) : -5 == o ? c.back({
                    str: "您已购买过此模板，不能重复购买！",
                    kind: "warning"
                }) : (c.back({
                    str: "获取支付链接错误！",
                    kind: "warning"
                }),
                console.log("获取支付链接错误！ code:" + o))
            },
            error: function() {
                c.back({
                    str: "获取支付链接错误！",
                    kind: "warning"
                })
            }
        })
    }
    function ia(e) {
        a.ajax({
            url: "/user/getUserInfo.do",
            dataType: "json",
            type: "GET",
            success: function(t) {
                window.USERINFO.vmAmount = t.userInfo.vmAmount,
                t.userInfo.vmAmount = t.userInfo.vmAmount / 100,
                a(".pay-success-wrap").find(".userBalance").text(t.userInfo.vmAmount),
                a(".pay-template-wra, .pay-qr-wrap").animate({
                    opacity: "0"
                }, 600),
                a(".pay-success-wrap").animate({
                    opacity: "1",
                    left: "0%"
                }, 600).find("#template_use").click(function() {
                    c.dialogHide(),
                    e.click()
                })
            },
            error: function() {
                console.log("请求登录状态失败!")
            }
        })
    }
    function oa(e, t, i) {
        window.GET_PAY_STATE_CLOCK && clearTimeout(window.GET_PAY_STATE_CLOCK),
        a.ajax({
            url: "/pay/getPayState.do",
            dataType: "json",
            type: "POST",
            data: {
                billSerialNo: e
            },
            success: function(a) {
                1 == a.code ? (i.attr("data-own", "true"),
                ia(i)) : window.GET_PAY_STATE_CLOCK = setTimeout(function() {
                    oa(e, t, i)
                }, 3e3)
            },
            error: function() {
                console.log("error!")
            }
        })
    }
    function ra() {
        -324 === parseInt(a("#leftPanelWrap").css("left")) && (a("#leftPanelWrap").stop(),
        a("#leftPanelWrap").css({
            left: "0px"
        }))
    }
    function na(e) {
        var a = null;
        if ("string" != typeof e)
            return a;
        var t = JSON.parse(e);
        if ("1.0.0" === t.v || "1.0.2" === t.v)
            return JSON.stringify(t);
        var i = {};
        i.title = t.title;
        var o = new Array;
        i.pages = o;
        var r = t.pages;
        if (null == r || void 0 == r || "object" != typeof r)
            return a = JSON.stringify(i);
        var n = null
          , l = null;
        for (var s in r) {
            n = r[s];
            var d = {
                elems: []
            };
            if (o.push(d),
            d.width = n.width,
            d.height = n.height,
            l = n.elements,
            null != l && void 0 != l && "object" == typeof l)
                for (var c in l) {
                    var p = la(l[c]);
                    null != p && void 0 != p && d.elems.push(p)
                }
        }
        return a = JSON.stringify(i)
    }
    function la(e) {
        var a = null;
        return null == e || void 0 == e || "object" != typeof e ? a : ("text" == e.type ? a = sa(e) : "svg" == e.type ? a = da(e) : ("img" == e.type || "background" == e.type) && (a = ca(e)),
        a)
    }
    function sa(e) {
        var a = {
            "data-elem": {}
        }
          , t = e.width
          , i = e.height
          , o = e.top
          , r = e.left
          , n = e.scale
          , l = (e.rotateX,
        e.rotateY,
        parseInt(e.rotate_x))
          , s = parseInt(e.rotate_y)
          , d = e.fontSize[0];
        o += d;
        var c = e.fillColors[0]
          , p = e.fontFamily[0]
          , f = 1 == parseInt(e.italic)
          , h = e.opacity
          , u = 100 * parseFloat(e.fontLetter[0]) + ""
          , g = e.fontPosition[0];
        "end" == g ? (g = "right",
        r -= t) : "middle" == g ? (g = "center",
        r -= t / 2) : g = "left";
        var m = "";
        180 == l && 180 == s ? m = "matrix(-1,0,0,-1,0,0)translate(-" + e.width + ",-" + e.height + ")" : 180 == l ? m = "matrix(-1,0,0,1,0,0)translate(-" + e.width + ",0)" : 180 == s && (m = "matrix(1,0,0,-1,0,0)translate(0,-" + e.height + ")"),
        a.reverse = m;
        var _ = ""
          , v = e.content;
        if ("object" == typeof e)
            for (var w in v)
                _ += v[w] + "\n";
        return _ = _.substring(0, _.length - 1),
        a["data-type"] = "text",
        a.transform = "translate(" + r + "," + o + ")rotate(" + n + ")",
        a.html = _,
        a["data-elem"]["font-size"] = d,
        a["data-elem"].fill = c,
        a["data-elem"]["font-family"] = p,
        a["data-elem"]["data-italic"] = f + "",
        a["data-elem"].opacity = h,
        a["data-elem"]["data-align"] = g,
        a["data-elem"].wspace = u,
        a["data-elem"].width = t,
        a["data-elem"].height = i,
        a
    }
    function da(e) {
        var a = {
            "data-elem": {}
        };
        "object" == typeof e.fillColors && (a["data-elem"]["data-colors"] = e.fillColors),
        a["data-elem"].opacity = e.opacity;
        var t = e.top
          , i = e.left
          , o = e.scale
          , r = parseFloat(e.width) / 2
          , n = parseFloat(e.height) / 2;
        a.transform = "translate(" + i + "," + t + ")rotate(" + o + "," + r + "," + n + ")",
        a["data-elem"].width = e.width,
        a["data-elem"].height = e.height;
        var l = parseInt(e.rotate_x)
          , s = parseInt(e.rotate_y)
          , d = "";
        if (180 == l && 180 == s ? d = "matrix(-1,0,0,-1,0,0)translate(-" + e.width + ",-" + e.height + ")" : 180 == l ? d = "matrix(-1,0,0,1,0,0)translate(-" + e.width + ",0)" : 180 == s && (d = "matrix(1,0,0,-1,0,0)translate(0,-" + e.height + ")"),
        a.reverse = d,
        "object" == typeof e.transform) {
            var c = {}
              , p = null;
            for (var f in e.transform)
                p = e.transform[f],
                c[f] = "translate(" + p.translate_x + "," + p.translate_y + ")scale(" + p.scale_x + "," + p.scale_y + ")";
            a["data-elem"].vary = c
        }
        "object" == typeof e.viewbox && (a["data-elem"].viewBox = e.viewbox.x + " " + e.viewbox.y + " " + e.viewbox.width + " " + e.viewbox.height),
        a["data-img-kind"] = e.content_type,
        a["data-elem"].id = e.id,
        a["data-elem"]["data-key"] = e.img_key;
        var h = Object.keys(e.svgHref).length > 0;
        if (h) {
            a["data-type"] = "svgFrame";
            var u = {};
            for (var f in e.svgHref) {
                var g = {};
                g.x = e.svgHref[f].x,
                g.y = e.svgHref[f].y,
                g.width = e.svgHref[f].width,
                g.height = e.svgHref[f].height,
                g["data-img-key"] = e.svgHref[f].img_key,
                g["data-class"] = f,
                a["data-elem"].filter = e.svgHref[f].filter,
                u[f] = g
            }
            a["data-elem"]["data-xhref-imgs"] = u
        } else
            a["data-type"] = "svgImage";
        return a
    }
    function ca(e) {
        var a = {
            "data-elem": {}
        }
          , t = e.top
          , i = e.left
          , o = e.scale
          , r = parseFloat(e.width) / 2
          , n = parseFloat(e.height) / 2;
        a.transform = "translate(" + i + "," + t + ")rotate(" + o + "," + r + "," + n + ")",
        a["data-elem"].width = e.width,
        a["data-elem"].height = e.height,
        a["data-elem"].opacity = e.opacity,
        a["data-elem"].id = e.id,
        a["data-elem"]["data-key"] = e.img_key,
        a["data-img-kind"] = e.content_type,
        a["data-elem"].filter = e.filter;
        var l = parseInt(e.rotate_x)
          , s = parseInt(e.rotate_y)
          , d = "";
        if (180 == l && 180 == s ? d = "matrix(-1,0,0,-1,0,0)translate(-" + e.width + ",-" + e.height + ")" : 180 == l ? d = "matrix(-1,0,0,1,0,0)translate(-" + e.width + ",0)" : 180 == s && (d = "matrix(1,0,0,-1,0,0)translate(0,-" + e.height + ")"),
        a.reverse = d,
        null != e.backgroundColor && void 0 != e.backgroundColor) {
            var c = {};
            c[0] = e.backgroundColor,
            a["data-elem"]["data-colors"] = c,
            a["data-type"] = "background"
        } else
            a["data-type"] = "img";
        return a
    }
    function pa(e) {
        !window.ISVIP && window.TEAM_ID <= 0 ? (a(".folder-add").css("display", "none"),
        a(".move_materialfile").css("display", "none"),
        a(".vip_line").click(function() {
            t.addSomeMouseClick("左侧-上传会员入口")
        })) : a(".folder_wrap").find(".join_vip").css("display", "none"),
        (window.api || window.ziyun) && (a(".folder-add").css("display", "none"),
        a(".move_materialfile").css("display", "none"),
        a(".folder_wrap").find(".join_vip").css("display", "none")),
        a(".folder_wrap").on("click", ".folder-edit", function() {
            return a(this).parent().addClass("folder-click"),
            !1
        }),
        a(".folder_wrap").on("mouseleave", ".folder", function() {
            a(this).find(".folder-edit-wrap").removeClass("folder-click")
        }),
        a(".folder_wrap").on("click", ".folder", function() {
            fa.call(this, e)
        }),
        a(".folder_wrap").on("click", ".folder-add", function() {
            return t.addBugTrackClick("m3"),
            t.addSomeMouseClick("左侧-新建文件夹"),
            ha.call(this, e),
            !1
        }),
        a(".folder_wrap").on("click", ".folder-del", function() {
            return ba.call(this, e),
            !1
        }),
        a(".delete-materialFloder").on("click", ".materialFloder-cansel-but", function() {
            a(".delete-materialFloder").hide()
        }),
        a(".delete-materialFloder").on("click", ".materialFloder-delete-but", function(e) {
            ua.call(this, e),
            a(".delete-materialFloder").hide()
        }),
        a(".folder_wrap").on("click", ".folder-changeName", function() {
            return ga.call(this, e),
            !1
        }),
        a(".folder_wrap").on("blur", ".folder-text", function() {
            ma.call(this)
        }),
        a(".folder_wrap").on("click", ".folder-text", function() {
            return a(this).hasClass("folder-text-click") ? !1 : void 0
        }),
        a("#personMaterialWrap").on("click", ".upload_file_manger", function() {
            return t.addBugTrackClick("m2"),
            t.addSomeMouseClick("左侧-管理"),
            Ia.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".cancel_file_manger", function() {
            return Ma.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".move_chooseMaterialLi", function() {
            return wa.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".move_chooseMaterialLi_click", function() {
            return wa.call(this, e),
            !1
        }),
        a("#personMaterialWrap").on("click", ".defalut_file", function() {
            return ya.call(this, e),
            a(this).parent(".materialfile_list").hide(),
            !1
        }),
        a("#personMaterialWrap").on("click", ".manage_delete", function() {
            t.addSomeMouseClick("左侧-删除"),
            a(".manage_delete").addClass("click_manage_delete"),
            xa.call(this, e)
        }),
        a("#leadingContent").on("click", ".sure_file_del", function() {
            ya.call(this, e)
        }),
        a("#leadingContent").on("click", ".cansel_file_del", function() {
            a(".manage_delete").removeClass("click_manage_delete"),
            a(".file_tips_del").hide()
        }),
        a(".move_list").click(function() {
            return t.addSomeMouseClick("左侧-移动"),
            Sa.call(this, e),
            !1
        }),
        a("#leadingContent").on("click", function() {
            a(".materialfile_list").hide()
        })
    }
    function fa(e) {
        var i = a(this)
          , o = i.attr("data-id") || 0
          , r = a("#personMaterialWrap");
        1 == a(".folder_wrap").css("opacity") ? r.find("#uploader").css("display", "block") : "Worker" == t.getTeamRole() ? r.find("#uploader").css("display", "none") : r.find("#uploader").css("display", "block"),
        a("#filePicker").attr({
            "data-id": o
        }),
        a(".folder").css("margin-top", "15px");
        var n = a("#leadingMaterialWrap");
        if (a(".folderClick").size() > 0)
            return r.css({
                top: 0,
                display: "none"
            }),
            n.css("height", "100px"),
            n.children(".chooseMaterialLi").detach(),
            a(".folderClick").removeClass("folderClick"),
            a(".cancel_file_manger").hasClass("file_click") && a(".cancel_file_manger").click(),
            !1;
        if (a(".folderClick").removeClass("folderClick"),
        i.addClass("folderClick"),
        i.hasClass("folder-add"))
            return i.removeClass("folderClick"),
            !1;
        va.call(this, e);
        var l;
        l = a(1 == a(".folder_wrap").css("opacity") ? ".folder_wrap" : ".team_folder_wrap");
        var s = l.children(".folder").index(this)
          , d = i.offset().top + i.getHeight() + 20 - a(".folder_wrap").offset().top + 60;
        Oa = a(".folder_wrap")[0].getBoundingClientRect().bottom,
        ja = r[0].getBoundingClientRect().bottom;
        var c = Oa - ja + 20
          , p = n.getHeight() + 100;
        a(".host_height").css({
            height: c
        }),
        window.TEAM_ID > 0 && (d += 64,
        p += 64),
        r.css({
            top: d,
            display: "block"
        });
        for (var f = s + 3 - s % 3, h = f + 3; h > f; f++) {
            var u = l.children(".folder").eq(f);
            u.css("margin-top", p)
        }
        return !1
    }
    function ha() {
        var e, t = a(this), i = t.children(".folder-text").text();
        window.TEAM_ID > 0 ? (e = {
            folder_name: i,
            tid: window.TEAM_ID
        },
        e.type = 1 == a(".folder_wrap").css("opacity") ? 0 : 1) : e = {
            folder_name: i
        },
        a.ajax({
            url: "/material/makeFolder.do",
            type: "POST",
            dataType: "json",
            data: e,
            success: function(t) {
                if (1 == t.code) {
                    var o = '<li class="folder folder-new" data-id="' + t.folderId + '"><span class="folder-img"></span><input class="folder-text" readonly="readonly" value="' + i + '"></input><span class="folder-edit-wrap"><span class="folder-btn folder-edit" title="设置"></span><span class="folder-btn folder-changeName" title="修改文件名" ></span><span class="folder-btn folder-del" title="删除"></span></span></li>';
                    1 === e.type ? (a(".team_folder_wrap").find(".folder-add").before(o),
                    Ka()) : (a(".folder_wrap").find(".folder-add").before(o),
                    Aa())
                }
            }
        })
    }
    function ua(e, t) {
        a(".folder_wrap").find(".folderClick").size() > 0 && a(".folder_wrap").find(".folderClick").click();
        var i;
        if (0 == a(this).attr("data-count"))
            var o = a(this).attr("data-id");
        else {
            var o = a(this).parents(".delete-materialFloder").attr("data-id");
            t = a(this).parents(".delete-materialFloder").attr("team-drag")
        }
        1 == t || "true" == t ? (i = {
            fid: o,
            tid: window.TEAM_ID
        },
        t = !0) : (i = {
            fid: o
        },
        t = !1),
        a.ajax({
            url: "/material/delMaterialFolder.do",
            dataType: "json",
            type: "POST",
            data: i,
            success: function() {
                a(".folder-new").detach(),
                t ? Ka() : Aa()
            }
        })
    }
    function ga() {
        var e = a(this)
          , t = e.parents(".folder-edit-wrap").siblings(".folder-text");
        t.addClass("folder-text-click"),
        t.select(),
        t.removeAttr("readonly")
    }
    function ma(e) {
        var t = a(this);
        t.removeClass("folder-text-click"),
        t.attr("readonly", "readonly"),
        _a(t, e)
    }
    function _a(e, t) {
        var i, o = e.val(), r = e.parents(".folder").attr("data-id");
        i = t ? {
            folder_id: r,
            folder_name: o,
            tid: window.TEAM_ID
        } : {
            folder_id: r,
            folder_name: o
        },
        a.ajax({
            url: "/material/renameMaterialFolder.do",
            type: "POST",
            dataType: "json",
            data: i,
            success: function(e) {
                1 == e.code ? Aa(!0) : alert("更改异常")
            }
        })
    }
    function va(e) {
        function t() {
            var e, t = a("#personMaterialWrap");
            e = a(1 == a(".folder_wrap").css("opacity") ? ".folder_wrap" : ".team_folder_wrap");
            var o = e.children(".folder").index(a(".folderClick"))
              , r = i.offset().top + i.getHeight() + 20 - a(".folder_wrap").offset().top + 60;
            Oa = a(".folder_wrap")[0].getBoundingClientRect().bottom,
            ja = t[0].getBoundingClientRect().bottom;
            var n = Oa - ja + 20
              , l = a("#leadingMaterialWrap")
              , s = l.getHeight() + 100;
            window.TEAM_ID > 0 && (r += 64,
            s += 64),
            a(".host_height").css({
                height: n
            }),
            t.css({
                top: r,
                display: "block"
            });
            for (var d = o + 3 - o % 3, c = d + 3; c > d; d++) {
                var p = e.children(".folder").eq(d);
                p.css("margin-top", s)
            }
        }
        var i = a(this)
          , o = i.attr("data-id") || 0;
        a(".leadingMaterialWrap").children().detach();
        var r;
        r = 1 == a(".folder_wrap").css("opacity") ? {
            pageNo: 1,
            pageSize: l.MATERIAL_PAGE_SIZE,
            fid: o,
            w: 180
        } : {
            pageNo: 1,
            pageSize: l.MATERIAL_PAGE_SIZE,
            fid: o,
            tid: window.TEAM_ID,
            w: 180
        };
        var n = "leadingMaterialWrap";
        e.queryMaterialPersonal(e._ajax_url.queryMaterialsInFolder, r, [0, 0, 0], n, t)
    }
    function wa() {
        if (a(this).hasClass("move_chooseMaterialLi"))
            a(this).removeClass("move_chooseMaterialLi"),
            a(this).addClass("move_chooseMaterialLi_click"),
            a(".manage_delete").addClass("selected_manage_delete");
        else {
            a(this).addClass("move_chooseMaterialLi"),
            a(this).removeClass("move_chooseMaterialLi_click");
            var e = a(".move_chooseMaterialLi_click");
            0 == e.length && a(".manage_delete").removeClass("selected_manage_delete")
        }
    }
    function ka() {
        if (Wa == [])
            a.ajax({
                url: "/material/getMaterialFolders.do",
                type: "GET",
                dataType: "json",
                success: function(e) {
                    var t = e.folderList.length;
                    Wa = e.folderList;
                    var i = '<li class="defalut_file" data-id="0">默认上传</li>';
                    a(".materialfile_list").append(i);
                    for (var o = 0; t > o; o++) {
                        var r = e.folderList[o]
                          , i = '<li class="defalut_file" data-id="' + r.folderId + '" title="' + r.folderName + '">' + r.folderName + "</li>";
                        a(".materialfile_list").append(i)
                    }
                }
            });
        else {
            var e = Wa.length
              , t = '<li class="defalut_file" data-id="0">默认上传</li>';
            a(".materialfile_list").append(t);
            for (var i = 0; e > i; i++) {
                var o = Wa[i]
                  , t = '<li class="defalut_file" data-id="' + o.folderId + '" title="' + o.folderName + '">' + o.folderName + "</li>";
                a(".materialfile_list").append(t)
            }
        }
    }
    function ya(e) {
        for (var t = a(this).attr("data-id"), i = a(this).attr("team-id"), o = a(".move_chooseMaterialLi_click"), r = [], n = 0; n < o.size(); n++)
            r[n] = o.eq(n).attr("data-id");
        a(".manage_delete").hasClass("click_manage_delete") ? (a(".manage_delete").removeClass("click_manage_delete"),
        Ta(e, r),
        a(".file_tips_del").hide()) : Ca(e, r, t, i)
    }
    function Ca(e, t, i, o) {
        for (var r = [], n = 0; n < t.length; n++)
            r.push(t[n]);
        var s;
        s = o ? {
            m_ids: r.join(","),
            nfid: i,
            tid: o
        } : {
            m_ids: r.join(","),
            nfid: i
        },
        a.ajax({
            url: "/material/moveMaterials.do",
            dataType: "json",
            type: "POST",
            data: s,
            success: function() {
                a("#leadingMaterialWrap").children().detach();
                var t = {
                    pageNo: 1,
                    pageSize: l.MATERIAL_PAGE_SIZE,
                    fid: a(".folderClick").attr("data-id"),
                    w: 180
                };
                2 == a("#folderKindWrap").attr("data-drag") && (t.tid = window.TEAM_ID);
                var i = "leadingMaterialWrap";
                e.queryMaterialPersonal(e._ajax_url.queryMaterialsInFolder, t, [0, 0, 0], i)
            }
        })
    }
    function Ta(e, t) {
        for (var i = "", o = 0; o < t.length; o++)
            i = i + t[o] + ",";
        var r = {
            m_ids: i,
            fid: a(".folderClick").attr("data-id") || 0
        };
        2 == a("#folderKindWrap").attr("data-drag") && (r.tid = window.TEAM_ID),
        a.ajax({
            url: "/material/delMaterials.do",
            dataType: "json",
            type: "POST",
            data: r,
            success: function() {
                a(".leadingMaterialWrap").children().detach();
                var t = {
                    pageNo: 1,
                    pageSize: l.MATERIAL_PAGE_SIZE,
                    fid: a(".folderClick").attr("data-id"),
                    w: 180
                };
                2 == a("#folderKindWrap").attr("data-drag") && (t.tid = window.TEAM_ID);
                var i = "leadingMaterialWrap";
                e.queryMaterialPersonal(e._ajax_url.queryMaterialsInFolder, t, [0, 0, 0], i)
            }
        })
    }
    function Ia() {
        a(".cancel_file_manger").show(),
        a(".upload_file_manger").hide(),
        a(".manage_delete").show(),
        window.ISVIP && a(".move_materialfile").show(),
        a(".cancel_file_manger").addClass("file_click"),
        a(".leadingMaterialWrap").find(".imgMaterial").addClass("move_chooseMaterialLi")
    }
    function Ma() {
        a(".upload_file_manger").show(),
        a(".manage_delete").hide(),
        a(".cancel_file_manger").hide(),
        a(".move_materialfile").hide(),
        a(".cancel_file_manger").removeClass("file_click"),
        a(".leadingMaterialWrap").find(".imgMaterial").removeClass("move_chooseMaterialLi_click"),
        a(".leadingMaterialWrap").find(".imgMaterial").removeClass("move_chooseMaterialLi"),
        a(".manage_delete").removeClass("selected_manage_delete")
    }
    function xa(e, t) {
        if (a(this).hasClass("selected_manage_delete")) {
            var i = t || window.event
              , o = document.documentElement.scrollLeft || document.body.scrollLeft
              , r = document.documentElement.scrollTop || document.body.scrollTop
              , n = i.pageX || i.clientX + o
              , l = i.pageY || i.clientY + r
              , s = l - 40 + "px"
              , d = n - 40 + "px";
            a(".file_tips_del").css({
                top: s,
                left: d
            }).show()
        } else
            a(".file_tips_del").hide()
    }
    function ba(e, t, i) {
        if (0 == a(this).attr("data-count"))
            ua.call(this, e, i);
        else {
            var o = a(this).attr("data-id");
            if (a(".delete-materialFloder").attr({
                "data-id": o
            }),
            a(".delete-materialFloder").attr(i ? {
                "team-drag": "true"
            } : {
                "team-drag": "false"
            }),
            "none" == a(".delete-materialFloder").css("display")) {
                var r = t || window.event
                  , n = document.documentElement.scrollLeft || document.body.scrollLeft
                  , l = document.documentElement.scrollTop || document.body.scrollTop
                  , s = r.pageX || r.clientX + n
                  , d = r.pageY || r.clientY + l
                  , c = d - 20 + "px"
                  , p = s - 20 + "px";
                a(".delete-materialFloder").css({
                    top: c,
                    left: p
                }).show()
            } else
                a(".delete-materialFloder").hide()
        }
    }
    function Sa() {
        "none" == a(".materialfile_list").css("display") ? (a(".materialfile_list").children().detach(),
        a(".materialfile_list").show(),
        ka()) : a(".materialfile_list").hide()
    }
    function Aa(e) {
        a.ajax({
            url: "/material/getMaterialFolders.do",
            dataType: "json",
            type: "POST",
            success: function(t) {
                Wa = null == t.folderList ? [] : t.folderList,
                e || (a(".folder_wrap").find(".folder-new").detach(),
                Ea())
            }
        })
    }
    function Ea() {
        if (0 == Wa.length)
            ;
        else
            for (var e = Wa.length, t = 0; e > t; t++) {
                var i = Wa[t]
                  , o = '<li class="folder folder-new" data-id="' + i.folderId + '"><span class="folder-img"></span><input class="folder-text" readonly="readonly" value="' + i.folderName + '"></iput><span class="folder-edit-wrap"><span class="folder-btn folder-edit"  title="设置"></span><span class="folder-btn folder-changeName" title="修改文件名"></span><span class="folder-btn folder-del" data-count="' + i.materialCounts + '" data-id="' + i.folderId + '" title="删除"></span></span></li>';
                a(".folder_wrap").find(".folder-add").before(o)
            }
    }
    function Da(e) {
        "Worker" == t.getTeamRole() && a(".team_folder_wrap").find(".folder-add").css("display", "none"),
        a(".team_folder_wrap").on("click", ".folder-edit", function() {
            return a(this).parent().addClass("folder-click"),
            !1
        }),
        a(".team_folder_wrap").on("mouseleave", ".folder", function() {
            a(this).find(".folder-edit-wrap").removeClass("folder-click")
        }),
        a(".team_folder_wrap").on("click", ".folder", function() {
            fa.call(this, e)
        }),
        a(".team_folder_wrap").on("click", ".folder-add", function() {
            return ha.call(this, e),
            !1
        }),
        a(".team_folder_wrap").on("click", ".folder-del", function(a) {
            return ba.call(this, e, a, !0),
            !1
        }),
        a(".team_folder_wrap").on("click", ".folder-changeName", function() {
            return ga.call(this, e),
            !1
        }),
        a(".team_folder_wrap").on("blur", ".folder-text", function() {
            ma.call(this, !0)
        }),
        a(".team_folder_wrap").on("click", ".folder-text", function() {
            return a(this).hasClass("folder-text-click") ? !1 : void 0
        }),
        a(".move_list").click(function(a) {
            return t.addSomeMouseClick("左侧-移动"),
            Sa.call(this, e),
            a.stopPropagation(),
            !1
        })
    }
    function Ka(e) {
        a.ajax({
            url: "/material/getMaterialFolders.do",
            dataType: "json",
            type: "POST",
            data: {
                tid: window.TEAM_ID
            },
            success: function(t) {
                Fa = null == t.folderList ? [] : t.folderList,
                e || (a(".team_folder_wrap").find(".folder-new").detach(),
                Na())
            }
        })
    }
    function Na() {
        if (0 == Fa.length)
            ;
        else
            for (var e, i, o = Fa.length, r = "", n = t.getTeamRole(), l = 0; o > l; l++)
                e = Fa[l],
                "Worker" != n && (r = '<span class="folder-edit-wrap"><span class="folder-btn folder-edit"  title="设置"></span><span class="folder-btn folder-changeName" title="修改文件名"></span><span class="folder-btn folder-del" data-count="' + e.materialCounts + '" data-id="' + e.folderId + '" title="删除"></span></span>'),
                i = '<li class="folder folder-new" data-id="' + e.folderId + '"><span class="folder-img"></span><input class="folder-text" readonly="readonly" value="' + e.folderName + '"></iput>' + r + "</li>",
                a(".team_folder_wrap").find(".folder-add").before(i)
    }
    function Pa() {
        a.ajax({
            url: "/material/getCollectedMaterialIdsCache.do",
            dataType: "json",
            type: "POST",
            success: function(e) {
                e.collectedMaterialIds && (window.colledMaterial = e.collectedMaterialIds.split(","))
            },
            error: function() {}
        })
    }
    var La = {
        _owner_design: null,
        _kind_click_drag: !1,
        _query_ajax: null,
        _query_ajax_personal: null,
        _template_ajax: null,
        _material_kind: [],
        _chinese_content: "",
        _copy_ele: null,
        _key_down_drag: !1,
        _ajax_url: {
            queryMyMaterial: "/material/getMaterialsInSpecFolder.do",
            queryMaterialsInFolder: "/material/getMaterialsInFolder.do",
            queryMaterial: "/material/searchAllMaterialsByKind.do",
            searchMaterial: "/material/queryMaterialsByWord.do",
            queryCollMaterial: "/material/getUserCollectedMaterial.do"
        },
        _background_drag: !1,
        domOnloadSet: function(e) {
            return this._owner_design = e,
            this
        },
        materialKindOnload: function() {
            var e = this;
            return a.ajax({
                url: "/material/getAllMaterialKind.do",
                type: "POST",
                dataType: "json",
                error: function() {
                    console.log("返回素材分类列表错误")
                },
                success: function(t) {
                    e._material_kind = t.list;
                    var i, o, t = t.list, r = {
                        isColl: !0,
                        firstKindId: -1,
                        firstKindName: "我的收藏",
                        imgUrl: "/img/static/colledmaterialkind.png",
                        lsQueryMaterialKindBean: [{
                            kindId: 1,
                            kindTitle: "图片"
                        }, {
                            kindId: 2,
                            kindTitle: "矢量"
                        }]
                    };
                    t.unshift(r);
                    for (var n = t.length, l = 0; n > l; l++)
                        i = t[l],
                        o = '<li class="materialKind" data-name="' + i.firstKindName + '" data-kind="' + i.firstKindId + '" style="width:80px;height:92px"><span class="materialKindOpacity1"></span><span class="materialKindOpacity2"></span><span class="materialKindIcon"><img width="100%" src="' + i.imgUrl + '" alt=""></span><span class="materialKindText">' + i.firstKindName + "</span></li>",
                        a("#materialKindList").append(o)
                }
            }),
            this
        },
        _saveToJson: [],
        _saveJsonAttr: [],
        _save_drag: "saved",
        _save_timer: null,
        set saveJsonAttr(e) {
            var t = this
              , i = e.data
              , o = e.obj
              , r = i.cont[0]
              , n = this._saveJsonAttr
              , l = n.length;
            if (l > 0 && n[l - 1].obj == o && n[l - 1].data.loc == i.loc) {
                var s = n[l - 1].data
                  , d = s.cont;
                if (3 == r.type && void 0 == d[0].tidx)
                    n.pop();
                else if (3 != r.type && void 0 == d[0].tidx && void 0 == r.tidx) {
                    for (var c = d.length, p = 0; c > p; p++)
                        if (d[p].key == r.key) {
                            d[p].val = r.val;
                            break
                        }
                    p == c && d.push(r)
                } else
                    d.push(r)
            } else
                l > 0 && n[l - 1].data.loc == i.loc && n[l - 1].data.cont[0].val && "background" === n[l - 1].data.cont[0].val["data-type"] && n[l - 1].data.cont[0].val["data-type"] === i.cont[0].val["data-type"] && "0" === n[l - 1].data.cont[0].key && n[l - 1].data.cont[0].key === i.cont[0].key ? n[l - 1].data.cont[0] = i.cont[0] : i.unshift ? n.unshift(e) : n.push(e);
            clearTimeout(t._save_timer),
            t._save_timer = setTimeout(function() {
                t.saveDesign()
            }, 2e3),
            "saved" == t._save_drag && (t._save_drag = "will saved"),
            a("#designTitle").find(".save-time").text("正在保存......"),
            a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .print-design").addClass("design-no-click"),
            (window.api || window.ziyun) && a(".download-design").addClass("design-no-click")
        },
        get saveJsonAttr() {
            for (var e = [], a = this._saveJsonAttr, t = a.length, i = 0; t > i; i++)
                e.push(a[i].data);
            return e
        },
        saveTemplate: function() {
            var e = new FormData
              , i = this
              , o = window.design_json;
            e.append("json", JSON.stringify(o)),
            e.append("k", KIND_ID),
            e.append("d", DESIGN_ID),
            e.append("kt", KIND_TITLE),
            e.append("ow", window.DESIGN_ORIGINAL_WIDTH),
            e.append("oh", window.DESIGN_ORIGINAL_HEIGHT),
            e.append("sec", DESIGN_SEC),
            e.append("dt", a(".design_title").children().val());
            var r = function() {
                return null == IS_ET ? 0 : IS_ET
            }();
            null != TEMPLATE_ID ? e.append("t", TEMPLATE_ID) : null != TEAM_TEMPLATE_ID && e.append("tt", TEAM_TEMPLATE_ID),
            window.TEAM_ID > 0 && e.append("tid", window.TEAM_ID),
            e.append("et", r),
            e.append("mp", window.MAX_PAGE),
            a.ajax({
                url: "/design/saveDesignV2.do",
                type: "POST",
                dataType: "json",
                data: e,
                cache: !1,
                contentType: !1,
                processData: !1,
                error: function() {
                    t.addSomeMouseClick("设计-保存失败"),
                    alert("设计保存失败，请尝试刷新当前页面。您还可以加入创客贴qq服务群，群号133818453（已满），538351505。")
                },
                success: function() {
                    window.saveTemplate = !0,
                    i.saveDesign()
                }
            })
        },
        saveDesign: function(e) {
            if (window.saveTemplate) {
                var t = this
                  , i = a("#designTitle").find(".save-time");
                if (0 == t._saveJsonAttr.length) {
                    i.text("保存成功！");
                    {
                        setTimeout(function() {
                            var e = new Date
                              , a = e.getMinutes();
                            10 > a && (a = "0" + a),
                            i.text("今天" + e.getHours() + ":" + a + "更新")
                        }, 500)
                    }
                    return void (e && c.back({
                        str: '成功保存设计到<a href="/designmanage" target="_blank" style="color: #07aefc">设计管理</a>',
                        kind: "success"
                    }))
                }
                if (window.ISLOGIN) {
                    if ("saving" == t._save_drag)
                        return;
                    a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .print-design").addClass("design-no-click"),
                    t._save_drag = "saving";
                    var o = p.getDownload().find(".sure_download")
                      , r = p.getShareTitle().find(".publick_share_button");
                    o.addClass("not-download"),
                    r.addClass("not-share");
                    var n = this.saveJsonAttr;
                    this._saveToJson = this._saveJsonAttr,
                    this._saveJsonAttr = [];
                    var l = new FormData;
                    if (0 == n.length) {
                        t._save_drag = "saved",
                        o.removeClass("not-download"),
                        r.removeClass("not-share"),
                        a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .design_size_move, .design_change_sence, .print-design").removeClass("design-no-click"),
                        (window.api || window.ziyun) && a(".download-design").removeClass("design-no-click"),
                        i.text("保存成功！");
                        {
                            setTimeout(function() {
                                var e = new Date
                                  , a = e.getMinutes();
                                10 > a && (a = "0" + a),
                                i.text("今天" + e.getHours() + ":" + a + "更新")
                            }, 500)
                        }
                        return
                    }
                    l.append("eJson", JSON.stringify(n)),
                    l.append("k", KIND_ID),
                    l.append("d", DESIGN_ID),
                    l.append("kt", KIND_TITLE),
                    l.append("ow", window.DESIGN_ORIGINAL_WIDTH),
                    l.append("oh", window.DESIGN_ORIGINAL_HEIGHT),
                    l.append("sec", DESIGN_SEC),
                    l.append("dt", a(".design_title").children().val());
                    var s = function() {
                        return null == IS_ET ? 0 : IS_ET
                    }();
                    l.append("et", s),
                    l.append("mp", window.MAX_PAGE),
                    null != TEMPLATE_ID ? l.append("t", TEMPLATE_ID) : null != TEAM_TEMPLATE_ID && l.append("tt", TEAM_TEMPLATE_ID),
                    window.TEAM_ID > 0 && l.append("tid", window.TEAM_ID),
                    window.COOPERATE_DESIGN && l.append("c", !0),
                    window.COOPERATE_STAMP > 0 && l.append("stamp", window.COOPERATE_STAMP),
                    a.ajax({
                        url: "/design/saveDesignV3.do",
                        type: "POST",
                        dataType: "json",
                        data: l,
                        cache: !1,
                        contentType: !1,
                        processData: !1,
                        success: function(n) {
                            if (window.SAVE_TIME > 2 && a(".pop-mod-prompt-container").remove(),
                            window.SAVE_TIME = 0,
                            "-4" == n.code)
                                return window.isLoginOut = !0,
                                window.modPrompt.show(2),
                                void setTimeout(function() {
                                    location.href = "/startdesign"
                                }, 2500);
                            if (("-1" == n.code || "-101" == n.code || "-102" == n.code || "-104" == n.cde) && window.modPrompt.show(0),
                            "-106" == n.code) {
                                console.log("-106该设计已被放入回收站"),
                                t._saveJsonAttr.unshift(t._saveToJson);
                                var l = {
                                    str: "当前设计已经被移至回收站，请还原后再操作！" + n.code,
                                    yes: "还原",
                                    no: "稍后",
                                    again: !1,
                                    show_no: "hide",
                                    successfun: function() {
                                        window.location.href = "/md.html?action=recycle"
                                    }
                                };
                                return void c.confirm(l)
                            }
                            if ("-108" == n.code) {
                                console.log("-108该设计已被彻底删除"),
                                t._saveJsonAttr.unshift(t._saveToJson);
                                var l = {
                                    str: "当前设计已经被已被彻底删除！" + n.code,
                                    yes: "好的",
                                    no: "",
                                    again: !1,
                                    show_no: "hide",
                                    successfun: function() {
                                        window.location.href = "/startdesign"
                                    }
                                };
                                return void c.confirm(l)
                            }
                            if ("1" != n.code)
                                return console.log("保存失败，网络连接"),
                                void t._saveJsonAttr.unshift(t._saveToJson);
                            e && c.back({
                                str: '成功保存设计到<a href="/designmanage" style="color: #07aefc">设计管理</a>',
                                kind: "success"
                            }),
                            window.ISEXIST = !0;
                            var s;
                            clearTimeout(s),
                            t._save_drag = "saved",
                            o.removeClass("not-download"),
                            r.removeClass("not-share"),
                            a(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .design_size_move, .design_change_sence, .print-design").removeClass("design-no-click"),
                            (window.api || window.ziyun) && a(".download-design").removeClass("design-no-click"),
                            i.text("保存成功！"),
                            s = setTimeout(function() {
                                var e = new Date
                                  , a = e.getMinutes();
                                10 > a && (a = "0" + a),
                                i.text("今天" + e.getHours() + ":" + a + "更新")
                            }, 500),
                            t._saveJsonAttr.length != [] && t.saveDesign(),
                            "" != n.error && void 0 != n.error && (alert("保存异常"),
                            location.href = "/startdesign")
                        },
                        error: function() {
                            console.log("保存失败，网络不可达"),
                            t._save_drag = "will save",
                            window.SAVE_TIME++;
                            for (var e = t._saveToJson.length - 1; e >= 0; e--)
                                t._saveJsonAttr.unshift(t._saveToJson[e]);
                            setTimeout(function() {
                                t.saveDesign()
                            }, 2e3),
                            3 === window.SAVE_TIME && window.modPrompt.show(1)
                        }
                    })
                }
            }
        },
        defineEveSet: function() {
            function i() {
                document.body.addEventListener("paste", function(e) {
                    {
                        var a = e.clipboardData
                          , i = J._owner_design
                          , o = i.getCurPage()
                          , r = i._focus_element;
                        i._owner_designEditbar,
                        i._owner_elementEditbar
                    }
                    if (null !== localStorage.getItem("eleJson")) {
                        if (null != r && "elementGroup" == r._element_type && r._text_ele_sum != r._text_ele_loaded)
                            return !1;
                        if (t.addBugTrackClick("e2"),
                        null != X()) {
                            var n = X()
                              , l = n.substr(0, 1);
                            if ("{" != l && (n = n.substr(1, n.length)),
                            /haogetedingzhiling/.test(n) && (n = n.split("haogetedingzhiling")),
                            window.MEMENTO_ID = t.now(),
                            n instanceof Array) {
                                var d = o.addEles(n, l);
                                d.nodeClick()
                            } else {
                                var d = o.eleCopyAndUndo({
                                    json: X()
                                });
                                d.nodeClick()
                            }
                        }
                        return localStorage.clear(),
                        !1
                    }
                    for (var c = [], p = 0, f = a.items.length; f > p; p++)
                        if (console.log(a.items),
                        "file" == a.items[p].kind || a.items[p].type.indexOf("image") > -1) {
                            var u = a.items[p].getAsFile();
                            c.push(u),
                            e.preventDefault()
                        }
                    var g = h.algo.MD5.create()
                      , m = new FileReader;
                    m.readAsBinaryString(u),
                    m.onload = function(e) {
                        g.update(h.enc.Latin1.parse(e.target.result));
                        var a = g.finalize();
                        Q.words[0] != a.words[0] ? (Q.words[0] = a.words[0],
                        s(c, !0)) : alert("你已经上传过该图片")
                    }
                })
            }
            function r(e) {
                e.length < 7 && (e = "#" + e);
                {
                    var t = J._owner_design;
                    t.getCurPage()
                }
                if ("back" == a(".ss-function-colorPicker").attr("data-kind"))
                    R(e, La, !0),
                    J._background_drag = !0;
                else {
                    var i = a(".element-edit-bar").find(".ele-color").index(a(".element-edit-bar").find(".ele-color.now-click"))
                      , o = t._focus_element;
                    void 0 != o && o.previewColor(e, i),
                    a(".element-edit-bar").find(".ele-color").eq(i).children().css("background-color", e)
                }
            }
            function n(e, i) {
                function o(e, i) {
                    if (1 != i.code)
                        return a(".background-upload-proress-color").css("width", "150px"),
                        a(".background-upload-proress-color").css("background-color", "red"),
                        a(".background-upload-proress-text").html("上传失败！"),
                        void setTimeout(function() {
                            a(".background-upload-proress").css("display", "none"),
                            a(".background-upload-proress-color").css("background-color", "#F6F6F6")
                        }, 1e3);
                    window.backgroundupload = !1,
                    a(".background-upload-proress-color").css("width", "150px"),
                    a(".background-upload-proress-text").html("上传成功,设置背景...");
                    var o = {
                        "data-type": "background",
                        "data-img-kind": i.dt,
                        "data-elem": {
                            id: i.mid,
                            "data-key": void 0,
                            opacity: 1
                        }
                    }
                      , r = J._owner_design
                      , n = (r.pageScale,
                    r.getCurPage())
                      , l = n.width
                      , s = n.height
                      , d = i.w
                      , c = i.h
                      , i = o["data-elem"];
                    d / l > c / s ? (i.height = s,
                    i.width = s * (d / c)) : (i.width = l,
                    i.height = l * (c / d)),
                    o.transform = "translate(" + (l - i.width) / 2 + "," + (s - i.height) / 2 + ")",
                    window.MEMENTO_ID = t.now(),
                    n.eleDelAndUndo(n.elements[0]);
                    var p = n.createElementAndUndo({
                        json: o,
                        unshift: !0
                    });
                    setTimeout(function() {
                        a(".background-upload-proress").css("display", "none"),
                        p.nodeClick()
                    }, 500)
                }
                if (window.backgroundupload = !1,
                void 0 == window.result)
                    return o(e, i),
                    void window.backuploader.removeFile(e);
                var r = {
                    p: window.result.policy,
                    s: window.result.signature,
                    fid: 0
                };
                a.ajax({
                    url: "/material/reportUploadMaterial.do",
                    dataType: "json",
                    type: "POST",
                    data: r,
                    success: function(a) {
                        o(e, a),
                        window.backuploader.removeFile(e)
                    },
                    error: function() {
                        console.log("上报出错"),
                        window.backuploader.removeFile(e)
                    }
                })
            }
            function s(e, i) {
                for (var o = [], r = 20971520, n = 0; n < e.length; n++)
                    e[n].size >= r ? c.back({
                        str: "支持上传20M以下的图片！",
                        kind: "warning"
                    }) : o.push(e[n]);
                var s, p = o.length;
                if (void 0 == window.personalMaterialData ? (window.personalMaterialData = {
                    page: {
                        pageNo: 1,
                        pageTotal: 0,
                        recordCount: 0,
                        recordData: []
                    }
                },
                s = []) : s = window.personalMaterialData.page.recordData,
                window.personalMaterialData.page.recordCount <= 0 && (window.personalMaterialData.page.pageTotal = Math.ceil(p / l.MATERIAL_PAGE_SIZE),
                window.personalMaterialData.page.recordCount = p),
                !(0 >= p))
                    for (var n = 0; n < o.length; n++) {
                        var f = new FileReader;
                        f.readAsDataURL(o[n]),
                        f.onload = function(e) {
                            var r = (new Date).getTime() + parseInt(1e4 * Math.random())
                              , n = new Image;
                            n.onload = function() {
                                p--;
                                var c = {
                                    h: n.height,
                                    w: n.width,
                                    imgurl: e.target.result,
                                    uploadImgId: r
                                };
                                if (s.unshift(c),
                                0 == p) {
                                    var f = {
                                        pageNo: 1,
                                        pageSize: l.MATERIAL_PAGE_SIZE,
                                        fid: a("#filePicker").attr("data-id"),
                                        w: 180
                                    };
                                    2 == a("#folderKindWrap").attr("data-drag") && (f.tid = window.TEAM_ID),
                                    a(".leadingMaterialWrap").children().detach(),
                                    J.loadMaterialPersonal(J, window.personalMaterialData, J._ajax_url.queryMaterialsInFolder, f, [0, 0, 0], "leadingMaterialWrap", t.noop);
                                    var h = new d;
                                    return h.fileList = s.slice(0, o.length),
                                    h.fileLength = o.length,
                                    h.index = -1,
                                    h.startUpload(),
                                    h.insertPage = i,
                                    void (h.chuangkit = J)
                                }
                            }
                            ,
                            n.src = e.target.result
                        }
                    }
            }
            function d() {
                this.startUpload = function() {
                    if (this.index++,
                    this.index < this.fileLength) {
                        var e = this.fileList[this.index];
                        this.width = e.w,
                        this.height = e.h,
                        this.uploadImgId = e.uploadImgId,
                        this.$img = a("#" + e.uploadImgId),
                        this.constructor(e.imgurl),
                        this.computeMD5()
                    }
                }
                ,
                this.constructor = function(e) {
                    this.dataBin = window.atob(e.split(",")[1]),
                    this.buffer = new Uint8Array(this.dataBin.length);
                    for (var a = 0; a < this.dataBin.length; a++)
                        this.buffer[a] = this.dataBin.charCodeAt(a);
                    this.blob = new Blob([this.buffer.buffer],{
                        type: "image/jpg"
                    })
                }
                ,
                this.computeMD5 = function() {
                    var e = this
                      , a = h.algo.MD5.create()
                      , t = new FileReader;
                    t.readAsBinaryString(this.blob),
                    t.onload = function(t) {
                        a.update(h.enc.Latin1.parse(t.target.result));
                        var i = a.finalize()
                          , o = {
                            md5: i,
                            blob: e.blob
                        };
                        e.preUpload(o)
                    }
                }
                ,
                this.preUpload = function(e) {
                    var t = new FormData
                      , i = this;
                    t.append("md5", e.md5),
                    t.append("file", e.blob.slice(0, 10));
                    var o = a(".folder_wrap").find(".folderClick").attr("data-id");
                    t.append("fid", o),
                    2 == a("#folderKindWrap").attr("data-drag") && t.append("tid", window.TEAM_ID),
                    a.ajax({
                        url: "/material/preUploadMaterial.do",
                        dataType: "json",
                        type: "POST",
                        data: t,
                        processData: !1,
                        contentType: !1,
                        success: function(a) {
                            var t = a.uploadPms;
                            switch (a.code) {
                            case 1:
                                i.progress(100),
                                i.uploadComplete(a);
                                break;
                            case 0:
                                var o = t.accessid
                                  , r = t.policy
                                  , n = t.signature
                                  , l = t.fileKey
                                  , s = t.host
                                  , d = t.md5;
                                i.uploading(o, r, n, l, s, d, e.blob),
                                window.upload = !0;
                                break;
                            default:
                                c.back({
                                    str: "图片解析失败！",
                                    kind: "warning"
                                }),
                                i.uploadFailed()
                            }
                        },
                        error: function() {
                            c.back({
                                str: "图片上传失败！",
                                kind: "error"
                            }),
                            i.this.uploadFailed()
                        }
                    })
                }
                ,
                this.uploading = function(e, t, i, o, r, n, l) {
                    var s = new FormData
                      , d = this;
                    s.append("OSSAccessKeyId", e),
                    s.append("policy", t),
                    s.append("Signature", i),
                    s.append("key", o),
                    s.append("Content-MD5", n),
                    s.append("file", l);
                    a.ajax({
                        url: "//" + r,
                        dataType: "json",
                        type: "POST",
                        xhr: function() {
                            var e = a.ajaxSettings.xhr();
                            return e.upload.addEventListener("progress", function(e) {
                                var a = parseInt(e.loaded / e.total * 100);
                                d.progress(a)
                            }, !1),
                            e
                        },
                        data: s,
                        processData: !1,
                        contentType: !1,
                        success: function() {
                            d.reportUpload(t, i)
                        },
                        error: function() {
                            console.log("图片上传,error"),
                            d.uploadFailed()
                        }
                    })
                }
                ,
                this.progress = function(e) {
                    this.$img.find(".waiting-text").hide(),
                    this.$img.find(".progress-text").show().find(".progress-num").text(e),
                    this.$img.find(".progress-color").height(e + "%")
                }
                ,
                this.reportUpload = function(e, t) {
                    var i = {
                        p: e,
                        s: t,
                        w: this.width,
                        h: this.height,
                        fid: 0
                    }
                      , o = this
                      , r = a(".folder_wrap").find(".folderClick").attr("data-id");
                    i.fid = r ? r : 0,
                    2 == a("#folderKindWrap").attr("data-drag") && (i.tid = window.TEAM_ID),
                    a.ajax({
                        url: "/material/reportUploadMaterial.do",
                        dataType: "json",
                        type: "POST",
                        data: i,
                        success: function(e) {
                            o.uploadComplete(e)
                        },
                        error: function() {
                            console.log("上报个人/团队素材的上传结果,error"),
                            o.uploadFailed()
                        }
                    })
                }
                ,
                this.uploadComplete = function(e) {
                    var t = this;
                    window.personalMaterialData.page.recordData[t.index].ik = e.ik,
                    window.personalMaterialData.page.recordData[t.index].mid = e.mid,
                    window.personalMaterialData.page.recordData[t.index].dt = e.dt,
                    window.personalMaterialData.page.recordData[t.index].uploadImgId = 0,
                    t.$img.find("img").attr("data-id", e.mid),
                    t.$img.attr({
                        "data-id": e.mid,
                        "data-type": e.dt
                    }).find(".progress-text").html("上传成功");
                    var i = t.$img.removeClass("img_uploading").find(".progress-color, .waiting-color, .progress-text, .waiting-text")
                      , o = parseInt(a(".folder_wrap").find(".folderClick").find(".folder-del").attr("data-count"));
                    if (o++,
                    a(".folder_wrap").find(".folderClick").find(".folder-del").attr("data-count", o),
                    setTimeout(function() {
                        i.fadeOut(400, function() {
                            a(this).remove()
                        })
                    }, 2e3),
                    this.insertPage) {
                        var r = t.chuangkit._owner_design
                          , n = r.getCurPage()
                          , l = n.getIndex();
                        a("#leadingMenuBtn").hasClass("listBtnClick") || a("#leadingMenuBtn").click(),
                        O.call(t.$img, l, t.chuangkit, !0)
                    }
                    this.startUpload()
                }
                ,
                this.uploadFailed = function() {
                    this.$img.find(".progress-text").hide(),
                    this.$img.find(".waiting-text").show().text("上传失败"),
                    this.startUpload()
                }
            }
            function P(e) {
                e.stopPropagation(),
                e.preventDefault()
            }
            function F(e) {
                e.stopPropagation(),
                e.preventDefault()
            }
            function B(e) {
                e.stopPropagation(),
                e.preventDefault();
                var t = e.dataTransfer
                  , i = t.files;
                if (!a("#leadingMenuBtn").hasClass("listBtnClick"))
                    return a("#leadingMenuBtn").click(),
                    void c.back({
                        str: "请选择要上传的文件夹后拖动文件到页面",
                        kind: "warning",
                        time: "4000"
                    });
                if (a("#leadingContent").find(".folderClick").size() <= 0)
                    return void c.back({
                        str: "请选择要上传的文件夹后拖动文件到页面",
                        kind: "warning",
                        time: "4000"
                    });
                for (var o = [], r = 0; r < i.length; r++)
                    ("image/png" == i[r].type || "image/jpeg" == i[r].type || "image/gif" == i[r].type) && o.push(i[r]);
                s(o)
            }
            var J = this;
            window.colledMaterial = [],
            Pa(),
            g(),
            m(),
            a(".design_title input").focus(function() {
                t.addSomeMouseClick("上方-重命名")
            }),
            window.SAVE_TIME = 0,
            i();
            var Q = {};
            Q.words = [],
            a(".step-yes").click(function() {
                var e = a(this).attr("data-kind");
                switch (e) {
                case "1":
                    a(".first-step").css("display", "none"),
                    a(".first-o").css("display", "none"),
                    a(".second-step").css("display", "block");
                    break;
                case "2":
                    a(".second-step").css("display", "none"),
                    window.api ? a("#login-first").animate({
                        opacity: "0"
                    }, function() {
                        a("#login-first").css("display", "none"),
                        a.ajax({
                            url: "/user/guided.do",
                            dataType: "json",
                            type: "POST",
                            success: function() {},
                            error: function() {}
                        })
                    }) : a(".third-step").css("display", "block");
                    break;
                case "3":
                    a("#login-first").animate({
                        opacity: "0"
                    }, function() {
                        a("#login-first").css("display", "none"),
                        a.ajax({
                            url: "/user/guided.do",
                            dataType: "json",
                            type: "POST",
                            success: function() {},
                            error: function() {}
                        })
                    })
                }
            }),
            a(".step-skip").click(function() {
                a("#login-first").animate({
                    opacity: "0"
                }, function() {
                    a("#login-first").css("display", "none"),
                    a.ajax({
                        url: "/user/guided.do",
                        dataType: "json",
                        type: "POST",
                        success: function() {},
                        error: function() {}
                    })
                })
            }),
            a(".leftPanelMenuListBtn").click(function(e) {
                _.call(this, J, e)
            }),
            a("#leftPanel").find(".panelArrow").click(function() {
                v.call(this, J)
            }),
            a("#materialKindList").on("click", ".materialKind", function(e) {
                w.call(this, J, e)
            }),
            a("#materialWrap").on("click", ".go-to-upload", function(e) {
                a("#leadingMenuBtn").click(),
                e.stopPropagation()
            }),
            a("#materialWrap").on("mouseenter", ".go-to-upload", function() {
                var e = a(this);
                e.children(".go-to-upload-icon").animate({
                    top: "18px"
                }, 300),
                e.children(".go-to-upload-text").animate({
                    opacity: "1",
                    bottom: "16px"
                }, 300)
            }),
            a("#materialWrap").on("mouseleave", ".go-to-upload", function() {
                var e = a(this);
                e.children(".go-to-upload-icon").stop(!0).animate({
                    top: "28px"
                }, 300),
                e.children(".go-to-upload-text").stop(!0).animate({
                    opacity: "0",
                    bottom: "6px"
                }, 300)
            }),
            127 == KIND_ID || 128 == KIND_ID ? (a("#templateMenuBtn").css("display", "none"),
            a("#materialMenuBtn").click()) : a("#templateMenuBtn").click(),
            a(".secondKindWrap").click(function() {
                var e = a(this)
                  , t = e.children("ul");
                "block" == t.css("display") ? t.css("display", "none") : t.css("display", "block");
                var i = e.find(".point-out-circle");
                if (i.length > 0) {
                    var i = i[0];
                    c.pointOutHide(i)
                }
            }),
            a("#secondKindUl").on("click", "li", function(e) {
                k.call(this, J, e),
                a(".secondKindWrap").click()
            }),
            a("#meterialSecondKindListWrap").on("click", ".secondKindList", function(e) {
                k.call(this, J, e)
            }),
            a("#meterialSecondKindListWrap").on("click", ".secondKindListMore", function() {
                a(this).hasClass("secondKindListMoreClick") ? C.call(this, J) : y.call(this, J)
            }),
            a("#materialup").click(function() {
                a("#materialContent").animate({
                    scrollTop: a(".materialKindClick").offset().top - a("#materialKindList").offset().top
                })
            });
            var ea = {
                name: "design_page_search_materia",
                element: a("#searchKeyWord div")[0],
                position_left: 153,
                position_top: -1
            };
            c.pointOut(ea),
            a("#searchMaterialup").click(function() {
                a("#searchContent").animate({
                    scrollTop: 0
                }),
                N()
            }),
            a("#leftPanelInput").mousedown(function() {
                a("#searchMenuBtn").click()
            }),
            a("#leftPanelInput").keyup(function(e) {
                13 == e.keyCode && (t.addBugTrackClick("h2"),
                A.call(this, J))
            }),
            a("#searchKeyWord").on("click", "li", function() {
                var e = a(this).attr("data-kind");
                a("#searchKeyWord").attr("data-type", e),
                A.call(this, J)
            }),
            a("#clear_search_material").click(function() {
                var e = a(this);
                E(),
                e.parent().find("#materialSearch").hide(),
                e.parent().find(".search_material_history_wrap").show(),
                e.prev().val(""),
                e.hide()
            }),
            a(".search_material_his_list").on("click", "li", function() {
                A.call(this, J)
            }),
            a("#materialSearch").on("mousedown", ".materialCollIcon", function(e) {
                return L.call(this, e),
                !1
            }),
            a("#materialSearch").on("mousedown", ".chooseMaterialLi", function(e) {
                D.call(this, J, e)
            }),
            a("#materialSearch").on("mousedown", ".materialInfoIcon", function(e) {
                K.call(this, e)
            }),
            a("#materialSearch").on("mousedown", ".materialInfoClose", function(e) {
                N.call(this, e)
            }),
            a("#materialSearch").on("mousedown", ".materialInfoWrap", function(e) {
                return e.stopPropagation(),
                !1
            }),
            a("#searchContent").scroll(function() {
                T.call(this, J)
            }),
            a("#materialContent").scroll(function() {
                I.call(this, J)
            }),
            a("#fontContent").scroll(function() {
                M.call(this, J)
            }),
            a("#backContent").scroll(function() {
                x.call(this, J)
            }),
            a("#leadingContent").scroll(function() {
                b.call(this, J)
            }),
            a("#templateContent").scroll(function() {
                S.call(this, J)
            }),
            a(".templateKindBtn").click(function() {
                V.call(this, J)
            }),
            a(".templateShow").on("click", ".templateLi", function() {
                t.addBugTrackClick("k1"),
                $.call(this, J)
            }),
            a("#multipage_back").click(function() {
                ra.call(this, J)
            }),
            a("#multipageContent").on("click", ".multipageSon", function() {
                $.call(this, J)
            }),
            a("#materialWrap").on("mousedown", ".chooseMaterialLi", function(e) {
                D.call(this, J, e)
            }),
            a("#materialWrap").on("mousedown", ".materialCollIcon", function(e) {
                return L.call(this, e),
                !1
            }),
            a("#materialWrap").on("mousedown", ".materialInfoIcon", function(e) {
                K.call(this, e)
            }),
            a("#materialWrap").on("mousedown", ".materialInfoClose", function(e) {
                N.call(this, e)
            }),
            a("#materialWrap").on("mousedown", ".materialInfoWrap", function(e) {
                return e.stopPropagation(),
                !1
            }),
            a("#fontMaterialShow").on("mousedown", ".chooseMaterialLi", function(e) {
                D.call(this, J, e)
            }),
            a("#leadingMaterialWrap").on("mousedown", ".chooseMaterialLi", function(e) {
                D.call(this, J, e)
            }),
            a(".fontAddLi").click(function() {
                j.call(this, J);
                var e = a(this).attr("id");
                "fontAddh1" == e ? t.addSomeMouseClick("左侧-添加标题") : "fontAddh2" == e ? t.addSomeMouseClick("左侧-添加副标题") : "fontAddh3" == e && t.addSomeMouseClick("左侧-添加正文")
            }),
            window.TEAM_ID > 0 ? (a(".contentKindCommon").css("display", "block"),
            a(".fontKindBtn").click(function() {
                U.call(this, J)
            }),
            a("#teamfontAddUl").on("click", ".teamFontAddLi", function() {
                W.call(this, J)
            }),
            a(".backgroundColorBtn").click(function() {
                z.call(this, J)
            }),
            a("#backColorTeaminstall").on("click", ".edit-color-span", function(e) {
                H.call(this, J, e)
            }),
            a("#folderKindWrap").on("click", ".folderKindBtn", function() {
                G.call(this, J)
            }),
            a.ajax({
                url: "/team/getTeamBaseInfo.do",
                dataType: "json",
                type: "POST",
                data: {
                    tid: window.TEAM_ID
                },
                success: function(e) {
                    if (e.team) {
                        var t = e.team.colorValue
                          , i = a("#backColorTeaminstall");
                        if (t.length > 0) {
                            t = t.split(",");
                            var o;
                            i.empty();
                            for (var r = 0; r < t.length; r++)
                                o = '<div class="edit-color-span" style="background-color:' + t[r] + '" title="' + t[r] + '"></div>',
                                i.append(o)
                        } else
                            i.find("a").attr("href", "/team/setup.html?id=" + window.TEAM_ID)
                    }
                },
                error: function() {
                    console.log("获取团队色值失败！")
                }
            }),
            a.ajax({
                url: "/team/getTeamFonts.do",
                dataType: "json",
                type: "POST",
                data: {
                    tid: window.TEAM_ID
                },
                success: function(e) {
                    var t = e.fonts;
                    if (t) {
                        var i = a("#teamfontAddUl");
                        if (t.length > 0) {
                            var o;
                            i.empty();
                            for (var r = 0; r < t.length; r++)
                                o = '<li class="teamFontAddLi" data-size="' + t[r].fs + '" data-color="' + t[r].cv + '" data-family="' + t[r].fn + '" data-space="' + t[r].sl + '" data-style="' + t[r].s + '"><span>' + t[r].in + "</span></li>",
                                i.append(o)
                        } else
                            i.find("a").attr("href", "/team/setup.html?id=" + window.TEAM_ID)
                    }
                },
                error: function() {
                    console.log("获取团队色值失败！")
                }
            })) : a("#templateContentKind").css({
                display: "block",
                width: "164px",
                "margin-left": "76px"
            }).find(".templateKindBtn:eq(2)").css("display", "none"),
            a("#backImgChooseWrap").on("mousedown", ".chooseMaterialLi", function(e) {
                D.call(this, J, e)
            }),
            a("#backColorPreinstall").on("click", ".edit-color-span", function(e) {
                H.call(this, J, e)
            }),
            J.color_picker = new u,
            a(".edit-color-span-pickup").on("click", function() {
                t.addBugTrackClick("n4"),
                J.colorPickupShow(a(this))
            }),
            a(".ss-function-colorPicker").on("click", ".confirm", function() {
                var e = a(".ss-function-colorPicker .color-input").val();
                r(e),
                J.colorPickupHide(a(".edit-color-span-pickup.now-click"))
            }),
            a(".ss-function-colorPicker").on("click", ".cancel", function() {
                J.colorPickupHide(a(".edit-color-span-pickup.now-click"))
            }),
            J.color_picker.getColor(r),
            a(".edit-color-span-transparent").click(function() {
                return a(this).hasClass("edit-color-span-no-click") ? !1 : (t.addBugTrackClick("n2"),
                void (window.ISVIP || window.TEAM_ID > 0 ? J.backgroundTransparent() : f.show()))
            }),
            J.chartKindInit(J);
            var aa;
            aa = window.api ? e.APIDOMAIN + "/design/uploadMaterial.do?_dataType=json&api=1" : e.APIDOMAIN + "/design/uploadMaterial.do?_dataType=json",
            window.backuploader = o.create({
                auto: !0,
                withCredentials: !1,
                server: aa,
                pick: {
                    id: "#background-upload",
                    label: "自定义背景",
                    multiple: !1
                },
                chunked: !1,
                accept: {
                    title: "Images",
                    extensions: "jpg,jpeg,bmp,png,gif",
                    mimeTypes: "image/png,image/jpg,image/jpeg"
                }
            }),
            window.backuploader.on("startUpload", function() {
                window.backgroundupload ? a(".background-upload-proress-text").html("图片上传中...") : this.stop()
            }),
            window.backuploader.on("fileQueued", function(e) {
                var t = 20971520;
                return e.size >= t ? void c.back({
                    str: "支持上传20M以下的图片！",
                    kind: "warning"
                }) : (a(".background-upload-proress").css("display", "block"),
                a(".background-upload-proress-color").width(0),
                a(".background-upload-proress-text").html("图片处理中..."),
                window.backuploader.md5File(e).progress(function() {}).then(function(t) {
                    if (e.size > 20971520)
                        return window.backuploader.stop(),
                        window.backuploader.removeFile(e),
                        a(".background-upload-proress-color").css("width", "150px"),
                        a(".background-upload-proress-color").css("background-color", "red"),
                        a(".background-upload-proress-text").html("图片不能超过20M"),
                        void setTimeout(function() {
                            a(".background-upload-proress").css("display", "none"),
                            a(".background-upload-proress-color").css("background-color", "#F6F6F6")
                        }, 1e3);
                    var i = new FormData;
                    i.append("md5", t),
                    i.append("file", e.source.source.slice(0, 10)),
                    i.append("fid", 0),
                    a.ajax({
                        url: "/material/preUploadMaterial.do",
                        dataType: "json",
                        type: "POST",
                        data: i,
                        processData: !1,
                        contentType: !1,
                        success: function(a) {
                            var t = a.uploadPms;
                            return window.result = t,
                            1 === a.code ? (n(e, a),
                            !1) : (window.backuploader.options.server = "//" + t.host,
                            window.backuploader.options.formData = {
                                OSSAccessKeyId: t.accessid,
                                policy: t.policy,
                                Signature: t.signature,
                                key: t.fileKey,
                                "Content-MD5": t.md5
                            },
                            window.backgroundupload = !0,
                            window.backuploader.upload(),
                            void 0)
                        },
                        error: function() {
                            console.log("error"),
                            window.backuploader.removeFile(e)
                        }
                    })
                }),
                !1)
            }),
            window.TEAM_ID > 0 && a(".background-upload-proress").css("top", "364px"),
            window.backuploader.on("uploadProgress", function(e, t) {
                a(".background-upload-proress-color").width(150 * t)
            }),
            window.backuploader.on("uploadSuccess", function(e) {
                n(e)
            }),
            a("#filePickerPhone").click(function() {
                var e = {
                    fid: a(".folder_wrap").find(".folderClick").attr("data-id") || 0
                };
                window.TEAM_ID > 0 && (e.tid = window.TEAM_ID),
                a.ajax({
                    url: "/material/getUploadToken.do",
                    dataType: "json",
                    type: "POST",
                    data: e,
                    success: function(e) {
                        function t() {
                            a(".folder_wrap").find(".folderClick").click().click()
                        }
                        var i = e.code;
                        if (1 === i) {
                            var o = p.getUploadPhone().clone()
                              , r = window.location.protocol + "//" + window.location.hostname + "/upload?t=" + e.token;
                            o.find(".download-text").text("用微信“扫一扫”上传手机相册图片"),
                            o.find(".qrcode").empty().qrcode({
                                width: 166,
                                height: 166,
                                correctLevel: 0,
                                text: r
                            }),
                            c.dialog(o[0], null, t),
                            clearTimeout(window.PHONE_UPLOAD_MATERIAL_CLOCK),
                            window.PHONE_UPLOAD_MATERIAL_CLOCK = setTimeout(function() {
                                o.find(".download-text").text("二维码已过期，请重新上传")
                            }, 6e5)
                        } else
                            c.back({
                                str: "获取素材上传令牌失败",
                                kind: "warning"
                            })
                    },
                    error: function() {
                        c.back({
                            str: "获取素材上传令牌错误",
                            kind: "error"
                        })
                    }
                })
            }),
            a("#filePicker").click(function() {
                a("#filePickerInput")[0].value = "",
                a("#filePickerInput").click()
            }),
            a("#filePickerInput").on("change", function() {
                a(".cancel_file_manger").hasClass("file_click") && a(".cancel_file_manger").click(),
                s(this.files)
            }),
            window.addEventListener ? (document.body.addEventListener("dragenter", P, !1),
            document.body.addEventListener("dragover", F, !1),
            document.body.addEventListener("drop", B, !1),
            document.getElementById("materialWrap").addEventListener("mousewheel", function(e) {
                if ("show" == a("#materialWrap").attr("data-material-info")) {
                    var t = a("#materialWrap").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    N(e)
                }
            }, !1),
            document.getElementById("materialSearch").addEventListener("mousewheel", function(e) {
                if ("show" == a("#materialSearch").attr("data-material-info")) {
                    var t = a("#materialSearch").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    N(e)
                }
            }, !1),
            document.getElementById("rightPanel").addEventListener("mousewheel", function(e) {
                N(e)
            }, !1),
            document.getElementById("leftPanel").addEventListener("mousedown", function(e) {
                N(e)
            }, !1),
            document.getElementById("rightPanel").addEventListener("mousedown", function(e) {
                var a = J._owner_design
                  , t = a.getCurPage();
                t.nodeMousedown(),
                Z(e, J),
                N(e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("keyup", function(e) {
                q.call(this, J, e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("keypress", function(e) {
                q.call(this, J, e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("keydown", function(e) {
                q.call(this, J, e)
            }, !1),
            document.getElementById(l.ANXID).addEventListener("mousedown", function(e) {
                e.stopPropagation()
            }, !1)) : window.attachEvent && (document.body.addEventListener("ondragenter", P, !1),
            document.body.addEventListener("ondragover", F, !1),
            document.body.addEventListener("ondrop", B, !1),
            document.getElementById("materialWrap").addEventListener("onmousewheel", function(e) {
                if ("show" == a("#materialWrap").attr("data-material-info")) {
                    var t = a("#materialWrap").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    N(e)
                }
            }, !1),
            document.getElementById("materialSearch").addEventListener("mousewheel", function(e) {
                if ("show" == a("#materialSearch").attr("data-material-info")) {
                    var t = a("#materialSearch").find(".materialInfoWrap")
                      , i = t.offset().top
                      , o = i + parseFloat(t.outerHeight());
                    if (e.y > i && e.y < o)
                        return e.preventDefault(),
                        !1;
                    N(e)
                }
            }, !1),
            document.getElementById("rightPanel").addEventListener("onmousewheel", function(e) {
                N(e)
            }, !1),
            document.getElementById("leftPanel").addEventListener("onmousedown", function(e) {
                N(e)
            }, !1),
            document.getElementById("rightPanel").attachEvent("onmousedown", function(e) {
                var a = J._owner_design
                  , t = a.getCurPage();
                t.nodeMousedown(),
                Z(e, J),
                N(e)
            }),
            document.getElementById(l.ANXID).attachEvent("onkeyup", function(e) {
                q.call(this, J, e)
            }),
            document.getElementById(l.ANXID).attachEvent("onkeypress", function(e) {
                q.call(this, J, e)
            }),
            document.getElementById(l.ANXID).attachEvent("onkeydown", function(e) {
                q.call(this, J, e)
            }),
            document.getElementById(l.ANXID).attachEvent("onmousedown", function(e) {
                e.stopPropagation()
            })),
            a("body").keydown(function(e) {
                N(e);
                var i = J._owner_design
                  , o = i.getCurPage()
                  , r = i._focus_element
                  , n = i._owner_designEditbar
                  , s = i._owner_elementEditbar;
                if ("INPUT" != e.target.tagName && ("TEXTAREA" != e.target.tagName || "copyPaste" == e.target.getAttribute("class")))
                    if (null != r && "block" == a("#" + l.ANXID).css("display"))
                        ;
                    else {
                        if ((1 == e.ctrlKey || 1 == e.metaKey) && 90 == e.keyCode)
                            return t.addBugTrackClick("b1"),
                            o.nodeMousedown(),
                            i.undoMemento(),
                            !1;
                        if (8 == e.keyCode || 46 == e.keyCode)
                            return null == r || "true" == r.lock ? !1 : (window.MEMENTO_ID = t.now(),
                            "circleSelect" == r._element_type || "elementGroup" == r._element_type ? r.removeAndUndo() : "background" === r.dataType ? (o.eleDelAndUndo(r),
                            o.addWhiteBackgroundAndUndo(!0)) : o.eleDelAndUndo(r),
                            !1);
                        if (null != r && (1 == e.ctrlKey || 1 == e.metaKey) && 67 == e.keyCode) {
                            if (t.addBugTrackClick("e1"),
                            "elementGroup" == r._element_type || "circleSelect" == r._element_type) {
                                for (var d = r._elements, c = [], p = 0; p < d.length; p++)
                                    c.push(JSON.stringify(d[p].getNewJson()));
                                "elementGroup" == r._element_type && c.push(JSON.stringify(r.getNewJson())),
                                Y(c, r._element_type)
                            } else {
                                var f = r.getNewJson();
                                "background" === f["data-type"] && (f["data-type"] = "img"),
                                Y(f)
                            }
                            return !1
                        }
                        if (1 != e.ctrlKey && 1 != e.metaKey || 86 != e.keyCode) {
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 40 == e.keyCode)
                                return t.addBugTrackClick("a4"),
                                void 0 == r ? !1 : (s.movedownMousedown({
                                    button: 0,
                                    execute: !0
                                }, a(".ele-movedown")),
                                !1);
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 38 == e.keyCode)
                                return t.addBugTrackClick("a3"),
                                void 0 == r ? !1 : (s.moveupMousedown({
                                    button: 0,
                                    execute: !0
                                }, a(".ele-movedown")),
                                !1);
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 83 == e.keyCode)
                                return t.addBugTrackClick("d1"),
                                o.nodeMousedown(),
                                J.saveDesign(!0),
                                !1;
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 187 == e.keyCode) {
                                t.addBugTrackClick("a7"),
                                o.nodeMousedown();
                                var h = i.pageScale + n._change_scale;
                                return n.changeDesignScale(h),
                                !1
                            }
                            if ((1 == e.ctrlKey || 1 == e.metaKey) && 189 == e.keyCode) {
                                t.addBugTrackClick("a7"),
                                o.nodeMousedown();
                                var h = i.pageScale - n._change_scale;
                                return n.changeDesignScale(h),
                                !1
                            }
                            if (27 == e.keyCode)
                                o.nodeMousedown();
                            else {
                                if ((1 == e.ctrlKey || 1 == e.metaKey) && 71 == e.keyCode)
                                    return void 0 == r ? !1 : ("circleSelect" == r._element_type && (t.addBugTrackClick("h1"),
                                    s.setGroup({
                                        button: 0
                                    })),
                                    e.shiftKey && (t.addBugTrackClick("h2"),
                                    "elementGroup" == r._element_type && r.groupSplitAndUndo()),
                                    !1);
                                if ((1 == e.ctrlKey || 1 == e.metaKey) && 75 == e.keyCode)
                                    return void 0 == r ? !1 : (t.addBugTrackClick("h4"),
                                    s.setLock({
                                        button: 0
                                    }, a(".ele-lock")),
                                    !1);
                                if (37 == e.keyCode) {
                                    if (void 0 == r)
                                        return !1;
                                    t.addBugTrackClick("h4"),
                                    r.moveByKey(-1, 0);
                                    var u, g;
                                    return "circleSelect" === r._element_type ? (u = parseInt(r.getLeft()),
                                    g = parseInt(r.getTop())) : (u = parseInt(t.getTransformAttr(r.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    g = parseInt(t.getTransformAttr(r.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(u + "," + g).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                                if (38 == e.keyCode) {
                                    if (void 0 == r)
                                        return !1;
                                    r.moveByKey(0, -1);
                                    var u, g;
                                    return "circleSelect" === r._element_type ? (u = parseInt(r.getLeft()),
                                    g = parseInt(r.getTop())) : (u = parseInt(t.getTransformAttr(r.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    g = parseInt(t.getTransformAttr(r.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(u + "," + g).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                                if (39 == e.keyCode) {
                                    if (void 0 == r)
                                        return !1;
                                    r.moveByKey(1, 0);
                                    var u, g;
                                    return "circleSelect" === r._element_type ? (u = parseInt(r.getLeft()),
                                    g = parseInt(r.getTop())) : (u = parseInt(t.getTransformAttr(r.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    g = parseInt(t.getTransformAttr(r.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(u + "," + g).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                                if (40 == e.keyCode) {
                                    if (void 0 == r)
                                        return !1;
                                    r.moveByKey(0, 1);
                                    var u, g;
                                    return "circleSelect" === r._element_type ? (u = parseInt(r.getLeft()),
                                    g = parseInt(r.getTop())) : (u = parseInt(t.getTransformAttr(r.getTransform(), "translate")[0] / l.ZOOM_IN),
                                    g = parseInt(t.getTransformAttr(r.getTransform(), "translate")[1] / l.ZOOM_IN)),
                                    a("#edit-data").text(u + "," + g).fadeIn(250),
                                    clearTimeout(window.ELE_LOCATION_LOCK),
                                    window.ELE_LOCATION_LOCK = setTimeout(function() {
                                        a("#edit-data").fadeOut(250)
                                    }, 2e3),
                                    !1
                                }
                            }
                        } else
                            ;
                    }
            }),
            a("#chartDataSet").on("keydown", ".handsontableInput", function(e) {
                return 13 == e.keyCode ? !1 : void 0
            }),
            document.onkeydown = function(e) {
                return e || (e = window.event),
                8 != e.keyCode && 46 != e.keyCode || "INPUT" == e.target.tagName || "TEXTAREA" == e.target.tagName ? void (13 == (e.keyCode || e.which) && "folder-text folder-text-click" == e.target.getAttribute("class") && (window.TEAM_ID > 0 ? _a(a(e.target), !0) : _a(a(e.target)),
                a(e.target).removeClass("folder-text-click"),
                a(e.target).attr("readonly", "readonly"))) : !1
            }
            ,
            window.onbeforeunload = function() {
                var e = (J._owner_design,
                {
                    d: DESIGN_ID,
                    type: 1
                });
                window.TEAM_ID > 0 && (e.tid = window.TEAM_ID),
                window.COOPERATE_DESIGN && (e.c = !0),
                a.ajax({
                    url: "/design/addMakeImageTask.do",
                    dataType: "json",
                    type: "POST",
                    data: e,
                    success: function() {},
                    error: function() {}
                });
                var t, i;
                for (t in window.allChartSaveDrag)
                    if ("saving" == t.drag) {
                        i = !0;
                        break
                    }
                return !window.isLoginOut && "saved" != La._save_drag || i ? (La.saveDesign(),
                "您现在还没有保存最新修改的设计") : void 0
            }
            ,
            J.colorBtnSet(),
            window.TEAM_ID > 0 && (a(".fontKindBtn").eq(1).click(),
            a(".templateKindBtn").eq(2).click(),
            a(".backgroundColorBtn").eq(1).click())
        },
        chartKindInit: function(e) {
            function i(e, a) {
                if ("loadData" != a) {
                    var i = o._focus_element;
                    if (null == i)
                        return;
                    var r = t.deepClone(window.CHART_HOT.getData());
                    window.MEMENTO_ID = t.now(),
                    i.data = {
                        value: r,
                        undo_drag: !0
                    },
                    i.setData(!0),
                    i.updateNodeAndUndo(),
                    i.setSvgAttrData("axisTitle"),
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("legend"),
                    i.setSvgAttrData("chartKind"),
                    i.setSvgAttrData("dataSize")
                }
            }
            var o = e._owner_design;
            a("#chartDataEnterBtn").click(function() {
                a("#chartContent").toggleClass("chartData");
                var e = o._focus_element
                  , i = t.deepClone(e.data);
                window.CHART_HOT.loadData(i)
            }),
            a("#backchartSetWrap").click(function() {
                a("#chartContent").toggleClass("chartData")
            }),
            a("#backchartSetWrap").click(function() {
                var a = o._focus_element;
                e.initChartBtn(a)
            }),
            a(".chartSwitch").click(function() {
                var e = a(this);
                return e.hasClass("chart-no-click") ? !1 : void e.toggleClass("switchyes")
            }),
            a(".selectInput").click(function() {
                var e = a(this)
                  , t = e.parent()
                  , i = o._focus_element;
                return e.hasClass("chart-no-click") ? !1 : (t.hasClass("optionsShow") ? t.removeClass("optionsShow") : (a(".selectInput").parent().removeClass("optionsShow"),
                t.addClass("optionsShow")),
                "chartColors" == e.attr("id") && i.colorsGroup >= 0 && a(".selectOptionsWrap").scrollTop(30 * i.colorsGroup),
                !1)
            }),
            a("#chartSet").click(function() {
                a(".selectInput").parent().removeClass("optionsShow"),
                a("#chartColorsWrap").height(20).find("#customChartColorsChoose").height(0).prev().find(".custom-now-click").removeClass("custom-now-click")
            }),
            a("#chartTitleSwitch").click(function() {
                window.MEMENTO_ID = t.now();
                var e = a(this)
                  , i = o._focus_element;
                e.hasClass("switchyes") ? (a(".chartTitleInput").removeClass("chart-no-click"),
                a(".chartTitleInput")[0].removeAttribute("readonly"),
                i.titleShow = !0) : (a(".chartTitleInput").addClass("chart-no-click"),
                a(".chartTitleInput")[0].setAttribute("readonly", "readonly"),
                i.titleShow = !1),
                i.setTitle(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("title")
            }),
            a("#chartTitleInput").focus(function() {
                var e = a(this);
                e.attr("data-old", e.val())
            }).keyup(function() {
                var e = a(this);
                if (e.attr("data-old") != e.val()) {
                    window.MEMENTO_ID = t.now();
                    var i = o._focus_element;
                    i.title = e.val(),
                    i.setTitle(),
                    i.updateNodeAndUndo()
                }
            }),
            a(".chartTitlePosition").click(function() {
                window.MEMENTO_ID = t.now();
                var e = a(this)
                  , i = e.attr("data-position")
                  , r = o._focus_element;
                r.titlePosition = i,
                r.setTitle(),
                r.nodeClick(),
                r.updateNodeAndUndo(),
                r.setSvgAttrData("title")
            }),
            a(".chartTitleColor").click(function() {
                window.MEMENTO_ID = t.now();
                var e = a(this)
                  , i = e.attr("data-color")
                  , r = o._focus_element;
                r.titleColor = i,
                r.setTitle(),
                r.updateNodeAndUndo()
            }),
            a("#xYAxisTitleSwitch").click(function() {
                {
                    var e = a(this)
                      , t = o._focus_element
                      , i = t.getJson();
                    i["data-elem"]
                }
                e.hasClass("switchyes") ? (a(".xYAxis").removeClass("chart-no-click"),
                a(".xYAxis").removeAttr("readonly"),
                t.axisTitleShow = !0) : (a(".xYAxis").addClass("chart-no-click"),
                a(".xYAxis").attr("readonly", "readonly"),
                t.axisTitleShow = !1),
                t.setAxisTitle(),
                t.updateNodeAndUndo(),
                t.setSvgAttrData("axisTitle")
            }),
            a("#x-axis").focus(function() {
                var e = a(this)
                  , t = e.val();
                e.attr("data-old", t)
            }).keyup(function() {
                var e = a(this);
                if (e.attr("data-old") != e.val()) {
                    window.MEMENTO_ID = t.now();
                    var i = o._focus_element
                      , r = e.val();
                    i.xAxisTitle = r,
                    i.setAxisTitle(),
                    i.updateNodeAndUndo(),
                    i.setSvgAttrData("axisTitle")
                }
            }),
            a("#y-axis").focus(function() {
                var e = a(this)
                  , t = e.val();
                e.attr("data-old", t)
            }).keyup(function() {
                var e = a(this);
                if (e.attr("data-old") != e.val()) {
                    window.MEMENTO_ID = t.now();
                    var i = o._focus_element
                      , r = e.val();
                    i.yAxisTitle = r,
                    i.setAxisTitle(),
                    i.updateNodeAndUndo()
                }
            }),
            a(".chartInput").focus(function() {
                var e = a(this);
                "readonly" != e.attr("readonly") && 0 == e.val().length && (e.val(""),
                e.attr("placeholder", ""))
            }).blur(function() {
                var e = a(this);
                "readonly" != e.attr("readonly") && e.attr("placeholder", e.attr("data-holder"))
            }),
            a("#legendSwitch").click(function() {
                var e = a(this)
                  , i = o._focus_element;
                window.MEMENTO_ID = t.now(),
                i.legendShow = e.hasClass("switchyes") ? !0 : !1,
                i.setLegend(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("legend")
            }),
            a("#xYAxisSwitch").click(function() {
                var e = a(this)
                  , i = o._focus_element;
                window.MEMENTO_ID = t.now(),
                i.axisShow = e.hasClass("switchyes") ? !0 : !1,
                i.setAxis(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("axis")
            }),
            a("#yAxisGrid").click(function() {
                var e = a(this)
                  , i = o._focus_element;
                window.MEMENTO_ID = t.now(),
                i.gridShow = e.hasClass("switchyes") ? !0 : !1,
                i.setData(),
                i.updateNodeAndUndo(),
                i.setSvgAttrData("grid")
            }),
            a("#moreColors").click(function() {
                var e = a(this);
                if (e.hasClass("radioSelect"))
                    return !1;
                window.MEMENTO_ID = t.now(),
                a("#customChartColorsChoose").height(0),
                a("#chartColors").removeClass("chart-no-click");
                var i = o._focus_element;
                i.setData(!0),
                i.updateNodeAndUndo()
            }),
            a("#onlyColor").click(function() {
                var e = a(this);
                if (e.hasClass("radioSelect"))
                    return !1;
                window.MEMENTO_ID = t.now(),
                a("#customChartColorsChoose").height(0),
                a("#chartColors").addClass("chart-no-click");
                var i = o._focus_element;
                i.setData(!0),
                i.updateNodeAndUndo()
            }),
            a(".chartRadio").click(function() {
                var e = a(this)
                  , t = e.parent();
                t.children().not(e).removeClass("radioSelect"),
                e.addClass("radioSelect")
            }),
            a("#customChartColors").on("click", "span", function(e) {
                var t = a(this)
                  , i = a("#customChartColorsChoose");
                return t.hasClass("custom-now-click") ? (t.removeClass("custom-now-click"),
                i.height(0),
                t.parent().parent().height(20),
                !1) : (a(".custom-now-click").removeClass("custom-now-click"),
                t.addClass("custom-now-click"),
                t.parent().parent().height(110),
                i.height(92),
                void e.stopPropagation())
            }),
            a("#customChartColors").on("mouseenter", "span", function() {
                var e = a(this)
                  , t = e.index()
                  , i = o._focus_element;
                i.showStrokeByIndex(t)
            }),
            a("#customChartColors").on("mouseleave", "span", function() {
                var e = a(this)
                  , t = (e.index(),
                o._focus_element);
                t.hideStroke()
            }),
            a(".customChartColorsChooseSon").click(function(e) {
                var i = a(this)
                  , r = a(".custom-now-click");
                if (r.size() <= 0)
                    return !1;
                var n = i.css("background-color");
                r.css("background-color", n);
                var l = a(".customChartColorsSpan")
                  , s = l.size()
                  , d = o._focus_element
                  , c = [];
                window.MEMENTO_ID = t.now();
                for (var p = 0; s > p; p++)
                    c[p] = t.colorHex(l.eq(p).css("background-color"));
                d.colors = {
                    value: c,
                    undo_drag: !0
                },
                d.setData(),
                d.updateNodeAndUndo(),
                e.stopPropagation(),
                d.colorsGroup = 0
            }),
            a(".selectOptions").click(function() {
                var e = a(this)
                  , i = e.parent()
                  , r = i.prev();
                if (r.html(e.html()),
                e.hasClass("chartColors")) {
                    window.MEMENTO_ID = t.now();
                    var n = e.attr("data-colors");
                    r.attr("data-colors", n);
                    var l = o._focus_element;
                    l.setData(!0),
                    l.updateNodeAndUndo();
                    var s = e.index();
                    l.colorsGroup = s
                }
                i.parent().removeClass("optionsShow")
            }),
            a("#axis_min").focus(function() {
                var e = a(this)
                  , t = e.val();
                e.attr("data-old", t)
            }).blur(function() {
                var e = a(this)
                  , t = e.val()
                  , i = o._focus_element;
                if (null == i)
                    return !1;
                if ("" == t)
                    return i.setYAxisNumMin(-1),
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    !1;
                if (e.attr("data-old") != t) {
                    if (isNaN(t))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    e.val(parseInt(t));
                    var r = i.setYAxisNumMin(parseInt(t));
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    r ? e.attr("data-old", parseInt(t)) : e.val(e.attr("data-old"))
                }
            }).keyup(function(e) {
                var t = a(this)
                  , i = t.val();
                if (38 == e.keyCode)
                    i++,
                    t.val(i);
                else if (40 == e.keyCode) {
                    if (i--,
                    0 > i)
                        return !1;
                    t.val(i)
                } else if (13 != e.keyCode)
                    return !1;
                if (t.attr("data-old") != i) {
                    var r = o._focus_element;
                    if (null == r)
                        return !1;
                    if (isNaN(i))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    t.val(parseInt(i));
                    var n = r.setYAxisNumMin(i);
                    r.setSvgAttrData("axisScale"),
                    r.setSvgAttrData("chartKind"),
                    n ? t.attr("data-old", parseInt(i)) : t.val(t.attr("data-old"))
                }
            }),
            a("#axis_max").focus(function() {
                var e = a(this);
                e.attr("data-old", e.val())
            }).blur(function() {
                var e = a(this)
                  , t = e.val()
                  , i = o._focus_element;
                if (null == i)
                    return !1;
                if ("" == t)
                    return i.setYAxisNumMax(-1),
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    !1;
                if (e.attr("data-old") != t) {
                    if (isNaN(t))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    e.val(parseInt(t));
                    var r = i.setYAxisNumMax(parseInt(t));
                    i.setSvgAttrData("axisScale"),
                    i.setSvgAttrData("chartKind"),
                    r ? e.attr("data-old", parseInt(t)) : e.val(e.attr("data-old"))
                }
            }).keyup(function(e) {
                var t = a(this)
                  , i = t.val();
                if (38 == e.keyCode)
                    i++,
                    t.val(i);
                else if (40 == e.keyCode) {
                    if (i--,
                    0 > i)
                        return !1;
                    t.val(i--)
                } else if (13 != e.keyCode)
                    return !1;
                if (t.attr("data-old") != i) {
                    var r = o._focus_element;
                    if (null == r)
                        return !1;
                    if (isNaN(i))
                        return c.back({
                            str: "请输入正整数！",
                            kind: "warning"
                        }),
                        !1;
                    t.val(parseInt(i));
                    var n = r.setYAxisNumMax(parseInt(i));
                    r.setSvgAttrData("axisScale"),
                    r.setSvgAttrData("chartKind"),
                    n ? t.attr("data-old", parseInt(i)) : t.val(t.attr("data-old"))
                }
            });
            var r = [["苹果", "60"], ["香蕉", "45"], ["橘子", "20"], ["草莓", "40"], ["西瓜", "35"]]
              , l = document.getElementById("chartDataSet");
            window.CHART_HOT = new n(l,{
                data: r,
                minCols: 2,
                minRows: 20,
                maxCols: 2,
                maxRows: 10,
                minSpareRows: 1,
                rowHeaders: !0,
                colHeaders: ["名称", "数据"],
                contextMenu: !1,
                afterChange: i,
                colWidths: 100
            }),
            a(".chartKind").click(function() {
                t.addBugTrackClick("g1"),
                window.MEMENTO_ID = t.now();
                var e = a(this);
                if (e.hasClass("chart-no-click"))
                    return !1;
                var i = o.getCurPage()
                  , r = e.attr("data-kind")
                  , n = o._focus_element;
                if (void 0 != n && "svgChart" == n._element_type)
                    return n.kind = r,
                    n.setData(),
                    n.updateNodeAndUndo(),
                    n.setSvgAttrData("axisScale"),
                    n.setSvgAttrData("grid"),
                    n.setSvgAttrData("legend"),
                    n.setSvgAttrData("chartKind"),
                    e.parent().find(".chartNowSet").removeClass("chartNowSet"),
                    e.addClass("chartNowSet"),
                    !1;
                {
                    var l, s = i.pageWH;
                    o.pageScale
                }
                l = s.width < s.height ? s.width > 300 ? .5 * s.width : .8 * s.width : s.height > 300 ? .5 * s.height : .8 * s.height;
                var d = (s.height - l) / 2
                  , c = (s.width - l) / 2
                  , p = t.deepClone(window.CHART_HOT.getData())
                  , f = {
                    "data-type": "svgChart",
                    "data-elem": {
                        id: "",
                        "view-width": 500,
                        "view-height": 500,
                        width: l,
                        height: l,
                        opacity: 1,
                        viewBox: "0 0 500 500",
                        "chart-data": p,
                        "chart-kind": r,
                        "chart-colors": ["#158C99", "#1BAFA1", "#E9A72C", "#4E545B", "#717B87", "#1B88BA", "#639080", "#92C4D9", "#3E5B79", "#A7B4C4"],
                        "chart-colors-group": 0,
                        "chart-title": "默认标题",
                        "chart-titleShow": !0,
                        "chart-titleColor": "#808284",
                        "chart-titlePosition": "top",
                        "chart-axisShow": !0,
                        "chart-axisTitleShow": !0,
                        "chart-xAxisTitle": "X轴标题",
                        "chart-yAxisTitle": "Y轴标题",
                        "chart-yAxisNumMin": 0,
                        "chart-xAxisNumMax": -1,
                        "chart-gridShow": !0,
                        "chart-legendShow": !0
                    },
                    transform: "translate(" + c + "," + d + ")",
                    reverse: "translate(0,0)rotate(0,0,0)"
                };
                a("#onlyColor").removeClass("radioSelect"),
                a("#moreColors").addClass("radioSelect"),
                a("#chartColors").removeClass("chart-no-click"),
                window.chart_add_chart = !0;
                var n = i.createElementAndUndo({
                    json: f,
                    unshift: !0
                });
                n.nodeClick(),
                a("#chartDataEnterBtn").click()
            })
        },
        initChartBtn: function(e) {
            if (null != e) {
                if (a("#chartContent").hasClass("chartData")) {
                    var i = t.deepClone(e.data);
                    return void window.CHART_HOT.loadData(i)
                }
                a("#chartSetKindContent").find(".chartNowSet").removeClass("chartNowSet"),
                a(".chartKind[data-kind=" + e.kind + "]").addClass("chartNowSet"),
                a("#chartSetFirstTitle").html("修改图表类型"),
                a("#chartDataEnterBtn").css("display", "block"),
                a("#chartSetSecondTitle").css("display", "block"),
                a("#chartSetContent").css("display", "block"),
                e.titleShow ? (a("#chartTitleSwitch").addClass("switchyes"),
                a(".chartTitleInput").removeClass("chart-no-click"),
                a(".chartTitleInput")[0].removeAttribute("readonly")) : (a("#chartTitleSwitch").removeClass("switchyes"),
                a(".chartTitleInput").addClass("chart-no-click"),
                a(".chartTitleInput")[0].setAttribute("readonly", "readonly")),
                "默认标题" != e.title && a("#chartTitleInput").val(e.title);
                var o;
                switch (e.titlePosition) {
                case "top":
                    o = "上";
                    break;
                case "bottom":
                    o = "下"
                }
                a("#chartTitlePositionSelect").html(o);
                var r;
                switch (e.titleColor) {
                case "#000":
                    r = "黑";
                    break;
                case "#FFF":
                    r = "白";
                    break;
                default:
                    r = "灰"
                }
                if (a("#chartTitleColorSelect").html(r),
                e.axisTitleShow ? (a("#xYAxisTitleSwitch").addClass("switchyes"),
                a("#x-axis").removeAttr("readonly").removeClass("chart-no-click"),
                a("#y-axis").removeAttr("readonly").removeClass("chart-no-click")) : (a("#xYAxisTitleSwitch").removeClass("switchyes"),
                a("#x-axis").attr("readonly", "readonly").addClass("chart-no-click"),
                a("#y-axis").attr("readonly", "readonly").addClass("chart-no-click")),
                a("#x-axis").val("X轴标题" != e.xAxisTitle ? e.xAxisTitle : ""),
                a("#y-axis").val("Y轴标题" != e.yAxisTitle ? e.yAxisTitle : ""),
                e.axisShow ? a("#xYAxisSwitch").addClass("switchyes") : a("#xYAxisSwitch").removeClass("switchyes"),
                e.gridShow ? a("#yAxisGrid").addClass("switchyes") : a("#yAxisGrid").removeClass("switchyes"),
                e.legendShow ? a("#legendSwitch").addClass("switchyes") : a("#legendSwitch").removeClass("switchyes"),
                1 == e.colors.length ? (a(".radioSelect").removeClass("radioSelect"),
                a("#onlyColor").addClass("radioSelect"),
                a("#chartColors").addClass("chart-no-click")) : (a(".radioSelect").removeClass("radioSelect"),
                a("#moreColors").addClass("radioSelect"),
                a("#chartColors").removeClass("chart-no-click")),
                a("#chartColorsWrap").height(20).find("#customChartColorsChoose").height(0),
                a(".optionsShow").removeClass("optionsShow"),
                e.colorsGroup >= 0) {
                    var n, l = a("#chart_color_group_" + e.colorsGroup), s = l.attr("data-colors"), d = s.split(","), c = d.length, p = a("#chartColors");
                    p.empty();
                    for (var f = 0; c > f; f++)
                        n = c > 6 ? '<span class="chartColorsSpan chartColorsSpanDefault" style="background-color: ' + d[f] + ';"></span>' : '<span class="chartColorsSpan" style="background-color: ' + d[f] + ';"></span>',
                        p.append(n)
                }
                e.showCustomColors(a("#customChartColors")),
                a("#axis_min").val(e.yAxisNumMin > 0 ? e.yAxisNumMin : ""),
                a("#axis_max").val(e.yAxisNumMax > 0 ? e.yAxisNumMax : "")
            } else
                a("#chartContent").removeClass("chartData"),
                a("#chartSetFirstTitle").html("新插入图表"),
                a("#chartDataEnterBtn").css("display", "none"),
                a("#chartSetSecondTitle").css("display", "none"),
                a("#chartSetContent").css("display", "none"),
                a(".chartNowSet").removeClass("chartNowSet");
            var h = a(".chartColors");
            if (h.eq(0).children().size() < 1)
                for (var u = h.size(), f = 0; u > f; f++)
                    for (var n, s = h.eq(f).attr("data-colors"), d = s.split(","), c = d.length, g = h.eq(f), m = 0; c > m; m++)
                        n = c > 6 ? '<span class="chartColorsSpan chartColorsSpanDefault" style="background-color: ' + d[m] + ';"></span>' : '<span class="chartColorsSpan" style="background-color: ' + d[m] + ';"></span>',
                        g.append(n)
        },
        colorBtnSet: function() {
            var e = localStorage.color;
            if (void 0 != e)
                for (var t = e.split(","), i = t.length, o = 0; i > o; o++)
                    a("#edit-color").find(".default-edit-color-wrap").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor"),
                    a("#backColorPreinstall").children(".edit-color-span").eq(o).css("background-color", t[o]).removeClass("edit-color-span-nocolor")
        },
        colorPickupHide: function(e, t, i) {
            var o = this
              , r = o._owner_design
              , n = r.getCurPage()
              , l = n.elements
              , s = r._focus_element || l[0];
            if (a(".ss-function-colorPicker").attr("data-block", "none"),
            a(".ss-function-colorPicker").animate({
                left: parseFloat(a(".ss-function-colorPicker").css("left")) + 50,
                opacity: 0
            }, function() {
                e.removeClass("now-click"),
                a(".ss-function-colorPicker").css("display", "none")
            }),
            !i) {
                var d = a(".ss-function-colorPicker .color-input").val();
                if (o._background_drag)
                    R(d, o),
                    o._background_drag = !1;
                else {
                    var c = a(".element-edit-bar").find(".ele-color").index(a(".element-edit-bar").find(".ele-color.now-click"));
                    s.setColor(d, c)
                }
                a(".seeColors-temp-container").fadeOut(function() {
                    a(".seeColors-temp-container").remove()
                }),
                J()
            }
        },
        colorPickupShow: function(e) {
            var i = this
              , o = i._owner_design
              , r = o.getCurPage();
            if (e.hasClass("now-click"))
                return i.colorPickupHide(e),
                !1;
            var n = r.getNode().firstChild;
            n = a(n)[0].outerHTML,
            n = n.toString(),
            i.color_picker.updateSVG(n),
            t.addBugTrackClick("n3"),
            e.addClass("now-click");
            var l;
            if (a(".ss-function-colorPicker").attr("data-block", "block"),
            "backColorPreinstall" == e.parent().attr("id"))
                a(".ss-function-colorPicker").attr("data-kind", "back"),
                l = r.getBackgroundColor();
            else {
                a(".ss-function-colorPicker").attr("data-kind", "element");
                var s = a(".ele-color").index(a(".ele-color.now-click"));
                a(".ss-function-colorPicker").attr("data-num", s);
                var d = o._focus_element;
                l = d.getFocusColor(s)
            }
            var c = e.offset().top - 11
              , p = e.offset().left + 40;
            return a(".ss-function-colorPicker").css({
                opacity: 0,
                left: p + 50,
                top: c,
                display: "block"
            }),
            a(".ss-function-colorPicker").animate({
                left: p,
                opacity: 1
            }),
            a(".ss-function-colorPicker .color-input").val(t.colorHex(l)),
            i.color_picker.setColor(t.colorHex(l)),
            !1
        },
        backgroundTransparent: function() {
            var e = this
              , i = e._owner_design
              , o = i.getCurPage()
              , r = o.elements[0];
            a(o.getNode()).addClass("page-transparent"),
            window.MEMENTO_ID = t.now(),
            r.previewOpacity(0),
            r.setOpacity(0)
        },
        queryMaterial: function(e, i, o, r, n) {
            n = n || t.noop;
            var l = this
              , s = a("#" + r);
            null != l._query_ajax && "pending" == l._query_ajax.promise().state() && l._query_ajax.abort(),
            l._query_ajax = a.ajax({
                url: e,
                dataType: "json",
                type: "POST",
                data: i,
                error: function() {
                    l._kind_click_drag = !1,
                    console.log("返回素材出错或者强行终止")
                },
                success: function(t) {
                    function d(t) {
                        s.children(".onloadMaterial").css("display", "none");
                        var d;
                        d = t.result ? t.result : t.page;
                        var c = d.pageTotal
                          , p = d.recordCount;
                        if (a(".folder").attr({
                            "data-size": p
                        }),
                        i.pageNo > c || 0 >= p) {
                            var f;
                            return f = "leadingMaterialWrap" == r ? '<div style="position:absolute;bottom:15px" class="nohaveTipsTemplate">已经没有更多了</div>' : '<div style="position:absolute;bottom:15px" class="nohaveTipsTemplate">素材库正在完善，敬请期待</div>',
                            s.append(f),
                            void (l._kind_click_drag = !1)
                        }
                        var h = d.recordData;
                        if ("/material/getMaterialsInFolder.do" == e)
                            for (var u, g = 0; g < h.length; g++)
                                u = h[g],
                                u.img_key = u.ik,
                                u.attach_id = u.ai,
                                u.kind_id = u.ki,
                                u.material_id = u.mid,
                                u.business_type = u.bt,
                                u.content_type = u.dt,
                                u.business_type__caption = u.bt__caption,
                                u.img_ori_height = u.h,
                                u.img_ori_width = u.w;
                        var m, _, v, w, k, y, C, T, I, M = 0, x = 0, b = 0, S = 1, A = (s.getWidth() - 20) / 3;
                        s.attr("data-index", parseInt(i.pageNo) + 1);
                        for (var g = 0, E = h.length; E > g; g++) {
                            m = h[g],
                            _ = o[0],
                            M = 0,
                            v = o[0],
                            x = 0;
                            for (var D = 1; 3 > D; D++)
                                o[D] < _ ? (_ = o[D],
                                M = D) : o[D] > v && (v = o[D],
                                x = D);
                            for (var D = 0; 3 > D; D++)
                                if (D != M && D != x) {
                                    b = D,
                                    w = o[D];
                                    break
                                }
                            switch (S = m.img_ori_width / m.img_ori_height,
                            S = S >= 1.6 && 2.5 > S ? 2 : S >= 2.5 ? 3 : 1) {
                            case 3:
                                if (30 > w - _ && 30 > v - w || 60 > v - _) {
                                    y = 3 * A + 20,
                                    C = m.img_ori_height / (m.img_ori_width / y),
                                    T = 0 * (A + 10),
                                    I = v + 10,
                                    o[0] = I + C,
                                    o[1] = I + C,
                                    o[2] = I + C;
                                    break
                                }
                            case 2:
                                if (30 > w - _) {
                                    if (1 != x) {
                                        y = 2 * A + 10,
                                        C = m.img_ori_height / (m.img_ori_width / y),
                                        T = M > b ? b * (A + 10) : M * (A + 10),
                                        I = w + 10,
                                        o[M] = I + C,
                                        o[b] = I + C;
                                        break
                                    }
                                    if (30 > v - w) {
                                        y = 2 * A + 10,
                                        C = m.img_ori_height / (m.img_ori_width / y),
                                        T = x > b ? b * (A + 10) : x * (A + 10),
                                        I = v + 10,
                                        o[x] = I + C,
                                        o[b] = I + C;
                                        break
                                    }
                                }
                            default:
                                y = A,
                                C = m.img_ori_height / (m.img_ori_width / y),
                                T = M * (A + 10),
                                I = _ + 10,
                                o[M] = I + C
                            }
                            k = s.find(".chooseMaterialLi").size();
                            var K = a('<li class="chooseMaterialLi" style="opacity:0;top:' + I + "px;left:" + T + "px;width:" + y + "px;height:" + C + 'px"></li>');
                            if ("backImgChooseWrap" == r && K.addClass("backgroundMaterial"),
                            K.attr({
                                "data-key": m.img_key,
                                "data-id": m.material_id,
                                "data-type": m.content_type
                            }),
                            "materialWrap" == r || "materialSearch" == r) {
                                K.attr({
                                    "data-nickname": decodeURI(m.nickname),
                                    "data-keywords": m.keywords
                                });
                                for (var N = '<div class="materialInfoIcon" title="素材信息"></div>', P = '<div class="materialCollIcon" title="收藏素材">', L = 0; L < window.colledMaterial.length; L++)
                                    if (m.material_id == window.colledMaterial[L]) {
                                        P = '<div class="materialCollIcon colled" title="取消收藏">';
                                        break
                                    }
                                K.append(P),
                                K.append(N)
                            }
                            s.append(K);
                            var O = new Image;
                            if ("image/svg+xml" == m.content_type ? (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            K.addClass("svgMaterial")) : "svg" == m.content_type ? (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            K.addClass("svgMaterial")) : "image/png" == m.content_type ? (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            K.addClass("imgMaterial")) : "image/chuangkit" == m.content_type ? (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            K.addClass("groupMaterial"),
                            O.setAttribute("fileurl", m.fileUrl)) : (O.src = m.imgUrl + "@" + Math.round(y) + "w_1x.src",
                            K.addClass("imgMaterial")),
                            "/material/getMaterialsInFolder.do" == e && (O.src = m.imgurl),
                            O.alt = k,
                            O.onload = function() {
                                a(this).attr({
                                    width: "100%",
                                    draggable: "false",
                                    height: "100%"
                                });
                                var t = a(this).attr("alt")
                                  , i = s.find(".chooseMaterialLi").eq(t);
                                i.append(a(this)).css("background-color", "#f6f6f6"),
                                a(this).attr({
                                    alt: i.attr("data-key"),
                                    "data-id": i.attr("data-id")
                                }),
                                "/material/getMaterialsInFolder.do" == e && a(this).removeAttr("alt"),
                                i.removeAttr("data-key")
                            }
                            ,
                            K.animate({
                                opacity: 1
                            }, 1e3),
                            o[M] > s.getHeight() - 10) {
                                if (s.height(o[M] + 10).attr("data-height", o[M] + 10),
                                s.height(o[M] + 10 + 46),
                                "materialWrap" == r)
                                    for (var j = a(".materialKindClick").index(".materialKind"), D = j + 3 - j % 3, W = D + 3; W > D; D++) {
                                        var F = a(".materialKind").eq(D);
                                        F.css("margin-top", 15 + s.getHeight() + a("#meterialSecondKindListWrap").outerHeight() + 20 + "px")
                                    }
                                n()
                            }
                        }
                        s.attr({
                            "data-a": o[0],
                            "data-b": o[1],
                            "data-c": o[2]
                        });
                        var B = s.parent()
                          , q = B.offset().top + B.height() + 60
                          , H = Math.max(o[0], o[1], o[2]);
                        H += s.offset().top,
                        q > H && (i.pageNo++,
                        s.height(s.getHeight() + 50),
                        s.children(".onloadMaterial").css("display", "block"),
                        l.queryMaterial(e, i, o, r)),
                        l._kind_click_drag = !1
                    }
                    var c = t.cacheUrl;
                    return "/material/searchAllMaterialsByKind.do" == e && void 0 != c ? void (l._query_ajax = a.ajax({
                        url: c,
                        type: "GET",
                        success: function(e) {
                            "object" != typeof e && (e = JSON.parse(e)),
                            d(e.body)
                        }
                    })) : void d(t)
                }
            }),
            a(".cancel_file_manger ").hasClass("file_click") && a(".upload_file_manger").click()
        },
        queryMaterialPersonal: function(e, i, o, r, n) {
            n = n || t.noop;
            var l = this;
            null != l._query_ajax_personal && "pending" == l._query_ajax_personal.promise().state() && l._query_ajax_personal.abort(),
            l._query_ajax_personal = a.ajax({
                url: e,
                dataType: "json",
                type: "POST",
                data: i,
                error: function() {
                    l._kind_click_drag = !1,
                    console.log("返回素材出错或者强行终止")
                },
                success: function(a) {
                    1 == i.pageNo ? window.personalMaterialData = a : window.personalMaterialData.page.recordData = window.personalMaterialData.page.recordData.concat(a.page.recordData),
                    l.loadMaterialPersonal(l, a, e, i, o, r, n)
                }
            }),
            a(".cancel_file_manger ").hasClass("file_click") && a(".upload_file_manger").click()
        },
        loadMaterialPersonal: function(e, t, i, o, r, n, l) {
            var s = a("#" + n);
            s.children(".onloadMaterial").css("display", "none");
            var d = t.page
              , c = d.pageTotal
              , p = d.recordCount;
            if (a(".folder").attr({
                "data-size": p
            }),
            o.pageNo > c || 0 >= p) {
                var f = '<div style="position:absolute;bottom:15px" class="nohaveTipsTemplate">已经没有更多了</div>';
                return s.append(f),
                void (e._kind_click_drag = !1)
            }
            for (var h, u = d.recordData, g = 0; g < u.length; g++)
                h = u[g],
                h.img_key = h.ik,
                h.attach_id = h.ai,
                h.kind_id = h.ki,
                h.material_id = h.mid,
                h.business_type = h.bt,
                h.content_type = h.dt,
                h.business_type__caption = h.bt__caption,
                h.img_ori_height = h.h,
                h.img_ori_width = h.w;
            var m, _, v, w, k, y, C, T, I, M = 0, x = 0, b = 0, S = 1, A = (s.getWidth() - 20) / 3;
            s.attr("data-index", parseInt(o.pageNo) + 1);
            for (var g = 0, E = u.length; E > g; g++) {
                m = u[g],
                _ = r[0],
                M = 0,
                v = r[0],
                x = 0;
                for (var D = 1; 3 > D; D++)
                    r[D] < _ ? (_ = r[D],
                    M = D) : r[D] > v && (v = r[D],
                    x = D);
                for (var D = 0; 3 > D; D++)
                    if (D != M && D != x) {
                        b = D,
                        w = r[D];
                        break
                    }
                switch (S = m.img_ori_width / m.img_ori_height,
                S = S >= 1.6 && 2.5 > S ? 2 : S >= 2.5 ? 3 : 1) {
                case 3:
                    if (30 > w - _ && 30 > v - w || 60 > v - _) {
                        y = 3 * A + 20,
                        C = m.img_ori_height / (m.img_ori_width / y),
                        T = 0 * (A + 10),
                        I = v + 10,
                        r[0] = I + C,
                        r[1] = I + C,
                        r[2] = I + C;
                        break
                    }
                case 2:
                    if (30 > w - _) {
                        if (1 != x) {
                            y = 2 * A + 10,
                            C = m.img_ori_height / (m.img_ori_width / y),
                            T = M > b ? b * (A + 10) : M * (A + 10),
                            I = w + 10,
                            r[M] = I + C,
                            r[b] = I + C;
                            break
                        }
                        if (30 > v - w) {
                            y = 2 * A + 10,
                            C = m.img_ori_height / (m.img_ori_width / y),
                            T = x > b ? b * (A + 10) : x * (A + 10),
                            I = v + 10,
                            r[x] = I + C,
                            r[b] = I + C;
                            break
                        }
                    }
                default:
                    y = A,
                    C = m.img_ori_height / (m.img_ori_width / y),
                    T = M * (A + 10),
                    I = _ + 10,
                    r[M] = I + C
                }
                k = s.find(".chooseMaterialLi").size();
                var K = a('<li class="chooseMaterialLi" style="opacity:0;top:' + I + "px;left:" + T + "px;width:" + y + "px;height:" + C + 'px"></li>');
                if (K.attr({
                    "data-key": m.img_key,
                    "data-id": m.material_id,
                    "data-type": m.content_type,
                    id: m.uploadImgId ? m.uploadImgId : ""
                }),
                m.uploadImgId > 0) {
                    var N = a('<span class="waiting-color"></span><span class="progress-color"></span><p class="waiting-text">等待上传···</p><p class="progress-text"><span class="progress-num">0</span>%<br />正在上传···</p>');
                    K.append(N),
                    K.addClass("img_uploading")
                }
                s.append(K);
                var P = new Image;
                if (P.alt = k,
                K.addClass("imgMaterial"),
                P.onload = function() {
                    a(this).attr({
                        width: "100%",
                        draggable: "false",
                        height: "100%"
                    });
                    var e = a(this).attr("alt")
                      , t = s.find(".chooseMaterialLi").eq(e);
                    t.prepend(a(this)).css("background-color", "#f6f6f6"),
                    a(this).attr({
                        alt: t.attr("data-key"),
                        "data-id": t.attr("data-id")
                    }),
                    "/material/getMaterialsInFolder.do" == i && a(this).removeAttr("alt"),
                    t.removeAttr("data-key")
                }
                ,
                P.src = m.imgurl,
                K.animate({
                    opacity: 1
                }, 1e3),
                r[M] > s.getHeight() - 10) {
                    if (s.height(r[M] + 10).attr("data-height", r[M] + 10),
                    s.height(r[M] + 10 + 46),
                    "materialWrap" == n)
                        for (var L = a(".materialKindClick").index(".materialKind"), D = L + 3 - L % 3, O = D + 3; O > D; D++) {
                            var j = a(".materialKind").eq(D);
                            j.css("margin-top", 15 + s.getHeight() + a("#meterialSecondKindListWrap").outerHeight() + 20 + "px")
                        }
                    l()
                }
            }
            s.attr({
                "data-a": r[0],
                "data-b": r[1],
                "data-c": r[2]
            });
            var W = s.parent()
              , F = W.offset().top + W.height() + 60
              , B = Math.max(r[0], r[1], r[2]);
            B += s.offset().top,
            F > B && (o.pageNo++,
            s.height(s.getHeight() + 50),
            s.children(".onloadMaterial").css("display", "block"),
            e.queryMaterial(i, o, r, n)),
            e._kind_click_drag = !1
        },
        materialSecondKindListShow: function(e, t) {
            var i = this
              , o = i._material_kind[e]
              , r = o.lsQueryMaterialKindBean
              , n = r.length
              , l = a("#meterialSecondKindListWrap")
              , s = l.children("ul");
            s.children(".secondKindList").detach();
            var d = "<li class='secondKindList secondKindListClick' data-name='全部' data-firstid='" + o.firstKindId + "'>全部</li>";
            a(d).appendTo(s);
            for (var c = 0; n > c; c++)
                d = "<li class='secondKindList' data-name='" + r[c].kindTitle + "' data-firstid='" + o.firstKindId + "' data-secondid='" + r[c].kindId + "'>" + r[c].kindTitle + "</li>",
                a(d).appendTo(s);
            if (l.find(".secondKindListMore").size() > 0 && l.find(".secondKindListMore").detach(),
            n > 8) {
                var p = 40 * Math.ceil((n + 1) / 4);
                s.attr("data-height-change", p - 80).css("height", 80);
                var f = a('</div><div class="secondKindListMore">展开更多分类</div>');
                l.append(f)
            } else
                s.css("height", "auto");
            var h = t.offset().top + t.getHeight() + 20 - a("#materialKindList").offset().top + 60;
            l.css({
                top: h,
                display: "block",
                height: "auto"
            })
        },
        searchMaterialSecondKind: function(e) {
            var t, i = this, o = i._material_kind[e], r = o.lsQueryMaterialKindBean, n = a(".secondKindUl"), l = r.length;
            if (1 == l)
                a("#secondKindWrap").children("div").html(r[0].kindTitle).addClass("noHaveSecondKind"),
                n.css("height", "auto");
            else {
                a("#secondKindWrap").children("div").removeClass("noHaveSecondKind"),
                t = "<li class='secondKindLi' data-name='全部' data-firstid='" + o.firstKindId + "' >全部</li>",
                a(t).appendTo(n),
                l > 3 ? n.css("height", "133px") : n.css("height", "auto");
                for (var s = 0; l > s; s++)
                    t = "<li class='secondKindLi' data-name='" + r[s].kindTitle + "' data-firstid='" + o.firstKindId + "' data-secondid='" + r[s].kindId + "'>" + r[s].kindTitle + "</li>",
                    a(t).appendTo(n)
            }
        },
        queryTemplate: function(e, i) {
            var o = this
              , r = a("#" + i);
            if (null != o._template_ajax && "pending" == o._template_ajax.promise().state() && o._template_ajax.abort(),
            "teamTemplate" == i)
                return void (o._template_ajax = a.ajax({
                    url: "/designtemplate/listTeamTemplate.do",
                    type: "POST",
                    dataType: "json",
                    data: e,
                    error: function() {
                        o._kind_click_drag = !1,
                        console.log("团队模版请求错误")
                    },
                    success: function(n) {
                        if (-4 == n.code)
                            n.templates = [],
                            n.totalCount = 0;
                        else {
                            if (-2 == n.code)
                                return d.show(),
                                !1;
                            if (-1 == n.code || -3 == n.code)
                                return console.log("团队模版请求错误,code:" + n.code),
                                c.back({
                                    str: "团队模版获取失败！",
                                    kind: "warning"
                                }),
                                !1
                        }
                        var s = n.templates
                          , p = n.totalCount / l.MATERIAL_PAGE_SIZE;
                        if (r.children(".onloadTemplate").css("display", "none"),
                        e.pageNo > Math.ceil(p)) {
                            if (r.children(".nohaveTipsTemplate").size() <= 0) {
                                var f = '<div class="nohaveTipsTemplate">没有更多模板，去<a href="/templatecenter" target="_blank">模板中心</a>看看</div>';
                                r.append(f),
                                a(".nohaveTipsTemplate a").click(function() {
                                    t.addSomeMouseClick("左侧-模板中心")
                                })
                            }
                            return o._kind_click_drag = !1,
                            void console.log("团队模板加载结束")
                        }
                        var h, u, g = parseFloat(s[0].width), m = parseFloat(s[0].height);
                        h = g / m >= 1.8 ? 290 : 140,
                        u = m / g * h;
                        var _, v, w, k = s.length, y = a("#templateContent");
                        r.attr("data-index", parseInt(e.pageNo) + 1);
                        for (var C = 0; k > C; C++)
                            _ = a(parseInt(s[C].pageCount) > 1 ? '<li class="templateLi templateMaterial multipage" alt="' + s[C].teamTemplateId + '" style="opacity:0;width:' + h + "px;height: " + u + 'px" data-size="' + s[C].pageCount + '"><div class="multipage_show"></div><div class="templateMaking" style="line-height:' + u + 'px">缩略图正在生成中...</div></li>' : '<li class="templateLi templateMaterial" alt="' + s[C].teamTemplateId + '" style="opacity:0;width:' + h + "px;height: " + u + 'px"><div class="templateMaking" style="line-height:' + u + 'px">缩略图正在生成中...</div></li>'),
                            v = r.children(".templateMaterial").size(),
                            w = new Image,
                            w.src = s[C].thumbImgUrl,
                            w.name = v,
                            a(w).attr("data-src", s[C].thumbImgUrl),
                            w.onload = function() {
                                a(this).attr({
                                    width: "100%",
                                    height: "100%",
                                    draggable: "false"
                                });
                                var e = r.children(".templateMaterial").eq(a(this).attr("name"));
                                e.append(a(this)).css("background-color", "#F6F6F6").click(function() {}).find(".templateMaking").remove()
                            }
                            ,
                            _.appendTo(r),
                            _.animate({
                                opacity: "1"
                            });
                        o._kind_click_drag = !1,
                        y.getHeight() - r.offset().top + y.offset().top >= r.height() - 10 && (e.pageNo++,
                        r.children(".onloadTemplate").appendTo(r),
                        r.children(".onloadTemplate").css("display", "block"),
                        o.queryTemplate(e, i))
                    }
                }));
            (window.ziyun || window.api) && (e.priceType = 2);
            var n;
            n = "collectionTemplate" == i ? "/designtemplate/listTemplateInFolder.do" : "/designtemplate/getAllTemplates.do",
            o._template_ajax = a.ajax({
                url: n,
                type: "GET",
                dataType: "json",
                data: e,
                error: function() {
                    o._kind_click_drag = !1,
                    console.log("模版请求错误")
                },
                success: function(n) {
                    function s(n) {
                        {
                            var s = n.queryDesignTemplateBeanList
                              , d = n.totalCount / l.MATERIAL_PAGE_SIZE;
                            n.hasNext
                        }
                        if (r.children(".onloadTemplate").css("display", "none"),
                        e.pageNo > Math.ceil(d)) {
                            if (r.children(".nohaveTipsTemplate").size() <= 0) {
                                var c;
                                c = "collectionTemplate" == i ? '<div class="nohaveTipsTemplate">没有更多收藏，去<a href="/templatecenter" target="_blank">模板中心</a>看看</div>' : '<div class="nohaveTipsTemplate">素材库正在完善，敬请期待</div>',
                                r.append(c),
                                a(".nohaveTipsTemplate a").click(function() {
                                    t.addSomeMouseClick("左侧-模板中心")
                                })
                            }
                            return void (o._kind_click_drag = !1)
                        }
                        var p, f, h = parseFloat(s[0].width), u = parseFloat(s[0].height);
                        p = h / u >= 1.8 ? 290 : 140,
                        f = u / h * p;
                        var g, m, _, v = s.length, w = a("#templateContent");
                        r.attr("data-index", parseInt(e.pageNo) + 1);
                        for (var k, y, C = 0; v > C; C++)
                            s[C].price > 0 ? (y = s[C].price / 100,
                            y += "元",
                            k = 1 == s[C].forVipFree ? '<span class="priceIcon"></span>' : "") : (y = "免费",
                            k = ""),
                            g = a(parseInt(s[C].designTemplatePageCount) > 1 ? '<li class="templateLi templateMaterial multipage" data-own="unknow" data-vip="' + s[C].forVipFree + '" data-price="' + s[C].price + '" data-pageNum="' + s[C].designTemplatePageCount + '" data-kind="' + s[C].kindTitle + '" data-view="' + s[C].viewTimes + '" data-collect="' + s[C].isCollected + '" data-title="' + s[C].templateTitle + '" alt="' + s[C].designTemplateId + '" style="opacity:0;width:' + p + "px;height: " + f + 'px" data-size="' + s[C].designTemplatePageCount + '">' + k + '<div class="blackMask"></div><div class="priceWrap"><div class="priceTagIcon"></div><div class="priceText">' + y + '</div></div><div class="multipage_show"></div></li>' : '<li class="templateLi templateMaterial" data-own="unknow" data-vip="' + s[C].forVipFree + '" data-price="' + s[C].price + '" data-pageNum="' + s[C].designTemplatePageCount + '" data-kind="' + s[C].kindTitle + '" data-view="' + s[C].viewTimes + '" data-collect="' + s[C].isCollected + '" data-title="' + s[C].templateTitle + '" alt="' + s[C].designTemplateId + '" style="opacity:0;width:' + p + "px;height: " + f + 'px">' + k + '<div class="blackMask"></div><div class="priceWrap"><span class="priceText">' + y + '</span><span class="priceTagIcon"></span></div></li>'),
                            m = r.children(".templateMaterial").size(),
                            _ = new Image,
                            _.src = 140 == p ? s[C].designTemplateImageUrl + "@140w_100Q_1x.jpg" : s[C].designTemplateImageUrl + "@290w_100Q_1x.jpg",
                            _.name = m,
                            a(_).attr("data-src", s[C].designTemplateImageUrl),
                            _.onload = function() {
                                a(this).attr({
                                    width: "100%",
                                    height: "100%",
                                    draggable: "false"
                                });
                                var e = r.children(".templateMaterial").eq(a(this).attr("name"));
                                e.append(a(this)).css("background-color", "#f6f6f6").click(function() {})
                            }
                            ,
                            g.appendTo(r),
                            g.animate({
                                opacity: "1"
                            });
                        o._kind_click_drag = !1,
                        w.getHeight() - r.offset().top + w.offset().top >= r.height() - 10 && (e.pageNo++,
                        r.children(".onloadTemplate").appendTo(r),
                        r.children(".onloadTemplate").css("display", "block"),
                        o.queryTemplate(e, i))
                    }
                    var p = n.cacheUrl;
                    if (void 0 != p)
                        return void (o._template_ajax = a.ajax({
                            url: p,
                            type: "GET",
                            success: function(e) {
                                "object" != typeof e && (e = JSON.parse(e)),
                                s(e.body)
                            }
                        }));
                    if ("collectionTemplate" == i)
                        if (n.templates) {
                            for (var f, h, u = [], g = n.templates, m = 0; m < g.length; m++)
                                h = g[m].template,
                                f = {
                                    collectedTimes: h.collectedTimes,
                                    createTime: h.createTime,
                                    designKindId: h.designKindId,
                                    designTemplateId: h.designTemplateId,
                                    designTemplateImageUrl: h.designTemplateImageUrl,
                                    designTemplatePageCount: h.designTemplatePageCount,
                                    forVipFree: h.forVipFree,
                                    height: h.height,
                                    isCollected: h.true,
                                    kindTitle: h.kindTitle,
                                    price: h.price,
                                    templateTitle: h.templateTitle,
                                    useTimes: h.useTimes,
                                    viewTimes: h.viewTimes,
                                    width: h.width
                                },
                                u.push(f);
                            n.resultCount = n.templates.length,
                            n.queryDesignTemplateBeanList = u
                        } else
                            -1 == n.code ? c.back({
                                str: "获取收藏模版失败！",
                                kind: "warning"
                            }) : -2 == n.code ? d.show() : -3 == n.code && (n.totalCount = 0,
                            n.queryDesignTemplateBeanList = []);
                    s(n)
                }
            })
        },
        createDiv: function(e, t, i, o, r, n) {
            var l = a(e).addClass(t).css({
                top: i,
                left: o,
                height: r,
                width: n
            });
            return l
        },
        getFontWH: function(e, a, t) {
            var i = document.getElementById("text-speakable");
            i.style.display = "block",
            i.style["font-size"] = a + "px",
            i.style["font-family"] = t,
            i.innerHTML = e;
            var o = i.getBoundingClientRect();
            return i.style.display = "none",
            {
                width: o.right - o.left,
                height: o.bottom - o.top
            }
        }
    };
    return a.fn.extend({
        getHeight: function() {
            if (void 0 == a(this)[0])
                return 0;
            if (void 0 == a(this)[0].style)
                return a(this).height();
            var e = parseFloat(a(this)[0].style.height);
            return isNaN(e) ? a(this).height() : e
        },
        getWidth: function() {
            if (void 0 == a(this)[0])
                return 0;
            if (void 0 == a(this)[0].style)
                return a(this).width();
            var e = parseFloat(a(this)[0].style.width);
            return isNaN(e) ? a(this).width() : e
        },
        createClone: function(e) {
            var t, i = (a(this),
            a(this).children()), o = i.clone(), r = i.offset().top, n = i.offset().left, l = a(this).getHeight(), s = a(this).getWidth(), d = a(this).attr("data-type");
            return t = e.createDiv("<div></div>", "sourceCloneDiv", r, n, l, s),
            a(this).hasClass("imgMaterial") ? t.addClass("imgMaterial") : a(this).hasClass("svgMaterial") ? t.addClass("svgMaterial") : a(this).hasClass("textMaterial") ? t.addClass("textMaterial") : a(this).hasClass("groupMaterial") && t.addClass("groupMaterial"),
            a(this).hasClass("backgroundMaterial") && t.addClass("backgroundMaterial"),
            t.append(o),
            t.attr("data-type", d),
            t
        }
    }),
    a.extend({
        colorMove: function(e) {
            a("#color-pickup-color").css("background-color", e);
            {
                var t = La._owner_design;
                t.getCurPage()
            }
            if ("back" == a("#color-pickup").attr("data-kind"))
                R(e, La, !0),
                La._background_drag = !0;
            else {
                var i = a(".element-edit-bar").find(".ele-color").index(a(".element-edit-bar").find(".ele-color.now-click"))
                  , o = t._focus_element;
                void 0 != o && o.previewColor(e, i),
                a(".element-edit-bar").find(".ele-color").eq(i).children().css("background-color", e)
            }
        }
    }),
    La;
    var Oa, ja, Wa, Fa
});
;/*!/compapi/design/requirejs/text.js*/
define("compapi/design/requirejs/text", ["module"], function(e) {
    "use strict";
    var n, t, r, o, i, a = ["Msxml2.XMLHTTP", "Microsoft.XMLHTTP", "Msxml2.XMLHTTP.4.0"], s = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im, u = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im, c = "undefined" != typeof location && location.href, l = c && location.protocol && location.protocol.replace(/\:/, ""), f = c && location.hostname, p = c && (location.port || void 0), d = {}, v = e.config && e.config() || {};
    return n = {
        version: "2.0.12",
        strip: function(e) {
            if (e) {
                e = e.replace(s, "");
                var n = e.match(u);
                n && (e = n[1])
            } else
                e = "";
            return e
        },
        jsEscape: function(e) {
            return e.replace(/(['\\])/g, "\\$1").replace(/[\f]/g, "\\f").replace(/[\b]/g, "\\b").replace(/[\n]/g, "\\n").replace(/[\t]/g, "\\t").replace(/[\r]/g, "\\r").replace(/[\u2028]/g, "\\u2028").replace(/[\u2029]/g, "\\u2029")
        },
        createXhr: v.createXhr || function() {
            var e, n, t;
            if ("undefined" != typeof XMLHttpRequest)
                return new XMLHttpRequest;
            if ("undefined" != typeof ActiveXObject)
                for (n = 0; 3 > n; n += 1) {
                    t = a[n];
                    try {
                        e = new ActiveXObject(t)
                    } catch (r) {}
                    if (e) {
                        a = [t];
                        break
                    }
                }
            return e
        }
        ,
        parseName: function(e) {
            var n, t, r, o = !1, i = e.indexOf("."), a = 0 === e.indexOf("./") || 0 === e.indexOf("../");
            return -1 !== i && (!a || i > 1) ? (n = e.substring(0, i),
            t = e.substring(i + 1, e.length)) : n = e,
            r = t || n,
            i = r.indexOf("!"),
            -1 !== i && (o = "strip" === r.substring(i + 1),
            r = r.substring(0, i),
            t ? t = r : n = r),
            {
                moduleName: n,
                ext: t,
                strip: o
            }
        },
        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,
        useXhr: function(e, t, r, o) {
            var i, a, s, u = n.xdRegExp.exec(e);
            return u ? (i = u[2],
            a = u[3],
            a = a.split(":"),
            s = a[1],
            a = a[0],
            !(i && i !== t || a && a.toLowerCase() !== r.toLowerCase() || (s || a) && s !== o)) : !0
        },
        finishLoad: function(e, t, r, o) {
            r = t ? n.strip(r) : r,
            v.isBuild && (d[e] = r),
            o(r)
        },
        load: function(e, t, r, o) {
            if (o && o.isBuild && !o.inlineText)
                return void r();
            v.isBuild = o && o.isBuild;
            var i = n.parseName(e)
              , a = i.moduleName + (i.ext ? "." + i.ext : "")
              , s = t.toUrl(a)
              , u = v.useXhr || n.useXhr;
            return 0 === s.indexOf("empty:") ? void r() : void (!c || u(s, l, f, p) ? n.get(s, function(t) {
                n.finishLoad(e, i.strip, t, r)
            }, function(e) {
                r.error && r.error(e)
            }) : t([a], function(e) {
                n.finishLoad(i.moduleName + "." + i.ext, i.strip, e, r)
            }))
        },
        write: function(e, t, r) {
            if (d.hasOwnProperty(t)) {
                var o = n.jsEscape(d[t]);
                r.asModule(e + "!" + t, "define(function () { return '" + o + "';});\n")
            }
        },
        writeFile: function(e, t, r, o, i) {
            var a = n.parseName(t)
              , s = a.ext ? "." + a.ext : ""
              , u = a.moduleName + s
              , c = r.toUrl(a.moduleName + s) + ".js";
            n.load(u, r, function() {
                var t = function(e) {
                    return o(c, e)
                };
                t.asModule = function(e, n) {
                    return o.asModule(e, c, n)
                }
                ,
                n.write(e, u, t, i)
            }, i)
        }
    },
    "node" === v.env || !v.env && "undefined" != typeof process && process.versions && process.versions.node && !process.versions["node-webkit"] ? (t = require.nodeRequire("fs"),
    n.get = function(e, n, r) {
        try {
            var o = t.readFileSync(e, "utf8");
            0 === o.indexOf("﻿") && (o = o.substring(1)),
            n(o)
        } catch (i) {
            r && r(i)
        }
    }
    ) : "xhr" === v.env || !v.env && n.createXhr() ? n.get = function(e, t, r, o) {
        var i, a = n.createXhr();
        if (a.open("GET", e, !0),
        o)
            for (i in o)
                o.hasOwnProperty(i) && a.setRequestHeader(i.toLowerCase(), o[i]);
        v.onXhr && v.onXhr(a, e),
        a.onreadystatechange = function() {
            var n, o;
            4 === a.readyState && (n = a.status || 0,
            n > 399 && 600 > n ? (o = new Error(e + " HTTP status: " + n),
            o.xhr = a,
            r && r(o)) : t(a.responseText),
            v.onXhrComplete && v.onXhrComplete(a, e))
        }
        ,
        a.send(null)
    }
    : "rhino" === v.env || !v.env && "undefined" != typeof Packages && "undefined" != typeof java ? n.get = function(e, n) {
        var t, r, o = "utf-8", i = new java.io.File(e), a = java.lang.System.getProperty("line.separator"), s = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),o)), u = "";
        try {
            for (t = new java.lang.StringBuffer,
            r = s.readLine(),
            r && r.length() && 65279 === r.charAt(0) && (r = r.substring(1)),
            null !== r && t.append(r); null !== (r = s.readLine()); )
                t.append(a),
                t.append(r);
            u = String(t.toString())
        } finally {
            s.close()
        }
        n(u)
    }
    : ("xpconnect" === v.env || !v.env && "undefined" != typeof Components && Components.classes && Components.interfaces) && (r = Components.classes,
    o = Components.interfaces,
    Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),
    i = "@mozilla.org/windows-registry-key;1"in r,
    n.get = function(e, n) {
        var t, a, s, u = {};
        i && (e = e.replace(/\//g, "\\")),
        s = new FileUtils.File(e);
        try {
            t = r["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),
            t.init(s, 1, 0, !1),
            a = r["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),
            a.init(t, "utf-8", t.available(), o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),
            a.readString(t.available(), u),
            a.close(),
            t.close(),
            n(u.value)
        } catch (c) {
            throw new Error((s && s.path || "") + ": " + c)
        }
    }
    ),
    n
});
;/*!/compapi/design/Widget.js*/
"use strict";
define("compapi/design/Widget", ["compapi/b"], function(t) {
    var e = function() {
        this._node = this.createWidget()
    };
    return e.prototype = {
        constructor: e,
        options: {},
        _dom_object: null,
        createWidget: t.noop,
        getNode: function() {
            return this._node
        }
    },
    e
});
;/*!/compapi/design/Toolbar.js*/
"use strict";
define("compapi/design/Toolbar", ["compapi/b", "compapi/design/Chuangkit", "compapi/design/Widget", "compapi/design/toolbar/toolbar_config"], function(o, i, n) {
    function t() {}
    var c = function() {
        var o = this;
        n.call(o),
        t.call(o)
    };
    return c.prototype = {
        constructor: c
    },
    o.classExtend(c, n),
    c
});
;/*!/compapi/design/widgets/DataWidget.js*/
"use strict";
define("compapi/design/widgets/DataWidget", ["compapi/b", "compapi/design/Chuangkit", "compapi/design/Widget", "components/jquery/jquery"], function(n, t, i, e) {
    function o(n) {
        this._json = e.extend(!0, {}, this._json, n)
    }
    var s = function(n) {
        var t = this;
        i.call(t),
        o.call(t, n)
    };
    return s.prototype = {
        constructor: s,
        _json: {},
        getJson: function() {
            return this._json
        }
    },
    n.classExtend(s, i),
    s
});
;/*!/compapi/design/toolbar/PageEditbar.js*/
"use strict";
define("compapi/design/toolbar/PageEditbar", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/Widget", "compapi/design/toolbar/toolbar_config", "compapi/design/Toolbar", "compapi/design/widgets/Page", "compapi/design/design_config", "widget/pop/pop"], function(e, a, i, t, n, o, s, d, r) {
    function g(e) {
        var a = this;
        e._owner_pageEditbar = a,
        p.call(a)
    }
    function p() {
        var i = this
          , t = a(i.getNode());
        t.find(".page-up").mousedown(function() {
            return e.addSomeMouseClick("画布-上移"),
            e.addBugTrackClick("a3"),
            a(this).hasClass("no-click") ? !1 : void i.pageUp()
        }),
        t.find(".page-down").mousedown(function() {
            return e.addSomeMouseClick("画布-下移"),
            e.addBugTrackClick("a4"),
            a(this).hasClass("no-click") ? !1 : void i.pageDown()
        }),
        t.find(".page-copy").mousedown(function() {
            return e.addSomeMouseClick("画布-复制"),
            e.addBugTrackClick("a1"),
            a(this).hasClass("no-click") ? !1 : (window.MEMENTO_ID = e.now(),
            i.pageCopy(),
            !1)
        }),
        t.find(".page-add").mousedown(function() {
            return e.addSomeMouseClick("画布-新建"),
            e.addBugTrackClick("a2"),
            a(this).hasClass("no-click") ? !1 : (i.pageAdd(),
            !1)
        }),
        t.find(".page-clear").mousedown(function() {
            return e.addSomeMouseClick("画布-清空"),
            e.addBugTrackClick("a5"),
            a(this).hasClass("no-click") ? !1 : void i.pageClear()
        }),
        t.find(".page-del").mousedown(function() {
            return e.addSomeMouseClick("画布-删除"),
            e.addBugTrackClick("a6"),
            a(this).hasClass("no-click") ? !1 : void i.pageDel()
        }),
        t.find(".page-bleed").mousedown(function() {
            e.addBugTrackClick("a9");
            var t = i._owner_page
              , n = t._owner_design;
            return a(this).hasClass("no-click") ? !1 : (a(this).removeClass("new-function"),
            window.localStorage.bleed_new = "true",
            window.MEMENTO_ID = e.now(),
            void (a(this).hasClass("page-bleed-showing") ? (e.addSomeMouseClick("画布-关闭出血"),
            a(".page-bleed").removeClass("page-bleed-showing").find(".page-edit-bar-text").html("出血<br />(印刷裁切)"),
            n.bleed = "false",
            n.hideBleed()) : (e.addSomeMouseClick("画布-开启出血"),
            a(".page-bleed").addClass("page-bleed-showing").find(".page-edit-bar-text").html("关闭出血<br />(印刷裁切)"),
            n.bleed = "true",
            n.showBleed())))
        }),
        t.find(".page_preview").mousedown(function() {
            return e.addSomeMouseClick("画布-预览"),
            a(this).hasClass("no-click") ? !1 : (window.localStorage.preview_new = "true",
            a(this).removeClass("new-function"),
            void (a(this).hasClass("preview-showing") ? (a(".page_preview").removeClass("preview-showing"),
            i.pagePreviewHide()) : (a(".page_preview").addClass("preview-showing"),
            i.pagePreviewShow())))
        })
    }
    var c = function(e) {
        var a = this;
        o.call(a),
        a._owner_page = e,
        g.call(a, e),
        a.show(),
        a.setBtnState()
    };
    return c.prototype = {
        constructor: c,
        _owner_page: null,
        createWidget: function() {
            return n.getPageEditbar()
        },
        show: function() {
            var e = this._owner_page
              , i = e.getNode();
            e._owner_pageEditbar = this;
            var t = this.getNode();
            i.lastChild.appendChild(t),
            "px" === window.DESIGN_ORIGINAL_UNIT && a(t).find(".page-bleed").css("display", "none")
        },
        setBtnState: function() {
            {
                var e = this._owner_page
                  , i = e._owner_design
                  , t = i.getPageSum();
                e.getIndex()
            }
            t >= window.MAX_PAGE ? (a(".page-copy").addClass("no-click"),
            a(".page-add").addClass("no-click")) : (a(".page-copy").removeClass("no-click"),
            a(".page-add").removeClass("no-click"));
            for (var n = a(this.getNode()), o = 0; t > o; o++)
                a(".page-num").eq(o).html(o + 1);
            a(".page-up").removeClass("no-click"),
            a(".page-down").removeClass("no-click"),
            a(".page-up").eq(0).addClass("no-click"),
            a(".page-down").eq(t - 1).addClass("no-click"),
            1 == t ? a(".page-del").addClass("no-click") : a(".page-del").removeClass("no-click"),
            6 != KIND_ID && 4 != KIND_ID && 20 != KIND_ID ? a(".page_preview").css("display", "none") : a(".page_preview").css("display", "block"),
            "true" == window.localStorage.bleed_new && n.find(".page-bleed").removeClass("new-function")
        },
        setEditbarStyle: function() {
            var e = this._owner_page
              , i = e.getRect()
              , t = i.bottom - i.top
              , n = a(window).width() - i.right;
            t < d.PAGE_EDITBAR_CHANGE_HEIGHT && n > d.PAGE_EDITBAR_CHANGE_MARGIN ? a(".page-edit-bar").addClass("page-edit-bar-landscape") : a(".page-edit-bar").removeClass("page-edit-bar-landscape")
        },
        pageUp: function(i) {
            var t = this
              , n = t._owner_page
              , o = n.getIndex()
              , s = a(n.getNode())
              , d = n._owner_design
              , r = d.pages
              , g = r[o - 1]
              , p = a(g.getNode())
              , c = g._owner_pageEditbar
              , l = parseFloat(s.css("top"))
              , w = parseFloat(p.css("top"));
            window.MEMENTO_ID = e.now(),
            n.moveUp(i),
            s.animate({
                top: w
            }),
            p.animate({
                top: l
            }, function() {
                p.before(s),
                t.setBtnState(),
                c.setBtnState()
            })
        },
        pageDown: function(i) {
            var t = this
              , n = t._owner_page
              , o = n.getIndex()
              , s = a(n.getNode())
              , d = n._owner_design
              , r = d.pages
              , g = r[o + 1]
              , p = a(g.getNode())
              , c = g._owner_pageEditbar
              , l = parseFloat(s.css("top"))
              , w = parseFloat(p.css("top"));
            window.MEMENTO_ID = e.now(),
            n.moveDown(i),
            s.animate({
                top: w
            }),
            p.animate({
                top: l
            }, function() {
                p.after(s),
                t.setBtnState(),
                c.setBtnState()
            })
        },
        pageCopy: function() {
            var e = this._owner_page
              , i = e.copyAndUndo()
              , t = i.getNode();
            this.setBtnState();
            var n = e._owner_design;
            a(n._wrap).animate({
                scrollTop: t.style.top
            }),
            this.setEditbarStyle();
            var o = a(this.getNode())
              , s = o.find(".page_preview");
            s.hasClass("preview-showing") && (s.trigger("mousedown"),
            s.trigger("mousedown")),
            "true" === n.bleed && a(".page-bleed").addClass("page-bleed-showing").find(".page-edit-bar-text").html("关闭出血<br />(印刷裁切)");
            var d = n.getPageSum();
            d >= window.MAX_PAGE && r.back({
                str: "页数达到上限",
                kind: "warning"
            }),
            i.nodeMouseenter()
        },
        pageAdd: function() {
            var i = this._owner_page
              , t = i.getDesign()
              , n = i.getJson()
              , o = JSON.parse(JSON.stringify(n))
              , s = i.getIndex();
            o.elems = [],
            o.width = i.width,
            o.height = i.height,
            window.MEMENTO_ID = e.now();
            var d = t.insertPageAndUndo(o, s + 1)
              , g = d.getNode();
            t.setPageScale(),
            this.setBtnState(),
            a(t._wrap).animate({
                scrollTop: g.style.top
            }),
            this.setEditbarStyle();
            var p = a(this.getNode())
              , c = p.find(".page_preview");
            c.hasClass("preview-showing") && (c.trigger("mousedown"),
            c.trigger("mousedown")),
            "true" === t.bleed && a(".page-bleed").addClass("page-bleed-showing").find(".page-edit-bar-text").html("关闭出血<br />(印刷裁切)");
            var l = t.getPageSum();
            l >= window.MAX_PAGE && r.back({
                str: "页数达到上限",
                kind: "warning"
            }),
            d.nodeMouseenter()
        },
        pageClear: function() {
            var a = this._owner_page;
            r.confirm({
                str: "清空页面后当前画布上的设计会消失哦！",
                yes: "继续清空",
                successfun: function() {
                    window.MEMENTO_ID = e.now(),
                    a.clear(),
                    a.addWhiteBackgroundAndUndo(!0)
                }
            })
        },
        pageDel: function() {
            var a = this
              , i = a._owner_page
              , t = i.getDesign();
            r.confirm({
                str: "删除页面后当前画布会消失哦！",
                yes: "继续删除",
                successfun: function() {
                    window.MEMENTO_ID = e.now(),
                    t.removePageAndUndo(i),
                    a.setBtnState()
                }
            })
        },
        pagePreviewShow: function() {
            a(".page_preview").find(".page-edit-bar-text").text("关闭预览");
            var e = this._owner_page
              , i = e.getDesign()
              , t = i.pageScale;
            a("#div_design section").each(function() {
                var e = n.getPagePreview();
                if (a(this).append(e),
                a(this).find(".preview-page-all").css("transform", "scale(" + t + ")"),
                20 == KIND_ID) {
                    var i = a(this).find(".preview_max_bar");
                    i.find(".preview_top_bar_img").bind("click", function() {
                        a(this).hasClass("preview_top_bar_img_up") ? (a(this).parent().css("height", "160px"),
                        a(this).next().css("height", "140px"),
                        a(this).removeClass("preview_top_bar_img_up")) : (a(this).parent().css("height", "90px"),
                        a(this).next().css("height", "70px"),
                        a(this).addClass("preview_top_bar_img_up"))
                    })
                }
            })
        },
        pagePreviewHide: function() {
            a(".page_preview").find(".page-edit-bar-text").text("开启预览"),
            a(".preview-page-all").each(function() {
                a(this).remove()
            })
        }
    },
    e.classExtend(c, o),
    c
});
;/*!/compapi/design/widgets/Element.js*/
"use strict";
define("compapi/design/widgets/Element", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/widgets/DataWidget", "compapi/design/Toolbar", "compapi/design/design_config"], function(e, t, o, n, a, r) {
    function s(e, t) {
        var o = this;
        o._owner_page = e,
        e.addElement(o, t);
        o.getNode();
        d.call(o),
        i.call(o),
        g.call(o)
    }
    function i() {
        var t = this
          , o = t.getJson()
          , n = t.getNode()
          , a = o["data-elem"];
        n.setAttribute("opacity", a.opacity),
        this._opacity = a.opacity;
        var s = o.transform;
        n.setAttribute("transform", e.transformScale(s, r.ZOOM_IN)),
        this._transform = s,
        this._lock = a.lock;
        var i = t.getPage();
        if (o.group && (void 0 != i.getJson().elegroups[o.group] || void 0 != i.element_groups[o.group] || window.undo)) {
            var d = o["group-transform"];
            n.setAttribute("transform", e.transformScale(d, r.ZOOM_IN)),
            this._groupTransform = d,
            this._group = o.group
        }
        var g = t.getContentNode()
          , h = o.reverse || "translate(0,0) rotate(0)";
        g.setAttribute("transform", e.transformScale(h, r.ZOOM_IN) || ""),
        this._reverse = h,
        "true" === this._lock && "background" != this._element_type && e.addClass(n, "elementsSonLock")
    }
    function d() {
        {
            var t = this
              , o = t.getPage()
              , n = o.getDesign();
            "pages]" + t.getPage().getIndex() + "]elems]"
        }
        e.dataBinding({
            obj: t,
            prop_name: "width",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "width",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "height",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "height",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "lock",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "lock",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "opacity",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "opacity",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "transform",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "transform",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "reverse",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "reverse",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "group",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "group",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "groupTransform",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: "pages]" + t.getPage().getIndex() + "]elems]" + t.getIndex() + "]",
                    key: "group-transform",
                    value: a,
                    type: "0",
                    action: "change"
                }, o)
            }
        })
    }
    function g() {
        var e = this
          , o = e.getNode();
        window.addEventListener ? (o.addEventListener("click", function(o) {
            if (o.ctrlKey || o.metaKey || o.shiftKey) {
                var n = e._owner_page
                  , a = n._owner_design
                  , r = a._focus_element;
                if (void 0 != r && a._focus_element._focus_drag && (r._group_drag ? a._focus_element.finishInput(r._group) : a._focus_element.finishInput()),
                e.isBackground() || "true" == e.lock)
                    return !1;
                if ("block" == t(".edit-div-write-wrap").css("display") && n.nodeMousedown(),
                "block" == t("#edit-div").css("display")) {
                    var a = n._owner_design
                      , s = a._owner_editDiv
                      , i = s._owner_element;
                    "elementGroup" !== i._element_type && 0 == n._select_element.length && "true" != i.lock && (n._select_element[0] = i)
                }
                var d = n._select_element.length;
                n._select_element[d] = e,
                n.selectElementUp()
            } else
                e.nodeClick(o);
            return !1
        }, !1),
        o.addEventListener("mousedown", function(o) {
            t(".materialInfoClose").mousedown(),
            e.nodeMousedown(o),
            e.isBackground() || "true" == e.lock || o.stopPropagation()
        }, !1),
        o.addEventListener("dblclick", function(t) {
            return (t.ctrlKey || t.metaKey || t.shiftKey) && e._group_drag ? !1 : void e.nodeDblclick(t)
        }, !1),
        o.addEventListener("mouseenter", function(t) {
            e.nodeMouseenter(t)
        }, !1),
        o.addEventListener("mouseleave", function(t) {
            e.nodeMouseleave(t)
        }, !1)) : window.attachEvent && (o.attachEvent("onclick", function(o) {
            if (o.ctrlKey || o.metaKey) {
                var n = e._owner_page;
                if ("block" == t(".edit-div-write-wrap").css("display") && n.nodeMousedown(),
                "block" == t("#edit-div").css("display")) {
                    var a = n._owner_design
                      , r = a._owner_editDiv
                      , s = r._owner_element;
                    "elementGroup" !== s._element_type && 0 == n._select_element.length && (n._select_element[0] = s)
                }
                var i = n._select_element.length;
                n._select_element[i] = e,
                n.selectElementUp()
            } else
                e.nodeClick(o);
            return !1
        }),
        o.attachEvent("onmousedown", function(o) {
            t(".materialInfoClose").mousedown(),
            e.nodeMousedown(o),
            e.isBackground() || "true" == e.lock || o.stopPropagation()
        }),
        o.attachEvent("ondblclick", function(t) {
            e.nodeDblclick(t)
        }),
        o.attachEvent("onmouseenter", function(t) {
            e.nodeMouseenter(t)
        }, !1),
        o.attachEvent("onmouseleave", function(t) {
            e.nodeMouseleave(t)
        }, !1))
    }
    var h = function(e, t, o) {
        void 0 == t && (t = e,
        e = void 0),
        n.call(this, t, o),
        s.call(this, e, o)
    };
    return h.prototype = {
        constructor: h,
        _json: {
            "data-type": "unknow",
            "data-elem": {
                "data-key": "",
                opacity: 1
            }
        },
        _owner_page: null,
        _move_drag: !1,
        _width: 0,
        _height: 0,
        _opacity: 1,
        _transform: "",
        _reverse: "",
        _group: "",
        _groupTransform: "",
        setNewJson: e.noop,
        getShowNode: function() {
            return this.getContentNode().firstChild
        },
        getSvgWidth: function() {
            var e = this.getNode()
              , o = t(e);
            return parseFloat(o.find("svg")[0].getAttribute("width"))
        },
        getSvgHeight: function() {
            var e = this.getNode()
              , o = t(e);
            return parseFloat(o.find("svg")[0].getAttribute("height"))
        },
        getWidth: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowWidth() * o
        },
        getShowWidth: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBBox().width / r.ZOOM_IN;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealWidth: function() {
            var e = this.getNode();
            return e.getBBox().width
        },
        getHeight: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowHeight() * o
        },
        getShowHeight: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBBox().height / r.ZOOM_IN;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealHeight: function() {
            var e = this.getNode();
            return e.getBBox().height
        },
        getLeft: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBoundingClientRect().left;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealLeft: function() {
            {
                var e = this._owner_page
                  , t = e._owner_design
                  , o = t.pageScale;
                this.getNode()
            }
            return this.getLeft() / o
        },
        getTop: function() {
            var e = this.getNode();
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBoundingClientRect().top;
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getRealTop: function() {
            {
                var e = this._owner_page
                  , t = e._owner_design
                  , o = t.pageScale;
                this.getNode()
            }
            return this.getTop() / o
        },
        setRealLeftTop: function(t, o) {
            var n = o || this.getNode()
              , a = e.setTransformAttr(n.getAttribute("transform"), "translate", t);
            n.setAttribute("transform", a)
        },
        getRect: function(e) {
            var e = e || this.getNode();
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath({
                    svg_node: e.firstChild.firstChild,
                    node: e
                })[0];
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBoundingClientRect();
            return t(e).find(".seat-rect").css("display", "block"),
            o
        },
        getBox: function() {
            var e = this.getNode();
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[1];
            t(e).find(".seat-rect").css("display", "none");
            var o = e.getBBox();
            return t(e).find(".seat-rect").css("display", "block"),
            {
                height: o.height,
                width: o.width,
                x: o.x,
                y: o.y
            }
        },
        getShowBox: function() {
            var e = this.getBox();
            return {
                height: e.height / r.ZOOM_IN,
                width: e.width / r.ZOOM_IN,
                x: e.x / r.ZOOM_IN,
                y: e.y / r.ZOOM_IN
            }
        },
        getTranslateLeftTop: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "translate");
            return [parseFloat(o[0]), parseFloat(o[1])]
        },
        getShowTranslateLeftTop: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "translate");
            return [parseFloat(o[0]) / r.ZOOM_IN, parseFloat(o[1]) / r.ZOOM_IN]
        },
        getTransform: function(e) {
            var t = e || this.getNode();
            return t.getAttribute("transform")
        },
        overstepPageDel: function() {
            var e = this.getRect()
              , t = e.left
              , o = e.top
              , n = e.right
              , a = e.bottom
              , r = this._owner_page
              , s = r.getRect()
              , i = s.left
              , d = s.top
              , g = s.right
              , h = s.bottom;
            return i > n || d > a || o > h || t > g ? (r.eleDelAndUndo(this),
            !0) : void 0
        },
        moveByKey: function(o, n) {
            var a = this._owner_page._owner_design
              , s = a._owner_editDiv
              , i = t(s.getNode())
              , d = this.addLeftTop(o * r.ZOOM_IN, n * r.ZOOM_IN);
            i.offset({
                top: d.top,
                left: d.left
            }),
            this.transform = {
                value: e.transformScale(this.getTransform(), 1 / r.ZOOM_IN),
                undo_drag: "noUndo"
            }
        },
        addLeftTop: function(t, o, n) {
            var a = this._owner_page
              , r = a._owner_design
              , s = r.pageScale
              , i = e.getTransformAttr(this.getTransform(n), "translate")
              , d = [parseFloat(i[0]) + t / s, parseFloat(i[1]) + o / s];
            this.setRealLeftTop(d, n);
            var g = this.getRotate(n);
            return this.setRotate(g, n),
            this.getRect()
        },
        setLeft: function(t) {
            var o = this._owner_page
              , n = o._owner_design
              , a = n.pageScale
              , r = e.getTransformAttr(this.getTransform(), "translate")
              , s = [t / a, parseFloat(r[1])];
            this.setRealLeftTop(s);
            var i = this.getRotate();
            return this.setRotate(i),
            this.getRect()
        },
        setTop: function(t) {
            var o = this._owner_page
              , n = o._owner_design
              , a = n.pageScale
              , r = e.getTransformAttr(this.getTransform(), "translate")
              , s = [parseFloat(r[0]), t / a];
            this.setRealLeftTop(s);
            var i = this.getRotate();
            return this.setRotate(i),
            this.getRect()
        },
        setLeftTop: function(e) {
            this.setRealLeftTop(e);
            var t = this.getRotate();
            return this.setRotate(t),
            this.getRect()
        },
        getRotate: function(t) {
            var o = t || this.getNode()
              , n = e.getTransformAttr(o.getAttribute("transform"), "rotate");
            return n[0]
        },
        setRotate: function(t, o) {
            var n = o || this.getNode()
              , a = this.getRealWidth()
              , r = this.getRealHeight()
              , s = a / 2
              , i = r / 2;
            "text" === this._element_type && (i = this.getRotateCenter());
            var d = [t, s, i]
              , g = e.setTransformAttr(n.getAttribute("transform"), "rotate", d);
            n.setAttribute("transform", g)
        },
        getRotateFormNode: function() {
            var e = this.getNode()
              , o = t(e);
            "text" !== this._element_type || this._fontFamilyLoaded || o.find(".fontLoad").css("display", "none");
            var n = this.getBox()
              , a = o.find(".rotate-set-left")[0];
            a.setAttribute("display", "block"),
            a.setAttribute("x", 0),
            a.setAttribute("y", n.height / 2),
            "text" == this._element_type && a.setAttribute("y", n.height / 2 + parseFloat(o.find(".autoline").eq(0).find("rect").attr("y")));
            var r = a.getBoundingClientRect()
              , s = r.left
              , i = r.top
              , d = this.getRect()
              , g = d.left + d.width / 2
              , h = d.top + d.height / 2
              , u = s - g
              , c = i - h
              , l = Math.abs(u)
              , _ = Math.abs(c)
              , f = this.rotateDeg(u, c, l, _);
            return a.setAttribute("y", "0"),
            a.setAttribute("display", "none"),
            "text" !== this._element_type || this._fontFamilyLoaded || o.find(".fontLoad").css("display", "block"),
            f
        },
        rotateDeg: function(e, t, o, n) {
            var a, r = 180 * Math.atan(o / n) / Math.PI;
            return a = 0 >= e && 0 > t ? 90 - r : e > 0 && 0 >= t ? 90 + r : e >= 0 && t > 0 ? 270 - r : 270 + r
        },
        getOpacity: function() {
            var e = this.getNode();
            return e.getAttribute("opacity")
        },
        getReverse: function() {
            var t = this.getContentNode();
            return e.transformScale(t.getAttribute("transform"), 1 / r.ZOOM_IN)
        },
        resetPosition: function() {
            var e = this.getNode()
              , t = e.getBoundingClientRect()
              , o = this.getRotate();
            this.setRotate(o);
            var n = e.getBoundingClientRect();
            this.addLeftTop((t.left - n.left) * r.ZOOM_IN, (t.top - n.top) * r.ZOOM_IN)
        },
        getIndex: function() {
            for (var e = this._owner_page, t = e.elements, o = t.length, n = 0; o > n; n++)
                if (this == t[n])
                    return n;
            return -1
        },
        getPage: function() {
            return this._owner_page
        },
        changeIndexAndUndo: function(e, t) {
            var o = this.getIndex()
              , n = e.new_index
              , a = this.getPage()
              , r = a.getIndex()
              , s = a.getDesign()
              , i = e.unshift;
            this.changeIndex(e),
            s.saveDesignAndUndo({
                obj: this,
                loc: "pages]" + r + "]elems]",
                key: o,
                tidx: n,
                type: 2,
                action: "moveIndex",
                unshift: i
            }, t)
        },
        changeIndexAndUndoForCreateGroup: function(e, t) {
            var o = this.getIndex()
              , n = e.new_index
              , a = this.getPage()
              , r = a.getIndex()
              , s = a.getDesign()
              , i = e.unshift;
            if (n !== o) {
                var d = {
                    index: n,
                    element: this,
                    action: "insert"
                };
                a.elements = d,
                s.saveDesignAndUndo({
                    obj: this,
                    loc: "pages]" + r + "]elems]",
                    key: o,
                    tidx: n,
                    type: 2,
                    action: "moveIndex",
                    unshift: i
                }, t)
            }
        },
        changeIndex: function(e) {
            var o = this._owner_page
              , n = o.elements
              , a = this.getNode()
              , r = t(a)
              , s = this.getIndex()
              , i = e.new_index;
            if (i !== s) {
                var d, g = n[i];
                d = g._group_drag ? g._element_group.getNode() : g.getNode();
                var h = t(d);
                if (s > i ? h.before(r) : h.after(r),
                "img_to_back" == e.changeFor)
                    var u = {
                        index: i,
                        element: this,
                        action: "insert"
                    };
                else
                    var u = {
                        index: i,
                        element: this,
                        action: "insert"
                    };
                o.elements = u
            }
        },
        moveTo: function(e) {
            var t = (this.getNode(),
            this._owner_page)
              , o = (t.elements,
            {
                index: e,
                element: this,
                action: "insert"
            });
            t.elements = o
        },
        intersectEle: function(e) {
            var t = this.getRect()
              , o = t.left
              , n = t.top
              , a = t.right
              , r = t.bottom;
            e._group_drag && (e = e._element_group);
            var s = e.getRect()
              , i = s.left
              , d = s.top
              , g = s.right
              , h = s.bottom;
            return o > g || n > h || d > r || i > a ? !1 : !0
        },
        nodeMoveTo: function(e) {
            var o = this.getNode()
              , n = this._owner_page
              , a = n.elements;
            e >= 1 ? a[e - 1]._group_drag ? t(n.element_groups[a[e - 1].getJson().group].getNode()).after(o) : t(a[e - 1].getNode()).after(o) : t(n.getPageSvg()).prepend(o),
            this.moveTo(e)
        },
        nodeClick: function() {
            var e = this._owner_page;
            if (e.nodeMousedown(),
            this._group_drag)
                return !1;
            if (this._move_drag)
                return void (this._move_drag = !1);
            if (this.isBackground() && "false" == this.getJson()["data-elem"]["data-key"])
                return !1;
            var t = e._owner_design
              , o = t._owner_editDiv;
            void 0 != o && o._owner_element != this ? o.show(this) : void 0 != o && o.show(this);
            var n = t._owner_elementEditbar;
            void 0 != n && n._owner_element != this && n.show(this)
        },
        nodeMousedown: function(o) {
            if (!(o.ctrlKey || o.metaKey || o.shiftKey)) {
                if (this._group_drag)
                    return this._element_group.nodeMousedown(o),
                    !1;
                if ("true" != this.lock) {
                    var n = this._owner_page;
                    n.nodeMousedown();
                    var a = n._owner_design;
                    if (this.isBackground())
                        return !1;
                    if (0 != o.button)
                        return !1;
                    {
                        var s = this
                          , i = o.pageX
                          , d = o.pageY;
                        t(this.getNode())
                    }
                    s._move_drag = !1;
                    var g = s.getTranslateLeftTop()
                      , h = this.getRect()
                      , u = {
                        drag: !1,
                        index: 0,
                        imgIndex: 0
                    };
                    n._svgLayoutNum > 0 && "img" == this._element_type && n.svgLayoutWrapCreate();
                    var c, l, _ = {
                        left: h.left,
                        right: h.right,
                        top: h.top,
                        bottom: h.bottom,
                        middle_x: (h.left + h.right) / 2,
                        middle_y: (h.top + h.bottom) / 2
                    }, f = n.elementsPositionNotThis([this]), p = a.pageScale;
                    s.showAnt(),
                    t(document).mousemove(function(e) {
                        var t = e.pageX
                          , o = e.pageY
                          , a = t - i
                          , h = o - d;
                        c = n.changeElePosition(_, a, h),
                        c.i = s.getIndex(),
                        l = n.guideShow(c, f),
                        s.setLeftTop([g[0] + (l.left - _.left) / p * r.ZOOM_IN, g[1] + (l.top - _.top) / p * r.ZOOM_IN]),
                        n._svgLayoutNum > 0 && "img" == s._element_type && n.svgLayoutEnter(u, s),
                        Math.abs(t - i) < 2 && Math.abs(o - d) < 2 ? s._move_drag = !1 : (s._move_drag = !0,
                        s.setMoveOpacity(!0))
                    }).mouseup(function() {
                        s.setMoveOpacity(!1);
                        for (var o = 0; o < t(".elementsSonEnter").size(); o++)
                            e.removeClass(t(".elementsSonEnter").eq(o)[0], "elementsSonEnter");
                        if (t(this).off("mousemove").off("mouseup"),
                        t(".moveGuide").detach(),
                        n._svgLayoutNum > 0 && "img" == s._element_type && (n.svgLayoutWrapRemove(u, s),
                        u.drag))
                            return !1;
                        var a = s.overstepPageDel();
                        return a ? !1 : (window.MEMENTO_ID = e.now(),
                        void (s._move_drag && !u.drag ? s.transform = e.transformScale(s.getTransform(), 1 / r.ZOOM_IN) : u.drag || s.nodeClick()))
                    })
                }
            }
        },
        nodeMouseenter: function() {
            this.showAnt()
        },
        showAnt: function() {
            var o = this.getNode()
              , n = t(o)
              , a = n.find(".ant-path")
              , s = a.eq(0)[0]
              , i = a.eq(1)[0];
            n.find(".seat-rect").css("display", "none");
            var d = this.getPage()
              , g = d.getDesign()
              , h = g.pageScale
              , u = parseFloat(this.getShowWidth()) * r.ZOOM_IN
              , c = parseFloat(this.getShowHeight()) * r.ZOOM_IN
              , l = "M 0 0 L " + u + " 0 L " + u + " " + c + " L 0 " + c + " Z";
            if ("text" === this._element_type) {
                var _ = this.getBox();
                l = "M 0 " + _.y + " L " + u + " " + _.y + " L " + u + " " + (c + parseFloat(_.y)) + " L 0 " + (c + parseFloat(_.y)) + " Z"
            }
            "background" != this._element_type && e.addClass(o, "elementsSonEnter"),
            s.style.stroke = "#fff",
            s.style.strokeWidth = .8 * r.ZOOM_IN / h,
            s.style.fill = "none",
            i.style.stroke = "#000",
            i.style.strokeWidth = .8 * r.ZOOM_IN / h,
            i.style.fill = "none",
            i.style.strokeDasharray = 4 * r.ZOOM_IN / h,
            s.setAttribute("d", l),
            i.setAttribute("d", l),
            n.find(".seat-rect").css("display", "block")
        },
        nodeMouseleave: function() {
            var e = this.getPage()
              , t = e.getDesign()
              , o = t._owner_editDiv;
            (null == o._owner_element || "elementGroup" != o._owner_element._element_type || this._group != o._owner_element.id) && this.hideAnt()
        },
        hideAnt: function() {
            var t = this.getNode();
            e.removeClass(t, "elementsSonEnter")
        },
        dblclickInGroup: function(e) {
            var t = this._owner_page
              , o = t._owner_design
              , n = o._owner_editDiv
              , a = o._owner_elementEditbar;
            n.showInGroup(this),
            a.showInGroup(this, n._owner_element),
            "text" == this._element_type && this.nodeDblclick(e)
        },
        isBackground: function() {
            return "background" === this.dataType ? !0 : !1
        },
        previewOpacity: function(e) {
            var t = this.getNode();
            t.setAttribute("opacity", e)
        },
        setOpacity: function(e) {
            this.opacity = e
        },
        setVerticalReverse: function() {
            var t = this.getJson()
              , o = t["data-elem"]
              , n = this.getContentNode()
              , a = n.getAttribute("transform") || ""
              , s = e.getTransformAttr(a, "matrix")
              , i = e.getTransformAttr(a, "translate");
            0 == s[0] ? (s = [1, 0, 0, -1, 0, 0],
            i[1] = -o.height * r.ZOOM_IN) : "-1" == s[3] ? (s[3] = 1,
            i[1] = 0) : (s[3] = -1,
            i[1] = -o.height * r.ZOOM_IN),
            a = e.setTransformAttr(a, "matrix", s),
            a = e.setTransformAttr(a, "translate", i),
            n.setAttribute("transform", a),
            this.reverse = e.transformScale(a, 1 / r.ZOOM_IN),
            "text" === this._element_type && this.saveParagraphs()
        },
        setHorizontalReverse: function() {
            var t = this.getJson()
              , o = t["data-elem"]
              , n = this.getContentNode()
              , a = n.getAttribute("transform") || ""
              , s = e.getTransformAttr(a, "matrix")
              , i = e.getTransformAttr(a, "translate");
            0 == s[0] ? (s = [-1, 0, 0, 1, 0, 0],
            i[0] = -o.width * r.ZOOM_IN) : "-1" == s[0] ? (s[0] = 1,
            i[0] = 0) : (s[0] = -1,
            i[0] = -o.width * r.ZOOM_IN),
            a = e.setTransformAttr(a, "matrix", s),
            a = e.setTransformAttr(a, "translate", i),
            n.setAttribute("transform", a),
            this.reverse = e.transformScale(a, 1 / r.ZOOM_IN),
            "text" === this._element_type && this.saveParagraphs()
        },
        getContentNode: function() {
            return this.getNode().firstChild
        },
        removeFormGroupAndUndo: function(o) {
            var n = this.getRect()
              , a = n.left
              , s = n.top
              , i = this._owner_page
              , d = i.getPageSvg()
              , g = i.elements
              , h = this.getRotateFormNode()
              , u = this.getIndex()
              , u = this.getIndex()
              , c = this.getNode();
            u >= 1 ? g[u - 1]._group_drag ? t(g[u - 1]._element_group.getNode()).after(c) : t(g[u - 1].getNode()).after(c) : t(d).prepend(c),
            this._group_drag = !1,
            this._group = null,
            delete this.getJson().group,
            this.setRotate(h);
            var l = this.getRect()
              , _ = l.left
              , f = l.top;
            this.addLeftTop((a - _) * r.ZOOM_IN, (s - f) * r.ZOOM_IN),
            this.group = {
                value: "",
                undo_drag: o
            },
            this.transform = {
                value: e.transformScale(this.getTransform(), 1 / r.ZOOM_IN),
                undo_drag: o
            },
            this.groupTransform = {
                value: "",
                undo_drag: o
            }
        },
        setNewJsonFormGroup: function(o) {
            var n = this.getRect()
              , a = n.left
              , s = n.top
              , i = this.getRotateFormNode()
              , d = this.getNode()
              , g = (t(d),
            t(d).clone()[0])
              , h = this._owner_page
              , u = h.getPageSvg();
            g.setAttribute("opacity", "1"),
            u.appendChild(g),
            this.setRotate(i, g);
            var c = this.getRect(g)
              , l = c.left
              , _ = c.top;
            if (this.addLeftTop((a - l) * r.ZOOM_IN, (s - _) * r.ZOOM_IN, g),
            "text" == this._element_type) {
                var f;
                f = t(g).find("text").size() > 0 ? parseFloat(t(g).find("text")[0].style["font-size"]) / r.ZOOM_IN : parseFloat(this.fontSize),
                this.fontSize = {
                    value: f,
                    undo_drag: o
                },
                this.saveParagraphs()
            }
            this.width = {
                value: this.getShowWidth(),
                undo_drag: o
            },
            this.height = {
                value: this.getShowHeight(),
                undo_drag: o
            },
            this.transform = {
                value: e.transformScale(g.getAttribute("transform"), 1 / r.ZOOM_IN),
                undo_drag: o
            },
            this.groupTransform = {
                value: e.transformScale(d.getAttribute("transform"), 1 / r.ZOOM_IN),
                undo_drag: o
            },
            this.reverse = {
                value: this.getReverse(),
                undo_drag: o
            },
            u.removeChild(g)
        },
        setMoveOpacity: function(e) {
            if (e)
                this.previewOpacity(".5");
            else {
                var t = this.opacity;
                this.previewOpacity(t)
            }
        },
        undoValue: function(e) {
            var t = e.key
              , o = e.val;
            switch (t) {
            case "transform":
                this.undoTransform(o);
                break;
            case "width":
                this.undoWidth(o);
                break;
            case "height":
                this.undoHeight(o);
                break;
            case "reverse":
                this.undoReverse(o);
                break;
            case "opacity":
                this.undoOpacity(o);
                break;
            case "data-colors":
                this.undoColors(o);
                break;
            case "viewBox":
                this.undoViewBox(o);
                break;
            case "vary":
                this.undoVary(o);
                break;
            case "data-xhref-imgs":
                this.undoXhrefImgs(o);
                break;
            case "group-transform":
                this.undoGroupTransform(o);
                break;
            case "fill":
                this.undoColors(o);
                break;
            case "font-size":
                this.undoFontSize(o);
                break;
            case "font-family":
                this.undoFontFamily(o);
                break;
            case "data-align":
                this.undoFontAlign(o);
                break;
            case "data-bold":
                this.undoFontBold(o);
                break;
            case "data-italic":
                this.undoItalic(o);
                break;
            case "data-decoration":
                this.undoDecoration(o);
                break;
            case "wspace":
                this.undoWspace(o);
                break;
            case "vspace":
                this.undoVspace(o);
                break;
            case "html":
                this.undoHtml(o);
                break;
            case "filter":
                this.undoFilter(o);
                break;
            case "data-type":
                this.undoDataType(o);
                break;
            case "lock":
                this.undoLock(o);
                break;
            case "cut-width":
                this.undoCutWidth(o);
                break;
            case "cut-height":
                this.undoCutHeight(o);
                break;
            case "repeat-width":
                this.undoRepeatWidth(o);
                break;
            case "group":
                this._group = null;
                break;
            case "real-width":
                this.undoWidth(o);
                break;
            case "real-height":
                this.undoHeight(o);
                break;
            case "chart-data":
                this.undoChartData(o);
                break;
            case "chart-kind":
                this.undoChartKind(o);
                break;
            case "chart-colors":
                this.undoChartColors(o);
                break;
            case "chart-title":
                this.undoChartTitle(o);
                break;
            case "chart-titleShow":
                this.undoChartTitleShow(o);
                break;
            case "chart-titleColor":
                this.undoChartTitleColor(o);
                break;
            case "chart-titlePosition":
                this.undoChartTitlePosition(o);
                break;
            case "chart-axisShow":
                this.undoChartAxisShow(o);
                break;
            case "chart-axisTitleShow":
                this.undoChartAxisTitleShow(o);
                break;
            case "chart-xAxisTitle":
                this.undoChartXAxisTitle(o);
                break;
            case "chart-yAxisTitle":
                this.undoChartYAxisTitle(o);
                break;
            case "chart-yAxisNumMin":
                this.undoChartYAxisNumMin(o);
                break;
            case "chart-yAxisNumMax":
                this.undoChartXAxisNumMax(o);
                break;
            case "chart-gridShow":
                this.undoChartGridShow(o);
                break;
            case "chart-legendShow":
                this.undoChartLegendShow(o)
            }
        },
        undoGroupTransform: function(t) {
            var o = this.getNode();
            o.setAttribute("transform", e.transformScale(t, r.ZOOM_IN)),
            this.groupTransform = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoTransform: function(t) {
            var o = this.getNode();
            this._group || o.setAttribute("transform", e.transformScale(t, r.ZOOM_IN)),
            this.transform = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoWidth: function(e) {
            var t = this.getShowNode();
            t.setAttribute("width", e * r.ZOOM_IN),
            this.width = {
                value: e,
                undo_drag: "noUndo"
            }
        },
        undoHeight: function(e) {
            var t = this.getShowNode();
            t.setAttribute("height", e * r.ZOOM_IN),
            this.height = {
                value: e,
                undo_drag: "noUndo"
            }
        },
        undoReverse: function(t) {
            var o = this.getContentNode();
            o.setAttribute("transform", e.transformScale(t, r.ZOOM_IN)),
            this.reverse = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoOpacity: function(e) {
            var t = this.getNode();
            t.setAttribute("opacity", e),
            this.opacity = {
                value: e,
                undo_drag: "noUndo"
            }
        },
        setLock: function(t) {
            var o = this.lock
              , n = this.getNode();
            "true" == o ? (this.lock = {
                value: "false",
                undo_drag: t
            },
            e.removeClass(n, "elementsSonLock")) : (this.lock = {
                value: "true",
                undo_drag: t
            },
            "background" != this._element_type && e.addClass(n, "elementsSonLock"))
        },
        undoLock: function() {
            var t = this.lock
              , o = this.getNode();
            "true" == t ? (this.lock = {
                value: "false",
                undo_drag: "noUndo"
            },
            e.removeClass(o, "elementsSonLock")) : (this.lock = {
                value: "true",
                undo_drag: "noUndo"
            },
            "background" != this._element_type && e.addClass(o, "elementsSonLock"))
        },
        seatRectSet: function() {
            if ("text" != this._element_type) {
                t(this.getNode()).find(".seat-rect").remove();
                var o, n, a = e.createSvgNode("rect"), s = this.width, i = this.height, d = this._owner_page._owner_design.pageScale;
                (20 > s * d || 20 > i * d) && (o = 20 > s * d ? 20 / d * r.ZOOM_IN : s * r.ZOOM_IN,
                n = 20 > i * d ? 20 / d * r.ZOOM_IN : i * r.ZOOM_IN,
                a.setAttribute("width", o),
                a.setAttribute("height", n),
                a.setAttribute("opacity", 0),
                a.setAttribute("x", -(o - s * r.ZOOM_IN) / 2),
                a.setAttribute("y", -(n - i * r.ZOOM_IN) / 2),
                a.setAttribute("class", "seat-rect"),
                this.getNode().appendChild(a))
            }
        }
    },
    e.classExtend(h, n),
    h
});
;/*!/compapi/design/toolbar/SvgFilter.js*/
define("compapi/design/toolbar/SvgFilter", ["components/jquery/jquery", "compapi/design/design_config"], function(t) {
    function e(t, e, r) {
        null != e && void 0 != e && e.children().size() <= 1 && null == e.find(".brightness") && this.setBrightness(e, r, 0),
        null != t && void 0 != t && 0 !== t.size() && t.remove()
    }
    function r(t) {
        return t -= 200 / 7,
        0 > t && (t = 200 + t),
        t = n(360 * t / 200, 100, 50),
        {
            color: {
                r: t[0],
                g: t[1],
                b: t[2]
            },
            Dm: 7
        }
    }
    function n(t, e, r) {
        if (t /= 360,
        e /= 100,
        r /= 100,
        0 == e)
            r = e = t = r;
        else {
            var n = .5 > r ? r * (1 + e) : r + e - r * e
              , s = 2 * r - n;
            r = i(s, n, t + 1 / 3),
            e = i(s, n, t),
            t = i(s, n, t - 1 / 3)
        }
        return [Math.round(255 * r), Math.round(255 * e), Math.round(255 * t)]
    }
    function i(t, e, r) {
        return 0 > r && (r += 1),
        r > 1 && --r,
        1 / 6 > r ? t + 6 * (e - t) * r : .5 > r ? e : 2 / 3 > r ? t + (e - t) * (2 / 3 - r) * 6 : t
    }
    function s(t) {
        function e(e) {
            return parseFloat((e * t / -100).toFixed(2))
        }
        if (t > 0) {
            var r = function(e) {
                return parseFloat((e * t / 100).toFixed(2))
            }
              , n = [0, .2, 0, -.1, 0].map(r)
              , i = [0, .1, 0, -.1, 0].map(r)
              , r = [.2, 0, .2].map(r);
            return {
                red: [[0, 0], [.3, .3 - n[1]], [.7, .7 - n[3]], [1, 1]],
                green: [[0, 0], [.25, .25 - i[1]], [.75, .75 - i[3]], [1, 1]],
                blue: [[0, r[0]], [0 + 2 / 3 * .5, r[0] + 2 / 3 * (.5 - r[0])], [1 + 2 / 3 * -.5, 1 - r[2] + 2 / 3 * (.5 - (1 - r[2]))], [1, 1 - r[2]]]
            }
        }
        return n = [0, .2, .5, -.05].map(e),
        i = [0, -.15, 0, 0].map(e),
        r = [0, -.01, 0, .3].map(e),
        {
            red: [[0, 0], [.3, .3 - n[1]], [.7, .7 - n[2]], [.95, .95 - n[3]]],
            green: [[0, 0], [.25, .25 - i[1]], [.6, .6], [1, 1]],
            blue: [[0, 0], [.3, .3 - r[1]], [.5, .5], [1, 1 - r[3]]]
        }
    }
    function a(t, e, r, n) {
        function i(t, e) {
            var r = t * t
              , n = 1 - t
              , i = n * n;
            return e[0] * i * n + 3 * e[1] * i * t + 3 * e[2] * n * r + e[3] * r * t
        }
        for (var s, a, o = 0, c = []; 1 > o; )
            s = i(o, [t.x, e.x, r.x, n.x]),
            a = i(o, [t.y, e.y, r.y, n.y]),
            c.push({
                x: s,
                y: a
            }),
            o += 5e-5;
        var u = [{
            x: t.x,
            y: t.y
        }]
          , l = .05
          , p = null;
        return c.forEach(function(t) {
            null !== p && t.x > l && (u.push(p),
            l += .05),
            p = t
        }),
        u.push({
            x: n.x,
            y: n.y
        }),
        u
    }
    var o = function(t) {
        this._owner_design = t
    };
    return o.prototype = {
        constructor: o,
        _owner_design: null,
        createElement: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", t);
            return e
        },
        createElementSvg: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            return t
        },
        createElementDefs: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            return t
        },
        createElementFilter: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "filter");
            return t
        },
        createElementG: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "g");
            return t
        },
        createElementImage: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "image");
            return t
        },
        createElementClipPath: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "clipPath");
            return t
        },
        createElementRect: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            return t
        },
        createElementBrightness: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer");
            return e.setAttribute("class", "brightness"),
            e.setAttribute("color-interpolation-filters", "sRGB"),
            ["r", "g", "b"].forEach(function(r) {
                var n = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + r.toUpperCase());
                n.setAttribute("type", "linear"),
                n.setAttribute("slope", 1),
                n.setAttribute("intercept", t),
                e.appendChild(n)
            }),
            e
        },
        createElementContrast: function(t, e) {
            return contrast = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer"),
            contrast.setAttribute("class", "contrast"),
            contrast.setAttribute("color-interpolation-filters", "sRGB"),
            ["r", "g", "b"].forEach(function(r) {
                r = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + r.toUpperCase()),
                r.setAttribute("type", "linear"),
                r.setAttribute("slope", t),
                r.setAttribute("intercept", e),
                contrast.appendChild(r)
            }),
            contrast
        },
        createElementSaturation: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feColorMatrix");
            return e.setAttribute("class", "saturation"),
            e.setAttribute("color-interpolation-filters", "sRGB"),
            e.setAttribute("type", "matrix"),
            e.setAttribute("values", t.join(" ")),
            e
        },
        createElementGaussianBlur: function(e) {
            var r = null;
            if (0 > e)
                e *= -1,
                e = e / 100 * 4,
                e = [0, -e, 0, -e, 4 * e + 1, -e, 0, -e, 0],
                r = document.createElementNS("http://www.w3.org/2000/svg", "feConvolveMatrix"),
                r.setAttribute("order", "3"),
                r.setAttribute("kernelMatrix", e.join(" ")),
                r.setAttribute("class", "sharpen");
            else {
                r = document.createElementNS("http://www.w3.org/2000/svg", "feGaussianBlur");
                var n, i = this._owner_design._focus_element;
                if ("img" === i._element_type || "background" === i._element_type) {
                    var s = t(".page").children("svg")[0].getAttribute("viewBox").split(" ");
                    n = parseInt(s[2]) / 1e3
                } else
                    n = 1;
                r.setAttribute("stdDeviation", .125 * n * e),
                r.setAttribute("class", "blur")
            }
            return r
        },
        createElementConvolveMatrix: function(t) {
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feConvolveMatrix");
            return e.setAttribute("class", "convolveMatrix"),
            e.setAttribute("order", "3"),
            e.setAttribute("kernelMatrix", t.join(" ")),
            e
        },
        createElementVignette: function(t, e) {
            var r = document.createElementNS("http://www.w3.org/2000/svg", "radialGradient")
              , n = document.createElementNS("http://www.w3.org/2000/svg", "stop")
              , i = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            r.setAttribute("class", "vignette"),
            r.setAttribute("id", e + "_VIGNETTE"),
            r.appendChild(n),
            r.appendChild(i),
            r.setAttribute("cx", "50%"),
            r.setAttribute("cy", "50%"),
            r.setAttribute("r", "50%"),
            r.setAttribute("fx", "50%"),
            r.setAttribute("fy", "50%");
            var s = .7 / 1.3
              , a = Math.min(1, 1.3);
            return n.setAttribute("offset", s.toString()),
            n.setAttribute("stop-color", "#000000"),
            n.setAttribute("stop-opacity", "0"),
            i.setAttribute("offset", a.toString()),
            i.setAttribute("stop-color", "#000000"),
            i.setAttribute("stop-opacity", t / 100),
            r
        },
        createElementRect: function(t, e) {
            var r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            return r.setAttribute("x", "-75"),
            r.setAttribute("y", "-75"),
            r.setAttribute("width", "650"),
            r.setAttribute("height", "650"),
            r.setAttribute("class", e.getAttribute("class")),
            r.setAttribute("fill", e.getAttribute("id")),
            r
        },
        createElementTint: function(t) {
            var e = r(t + 100)
              , n = {
                r: e.color.r / 255,
                g: e.color.g / 255,
                b: e.color.b / 255
            }
              , i = e.Dm / 100 * 2
              , s = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer");
            return s.setAttribute("class", "tint"),
            s.setAttribute("color-interpolation-filters", "sRGB"),
            ["r", "g", "b"].forEach(function(t) {
                var e = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + t.toUpperCase());
                t = n[t] * i,
                e.setAttribute("type", "linear"),
                e.setAttribute("slope", 1 - i),
                e.setAttribute("intercept", t),
                s.appendChild(e)
            }),
            s
        },
        createElementCrossProcess: function(t) {
            t = s(t);
            var e = document.createElementNS("http://www.w3.org/2000/svg", "feComponentTransfer");
            e.setAttribute("color-interpolation-filters", "sRGB"),
            e.setAttribute("class", "crossProcess");
            var r = {
                r: t.red,
                g: t.green,
                b: t.blue
            };
            return ["r", "g", "b"].forEach(function(t) {
                var n = document.createElementNS("http://www.w3.org/2000/svg", "feFunc" + t.toUpperCase());
                (t = r[t]) && (t = a({
                    x: t[0][0],
                    y: t[0][1]
                }, {
                    x: t[1][0],
                    y: t[1][1]
                }, {
                    x: t[2][0],
                    y: t[2][1]
                }, {
                    x: t[3][0],
                    y: t[3][1]
                }).map(function(t) {
                    return t.y
                })),
                n.setAttribute("type", "table"),
                n.setAttribute("tableValues", t.join(" ")),
                e.appendChild(n)
            }),
            e
        },
        setBrightness: function(e, r, n) {
            var i = e.find(".brightness")
              , s = this
              , a = e.attr("id");
            n *= .5;
            var o = n / 100;
            if (0 === i.size())
                e.append(s.createElementBrightness(o));
            else {
                var c = t(i).children().toArray();
                c.forEach(function(e) {
                    t(e).attr("intercept", o)
                })
            }
            r.attr("filter", "url(#" + a + ")")
        },
        setContrast: function(r, n, i) {
            var s = r.find(".contrast")
              , a = this
              , o = r.attr("id");
            if (0 !== i) {
                i *= .6;
                var c = (i * (i > 1 ? 1 / .6 : 1) + 100) / 100
                  , u = -(.5 * c) + .5;
                if (0 === s.size())
                    r.append(a.createElementContrast(c, u));
                else {
                    var l = t(s).children().toArray();
                    l.forEach(function(e) {
                        t(e).attr("intercept", u),
                        t(e).attr("slope", c)
                    })
                }
                n.attr("filter", "url(#" + o + ")")
            } else
                e.call(this, s, r, n)
        },
        setSaturation: function(r, n, i) {
            var s = r.find(".saturation")
              , a = this
              , o = r.attr("id");
            0 !== i ? (i > 0 && (i *= .8),
            i = (i + 100) / 100,
            i *= 1 >= i ? 1 : i,
            i = [.3086 + .6914 * i, .6094 - .6094 * i, .082 - .082 * i, 0, 0, .3086 - .3086 * i, .6094 + (1 - .6094) * i, .082 - .082 * i, 0, 0, .3086 - .3086 * i, .6094 - .6094 * i, .082 + .918 * i, 0, 0, 0, 0, 0, 1, 0],
            0 === s.size() ? r.append(a.createElementSaturation(i)) : t(s).attr("values", i.join(" ")),
            n.attr("filter", "url(#" + o + ")")) : e.call(this, s, r, n)
        },
        setGaussianBlur: function(t, r, n) {
            var i = this
              , s = t.attr("id")
              , a = t.find(".blur")
              , o = t.find(".sharpen");
            0 !== n ? (0 !== a.size() ? e.call(this, a, t, r) : 0 !== o.size() && e.call(this, o, t, r),
            n *= .5,
            t.append(i.createElementGaussianBlur(n)),
            r.attr("filter", "url(#" + s + ")")) : (e.call(this, a, t, r),
            e.call(this, o, t, r))
        },
        setTint: function(n, i, s) {
            var a = n.find(".tint")
              , o = this
              , c = n.attr("id");
            if (0 !== s) {
                if (0 === a.size())
                    n.append(o.createElementTint(s));
                else {
                    var u = r(s + 100)
                      , l = {
                        r: u.color.r / 255,
                        g: u.color.g / 255,
                        b: u.color.b / 255
                    }
                      , p = u.Dm / 100 * 2
                      , f = t(a).children().toArray();
                    f.forEach(function(e) {
                        var r = l[e.tagName.substr(6).toLowerCase()] * p;
                        t(e).attr("slope", 1 - p),
                        t(e).attr("intercept", r)
                    })
                }
                i.attr("filter", "url(#" + c + ")")
            } else
                e.call(this, a, n, i)
        },
        setVignette: function(r, n, i) {
            var s = r.parent().find(".vignette")
              , a = this
              , o = r.attr("id");
            if (0 !== i)
                if (i *= .7,
                0 === s.size()) {
                    var s = a.createElementVignette(i, o);
                    t(".vignette").attr("fill", "url(#" + s.getAttribute("id") + ")"),
                    r.after(s),
                    n.attr("filter", "url(#" + o + ")")
                } else {
                    var c = t(s).children().toArray();
                    t.each(c, function(e, r) {
                        0 === e ? t(r).attr("stop-opacity", 0) : t(r).attr("stop-opacity", i / 100)
                    })
                }
            else
                e.call(this, s, r, n)
        },
        setCrossProcess: function(t, r, n) {
            var i = t.find(".crossProcess")
              , s = this
              , a = t.attr("id");
            e.call(this, i, t, r),
            0 !== n && (t.find(".brightness").after(s.createElementCrossProcess(n)),
            r.attr("filter", "url(#" + a + ")"))
        }
    },
    o
});
;/*!/compapi/design/widgets/Img.js*/
"use strict";
define("compapi/design/widgets/Img", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/widgets/Element", "compapi/design/toolbar/toolbar_config", "compapi/design/toolbar/SvgFilter", "compapi/design/design_config"], function(t, e, a, i, r, s, n) {
    function o() {
        var t = this;
        d.call(t),
        g.call(t),
        this.seatRectSet()
    }
    function g() {
        function t() {
            var t = new Image;
            e.ajax({
                url: "/material/getMaterialUrlsByIds.do",
                type: "POST",
                dataType: "json",
                data: {
                    mids: d.id,
                    w: 800
                },
                success: function(a) {
                    t.src = a.urls[d.id],
                    t.onload = function() {
                        var t = e(this).attr("src");
                        g.href.baseVal = t
                    }
                },
                error: function() {}
            })
        }
        function a() {
            g.setAttribute("width", d.width * n.ZOOM_IN),
            g.setAttribute("height", d.height * n.ZOOM_IN),
            r._width = d.width,
            r._height = d.height,
            r.createFilter(),
            r._filter = d.filter,
            r.setFilterMove()
        }
        function i() {
            if (r._dataType = "img",
            "background" === s["data-type"]) {
                r._dataType = "background",
                r._element_type = "background";
                var t = s["data-elem"];
                r._lock = "true" == t.lock ? "true" : "false",
                o.setAttribute("class", "elementsSon imgSon backgroundSon")
            }
            r._width = r.getShowWidth(),
            r._height = r.getShowHeight()
        }
        var r = this
          , s = r.getJson()
          , o = r.getNode()
          , g = (e(o),
        r.getImgNode())
          , d = s["data-elem"]
          , h = s["data-img-kind"];
        if (r._img_kind = h,
        "false" != d["data-key"]) {
            if (void 0 == d["data-key"])
                return void (null != window.imgsrc ? (g.href.baseVal = window.imgsrc,
                a(),
                i(),
                window.imgsrc = null,
                t()) : e.ajax({
                    url: "/material/getMaterialUrlsByIds.do",
                    type: "POST",
                    dataType: "json",
                    data: {
                        mids: d.id,
                        w: 120
                    },
                    success: function(e) {
                        var r;
                        r = e.urls[d.id],
                        g.href.baseVal = r,
                        t(),
                        a(),
                        i()
                    },
                    error: function() {
                        console.log("请求img素材错误")
                    }
                }));
            var c;
            c = "image/png" == h ? "//" + img_config.imgdomain + "/materials/" + d["data-key"] + "@120w_1x.png" : "//" + img_config.imgdomain + "/materials/" + d["data-key"] + "@120w_100Q_1x.jpg",
            g.href.baseVal = c;
            var l = new Image;
            l.src = "//" + img_config.imgdomain + "/materials/" + d["data-key"] + "@0e_800w_800h_0c_0i_0o_1x.png",
            l.onload = function() {
                var t = e(this).attr("src");
                g.href.baseVal = t
            }
            ,
            a()
        } else
            void 0 == d["data-colors"] && (d["data-colors"] = {
                0: "#000"
            }),
            r.createBackgroundRect(d["data-colors"][0]);
        i()
    }
    function d() {
        {
            var e = this
              , a = this.getPage()
              , i = a.getDesign();
            "pages]" + e.getPage().getIndex() + "]elems]"
        }
        t.dataBinding({
            obj: e,
            prop_name: "filter",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "filter",
                    value: r,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "dataType",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    key: "data-type",
                    value: r,
                    type: "0",
                    action: "change",
                    unshift: !0
                }, a)
            }
        })
    }
    var h = function(t, e, a) {
        i.call(this, t, e, a),
        o.call(this)
    };
    return h.prototype = {
        constructor: h,
        _element_type: "img",
        _image_type: "img",
        _dataType: "img",
        _img_kind: "jpeg",
        _json: {
            "data-type": "img",
            "data-elem": {
                filter: {
                    brightness: 0,
                    contrast: 0,
                    crossProcess: 0,
                    gaussianBlur: 0,
                    saturation: 0,
                    tint: 0
                }
            }
        },
        _filter: {},
        createWidget: function() {
            var e = t.createSvgNode("g")
              , a = t.createSvgNode("image")
              , i = t.createSvgNode("defs")
              , r = t.createSvgNode("g")
              , s = t.createSvgNode("rect");
            s.setAttribute("width", "1"),
            s.setAttribute("height", "1"),
            s.setAttribute("class", "rotate-set-left"),
            s.setAttribute("opacity", "0"),
            s.setAttribute("display", "none"),
            e.setAttribute("class", "elementsSon imgSon"),
            e.appendChild(r),
            e.appendChild(s),
            r.appendChild(a),
            e.appendChild(i);
            var n = t.createSvgNode("path")
              , o = t.createSvgNode("path");
            return o.setAttribute("class", "ant-path"),
            n.setAttribute("class", "ant-path"),
            e.appendChild(n),
            e.appendChild(o),
            e
        },
        getImgNode: function() {
            return this.getContentNode().firstChild
        },
        nodeDblclick: function() {
            console.log("img 双击")
        },
        getSvgWidth: function() {
            var t = this.getNode()
              , a = e(t);
            return parseFloat(a.find("image")[0].getAttribute("width"))
        },
        getSvgHeight: function() {
            var t = this.getNode()
              , a = e(t);
            return parseFloat(a.find("image")[0].getAttribute("height"))
        },
        previewWH: function(e, a) {
            e *= n.ZOOM_IN,
            a *= n.ZOOM_IN;
            var i = (this.getNode(),
            this.getImgNode());
            i.setAttribute("width", e),
            i.setAttribute("height", a);
            var r = this.reverse
              , s = this.getContentNode()
              , o = t.getTransformAttr(r, "translate");
            0 != o[0] && (o[0] = -e),
            0 != o[1] && (o[1] = -a),
            r = t.setTransformAttr(r, "translate", o),
            s.setAttribute("transform", r || "")
        },
        resetWH: function() {
            var t = this.getShowWidth()
              , e = this.getShowHeight();
            this.width = t,
            this.height = e,
            this.reverse = this.getReverse()
        },
        getImgKey: function() {
            var t = this.getJson()
              , e = t["data-elem"];
            return e["data-key"]
        },
        getImgId: function() {
            var t = this.getJson()
              , e = t["data-elem"];
            return e.id
        },
        createBackgroundRect: function(a) {
            var i = this.getNode()
              , r = this.getJson()
              , s = r["data-elem"]
              , o = r.transform || "translate(0,0)";
            i.setAttribute("transform", o);
            var g = this._owner_page
              , d = e(i);
            if (d.find(".background-color").size() > 0)
                d.find(".background-color").attr({
                    fill: a
                });
            else {
                var h = this.getContentNode()
                  , c = this.getImgNode();
                h.removeChild(c);
                var l = t.createSvgNode("rect");
                l.setAttribute("class", "background-color");
                var u = s.width * n.ZOOM_IN || g._width
                  , f = s.height * n.ZOOM_IN || g._height;
                l.setAttribute("x", 0),
                l.setAttribute("y", 0),
                l.setAttribute("width", u),
                l.setAttribute("height", f),
                l.setAttribute("fill", a),
                h.appendChild(l)
            }
        },
        previewBackgroundColor: function(t) {
            this.createBackgroundRect(t)
        },
        setBackgroundColor: function(t) {
            this.createBackgroundRect(t)
        },
        changeSizeByPage: function() {
            var e = this.getPage()
              , a = e.width
              , i = e.height;
            if (!e.compareElementPosition(this)) {
                var r, s, o = this.width, g = this.height;
                o / a > g / i ? (s = parseFloat(i),
                r = i * (o / g)) : (r = parseFloat(a),
                s = a * (g / o));
                var d = "translate(" + (a - r) / 2 + "," + (i - s) / 2 + ")"
                  , h = this.getNode();
                h.setAttribute("transform", t.transformScale(d, n.ZOOM_IN)),
                this.previewWH(r, s),
                this.transform = d,
                this.resetWH()
            }
        },
        imgChangeToBackground: function() {
            if ("img" == this._element_type) {
                var t = this.getPage()
                  , e = t.elements;
                e[0].isBackground() && t.eleDelAndUndoByChangeBackground(e[0]),
                this.dataType = "background",
                this._element_type = "background";
                var a = this.getNode()
                  , i = a.getAttribute("class") + " backgroundSon";
                a.setAttribute("class", i),
                this.changeIndexAndUndo({
                    new_index: 0,
                    unshift: !0
                }),
                this.nodeClick()
            }
        },
        backgroundChangeToImg: function() {
            if ("background" == this._element_type) {
                var t = this.getPage();
                this._element_type = "img",
                this.dataType = "img";
                var e = this.getNode()
                  , a = e.getAttribute("class").replace("backgroundSon", "");
                e.setAttribute("class", a),
                t.addWhiteBackgroundAndUndo(!0),
                this.nodeClick()
            }
        },
        createFilter: function() {
            var a = this._owner_page._owner_design;
            a._focus_element = this;
            var i = e(this.getNode())
              , r = this._owner_page._owner_design._svg_filter
              , s = e(r.createElementFilter())
              , n = "_FILTER_" + t.now() + "_" + Math.floor(1e6 * Math.random());
            s.attr("id", n);
            var o = this.getImgNode();
            o.setAttribute("filter", "url(#" + n + ")");
            var g = i.find("defs");
            g.append(s)
        },
        filterMove: function(t, a) {
            var i = this._owner_page._owner_design._svg_filter
              , r = e(this.getImgNode())
              , s = e(this.getNode())
              , n = (s.find("defs"),
            s.find("defs").find("filter"));
            switch (a) {
            case "brightness":
                i.setBrightness(n, r, parseInt(t));
                break;
            case "contrast":
                i.setContrast(n, r, parseInt(t));
                break;
            case "crossProcess":
                i.setCrossProcess(n, r, parseInt(t));
                break;
            case "gaussianBlur":
                i.setGaussianBlur(n, r, parseInt(t));
                break;
            case "saturation":
                i.setSaturation(n, r, parseInt(t));
                break;
            case "tint":
                i.setTint(n, r, parseInt(t))
            }
        },
        setFilter: function(t) {
            this.filter = {
                value: t
            }
        },
        undoFilter: function(t) {
            this.filter = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setFilterMove()
        },
        setFilterMove: function() {
            var t = this.filter;
            for (var e in t)
                this.filterMove(t[e], e)
        },
        resetEle: function(e) {
            this._json = e;
            var a = this.getJson()
              , i = a["data-elem"]
              , r = this.getNode();
            r.setAttribute("opacity", i.opacity);
            var s = a.transform;
            a["group-transform"] && (s = a["group-transform"]),
            r.setAttribute("transform", t.transformScale(s, n.ZOOM_IN));
            var o = this.getContentNode();
            if (o.setAttribute("transform", t.transformScale(a.reverse, n.ZOOM_IN) || ""),
            "false" != i["data-key"]) {
                var g = this.getImgNode();
                g.setAttribute("width", i.width * n.ZOOM_IN),
                g.setAttribute("height", i.height * n.ZOOM_IN),
                this.setFilterMove()
            } else
                this.createBackgroundRect(i["data-colors"][0])
        },
        getNewJson: function() {
            var t = this._json;
            t.transform = this.transform,
            t["group-transform"] = this.groupTransform,
            t.group = this.group,
            t["data-type"] = this.dataType,
            t.reverse = this.reverse;
            var e = t["data-elem"];
            return e.width = this.width,
            e.height = this.height,
            e.filter = this.filter,
            e.opacity = this.opacity,
            JSON.parse(JSON.stringify(t))
        },
        undoDataType: function(t) {
            if (this.dataType = {
                value: t,
                undo_drag: "noUndo"
            },
            this._element_type = t,
            "img" === t) {
                var e = this.getNode()
                  , a = e.getAttribute("class").replace("backgroundSon", "");
                e.setAttribute("class", a)
            }
            if ("background" === t) {
                var e = this.getNode()
                  , a = e.getAttribute("class") + " backgroundSon";
                e.setAttribute("class", a)
            }
        },
        setNewJson: function() {},
        reseatBackgroundPosition: function(t, a, i) {
            i || (t = -t,
            a = -a);
            var r, s = this.getRealWidth(), n = this.getRealHeight(), o = this.getPage(), g = {
                width: o.width,
                height: o.height
            }, d = this.getNode(), h = e(d);
            if (r = h.find(".background-color").size() > 0 ? !0 : !1,
            s / g.width <= n / g.height) {
                var c = n / s;
                s = parseFloat(s) + 2 * parseFloat(t),
                n = r ? parseFloat(n) + 2 * parseFloat(a) : parseFloat(n) + 2 * parseFloat(a) * c
            } else {
                var c = s / n;
                n = parseFloat(n) + 2 * parseFloat(a),
                s = r ? parseFloat(s) + 2 * parseFloat(t) : parseFloat(s) + 2 * parseFloat(t) * c
            }
            h.find(".background-color").size() > 0 ? h.find(".background-color").attr({
                width: s,
                height: n
            }) : h.find("image").size() > 0 && h.find("image").attr({
                width: s,
                height: n
            });
            var l = this.getShowWidth()
              , u = this.getShowHeight();
            this.width = {
                value: l,
                undo_drag: "noUndo"
            },
            this.height = {
                value: u,
                undo_drag: "noUndo"
            }
        },
        cutOut: function() {
            var e = this.getImgNode();
            window.imgsrc = e.href.baseVal;
            var a, i, r, s, o, g, d = this.getNewJson(), h = d["data-elem"], c = h.width, l = h.height, u = 0, f = 0;
            l > c ? (a = c,
            i = c,
            r = 120,
            s = l / c * 120,
            o = 0,
            g = -(s - 120) / 2,
            u = 0,
            f = (l - c) / 2) : (a = l,
            i = l,
            s = 120,
            r = c / l * 120,
            g = 0,
            o = -(r - 120) / 2,
            f = 0,
            u = (c - l) / 2);
            var m = {
                "data-type": "svgFrame",
                "data-img-kind": "image/svg+xml",
                transform: d.transform,
                reverse: d.reverse,
                group: "",
                "group-transform": "",
                "data-elem": {
                    id: "cut1",
                    "data-key": "sys/cut/rect.svg",
                    width: a,
                    height: i,
                    opacity: h.opacity,
                    "data-xhref-imgs": {
                        sorb_1: {
                            "data-class": "sorb_1",
                            "data-img-key": h["data-key"],
                            x: o,
                            y: g,
                            width: r,
                            height: s,
                            transform: "",
                            id: h.id
                        }
                    },
                    "cut-width": "120",
                    "cut-height": "120",
                    filter: h.filter,
                    "data-colors": {},
                    vary: {},
                    viewBox: "0 0 120 120"
                }
            }
              , p = this.getPage()
              , v = p.getDesign()
              , _ = v.pageScale;
            p.eleDelAndUndo(this);
            var b = p.createElementAndUndo({
                json: m,
                unshift: !0
            });
            b.imgform = !0,
            b.addLeftTop(u * _ * n.ZOOM_IN, f * _ * n.ZOOM_IN),
            b.transform = {
                value: t.transformScale(b.getTransform(), 1 / n.ZOOM_IN),
                undo_drag: "noUndo"
            }
        }
    },
    t.classExtend(h, i),
    h
});
;/*!/compapi/design/widgets/Text.js*/
"use strict";
define("compapi/design/widgets/Text", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/widgets/Element", "compapi/design/toolbar/toolbar_config", "libs/jquery/jquery.transit.min", "widget/pop/pop", "compapi/design/design_config"], function(t, e, i, a, o, n, s, r) {
    function h() {
        {
            var t = this;
            t.getJson()
        }
        g.call(t),
        d.call(t)
    }
    function d() {
        var t = this
          , e = t.getJson()
          , i = t.getNode()
          , a = (e.html,
        e["data-elem"]);
        i.setAttribute("opacity", a.opacity),
        t._width = a.width,
        t._height = a.height,
        t._fontSize = a["font-size"],
        t._fontFamily = a["font-family"],
        t._fontAlign = a["data-align"],
        t._bold = a["data-bold"],
        t._italic = a["data-italic"],
        t._decoration = a["data-decoration"],
        t._wspace = a.wspace || 0,
        t._vspace = a.vspace || 0,
        t._html = e.html,
        t._colors = a.fill,
        t._paragraphs = a.paragraphs,
        t._fontFamilyLoaded = !1,
        t.textShow(),
        t.setFontFamily()
    }
    function g() {
        {
            var e = this
              , i = this.getPage()
              , a = i.getDesign();
            "pages]" + e.getPage().getIndex() + "]elems]"
        }
        t.dataBinding({
            obj: e,
            prop_name: "colors",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "fill",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "fontSize",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "font-size",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "fontFamily",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "font-family",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "fontAlign",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-align",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "bold",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-bold",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "italic",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-italic",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "decoration",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-decoration",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "wspace",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "wspace",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "vspace",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "vspace",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "html",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , o = t;
                "object" == typeof t && (o = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    key: "html",
                    value: o,
                    type: "0",
                    action: "change"
                }, i)
            }
        })
    }
    var l = function(t, e, i) {
        a.call(this, t, e, i),
        h.call(this, t)
    };
    return l.prototype = {
        constructor: l,
        _element_type: "text",
        _focus_drag: !1,
        _colors: "",
        _fontSize: "",
        _fontFamily: "",
        _fontAlign: "",
        _bold: "",
        _italic: "",
        _decoration: "",
        _wspace: "",
        _vspace: "",
        _html: "",
        _paragraphs: [],
        _input_point: {},
        createWidget: function() {
            var e = t.createSvgNode("g");
            e.setAttribute("class", "elementsSon textSon");
            var i = t.createSvgNode("rect");
            i.setAttribute("width", "1"),
            i.setAttribute("height", "1"),
            i.setAttribute("class", "rotate-set-left"),
            i.setAttribute("opacity", "0"),
            i.setAttribute("display", "none");
            var a = t.createSvgNode("g");
            e.appendChild(a),
            e.appendChild(i);
            var o = t.createSvgNode("path")
              , n = t.createSvgNode("path");
            return n.setAttribute("class", "ant-path"),
            o.setAttribute("class", "ant-path"),
            e.appendChild(o),
            e.appendChild(n),
            e
        },
        createParagraph: function(e) {
            var i = t.createSvgNode("g");
            return i.setAttribute("class", "paragraph"),
            i.setAttribute("transform", e),
            i
        },
        createAutoline: function(e, i, a, o) {
            var n = t.createSvgNode("g");
            n.setAttribute("class", "autoline"),
            n.setAttribute("transform", e),
            i.appendChild(n);
            var s = t.createSvgNode("rect");
            s.setAttribute("class", "autoline-rect"),
            s.setAttribute("opacity", "0"),
            n.appendChild(s);
            var r = a || this.getFontFocusSize()
              , h = this.getFontFocusFamily()
              , d = t.createSvgNode("text");
            d.style["font-size"] = r + "px",
            d.style["font-family"] = h,
            d.setAttribute("text-rendering", "geometricPrecision"),
            d.setAttribute("x", 0),
            d.innerHTML = "x",
            n.appendChild(d);
            var g = n.getBBox()
              , l = o || this.getTextMaxWidth();
            return s.setAttribute("x", g.x),
            s.setAttribute("y", g.y),
            s.setAttribute("width", l),
            s.setAttribute("height", g.height),
            n.removeChild(d),
            n
        },
        getPosition: function() {
            var t = this.getRect()
              , e = this.getPage()
              , i = e.getRect()
              , a = e.getDesign().pageScale;
            return [(parseFloat(t.left) - parseFloat(i.left)) / a, (parseFloat(t.top) - parseFloat(i.top)) / a]
        },
        getHtml: function() {
            return this.html
        },
        getRotateCenter: function() {
            var t = this.getNode()
              , e = t.getBBox()
              , i = e.height / 2 + e.y;
            return i
        },
        getLineHeight: function() {
            var e, i = this._owner_page, a = i._owner_design, o = a.pageScale, n = this.getBox(), s = n.height / r.ZOOM_IN, h = this._paragraphs, d = t.jsonLength(h);
            e = d;
            for (var g, l = 0; d > l; l++)
                g = h[l].autolines,
                e = t.jsonLength(g) - 1 + e;
            return s / e * o
        },
        getStyleFontSize: function() {
            var t = this.getNode()
              , i = e(t)
              , a = parseFloat(i.find("text")[0].style["font-size"]);
            return a
        },
        getFontFocusSize: function() {
            return this.fontSize
        },
        getFontFocusFamily: function() {
            return this.fontFamily
        },
        getFontFocusColor: function() {
            return this.colors
        },
        getFocusColor: function() {
            return this.colors
        },
        getFontFocusWspace: function() {
            return this.wspace
        },
        getFontFocusVspace: function() {
            return this.vspace
        },
        getFontFocusBold: function() {
            return this.bold
        },
        getFontFocusItalic: function() {
            return "true" == this.italic ? !0 : !1
        },
        getFontFocusDecoration: function() {
            return "true" == this.decoration ? !0 : !1
        },
        getSvgWidth: function() {
            var t = this.getNode()
              , i = e(t);
            return i.find("rect")[0].getAttribute("width")
        },
        previewFontSize: function(t) {
            var i = (this.getJson()["data-elem"],
            this.getFontFocusFamily());
            this.textShow({
                family: i,
                size: t
            });
            var a = this.getLeft()
              , o = this.getTop()
              , n = this.getWidth()
              , s = this.getHeight()
              , r = this._owner_page
              , h = r._owner_design
              , d = h._owner_editDiv
              , g = e(d.getNode());
            e(".editdiv-clone").size() > 0 && (g = e(".editdiv-clone")),
            g.css({
                width: n + 1,
                height: s + 1
            }).offset({
                left: a,
                top: o
            })
        },
        setFontSize: function(t) {
            this.fontSize = t,
            this.saveParagraphs()
        },
        undoFontSize: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                "font-size": t
            }),
            this.fontSize = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        setFontFamilyAndUndo: function(t) {
            {
                var e = this.getPage();
                e.getDesign()
            }
            this.setFontFamily(t, !0)
        },
        undoFontFamily: function(t) {
            this.setFontFamily(t, !0, "noUndo")
        },
        setFontFamily: function(i, a, o) {
            var n = this;
            n.updateFontLoad(!1);
            var s = i || n.fontFamily;
            "微软雅黑" == s && (s = "Microsoft YaHei");
            var h, d = window.FONT_FAMILY[s];
            return void 0 == d ? (s = "SimHei",
            h = r.FONTLOCALHOST + r.FONTFAMILY[s],
            void this.setFontFamily(s, !0, "noUndo")) : (h = d.url,
            n.showFontLoad(),
            void t.addRequestQueue({
                url: h,
                complete: function() {
                    setTimeout(function() {
                        n.hideFontLoad(),
                        e(".font_test").detach();
                        var t, h = s;
                        t = e(n.getNode()).find("text").size() > 0 ? parseFloat(e(n.getNode()).find("text")[0].style["font-size"]) / r.ZOOM_IN : parseFloat(n.fontSize),
                        n.textShow({
                            family: h,
                            size: t,
                            width: parseFloat(e(n.getNode()).find(".autoline-rect").attr("width")) / r.ZOOM_IN
                        }),
                        a && (n.fontFamily = {
                            value: i,
                            undo_drag: o
                        },
                        n.saveParagraphs()),
                        (void 0 == n._paragraphs || void 0 != n._paragraphs && 0 == n._paragraphs.length) && n.saveParagraphs();
                        var d = n.getLeft()
                          , g = n.getTop()
                          , l = n.getWidth()
                          , c = n.getHeight()
                          , p = n._owner_page
                          , u = p._owner_design
                          , f = u._owner_editDiv;
                        if (null != f && f._owner_element == n) {
                            var v = e(f.getNode());
                            e(".editdiv-clone").size() > 0 && (v = e(".editdiv-clone")),
                            v.css({
                                width: l + 1,
                                height: c + 1
                            }).offset({
                                left: d,
                                top: g
                            })
                        }
                        n.updateFontLoad(!0)
                    }, 900)
                },
                error: function() {
                    console.log("返回字体文件失败")
                },
                font: s
            }))
        },
        updateFontLoad: function(t) {
            var e = this;
            e._fontFamilyLoaded = t,
            e._group_drag && e._element_group.uplateTextEleLoaded(t)
        },
        showFontLoad: function() {
            var e = this.getPage()
              , i = e._owner_design
              , a = i.pageScale
              , o = e.getTop()
              , n = this.getTop()
              , s = n - o;
            s /= a;
            var h = this.getShowTranslateLeftTop()
              , d = h[1] - s
              , g = this.getShowWidth()
              , l = this.getShowHeight()
              , c = d - l / 2
              , p = 24
              , u = '<svg width="' + p * r.ZOOM_IN / a + 'px" height="' + p * r.ZOOM_IN / a + 'px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><linearGradient x1="0%" y1="0%" x2="101.999998%" y2="100.999999%" id="linearGradient-1"><stop stop-color="#5EA2FF" offset="0%"></stop><stop stop-color="#00D5FF" offset="62.5956633%"></stop><stop stop-color="#00E3FF" offset="100%"></stop></linearGradient></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" class="fontLoad"><g id="Artboard" fill-rule="nonzero" fill="url(#linearGradient-1)"><g id="加载" transform="translate(7.000000, 6.000000)"><path d="M11,8 C11,12.418278 14.581722,16 19,16 C23.418278,16 27,12.418278 27,8 C27,3.581722 23.418278,2.71558832e-16 19,0 C14.581722,-2.60243881e-16 11,3.581722 11,8 L11,8 Z" id="Shape"></path><path d="M1.31881038e-15,23.9999999 C-3.7265705e-08,26.5008591 1.33419242,28.8117482 3.49999997,30.0621778 C5.66580752,31.3126074 8.33419248,31.3126074 10.5,30.0621778 C12.6658076,28.8117482 14,26.5008591 14,23.9999999 C14,20.1340067 10.8659932,17 7,17 C3.13400675,17 3.76802966e-16,20.1340067 0,23.9999999 L1.31881038e-15,23.9999999 Z" id="Shape" fill-opacity="0.9"></path><path d="M6,41 C5.99999997,43.1435935 7.1435935,45.1243556 8.99999997,46.1961524 C10.8564064,47.2679492 13.1435936,47.2679492 15,46.1961524 C16.8564065,45.1243556 18,43.1435935 18,41 C18,37.6862915 15.3137085,35 12,35 C8.6862915,35 6,37.6862915 6,41 L6,41 Z" id="Shape" fill-opacity="0.8"></path><path d="M22,47 C22,49.7614237 24.2385763,52 27,52 C29.7614237,52 32,49.7614237 32,47 C32,44.2385763 29.7614237,42 27,42 C24.2385763,42 22,44.2385763 22,47 Z" id="Shape" fill-opacity="0.6"></path><path d="M36,40.5 C36,42.9852814 38.0147186,45 40.5,45 C42.9852814,45 45,42.9852814 45,40.5 C45,38.0147186 42.9852814,36 40.5,36 C38.0147186,36 36,38.0147186 36,40.5 L36,40.5 Z" id="Shape" fill-opacity="0.4"></path><path d="M42,29 C42,31.209139 43.790861,33 46,33 C48.209139,33 50,31.209139 50,29 C50,26.790861 48.209139,25 46,25 C43.790861,25 42,26.790861 42,29 Z" id="Shape" fill-opacity="0.3"></path><path d="M42,18 C42,19.6568542 43.3431458,21 45,21 C46.6568542,21 48,19.6568542 48,18 C48,16.3431458 46.6568542,15 45,15 C43.3431458,15 42,16.3431458 42,18 L42,18 Z" id="Shape" fill-opacity="0.2"></path><path d="M36,11.5 C36,12.8807119 37.1192881,14 38.5,14 C39.8807119,14 41,12.8807119 41,11.5 C41,10.1192881 39.8807119,9 38.5,9 C37.1192881,9 36,10.1192881 36,11.5 Z" id="Shape" fill-opacity="0.1"></path></g></g></g></svg>'
              , f = t.createSvgNode("g");
            f.setAttribute("transform", "translate(" + (g * r.ZOOM_IN - p * r.ZOOM_IN / a) / 2 + "," + -(c + p / 2 / a) * r.ZOOM_IN + ")"),
            f.innerHTML = u,
            f.setAttribute("class", "fontLoadWrap");
            var v = this.getNode();
            v.appendChild(f)
        },
        hideFontLoad: function() {
            var t = this.getNode()
              , i = e(t);
            i.find(".fontLoadWrap").remove()
        },
        previewColor: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                color: t
            })
        },
        setColor: function(t) {
            this.colors = t,
            this.saveParagraphs()
        },
        undoColors: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                color: t
            }),
            this.colors = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        previewBold: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                bold: t
            })
        },
        setBold: function(t) {
            this.bold = t,
            this.saveParagraphs()
        },
        undoFontBold: function(t) {
            this.previewBold(t),
            this.bold = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        setItalic: function(t) {
            var i = this.italic
              , a = e(this.getNode());
            "true" == i ? (this.italic = {
                value: "false",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["font-style"] = ""
            })) : (this.italic = {
                value: "true",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["font-style"] = "italic"
            })),
            this.saveParagraphs()
        },
        undoItalic: function() {
            this.setItalic("noUndo")
        },
        setDecoration: function(t) {
            var i = this.decoration
              , a = e(this.getNode());
            "true" == i ? (this.decoration = {
                value: "false",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["text-decoration"] = ""
            })) : (this.decoration = {
                value: "true",
                undo_drag: t
            },
            a.find("text").each(function() {
                e(this)[0].style["text-decoration"] = "underline"
            })),
            this.saveParagraphs()
        },
        undoDecoration: function() {
            this.setDecoration("noUndo")
        },
        setAlign: function(t) {
            this.fontAlign = t;
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e
            }),
            this.saveParagraphs()
        },
        undoFontAlign: function(t) {
            this.fontAlign = {
                value: t,
                undo_drag: "noUndo"
            };
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e
            }),
            this.saveParagraphs()
        },
        previewWspace: function(t) {
            var i = this.getJson()
              , a = (i["data-elem"],
            this.getFontFocusFamily());
            this.textShow({
                family: a,
                wspace: t
            });
            var o = this.getLeft()
              , n = this.getTop()
              , s = this.getWidth()
              , r = this.getHeight()
              , h = this._owner_page
              , d = h._owner_design
              , g = d._owner_editDiv
              , l = e(g.getNode());
            e(".editdiv-clone").size() > 0 && (l = e(".editdiv-clone")),
            l.css({
                width: s + 1,
                height: r + 1
            }).offset({
                left: o,
                top: n
            })
        },
        setWspace: function(t) {
            this.wspace = t,
            this.saveParagraphs()
        },
        undoWspace: function(t) {
            this.previewWspace(t),
            this.wspace = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        previewVspace: function(t) {
            var i = this.getJson()
              , a = (i["data-elem"],
            this.getFontFocusFamily());
            this.textShow({
                family: a,
                vspace: t
            });
            var o = this.getLeft()
              , n = this.getTop()
              , s = this.getWidth()
              , r = this.getHeight()
              , h = this._owner_page
              , d = h._owner_design
              , g = d._owner_editDiv
              , l = e(g.getNode());
            e(".editdiv-clone").size() > 0 && (l = e(".editdiv-clone")),
            l.css({
                width: s + 1,
                height: r + 1
            }).offset({
                left: o,
                top: n
            })
        },
        setVspace: function(t) {
            this.vspace = t,
            this.saveParagraphs()
        },
        undoVspace: function(t) {
            this.previewVspace(t),
            this.vspace = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        getAlign: function() {
            var t = this.fontAlign;
            return (void 0 == t || "" === t) && (t = "left"),
            t
        },
        nodeDblclick: function() {
            var t, i = this.getFontFocusFamily(), a = window.FONT_FAMILY[i];
            if (t = void 0 == a ? !1 : a.is_vip_exclusive,
            t && !window.ISVIP)
                return void s.back({
                    str: "此字体为会员专属字体",
                    kind: "warning"
                });
            this._focus_drag = !0;
            var o = this._owner_page
              , n = o._owner_design
              , h = n.pageScale
              , d = e(o.getNode())
              , g = (d.find("svg")[0],
            this.html)
              , l = this.getWidth()
              , c = this.getHeight()
              , p = this.getLeft()
              , u = this.getTop()
              , f = this.getRotate()
              , v = this.getLineHeight()
              , m = this.getAlign()
              , F = this.getFontFocusColor()
              , y = this.getFontFocusWspace();
            this._group_drag && (f = this.getRotateFormNode());
            var _ = this.getNode()
              , w = e(_)
              , x = w.find(".autoline").eq(0)[0]
              , b = (x.getBoundingClientRect(),
            this.getFontFocusSize() * h)
              , A = document.getElementById(r.ANXID)
              , S = e(A)
              , N = document.getElementById(r.ANXIDCOPY)
              , C = e(N)
              , I = this.opacity;
            S.css({
                width: l,
                height: c,
                display: "block",
                rotate: f + "deg",
                "font-size": b,
                "font-family": i,
                "line-height": Math.round(v) + "px",
                "text-align": m,
                color: F,
                opacity: I,
                "letter-spacing": y / 1e3 + "em"
            }),
            C.css({
                width: l,
                "font-size": b,
                "font-family": i,
                "line-height": Math.round(v) + "px",
                "letter-spacing": y / 1e3 + "em"
            }),
            S.css("true" == this.italic ? {
                "font-style": "italic"
            } : {
                "font-style": "normal"
            }),
            S.offset({
                left: -1e4,
                top: -1e4
            }),
            S.offset({
                left: p,
                top: u
            }),
            A.value = g,
            e(A).addClass("focus-text"),
            A.select(),
            _.style.display = "none";
            var n = o._owner_design
              , L = n._owner_elementEditbar;
            L.hideMoreMenu()
        },
        finishInput: function(i) {
            var a = this.html
              , o = document.getElementById(r.ANXID)
              , n = o.value
              , s = this.getFontFocusFamily();
            a != n && (window.MEMENTO_ID = t.now(),
            this.html = n),
            this.textShow({
                family: s
            }),
            a != n && this.saveParagraphs(),
            void 0 != i && "elementGroup" === i._element_type && (i.resetWH(!0),
            e(".editdiv-clone").detach())
        },
        undoHtml: function(t) {
            this.html = {
                value: t,
                undo_drag: "noUndo"
            };
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e
            }),
            this.saveParagraphs()
        },
        saveParagraphs: function() {
            var t = this
              , e = this.getPage()
              , i = e.getDesign()
              , a = "pages]" + e.getIndex() + "]elems]";
            this._paragraphs = t.getParagraphs(),
            i.saveDesignAndUndo({
                obj: t,
                loc: a + t.getIndex() + "]",
                key: "paragraphs",
                value: t._paragraphs,
                type: "0",
                cLoc: "data-elem]",
                action: "change"
            }, "noUndo")
        },
        textShow: function(a) {
            void 0 == a && (a = {});
            var o = this._owner_page
              , n = o._owner_design
              , s = (n.pageScale,
            this.getJson())
              , h = a.html || this._html
              , d = this.getNode()
              , g = (e(d),
            this.getContentNode())
              , l = e(g);
            if (void 0 != h && void 0 != h.split) {
                h = h.split("\n").join("®");
                var c = h.length
                  , p = (a.width || this.getTextMaxWidth()) * r.ZOOM_IN;
                l.children().detach();
                var u = this.createParagraph("translate(0,0)");
                g.appendChild(u);
                var f, v, m, F = (a.size || this.getFontFocusSize()) * r.ZOOM_IN, y = this.createAutoline("translate(0,0)", u, F, p), _ = {
                    x: 0,
                    width: 0
                }, w = a.color || this.getFontFocusColor(), x = (this.getFontFocusItalic(),
                a.bold || this.getFontFocusBold());
                0 === a.bold && (x = a.bold);
                for (var b, A, S = (this.getFontFocusDecoration(),
                a.wspace || this.getFontFocusWspace()), N = a.vspace || this.getFontFocusVspace(), C = 0; c > C; C++) {
                    v = h[C],
                    " " == v && (v = "&nbsp;");
                    var I = v.charCodeAt(0);
                    if (!(I >= 0 && 31 >= I || 127 == I))
                        if ("®" != v) {
                            f = t.createSvgNode("text"),
                            f.innerHTML = v,
                            m = _.x + _.width,
                            A = _;
                            var L = x * F / 20 || 0;
                            f.setAttribute("x", m),
                            f.setAttribute("stroke-width", L + "px"),
                            f.setAttribute("stroke", w),
                            f.style["font-size"] = F + "px",
                            f.style["font-style"] = "",
                            f.style["text-decoration"] = "",
                            a.family && (f.style["font-family"] = a.family),
                            f.setAttribute("fill", w),
                            y.appendChild(f),
                            _ = i.getFontWH(v, 10 * F, a.family),
                            _ = {
                                height: _.height / 10,
                                width: _.width / 10
                            },
                            f.setAttribute("text-rendering", "geometricPrecision"),
                            _ = f.getBBox(),
                            _.width = "1.0.1" === s.v ? _.width + i.getFontWH("正", 10 * F, a.family).width / 10 * (S / 1e3) : _.width + _.width * (S / 1e3),
                            b = _.x + _.width;
                            var P = e(y)
                              , O = P.children();
                            if (b > p && O.length >= 3) {
                                if ("&nbsp;" == v) {
                                    e(f).detach(),
                                    _ = A;
                                    continue
                                }
                                var M = t.getTransformAttr(y.getAttribute("transform"), "translate")[1]
                                  , z = y.getBBox()
                                  , B = y;
                                y = this.createAutoline("translate(0," + (parseFloat(M) + parseFloat(z.height) + parseFloat(z.height) * (N / 1e3)) + ")", u, F, p),
                                f.setAttribute("x", 0),
                                y.appendChild(f),
                                this.setLineAlign(B, p),
                                _ = f.getBBox(),
                                _.width = "1.0.1" === s.v ? _.width + i.getFontWH("正", 10 * F, a.family).width / 10 * (S / 1e3) : _.width + _.width * (S / 1e3)
                            }
                        } else {
                            var j = t.getTransformAttr(u.getAttribute("transform"), "translate")[1]
                              , T = u.getBBox()
                              , W = u.firstChild
                              , D = W.getBBox()
                              , k = "translate(0," + (parseFloat(j) + parseFloat(T.height) + parseFloat(D.height) * (N / 1e3)) + ")";
                            this.setLineAlign(y, p),
                            u = this.createParagraph(k),
                            g.appendChild(u);
                            var y = this.createAutoline("translate(0,0)", u, F, p);
                            _ = {
                                x: 0,
                                width: 0
                            }
                        }
                }
                this.setLineAlign(y, p),
                d.style.display = "block",
                this.resetPosition(),
                document.getElementById(r.ANXID).style.display = "none",
                this._focus_drag = !1,
                this.setFontStyle()
            }
        },
        setFontStyle: function() {
            var t = this.getNode()
              , i = e(t)
              , a = this.italic
              , o = this.decoration;
            i.find("text").each(function() {
                "true" == a && (e(this)[0].style["font-style"] = "italic"),
                "true" == o && (e(this)[0].style["text-decoration"] = "underline")
            })
        },
        setLineAlign: function(t, i) {
            var a = this.fontAlign;
            if ("left" != a && void 0 != a) {
                var o = e(t)
                  , n = o.children("text")
                  , s = n.last()
                  , r = s[0];
                if (void 0 != r) {
                    var h = r.getBBox()
                      , d = h.x + h.width
                      , g = i || parseFloat(this.getTextMaxWidth())
                      , l = 0;
                    "center" == a ? l = (g - d) / 2 : "right" == a && (l = g - d),
                    n.each(function() {
                        e(this).attr("x", parseFloat(e(this).attr("x")) + l)
                    })
                }
            }
        },
        getTextMaxWidth: function() {
            var t = this.width;
            return t
        },
        previewWidth: function(e) {
            var i = this.getFontFocusFamily()
              , a = this.getContentNode()
              , o = this.reverse
              , n = t.getTransformAttr(o, "translate");
            0 != n[0] && (n[0] = -e),
            o = t.setTransformAttr(o, "translate", n),
            a.setAttribute("transform", o || ""),
            this.textShow({
                family: i,
                width: e
            })
        },
        previewWH: function(t) {
            var e = this.fontSize;
            this.previewBig(t, e / this.width * t)
        },
        resetWH: function() {
            var i = this.getNode();
            this.fontSize = parseFloat(e(i).find("text")[0].style["font-size"]) / r.ZOOM_IN,
            this.saveParagraphs();
            var a = this.getShowWidth()
              , o = this.getShowHeight();
            this.width = a,
            this.height = o,
            this.reverse = this.getReverse(),
            this.transform = t.transformScale(this.getTransform(), 1 / r.ZOOM_IN);
            var n = this._owner_page._owner_design._owner_elementEditbar;
            void 0 != n && n.show(this)
        },
        previewBig: function(e, i) {
            var a = this.getFontFocusFamily();
            this.textShow({
                family: a,
                width: e,
                size: i
            });
            var o = this.getJson()
              , n = this.getContentNode()
              , s = t.getTransformAttr(o.reverse, "translate");
            0 != s[0] && (s[0] = -e),
            0 != s[1] && (s[1] = -this.getShowHeight());
            var h = o.reverse;
            h = t.setTransformAttr(h, "translate", s),
            n.setAttribute("transform", t.transformScale(h, r.ZOOM_IN) || "")
        },
        resetWidth: function() {
            this.width = this.getShowWidth(),
            this.height = this.getShowHeight(),
            this.reverse = this.getReverse(),
            this.saveParagraphs()
        },
        undoWidth: function(t) {
            var e = this.getFontFocusFamily();
            this.textShow({
                family: e,
                width: t
            }),
            this.width = {
                value: t,
                undo_drag: "noUndo"
            },
            this.saveParagraphs()
        },
        getParagraphs: function() {
            for (var i, a, o, n, s, h, d, g = this.getNode(), l = [], c = e(g), p = c.find(".paragraph"), u = p.length, f = this.fontSize, v = this.fontFamily, m = this.italic, F = this.decoration, y = 0; u > y; y++) {
                i = p.eq(y)[0],
                l[y] = {
                    transform: t.transformScale(i.getAttribute("transform"), 1 / r.ZOOM_IN),
                    autolines: []
                },
                a = p.eq(y).find(".autoline"),
                n = a.length;
                for (var _ = 0; n > _; _++) {
                    o = a.eq(_)[0],
                    l[y].autolines[_] = {
                        transform: t.transformScale(o.getAttribute("transform"), 1 / r.ZOOM_IN),
                        contents: []
                    },
                    s = a.eq(_).find("text"),
                    h = s.length;
                    for (var w = 0; h > w; w++) {
                        d = s.eq(w)[0];
                        var x = t.htmlUtil(d.innerHTML, !1)
                          , b = x.charCodeAt(0);
                        if (!(b >= 0 && 31 >= b || 127 == b)) {
                            var A = "font-size:" + f + "px;font-family: " + v + ";";
                            "false" != m && m && (A += "font-style: italic;"),
                            "false" != F && F && (A += "text-decoration: underline;"),
                            l[y].autolines[_].contents[w] = {
                                "data-txt": x,
                                x: parseFloat(d.getAttribute("x")) / r.ZOOM_IN,
                                "stroke-width": (parseFloat(d.getAttribute("stroke-width")) || 0) / r.ZOOM_IN,
                                fill: d.getAttribute("fill"),
                                style: A,
                                stroke: d.getAttribute("fill")
                            }
                        }
                    }
                }
            }
            return l
        },
        resetEle: function(i) {
            this._json = i;
            {
                var a = this.getJson()
                  , o = this.getJson()["data-elem"]
                  , n = this.getNode();
                e(n)
            }
            n.setAttribute("opacity", o.opacity);
            var s = a.transform;
            a["group-transform"] && (s = a["group-transform"]),
            n.setAttribute("transform", t.transformScale(s, r.ZOOM_IN)),
            this.textShow(),
            this.setFontFamily()
        },
        getNewJson: function() {
            var t = this._json;
            t.transform = this.transform,
            t.html = this.html,
            t["group-transform"] = this.groupTransform,
            t.group = this.group,
            t.reverse = this.reverse;
            var e = t["data-elem"];
            return e.width = this.width,
            e.height = this.height,
            e.wspace = this.wspace,
            e.vspace = this.vspace,
            e.fill = this.colors,
            e["font-size"] = this.fontSize,
            e["font-family"] = this.fontFamily,
            e["data-bold"] = this.bold,
            e["data-italic"] = this.italic,
            e["data-decoration"] = this.decoration,
            e["data-align"] = this.fontAlign,
            e.paragraphs = this._paragraphs,
            e.opacity = this.opacity,
            JSON.parse(JSON.stringify(t))
        },
        setNewJson: function() {}
    },
    t.classExtend(l, a),
    l
});
;/*!/compapi/design/widgets/Svg.js*/
"use strict";
define("compapi/design/widgets/Svg", ["compapi/b", "compapi/design/Chuangkit", "compapi/design/widgets/Element", "compapi/design/toolbar/toolbar_config", "compapi/design/widgets/Text", "components/jquery/jquery", "compapi/design/design_config"], function(t, e, i, a, r, n, s) {
    function o() {
        var t = this;
        g.call(t),
        d.call(t),
        this.seatRectSet()
    }
    function d() {
        var e, i = this, a = i._owner_page, r = i.getNode(), o = n(r), d = i.getContentNode(), g = n(d), h = i.getJson(), l = h["data-elem"];
        t.isNull(l["data-key"]) ? console.log("data-key为空") : (e = t.createSvgNode("image"),
        e.href.baseVal = "//" + img_config.imgdomain + "/materials/" + l["data-key"],
        e.setAttribute("width", l.width * s.ZOOM_IN),
        e.setAttribute("height", l.height * s.ZOOM_IN),
        i._width = l.width,
        i._height = l.height,
        d.appendChild(e)),
        n.ajax({
            url: "//" + img_config.imgdomain + "/materials/" + l["data-key"],
            type: "GET",
            error: function() {
                console.log("返回svg素材错误")
            },
            complete: function(r) {
                var u = r
                  , c = u.responseText;
                c = c.replace(/SVGID_/g, "SVGID_" + t.now()),
                d.removeChild(e),
                g.append(c);
                var f = i.getSvgNode();
                f.setAttribute("width", l.width * s.ZOOM_IN),
                f.setAttribute("height", l.height * s.ZOOM_IN),
                void 0 != l["cut-width"] && (i.setCutWidth(l["cut-width"]),
                i._cutwidth = l["cut-width"]),
                void 0 != l["cut-height"] && (i.setCutHeight(l["cut-height"]),
                i._cutheight = l["cut-height"]),
                void 0 != l["repeat-width"] && (i.setRepeatWidth(l["repeat-width"]),
                i._repeatwidth = l["repeat-width"]);
                var v = l["data-colors"];
                if (t.isNull(v)) {
                    for (var p = 0, m = {}, y = 1; 1; y++) {
                        if (0 == o.find(".color-" + y).size()) {
                            p = y;
                            break
                        }
                        m["color-" + y] = o.find(".color-" + y).attr("fill")
                    }
                    i.colors = {
                        value: m,
                        undo_drag: "noUndo"
                    }
                } else {
                    for (var y in v)
                        o.find("." + y).attr("fill", v[y]);
                    i._colors = l["data-colors"]
                }
                if (void 0 != l.vary ? (i.resetVary(),
                i._viewBox = l.viewBox) : i.resetSvgWH("noUndo"),
                o.find(".wbk").size() > 0 && o.find(".wbk").detach(),
                o.find(".hh").size() > 0 && o.find(".hh").detach(),
                o.find(".layoutImgWrap").size() > 0) {
                    i._svg_type = "svgLayout",
                    "svgFrame" != h["data-type"] && (i.dataType = "svgFrame"),
                    a._svgLayoutNum++;
                    var _ = l["data-xhref-imgs"];
                    void 0 == _ && (l["data-xhref-imgs"] = {});
                    var w = t.jsonLength(_);
                    o.find(".layoutImgWrap").each(function() {
                        var t = n(this)
                          , e = t.children().attr("class");
                        if (0 != w) {
                            if (_[e]["data-key"] ? _[e]["data-img-key"] = _[e]["data-key"] : "",
                            t.children().attr({
                                x: _[e].x,
                                y: _[e].y,
                                width: _[e].width,
                                height: _[e].height,
                                "data-key": _[e]["data-img-key"],
                                transform: _[e].transform || ""
                            }),
                            void 0 == _[e]["data-img-key"] && void 0 == _[e].id)
                                t.children().attr({
                                    "xlink:href": "",
                                    "data-old": ""
                                });
                            else if (void 0 == _[e]["data-img-key"] && void 0 != _[e].id)
                                t.children().attr({
                                    "data-id": _[e].id
                                }),
                                null != window.imgsrc ? (t.children().attr({
                                    "xlink:href": window.imgsrc,
                                    "data-old": window.imgsrc
                                }),
                                window.imgsrc = null) : n.ajax({
                                    url: "/material/getMaterialUrlsByIds.do",
                                    type: "POST",
                                    dataType: "json",
                                    data: {
                                        mids: _[e].id,
                                        w: 120
                                    },
                                    success: function(i) {
                                        var a;
                                        a = i.urls[_[e].id],
                                        t.children().attr({
                                            "xlink:href": a,
                                            "data-old": a
                                        }),
                                        n.ajax({
                                            url: "/material/getMaterialUrlsByIds.do",
                                            type: "POST",
                                            dataType: "json",
                                            data: {
                                                mids: _[e].id,
                                                w: 800
                                            },
                                            success: function(i) {
                                                var a = new Image;
                                                a.src = i.urls[_[e].id],
                                                a.onload = function() {
                                                    t.children().attr({
                                                        "xlink:href": i.urls[_[e].id],
                                                        "data-old": i.urls[_[e].id]
                                                    })
                                                }
                                            },
                                            error: function() {}
                                        })
                                    },
                                    error: function() {
                                        console.log("请求img素材错误")
                                    }
                                });
                            else {
                                t.children().attr({
                                    "xlink:href": "//" + img_config.imgdomain + "/materials/" + _[e]["data-img-key"] + "@120w_1x.png",
                                    "data-old": "//" + img_config.imgdomain + "/materials/" + _[e]["data-img-key"] + "@120w_1x.png"
                                });
                                var a = new Image;
                                a.src = "//" + img_config.imgdomain + "/materials/" + _[e]["data-img-key"] + "@0e_800w_800h_0c_0i_0o_1x.png",
                                a.onload = function() {
                                    t.children().attr({
                                        "xlink:href": a.src,
                                        "data-old": a.src
                                    })
                                }
                            }
                            i._xhrefImgs = _
                        } else
                            t.children().attr({
                                "xlink:href": "",
                                "data-old": ""
                            });
                        t.children().attr({
                            "data-x": t.children().attr("x"),
                            "data-y": t.children().attr("y"),
                            "data-width": t.children().attr("width"),
                            "data-height": t.children().attr("height"),
                            "data-transform": t.children().attr("transform")
                        })
                    });
                    var x = o.find(".layoutImgWrap").size();
                    if (0 == w) {
                        for (var y = 0; x > y; y++) {
                            var b = o.find(".layoutImgWrap").eq(y).children();
                            l["data-xhref-imgs"][b.attr("class")] = {
                                "data-class": b.attr("class"),
                                "data-img-key": b.attr("data-key"),
                                x: b.attr("x"),
                                y: b.attr("y"),
                                width: b.attr("width"),
                                height: b.attr("height")
                            }
                        }
                        i._xhrefImgs = l["data-xhref-imgs"]
                    }
                    i.createFilter(),
                    void 0 == l.filter || "" == l.filter ? (l.filter = {
                        brightness: 0,
                        contrast: 0,
                        crossProcess: 0,
                        gaussianBlur: 0,
                        saturation: 0,
                        tint: 0
                    },
                    i._filter = l.filter,
                    i.filterMove(0, "brightness")) : (i._filter = l.filter,
                    i.setFilterMove()),
                    o.find(".layoutImgWrap").mouseenter(function() {
                        0 == n(".edit-div-write-wrap").size() && (i._layout_index = o.find(".layoutImgWrap").index(n(this)))
                    })
                }
                var I = a._owner_design
                  , S = I._owner_editDiv
                  , N = I._owner_elementEditbar;
                void 0 != S && S._owner_element == i && (S.show(i),
                N.show(i)),
                i.imgform && i.nodeDblclick(),
                window.imgsrc = null
            }
        })
    }
    function g() {
        {
            var e = this
              , i = this.getPage()
              , a = i.getDesign();
            "pages]" + e.getPage().getIndex() + "]elems]"
        }
        t.dataBinding({
            obj: e,
            prop_name: "colors",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-colors",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "viewBox",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "viewBox",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "vary",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "vary",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "xhrefImgs",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "data-xhref-imgs",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "filter",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "filter",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "dataType",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    key: "data-type",
                    value: r,
                    type: "0",
                    action: "change"
                }, "noUndo")
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "cutwidth",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "cut-width",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "cutheight",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "cut-height",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "repeatwidth",
            getFun: t.$noop,
            setFun: function(t) {
                var i = !0
                  , r = t;
                "object" == typeof t && (r = t.value,
                i = t.undo_drag),
                a.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "repeat-width",
                    value: r,
                    type: "0",
                    action: "change"
                }, i)
            }
        })
    }
    var h = function(t, e, a) {
        i.call(this, t, e, a),
        o.call(this)
    };
    return h.prototype = {
        constructor: h,
        _element_type: "svg",
        _svg_type: "svg",
        _layout_index: 0,
        _json: {
            "data-type": "svg",
            "data-elem": {}
        },
        _colors: {},
        _vary: {},
        _viewbox: "",
        _filter: {},
        _xhrefImgs: {},
        createWidget: function() {
            var e = t.createSvgNode("g");
            e.setAttribute("class", "elementsSon svgSon");
            var i = t.createSvgNode("rect");
            i.setAttribute("width", "1"),
            i.setAttribute("height", "1"),
            i.setAttribute("class", "rotate-set-left"),
            i.setAttribute("opacity", "0"),
            i.setAttribute("display", "none");
            var a = t.createSvgNode("g");
            e.appendChild(a),
            e.appendChild(i);
            var r = t.createSvgNode("path")
              , n = t.createSvgNode("path");
            return n.setAttribute("class", "ant-path"),
            r.setAttribute("class", "ant-path"),
            e.appendChild(r),
            e.appendChild(n),
            e
        },
        getViewBoxWH: function() {
            var t = this.getSvgNode()
              , e = t.getAttribute("viewBox").split(" ")
              , i = [e[2], e[3]];
            return i
        },
        createSvgPath: function(e) {
            void 0 == e && (e = {});
            var i = e.svg_node || this.getSvgNode()
              , a = n(i);
            a.children().css("display", "none");
            var r = this.getViewBoxWH()
              , s = t.createSvgNode("path")
              , o = "M0 0 L" + r[0] + " 0 L" + r[0] + " " + r[1] + " L0 " + r[1] + " Z";
            s.setAttribute("class", "svgLayoutHide"),
            s.setAttribute("d", o),
            i.appendChild(s);
            var d = e.node || this.getNode()
              , g = d.getBoundingClientRect()
              , h = d.getBBox();
            return i.removeChild(s),
            a.children().css("display", "block"),
            [g, h]
        },
        svgLayoutHide: function() {
            var e = this.getSvgNode()
              , i = n(e);
            i.children().css("display", "none");
            var a = this.getViewBoxWH()
              , r = t.createSvgNode("path")
              , s = "M0 0 L" + a[0] + " 0 L" + a[0] + " " + a[1] + " L0 " + a[1] + " Z";
            r.setAttribute("class", "svgLayoutHide"),
            r.setAttribute("d", s),
            e.appendChild(r)
        },
        svgLayoutShow: function() {
            var t = this.getSvgNode()
              , e = n(t);
            e.children().css("display", "block"),
            e.find(".svgLayoutHide").detach()
        },
        getRealWidth: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[1].width;
            var t = this.getNode();
            n(t).find(".seat-rect").css("display", "none");
            var e = t.getBBox().width;
            return n(t).find(".seat-rect").css("display", "block"),
            e
        },
        getShowWidth: function() {
            return this.getRealWidth() / s.ZOOM_IN
        },
        getShowHeight: function() {
            return this.getRealHeight() / s.ZOOM_IN
        },
        getRealHeight: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[1].height;
            var t = this.getNode();
            n(t).find(".seat-rect").css("display", "none");
            var e = t.getBBox().height;
            return n(t).find(".seat-rect").css("display", "block"),
            e
        },
        getLeft: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[0].left;
            var t = this.getNode();
            n(t).find(".seat-rect").css("display", "none");
            var e = t.getBoundingClientRect().left;
            return n(t).find(".seat-rect").css("display", "block"),
            e
        },
        getTop: function() {
            if ("svgLayout" == this._svg_type)
                return this.createSvgPath()[0].top;
            var t = this.getNode();
            n(t).find(".seat-rect").css("display", "none");
            var e = t.getBoundingClientRect().top;
            return n(t).find(".seat-rect").css("display", "block"),
            e
        },
        nodeDblclick: function() {
            if ("svgLayout" == this._svg_type) {
                var t = this.getSvgNode()
                  , e = n(t)
                  , i = this._owner_page
                  , a = i._owner_design;
                if ("svgLayout" == this._svg_type) {
                    var r = e.find(".layoutImgWrap").eq(this._layout_index);
                    if ("" == r.children().attr("xlink:href")) {
                        for (var s = -1, o = 0; o < e.find(".layoutImgWrap").size(); o++)
                            "" != e.find(".layoutImgWrap").eq(o).children().attr("xlink:href") && (s = o);
                        if (-1 == s)
                            return !1;
                        this._layout_index = s
                    }
                    a._owner_editDiv.svgLayoutShow(this)
                }
            }
        },
        getSvgNode: function() {
            return this.getContentNode().firstChild
        },
        setSvgImageLT: function(t, e) {
            t *= s.ZOOM_IN,
            e *= s.ZOOM_IN;
            var i = n(this.getSvgNode())
              , a = i.find(".layoutImgWrap").eq(this._layout_index).children()[0]
              , r = parseFloat(a.getAttribute("x"))
              , o = parseFloat(a.getAttribute("y"))
              , d = parseFloat(a.getAttribute("height"))
              , g = parseFloat(a.getAttribute("width"))
              , h = r + t
              , l = o + e
              , u = this.getSvgImageWrapBox();
            h > u.x ? (t = u.x - r,
            h = u.x) : h + g < u.x + u.width && (t = u.width + u.x - g - r,
            h = u.width + u.x - g),
            l > u.y ? (e = u.y - o,
            l = u.y) : l + d < u.y + u.height && (e = u.height + u.y - d - o,
            l = u.height + u.y - d),
            a.setAttribute("x", h),
            a.setAttribute("y", l),
            a.setAttribute("data-x", h),
            a.setAttribute("data-y", l)
        },
        getSvgImageRect: function() {
            var t = n(this.getSvgNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children()[0].getBoundingClientRect()
        },
        getSvgImageBox: function() {
            var t = n(this.getSvgNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children()[0].getBBox()
        },
        getShowSvgImageBox: function() {
            var t = this.getSvgImageBox();
            return {
                height: t.height / s.ZOOM_IN,
                width: t.width / s.ZOOM_IN,
                x: t.x / s.ZOOM_IN,
                y: t.y / s.ZOOM_IN
            }
        },
        getSvgImageWrapBox: function() {
            var t, e = n(this.getSvgNode()), i = e.find(".layoutImgWrap").eq(this._layout_index);
            return i.parent().find("rect").size() > 0 ? t = i.parent().find("rect") : i.parent().find("circle").size() > 0 ? t = i.parent().find("circle") : i.parent().find("ellipse").size() > 0 ? t = i.parent().find("ellipse") : i.parent().find("line").size() > 0 ? t = i.parent().find("line") : i.parent().find("polyline").size() > 0 ? t = i.parent().find("polyline") : i.parent().find("polygon").size() > 0 ? t = i.parent().find("polygon") : i.parent().find("path").size() > 0 && (t = i.parent().find("path")),
            t[0].getBBox()
        },
        getSvgImageWrapRect: function() {
            var t, e = n(this.getSvgNode()), i = e.find(".layoutImgWrap").eq(this._layout_index);
            return i.parent().find("rect").size() > 0 ? t = i.parent().find("rect") : i.parent().find("circle").size() > 0 ? t = i.parent().find("circle") : i.parent().find("ellipse").size() > 0 ? t = i.parent().find("ellipse") : i.parent().find("line").size() > 0 ? t = i.parent().find("line") : i.parent().find("polyline").size() > 0 ? t = i.parent().find("polyline") : i.parent().find("polygon").size() > 0 ? t = i.parent().find("polygon") : i.parent().find("path").size() > 0 && (t = i.parent().find("path")),
            t[0].getBoundingClientRect()
        },
        getSvgScale: function() {
            var t = this.getSvgNode()
              , e = this.getViewBox()
              , i = parseFloat(t.getAttribute("width"));
            return i / parseFloat(e[2])
        },
        setRepeatWidth: function(t) {
            var e = n(this.getNode());
            e.find("rect[class=repeat]").attr("width", t)
        },
        getRepeatWidth: function() {
            var t = n(this.getNode());
            return t.find("rect[class=repeat]").attr("width")
        },
        setCutWidth: function(t) {
            var e = n(this.getNode());
            e.find(".cut").each(function(i) {
                e.find(".cut").eq(i).attr("width", t)
            })
        },
        setCutHeight: function(t) {
            var e = n(this.getNode());
            e.find(".cut").each(function(i) {
                e.find(".cut").eq(i).attr("height", t)
            })
        },
        getCutWidth: function() {
            var t = n(this.getNode());
            return t.find(".cut").attr("width")
        },
        getCutHeight: function() {
            var t = n(this.getNode());
            return t.find(".cut").attr("height")
        },
        getSvgImageSrc: function() {
            var t = n(this.getSvgNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children().attr("xlink:href")
        },
        getViewBox: function() {
            var t = this.getSvgNode()
              , e = t.getAttribute("viewBox");
            return e.split(" ")
        },
        setViewBox: function(t) {
            var e = this.getSvgNode()
              , i = t[0] + " " + t[1] + " " + t[2] + " " + t[3];
            e.setAttribute("viewBox", i)
        },
        setViewBoxWidth: function(e) {
            var i = this.getSvgNode()
              , a = this.getSvgScale()
              , r = e / a
              , n = this.getViewBox();
            n[2] = r,
            this.setViewBox(n),
            i.setAttribute("width", e);
            var o = this.reverse
              , d = this.getContentNode()
              , g = t.getTransformAttr(o, "translate");
            0 != g[0] && (g[0] = -e / s.ZOOM_IN),
            o = t.setTransformAttr(o, "translate", g),
            d.setAttribute("transform", t.transformScale(o, s.ZOOM_IN) || "")
        },
        setViewBoxHeight: function(e) {
            var i = this.getSvgNode()
              , a = this.getSvgScale()
              , r = e / a
              , n = this.getViewBox();
            n[3] = r,
            this.setViewBox(n),
            i.setAttribute("height", e);
            var o = this.reverse
              , d = this.getContentNode()
              , g = t.getTransformAttr(o, "translate");
            0 != g[1] && (g[1] = -e / s.ZOOM_IN),
            o = t.setTransformAttr(o, "translate", g),
            d.setAttribute("transform", t.transformScale(o, s.ZOOM_IN) || "")
        },
        svgLayoutPreviewWidth: function(t) {
            t *= s.ZOOM_IN;
            var e = this.getSvgScale()
              , i = t / e
              , a = n(this.getSvgNode())
              , r = a.find(".layoutImgWrap").find("image")
              , o = parseFloat(r.attr("x"))
              , d = parseFloat(r.attr("width"));
            i > o + d && (i = o + d),
            t = i * e,
            this.setViewBoxWidth(t),
            this.setCutWidth(i)
        },
        previewWidth: function(e) {
            if ("svgLayout" == this._svg_type)
                return void this.svgLayoutPreviewWidth(e);
            e *= s.ZOOM_IN;
            var i = this.getSvgNode()
              , a = n(i)
              , r = a.children()[0]
              , o = this.getSvgScale();
            this.setViewBoxWidth(e);
            var d = e / o;
            if (null != r) {
                var g = r.getAttribute("id");
                if ("hx" == g || "hs" == g) {
                    var h, l;
                    "hx" == g ? (h = [["nw", "n", "ne"]],
                    l = 1) : (h = [["nw", "n", "ne"], ["w", "c", "e"], ["sw", "s", "se"]],
                    l = 3);
                    for (var u = 0; l > u; u++) {
                        var c = a.find("#" + h[u][0])[0]
                          , f = a.find("#" + h[u][1])[0]
                          , v = a.find("#" + h[u][2])[0]
                          , p = {
                            width: 0
                        }
                          , m = {
                            width: 0
                        };
                        if (void 0 != c)
                            var p = c.getBBox();
                        if (void 0 != v) {
                            var m = v.getBBox()
                              , y = v.getAttribute("transform")
                              , _ = t.getTransformAttr(y, "translate");
                            _[0] = d - m.width - m.x;
                            var w = t.setTransformAttr(y, "translate", _);
                            v.setAttribute("transform", w)
                        }
                        if (void 0 != f) {
                            var x = f.getBBox()
                              , b = d - p.width - m.width
                              , I = f.getAttribute("transform")
                              , S = t.getTransformAttr(I, "scale")
                              , N = t.getTransformAttr(I, "translate")
                              , A = b / x.width;
                            S[0] = A,
                            N[0] = -x.x * (A - 1) / A;
                            var B = t.setTransformAttr(I, "scale", S);
                            B = t.setTransformAttr(B, "translate", N),
                            f.setAttribute("transform", B)
                        }
                    }
                } else if ("ry" == g) {
                    var k = r.getBBox()
                      , W = d / k.width
                      , O = r.getAttribute("transform")
                      , L = t.getTransformAttr(O, "scale");
                    0 == L[1] && (L[1] = 1),
                    L[0] = W;
                    var C = t.setTransformAttr(O, "scale", L);
                    r.setAttribute("transform", C)
                } else
                    "hx_def" == g && a.find("rect[class=repeat]").attr("width", d)
            }
        },
        resetWidth: function() {
            this.resetSvgWH();
            var t = this.getShowWidth();
            this.width = t
        },
        svgLayoutPreviewHeight: function(t) {
            t *= s.ZOOM_IN;
            var e = this.getSvgScale()
              , i = t / e
              , a = n(this.getSvgNode())
              , r = a.find(".layoutImgWrap").find("image")
              , o = parseFloat(r.attr("y"))
              , d = parseFloat(r.attr("height"));
            i > o + d && (i = o + d),
            t = i * e,
            this.setViewBoxHeight(t),
            this.setCutHeight(i)
        },
        previewHeight: function(e) {
            if ("svgLayout" == this._svg_type)
                return void this.svgLayoutPreviewHeight(e);
            e *= s.ZOOM_IN;
            var i = this.getSvgNode()
              , a = n(i)
              , r = a.children()[0]
              , o = this.getSvgScale();
            this.setViewBoxHeight(e);
            var d = e / o;
            if (null != r) {
                var g = r.getAttribute("id");
                if ("zx" == g || "hs" == g) {
                    var h, l;
                    "zx" == g ? (h = [["nw", "w", "sw"]],
                    l = 1) : (h = [["nw", "w", "sw"], ["n", "c", "s"], ["ne", "e", "se"]],
                    l = 3);
                    for (var u = 0; l > u; u++) {
                        var c = a.find("#" + h[u][0])[0]
                          , f = a.find("#" + h[u][1])[0]
                          , v = a.find("#" + h[u][2])[0]
                          , p = {
                            height: 0
                        }
                          , m = {
                            height: 0
                        };
                        if (void 0 != c)
                            var p = c.getBBox();
                        if (void 0 != v) {
                            var m = v.getBBox()
                              , y = v.getAttribute("transform")
                              , _ = t.getTransformAttr(y, "translate");
                            _[1] = d - m.height - m.y;
                            var w = t.setTransformAttr(y, "translate", _);
                            v.setAttribute("transform", w)
                        }
                        if (void 0 != f) {
                            var x = f.getBBox()
                              , b = d - p.height - m.height
                              , I = f.getAttribute("transform")
                              , S = t.getTransformAttr(I, "scale")
                              , N = t.getTransformAttr(I, "translate")
                              , A = b / x.height;
                            S[1] = A,
                            N[1] = -x.y * (A - 1) / A;
                            var B = t.setTransformAttr(I, "scale", S);
                            B = t.setTransformAttr(B, "translate", N),
                            f.setAttribute("transform", B)
                        }
                    }
                } else if ("ry" == g || "hx_def" == g) {
                    var k = r.getBBox()
                      , W = d / k.height
                      , O = r.getAttribute("transform")
                      , L = t.getTransformAttr(O, "scale");
                    0 == L[0] && (L[0] = 1),
                    L[1] = W;
                    var C = t.setTransformAttr(O, "scale", L);
                    r.setAttribute("transform", C)
                }
            }
        },
        resetHeight: function() {
            this.resetSvgWH();
            var t = this.getShowHeight();
            this.height = t
        },
        resetViewBox: function(t) {
            var e = this.getSvgNode()
              , i = e.getAttribute("viewBox");
            this.viewBox = {
                value: i,
                undo_drag: t
            }
        },
        resetSvgWH: function(t) {
            {
                var e = this.getSvgNode()
                  , i = this.getJson();
                i["data-elem"]
            }
            this.resetViewBox(t);
            var a, r = n(e), s = r.children()[0], o = 0, d = {};
            if (null != s) {
                var g = s.getAttribute("id");
                if ("zx" == g || "hs" == g || "hx" == g) {
                    "zx" == g ? (a = [["nw", "w", "sw"]],
                    o = 1) : "hx" == g ? (a = [["nw", "n", "ne"]],
                    o = 1) : (a = [["nw", "w", "sw"], ["n", "c", "s"], ["ne", "e", "se"]],
                    o = 3);
                    for (var h = 0; o > h; h++) {
                        var l = r.find("#" + a[h][0])[0]
                          , u = r.find("#" + a[h][1])[0]
                          , c = r.find("#" + a[h][2])[0];
                        void 0 != l && (d[a[h][0]] = l.getAttribute("transform")),
                        void 0 != u && (d[a[h][1]] = u.getAttribute("transform")),
                        void 0 != c && (d[a[h][2]] = c.getAttribute("transform"))
                    }
                } else
                    "ry" == g ? d.ry = s.getAttribute("transform") : "hx_def" == g && (d.hx_def = null == s.getAttribute("transform") ? "scale(1,1)" : s.getAttribute("transform"))
            }
            this.vary = {
                value: d,
                undo_drag: t
            },
            this.reverse = {
                value: this.getReverse(),
                undo_drag: t
            },
            void 0 != this.getCutWidth() && (this.cutwidth = {
                value: this.getCutWidth(),
                undo_drag: t
            },
            this.cutheight = {
                value: this.getCutHeight(),
                undo_drag: t
            }),
            void 0 != this.getRepeatWidth() && (this.repeatwidth = {
                value: this.getRepeatWidth(),
                undo_drag: t
            })
        },
        previewWH: function(e, i) {
            e *= s.ZOOM_IN,
            i *= s.ZOOM_IN;
            var a = (this.getNode(),
            this.getSvgNode());
            a.setAttribute("width", e),
            a.setAttribute("height", i);
            var r = this.reverse
              , n = this.getContentNode()
              , o = t.getTransformAttr(r, "translate");
            0 != o[0] && (o[0] = -e),
            0 != o[1] && (o[1] = -i),
            r = t.setTransformAttr(r, "translate", o),
            n.setAttribute("transform", r || "")
        },
        resetWH: function() {
            var t = this.getShowWidth()
              , e = this.getShowHeight();
            this.width = t,
            this.height = e,
            this.reverse = this.getReverse()
        },
        previewSvgLayoutWH: function(t, e) {
            t *= s.ZOOM_IN,
            e *= s.ZOOM_IN;
            var i = this.getSvgScale()
              , a = n(this.getSvgNode())
              , r = a.find(".layoutImgWrap").eq(this._layout_index).children()[0]
              , o = t / i
              , d = e / i
              , g = this.getSvgImageBox()
              , h = this.getSvgImageWrapBox()
              , l = g.width / g.height
              , u = h.width + h.x - g.x
              , c = u / l;
            c < h.height + h.y - g.y && (c = h.height + h.y - g.y,
            u = c * l),
            u > o && (o = u),
            c > d && (d = c),
            r.setAttribute("width", o),
            r.setAttribute("height", d),
            r.setAttribute("data-width", o),
            r.setAttribute("data-height", d)
        },
        setSvgLayoutWH: function() {
            this.setNewJson()
        },
        getFocusColor: function(t) {
            return this.colors["color-" + (parseInt(t) + 1)]
        },
        previewColor: function(t, e) {
            var i = this.getSvgNode()
              , a = n(i);
            a.find(".color-" + (e + 1)).attr("fill", t)
        },
        setColor: function(t, e) {
            if (-1 != e) {
                var i = JSON.parse(JSON.stringify(this._colors));
                i["color-" + (e + 1)] = t,
                this.colors = {
                    value: i
                }
            }
        },
        setColorOld: function(t, e) {
            if (-1 != e) {
                var i = this.getJson()
                  , a = JSON.parse(JSON.stringify(i));
                i["data-elem"]["data-colors"]["color-" + (e + 1)] = t,
                this.setNewJson({
                    old_json: a
                })
            }
        },
        getImgNode: function() {
            var t = n(this.getNode());
            return t.find(".layoutImgWrap").eq(this._layout_index).children()[0]
        },
        createFilter: function() {
            var e = this._owner_page._owner_design;
            e._focus_element = this;
            var i = n(this.getNode())
              , a = i.find(".layoutImgWrap").children()
              , r = a.parent().parent().children("defs")
              , s = this._owner_page._owner_design._svg_filter
              , o = n(s.createElementFilter())
              , d = "_FILTER_" + t.now() + "_" + Math.floor(1e6 * Math.random());
            o.attr("id", d),
            a.attr("filter", "url(#" + d + ")");
            for (var g = a.size(), h = 0; g > h; h++)
                o.clone().appendTo(r.eq(h))
        },
        getNewJson: function() {
            var t = this._json;
            t.transform = this.transform,
            t.reverse = this.reverse,
            t["group-transform"] = this.groupTransform,
            t.group = this.group;
            var e = t["data-elem"];
            return e.width = this.width,
            e.height = this.height,
            e["data-colors"] = this.colors,
            e.filter = this.filter,
            e.vary = this.vary,
            e.viewBox = this.viewBox,
            e["data-xhref-imgs"] = this.xhrefImgs,
            e["repeat-width"] = this.repeatwidth,
            e["cut-height"] = this.cutheight,
            e["cut-width"] = this.cutwidth,
            e.opacity = this.opacity,
            JSON.parse(JSON.stringify(t))
        },
        setNewJson: function() {},
        filterMove: function(t, e) {
            for (var i = this._owner_page._owner_design._svg_filter, a = n(this.getNode()), r = a.find(".layoutImgWrap").children(), s = r.parent().parent().children("defs"), o = s.find("filter"), d = o.size(), g = 0; d > g; g++)
                switch (e) {
                case "brightness":
                    i.setBrightness(o.eq(g), r, parseInt(t));
                    break;
                case "contrast":
                    i.setContrast(o.eq(g), r, parseInt(t));
                    break;
                case "saturation":
                    i.setSaturation(o.eq(g), r, parseInt(t));
                    break;
                case "tint":
                    i.setTint(o.eq(g), r, parseInt(t));
                    break;
                case "gaussianBlur":
                    i.setGaussianBlur(o.eq(g), r, parseInt(t));
                    break;
                case "crossProcess":
                    i.setCrossProcess(o.eq(g), r, parseInt(t))
                }
        },
        setFilterMove: function() {
            var t = this.getJson()["data-elem"].filter;
            for (var e in t)
                this.filterMove(t[e], e)
        },
        setFilter: function(t) {
            this.filter = {
                value: t
            }
        },
        undoFilter: function(t) {
            this.filter = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setFilterMove()
        },
        undoColors: function(t) {
            var e = this.getNode()
              , i = n(e);
            for (var a in t)
                i.find("." + a).attr("fill", t[a]);
            this.colors = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoViewBox: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("viewBox", t),
            this.viewBox = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoVary: function(t) {
            var e = this.getSvgNode()
              , i = n(e);
            for (var a in t)
                i.find("#" + a)[0].setAttribute("transform", t[a]);
            this.vary = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoCutWidth: function(t) {
            this.setCutWidth(t),
            this.cutwidth = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoCutHeight: function(t) {
            this.setCutHeight(t),
            this.cutheight = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoRepeatWidth: function(t) {
            this.setRepeatWidth(t),
            this.repeatwidth = {
                value: t,
                undo_drag: "noUndo"
            }
        },
        undoXhrefImgs: function(t) {
            var e, i = t, a = this.getSvgNode(), r = n(a);
            for (var s in i)
                if (e = i[s],
                r.find("." + s).attr({
                    "data-key": e["data-img-key"],
                    x: e.x,
                    y: e.y,
                    width: e.width,
                    height: e.height,
                    transform: "",
                    "data-x": e.x,
                    "data-y": e.y,
                    "data-width": e.width,
                    "data-height": e.height,
                    "data-id": e.id
                }),
                void 0 != e["data-img-key"]) {
                    r.find("." + s).attr({
                        "xlink:href": "//" + img_config.imgdomain + "/materials/" + e["data-img-key"] + "@120w_1x.png",
                        "data-old": "//" + img_config.imgdomain + "/materials/" + e["data-img-key"] + "@120w_1x.png"
                    });
                    var o = new Image;
                    o.src = "//" + img_config.imgdomain + "/materials/" + e["data-img-key"] + "@0e_800w_800h_0c_0i_0o_1x.png",
                    o.onload = function() {
                        r.find("." + s).attr({
                            "xlink:href": o.src,
                            "data-old": o.src
                        })
                    }
                } else
                    void 0 != e.id && n.ajax({
                        url: "/material/getMaterialUrlsByIds.do",
                        type: "POST",
                        dataType: "json",
                        data: {
                            mids: e.id,
                            w: 120
                        },
                        success: function(t) {
                            r.find("." + s).attr({
                                "xlink:href": t.urls[e.id],
                                "data-old": t.urls[e.id]
                            }),
                            n.ajax({
                                url: "/material/getMaterialUrlsByIds.do",
                                type: "POST",
                                dataType: "json",
                                data: {
                                    mids: e.id,
                                    w: 800
                                },
                                success: function(t) {
                                    var i = new Image;
                                    i.src = t.urls[e.id],
                                    r.find("." + s).attr({
                                        "xlink:href": i.src,
                                        "data-old": i.src
                                    })
                                },
                                error: function() {}
                            })
                        },
                        error: function() {}
                    }),
                    r.find("." + s).attr({
                        "xlink:href": "",
                        "data-old": ""
                    });
            this.xhrefImgs = {
                value: i,
                undo_drag: "noUndo"
            }
        },
        resetVary: function() {
            var t = this.getJson()
              , e = t["data-elem"]
              , i = e.viewBox
              , a = this.getSvgNode();
            a.setAttribute("viewBox", i);
            var r = n(a)
              , s = e.vary;
            for (var o in s)
                r.find("#" + o)[0].setAttribute("transform", s[o]);
            this._vary = s
        },
        resetEle: function(e) {
            this._json = e;
            var i = this.getJson()
              , a = i["data-elem"]
              , r = this.getNode()
              , o = n(r);
            r.setAttribute("opacity", a.opacity);
            var d = i.transform;
            i["group-transform"] && (d = i["group-transform"]),
            r.setAttribute("transform", t.transformScale(d, s.ZOOM_IN));
            var g = this.getContentNode();
            g.setAttribute("transform", t.transformScale(i.reverse, s.ZOOM_IN) || "");
            var h = a["data-colors"];
            for (var l in h)
                o.find("." + l).attr("fill", h[l]);
            this.getSvgNode().setAttribute("width", a.width * s.ZOOM_IN),
            this.getSvgNode().setAttribute("height", a.height * s.ZOOM_IN),
            void 0 != a.vary && this.resetVary(),
            "svgLayout" == this._svg_type && (this.setLayoutJson(),
            this.setFilterMove())
        },
        setLayoutJson: function() {
            var t, e = this.getJson(), i = e["data-elem"], a = i["data-xhref-imgs"], r = this.getSvgNode(), s = n(r);
            for (var o in a)
                if (t = a[o],
                s.find("." + o).attr({
                    "data-key": t["data-img-key"],
                    x: t.x,
                    y: t.y,
                    width: t.width,
                    height: t.height,
                    transform: "",
                    "data-x": t.x,
                    "data-y": t.y,
                    "data-width": t.width,
                    "data-height": t.height
                }),
                void 0 != t["data-img-key"]) {
                    s.find("." + o).attr({
                        "xlink:href": "//" + img_config.imgdomain + "/materials/" + t["data-img-key"] + "@120w_1x.png",
                        "data-old": "//" + img_config.imgdomain + "/materials/" + t["data-img-key"] + "@120w_1x.png"
                    });
                    var d = new Image;
                    d.src = "//" + img_config.imgdomain + "/materials/" + t["data-img-key"] + "@0e_800w_800h_0c_0i_0o_1x.png",
                    d.onload = function() {
                        s.find("." + o).attr({
                            "xlink:href": d.src,
                            "data-old": d.src
                        })
                    }
                } else
                    s.find("." + o).attr({
                        "xlink:href": "",
                        "data-old": ""
                    })
        },
        setLayout: function() {
            for (var t = this.getNode(), e = n(t), i = e.find(".layoutImgWrap").size(), a = {}, r = 0; i > r; r++) {
                var s = e.find(".layoutImgWrap").eq(r).children();
                a[s.attr("class")] = {
                    "data-class": s.attr("class"),
                    "data-img-key": s.attr("data-key"),
                    x: s.attr("x"),
                    y: s.attr("y"),
                    width: s.attr("width"),
                    height: s.attr("height"),
                    transform: s.attr("transform"),
                    id: s.attr("data-id")
                }
            }
            this.xhrefImgs = {
                value: a
            }
        },
        getLayoutJson: function() {
            var t = this.getJson()
              , e = t["data-elem"];
            t["data-type"] = "svgFrame";
            var i = this.getNode()
              , a = n(i)
              , r = a.find(".layoutImgWrap").size();
            e["data-xhref-imgs"] = {};
            for (var s = 0; r > s; s++) {
                var o = a.find(".layoutImgWrap").eq(s).children();
                e["data-xhref-imgs"][o.attr("class")] = {
                    "data-class": o.attr("class"),
                    "data-img-key": o.attr("data-key"),
                    x: o.attr("x"),
                    y: o.attr("y"),
                    width: o.attr("width"),
                    height: o.attr("height"),
                    transform: o.attr("transform"),
                    id: o.attr("data-id")
                }
            }
        }
    },
    t.classExtend(h, i),
    h
});
;/*!/compapi/design/widgets/Chart.js*/
"use strict";
define("compapi/design/widgets/Chart", ["compapi/b", "compapi/design/widgets/Element", "components/jquery/jquery", "compapi/design/design_config", "widget/pop/pop", "widget/logreg/logreg"], function(t, e, a, i, n, r) {
    function s() {
        var t = this;
        c.call(t),
        d.call(t),
        o.call(t)
    }
    function o() {
        window.chart_shape_info_show || (window.chart_shape_info_show = function(t) {
            var e = t.target
              , i = a(e);
            i.next().css("opacity", "1"),
            i.next().next().css("opacity", "1")
        }
        ,
        window.chart_shape_info_hide = function(t) {
            var e = t.target
              , i = a(e);
            i.next().css("opacity", "0"),
            i.next().next().css("opacity", "0")
        }
        )
    }
    function d() {
        var e = this;
        e._chart_id = "chart_" + t.now();
        var a = e.getJson();
        e._dataType = a["data-type"];
        var i = a["data-elem"];
        e._width = i.width,
        e._height = i.height,
        e._viewWidth = i["view-width"],
        e._viewHeight = i["view-height"],
        e._id = i.id,
        e._viewBox = i.viewBox,
        e._data = i["chart-data"],
        e._kind = i["chart-kind"],
        e._colors = i["chart-colors"],
        e._colorsGroup = i["chart-colors-group"] || 0,
        e._title = i["chart-title"],
        e._titleShow = i["chart-titleShow"],
        e._titleColor = i["chart-titleColor"],
        e._titlePosition = i["chart-titlePosition"],
        e._axisShow = i["chart-axisShow"],
        e._axisTitleShow = i["chart-axisTitleShow"],
        e._xAxisTitle = i["chart-xAxisTitle"],
        e._yAxisTitle = i["chart-yAxisTitle"],
        e._yAxisNumMin = i["chart-yAxisNumMin"],
        e._yAxisNumMax = i["chart-yAxisNumMax"],
        e._gridShow = i["chart-gridShow"],
        e._legendShow = i["chart-legendShow"],
        e._title_top_p = {
            y: 41
        },
        e._title_bottom_p = {
            y: 550
        },
        "bar" == e._kind && (e._title_bottom_p.y = e._title_bottom_p.y + 30),
        e._origin_p = {
            x: 35,
            y: 450
        },
        e._y_axis_length = 360,
        e._x_axis_length = 430,
        e._y_axis_num_p = {
            x: 25
        },
        e._x_axis_num_p = {
            y: 474
        },
        e._y_axis_title_p = {
            x: 25,
            y: 65
        },
        e._x_axis_title_p = {
            x: 490
        },
        e._legend_block_p = {
            y: 490
        },
        e.createSvg(),
        e.createAxis(),
        e.setAxis(),
        e.createAxisTitle(),
        e.setAxisTitle(),
        e.setTitle(),
        e.setData(),
        window.DESIGN_MAKING || e.updateNode(),
        e.resetChartWH(),
        void 0 === i["chart-title-xAttr"] && e.setSvgAttrData("saveAll"),
        window.chart_add_chart = !1
    }
    function c() {
        var e = this
          , a = this.getPage()
          , i = a.getDesign();
        t.dataBinding({
            obj: e,
            prop_name: "viewWidth",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "view-width",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "viewHeight",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "view-height",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "id",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "id",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "viewBox",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "viewBox",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "data",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-data",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "kind",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-kind",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "colors",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-colors",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "colorsGroup",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-colors-group",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "title",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-title",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "titleShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-titleShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "titleColor",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-titleColor",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "titlePosition",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-titlePosition",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "axisShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axisShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "axisTitleShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axisTitleShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "xAxisTitle",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxisTitle",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "yAxisTitle",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxisTitle",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "yAxisNumMin",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxisNumMin",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "yAxisNumMax",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxisNumMax",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "gridShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-gridShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "legendShow",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legendShow",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_grid_dAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-grid-dAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_title_xAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-title-xAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_title_yAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-title-yAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_xAxis_dAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxis-dAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_yAxis_dAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxis-dAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_xAxis_xAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxis-xAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_xAxis_yAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-xAxis-yAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_yAxis_xAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxis-xAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_yAxis_yAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-yAxis-yAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_axis_scale_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axis-scale-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_axis_scale_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axis-scale-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_axis_scale_numbers",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-axis-scale-numbers",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_color_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-color-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_color_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-color-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_text_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-text-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_text_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-text-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_legend_color_block",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-legend-color-block",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_xAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-xAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_yAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-yAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_widthAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-widthAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_notCone_rect_heightAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-notCone-rect-heightAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_cone_polygon_pointsAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-cone-polygon-pointsAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_area_polygon_pointsAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-area-polygon-pointsAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_area_defs_linearGradient_idAttr",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-area-defs-linearGradient-idAttr",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_lineArea_path_dAttrs",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-lineArea-path-dAttrs",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        }),
        t.dataBinding({
            obj: e,
            prop_name: "chart_data_size",
            getFun: t.$noop,
            setFun: function(t) {
                var a = !0
                  , n = t;
                "object" == typeof t && (n = t.value,
                a = t.undo_drag),
                window.chart_add_chart || i.saveDesignAndUndo({
                    obj: e,
                    loc: "pages]" + e.getPage().getIndex() + "]elems]" + e.getIndex() + "]",
                    cLoc: "data-elem]",
                    key: "chart-data-size",
                    value: n,
                    type: "0",
                    action: "change"
                }, a)
            }
        })
    }
    var g = function(t, a, i) {
        e.call(this, t, a, i),
        s.call(this)
    };
    return g.prototype = {
        constructor: g,
        _element_type: "svgChart",
        _viewBox: "",
        _data: {},
        _kind: "",
        _title: "",
        _titlePosition: "",
        _xyShow: !0,
        _legend: !1,
        _colors: [],
        _axisMin: 0,
        _axisMax: -1,
        updateNodeAjax: null,
        _saving_drag: !1,
        _save_node_timer: null,
        _chart_grid_dAttrs: null,
        _chart_title_xAttr: null,
        _chart_title_yAttr: null,
        _chart_xAxis_dAttr: null,
        _chart_yAxis_dAtt: null,
        _chart_xAxis_xAttr: null,
        _chart_xAxis_yAttr: null,
        _chart_yAxis_xAttr: null,
        _chart_yAxis_yAttr: null,
        _chart_axis_scale_xAttrs: null,
        _chart_axis_scale_yAttrs: null,
        _chart_axis_scale_numbers: null,
        _chart_legend_color_xAttrs: null,
        _chart_legend_color_yAttrs: null,
        _chart_legend_text_xAttrs: null,
        _chart_legend_text_yAttrs: null,
        _chart_legend_color_block: 12,
        _chart_notCone_rect_xAttrs: null,
        _chart_notCone_rect_yAttrs: null,
        _chart_notCone_rect_widthAttrs: null,
        _chart_notCone_rect_heightAttrs: null,
        _chart_cone_polygon_pointsAttrs: null,
        _chart_area_polygon_pointsAttr: null,
        _chart_area_defs_linearGradient_idAttr: null,
        _chart_lineArea_path_dAttrs: null,
        _chart_data_size: null,
        createWidget: function() {
            var e = t.createSvgNode("g");
            e.setAttribute("class", "elementsSon svgSon");
            var a = t.createSvgNode("rect");
            a.setAttribute("width", "1"),
            a.setAttribute("height", "1"),
            a.setAttribute("class", "rotate-set-left"),
            a.setAttribute("opacity", "0"),
            a.setAttribute("display", "none");
            var i = t.createSvgNode("g");
            e.appendChild(i),
            e.appendChild(a);
            var n = t.createSvgNode("path");
            return n.setAttribute("class", "ant-path"),
            e.appendChild(n),
            e
        },
        getNewJson: function() {
            var e = this._json;
            e["data-type"] = this._dataType,
            e.transform = this.transform,
            e.reverse = this.reverse;
            var a = e["data-elem"];
            return a.id = "",
            a.width = this.width,
            a.height = this.height,
            a["view-width"] = this.viewWidth,
            a["view-height"] = this.viewHeight,
            a.opacity = this.opacity,
            a.viewBox = this.viewBox,
            a["chart-data"] = t.deepClone(this.data),
            a["chart-kind"] = this.kind,
            a["chart-colors"] = this.colors,
            a["chart-colors-group"] = this.colorsGroup,
            a["chart-title"] = this.title,
            a["chart-titleShow"] = this.titleShow,
            a["chart-titleColor"] = this.titleColor,
            a["chart-titlePosition"] = this.titlePosition,
            a["chart-axisShow"] = this.axisShow,
            a["chart-axisTitleShow"] = this.axisTitleShow,
            a["chart-xAxisTitle"] = this.xAxisTitle,
            a["chart-yAxisTitle"] = this.yAxisTitle,
            a["chart-yAxisNumMin"] = this.yAxisNumMin,
            a["chart-xAxisNumMax"] = this.xAxisNumMax,
            a["chart-gridShow"] = this.gridShow,
            a["chart-legendShow"] = this.legendShow,
            a["chart-grid-dAttrs"] = this.chart_grid_dAttrs || a["chart-grid-dAttrs"],
            a["chart-title-xAttr"] = this.chart_title_xAttr || a["chart-title-xAttr"],
            a["chart-title-yAttr"] = this.chart_title_yAttr || a["chart-title-yAttr"],
            a["chart-xAxis-dAttr"] = this.chart_xAxis_dAttr || a["chart-xAxis-dAttr"],
            a["chart-yAxis-dAttr"] = this.chart_yAxis_dAttr || a["chart-yAxis-dAttr"],
            a["chart-xAxis-xAttr"] = this.chart_xAxis_xAttr || a["chart-xAxis-xAttr"],
            a["chart-xAxis-yAttr"] = this.chart_xAxis_yAttr || a["chart-xAxis-yAttr"],
            a["chart-yAxis-xAttr"] = this.chart_yAxis_xAttr || a["chart-yAxis-xAttr"],
            a["chart-yAxis-yAttr"] = this.chart_yAxis_yAttr || a["chart-yAxis-yAttr"],
            a["chart-axis-scale-xAttrs"] = this.chart_axis_scale_xAttrs || a["chart-axis-scale-xAttrs"],
            a["chart-axis-scale-yAttrs"] = this.chart_axis_scale_yAttrs || a["chart-axis-scale-yAttrs"],
            a["chart-axis-scale-numbers"] = this.chart_axis_scale_numbers || a["chart-axis-scale-numbers"],
            a["chart-legend-color-xAttrs"] = this.chart_legend_color_xAttrs || a["chart-legend-color-xAttrs"],
            a["chart-legend-color-yAttrs"] = this.chart_legend_color_yAttrs || a["chart-legend-color-yAttrs"],
            a["chart-legend-text-xAttrs"] = this.chart_legend_text_xAttrs || a["chart-legend-text-xAttrs"],
            a["chart-legend-text-yAttrs"] = this.chart_legend_text_yAttrs || a["chart-legend-text-yAttrs"],
            a["chart-legend-color-block"] = this.chart_legend_color_block || a["chart-legend-color-block"],
            a["chart-notCone-rect-xAttrs"] = this.chart_notCone_rect_xAttrs || a["chart-notCone-rect-xAttrs"],
            a["chart-notCone-rect-yAttrs"] = this.chart_notCone_rect_yAttrs || a["chart-notCone-rect-yAttrs"],
            a["chart-notCone-rect-widthAttrs"] = this.chart_notCone_rect_widthAttrs || a["chart-notCone-rect-widthAttrs"],
            a["chart-notCone-rect-heightAttrs"] = this.chart_notCone_rect_heightAttrs || a["chart-notCone-rect-heightAttrs"],
            a["chart-cone-polygon-pointsAttrs"] = this.chart_cone_polygon_pointsAttrs || a["chart-cone-polygon-pointsAttrs"],
            a["chart-area-polygon-pointsAttr"] = this.chart_area_polygon_pointsAttr || a["chart-area-polygon-pointsAttr"],
            a["chart-area-defs-linearGradient-idAttr"] = this.chart_area_defs_linearGradient_idAttr || a["chart-area-defs-linearGradient-idAttr"],
            a["chart-lineArea-path-dAttrs"] = this.chart_lineArea_path_dAttrs || a["chart-lineArea-path-dAttrs"],
            a["chart-data-size"] = this.chart_data_size || a["chart-data-size"],
            JSON.parse(JSON.stringify(e))
        },
        getPosition: function() {
            var t = this.getRect()
              , e = this.getPage()
              , a = e.getRect()
              , i = e.getDesign().pageScale;
            return [(parseFloat(t.left) - parseFloat(a.left)) / i, (parseFloat(t.top) - parseFloat(a.top)) / i]
        },
        nodeDblclick: function() {
            this.nodeClick(),
            a("#chartDataEnterBtn").click()
        },
        getChartWrap: function() {
            var t = this.getNode();
            return t.childNodes[0]
        },
        getSvgNode: function() {
            var t = this.getNode()
              , e = a(t);
            return e.find("svg")[0]
        },
        getRealWidth: function() {
            var t = this.getNode();
            return t.getBBox().width
        },
        getRealHeight: function() {
            var t = this.getNode();
            return t.getBBox().height
        },
        getShowWidth: function() {
            return this.getRealWidth() / i.ZOOM_IN
        },
        getShowHeight: function() {
            return this.getRealHeight() / i.ZOOM_IN
        },
        getContentNode: function() {
            return this.getNode().firstChild
        },
        getChartData: function() {
            for (var e = t.deepClone(this.data), a = [], i = 0; i < e.length; i++)
                null != e[i][0] && "" != e[i][0] && (null != e[i][1] && "" != e[i][1] ? a.push(e[i]) : (e[i][1] = "0",
                a.push(e[i])));
            return a
        },
        previewWH: function(e, a) {
            e *= i.ZOOM_IN,
            a *= i.ZOOM_IN;
            var n = (this.getNode(),
            this.getSvgNode());
            n.setAttribute("width", e),
            n.setAttribute("height", a);
            var r = this.getJson()
              , s = this.getContentNode()
              , o = t.getTransformAttr(r.reverse, "translate");
            0 != o[0] && (o[0] = -e),
            0 != o[1] && (o[1] = -a);
            var d = r.reverse;
            d = t.setTransformAttr(d, "translate", o),
            s.setAttribute("transform", d || "")
        },
        resetWH: function() {
            var t = this.getShowWidth()
              , e = this.getShowHeight();
            this.width = t,
            this.height = e,
            this.updateNode()
        },
        resetChartBox: function() {
            var t = this.getSvgNode()
              , e = t.getBBox()
              , a = e.x + " " + e.y + " " + e.width + " " + e.height;
            this.viewBox = a,
            t.setAttribute("viewBox", this.viewBox)
        },
        resetChartWH: function() {
            var t = this.getChartWrap()
              , e = this.getSvgNode()
              , a = t.getBBox();
            this._width = a.width / i.ZOOM_IN,
            this._height = a.height / i.ZOOM_IN,
            e.setAttribute("width", this.width * i.ZOOM_IN),
            e.setAttribute("height", this.height * i.ZOOM_IN);
            var n = e.getBBox()
              , r = n.x + " " + n.y + " " + n.width + " " + n.height;
            this._viewBox = r,
            e.setAttribute("viewBox", this.viewBox)
        },
        undoWidth: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("width", t * i.ZOOM_IN),
            this.width = {
                value: t,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        undoHeight: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("height", t * i.ZOOM_IN),
            this.height = {
                value: t,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        undoReverse: function(e) {
            var a = this.getSvgNode();
            a.setAttribute("transform", t.transformScale(e, i.ZOOM_IN)),
            this.reverse = {
                value: e,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        undoChartData: function(t) {
            this.data = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setData(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("legend"),
            this.setSvgAttrData("chartKind"),
            this.setSvgAttrData("dataSize")
        },
        undoChartKind: function(t) {
            this.kind = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setData(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("legend"),
            this.setSvgAttrData("chartKind")
        },
        undoChartColors: function(t) {
            this.colors = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setData(),
            this.showCustomColors(),
            this.updateNode()
        },
        undoChartTitle: function(t) {
            this.title = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode()
        },
        undoChartTitleShow: function(t) {
            this.titleShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode(),
            this.setSvgAttrData("title")
        },
        undoChartTitleColor: function(t) {
            this.titleColor = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode()
        },
        undoChartTitlePosition: function(t) {
            this.titlePosition = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setTitle(),
            this.updateNode(),
            this.setSvgAttrData("title")
        },
        undoChartAxisShow: function(t) {
            this.axisShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxis(),
            this.updateNode(),
            this.setSvgAttrData("axis")
        },
        undoChartAxisTitleShow: function(t) {
            this.axisTitleShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxisTitle(),
            this.updateNode(),
            this.setSvgAttrData("axisTitle")
        },
        undoChartXAxisTitle: function(t) {
            this.xAxisTitle = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxisTitle(),
            this.updateNode(),
            this.setSvgAttrData("axisTitle")
        },
        undoChartYAxisTitle: function(t) {
            this.yAxisTitle = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setAxisTitle(),
            this.updateNode()
        },
        undoChartYAxisNumMin: function(t) {
            this.yAxisNumMin = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setYAxisNumAndGrid(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("chartKind")
        },
        undoChartXAxisNumMax: function(t) {
            this.yAxisNumMax = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setYAxisNumAndGrid(),
            this.updateNode(),
            this.setSvgAttrData("axisScale"),
            this.setSvgAttrData("chartKind")
        },
        undoChartGridShow: function(t) {
            this.gridShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setGrid(),
            this.updateNode(),
            this.setSvgAttrData("grid")
        },
        undoChartLegendShow: function(t) {
            this.legendShow = {
                value: t,
                undo_drag: "noUndo"
            },
            this.setLegend(),
            this.updateNode(),
            this.setSvgAttrData("legend")
        },
        undoViewBox: function(t) {
            var e = this.getSvgNode();
            e.setAttribute("viewBox", t),
            this.viewBox = {
                value: t,
                undo_drag: "noUndo"
            },
            this.updateNode()
        },
        setSvgAttrData: function(t) {
            var e = this;
            switch (t) {
            case "grid":
                e.saveGridData();
                break;
            case "title":
                e.saveTitleData();
                break;
            case "axis":
                e.saveAxisData();
                break;
            case "axisTitle":
                e.saveAxisTilteData();
                break;
            case "axisScale":
                e.saveAxisScaleData();
                break;
            case "legend":
                e.saveLegendData();
                break;
            case "dataSize":
                e.saveDataSizeData();
                break;
            case "chartKind":
                e.saveRectData(),
                e.saveConeData(),
                e.saveLineAndAreaData(),
                e.saveAreaData();
                break;
            case "saveAll":
                e.saveGridData(),
                e.saveTitleData(),
                e.saveAxisData(),
                e.saveAxisTilteData(),
                e.saveAxisScaleData(),
                e.saveLegendData(),
                e.saveRectData(),
                e.saveConeData(),
                e.saveLineAndAreaData(),
                e.saveAreaData(),
                e.saveDataSizeData()
            }
        },
        saveGridData: function() {
            var t = this;
            if (!t.gridShow)
                return void (t.chart_grid_dAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".yAxisGrid"), r = n.size(), s = [], o = 0; r > o; o++)
                s.push(n.eq(o).attr("d"));
            t.chart_grid_dAttrs = {
                value: s,
                undo_drag: "noUndo"
            }
        },
        saveTitleData: function() {
            var t = this;
            if (!t.titleShow)
                return t.chart_title_xAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_title_yAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e, i = t.getNode(), n = a(i);
            e = n.find("top" == t.titlePosition ? ".svgChartTitleTop" : ".svgChartTitleBottom"),
            t.chart_title_xAttr = {
                value: e.attr("x"),
                undo_drag: "noUndo"
            },
            t.chart_title_yAttr = {
                value: e.attr("y"),
                undo_drag: "noUndo"
            }
        },
        saveAxisData: function() {
            var t = this;
            if (!t.axisShow)
                return t.chart_xAxis_dAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_yAxis_dAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e = t.getNode()
              , i = a(e)
              , n = i.find(".svgXAxis")
              , r = i.find(".svgYAxis");
            t.chart_xAxis_dAttr = {
                value: n.attr("d"),
                undo_drag: "noUndo"
            },
            t.chart_yAxis_dAttr = {
                value: r.attr("d"),
                undo_drag: "noUndo"
            }
        },
        saveAxisTilteData: function() {
            var t = this;
            if (!t.axisTitleShow)
                return t.chart_xAxis_xAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_xAxis_yAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_yAxis_xAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_yAxis_yAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e = t.getNode()
              , i = a(e)
              , n = i.find(".xAxisTitle").children()
              , r = i.find(".yAxisTitle");
            t.chart_xAxis_xAttr = {
                value: n.attr("x"),
                undo_drag: "noUndo"
            },
            t.chart_xAxis_yAttr = {
                value: n.attr("y"),
                undo_drag: "noUndo"
            },
            t.chart_yAxis_xAttr = {
                value: r.attr("x"),
                undo_drag: "noUndo"
            },
            t.chart_yAxis_yAttr = {
                value: r.attr("y"),
                undo_drag: "noUndo"
            }
        },
        saveAxisScaleData: function() {
            var t = this;
            if (!t.axisShow)
                return t.chart_axis_scale_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_axis_scale_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_axis_scale_numbers = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".yAxisNum"), r = n.size(), s = "", o = "", d = "", c = "", g = 0; r > g; g++)
                s = s + c + n.eq(g).attr("x"),
                o = o + c + n.eq(g).attr("y"),
                d = d + c + n.eq(g).children().text(),
                c = " ";
            t.chart_axis_scale_xAttrs = {
                value: s,
                undo_drag: "noUndo"
            },
            t.chart_axis_scale_yAttrs = {
                value: o,
                undo_drag: "noUndo"
            },
            t.chart_axis_scale_numbers = {
                value: d,
                undo_drag: "noUndo"
            }
        },
        saveLegendData: function() {
            var t = this;
            if (!t.legendShow)
                return t.chart_legend_color_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_legend_color_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_legend_text_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_legend_text_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".legendColor"), r = i.find(".legendText"), s = n.size(), o = "", d = "", c = "", g = "", u = "", h = 0; s > h; h++)
                o = o + u + n.eq(h).attr("x"),
                d = d + u + n.eq(h).attr("y"),
                c = c + u + r.eq(h).attr("x"),
                g = g + u + r.eq(h).attr("y"),
                u = " ";
            t.chart_legend_color_xAttrs = {
                value: o,
                undo_drag: "noUndo"
            },
            t.chart_legend_color_yAttrs = {
                value: d,
                undo_drag: "noUndo"
            },
            t.chart_legend_text_xAttrs = {
                value: c,
                undo_drag: "noUndo"
            },
            t.chart_legend_text_yAttrs = {
                value: g,
                undo_drag: "noUndo"
            },
            t.chart_legend_color_block = {
                value: 12,
                undo_drag: "noUndo"
            }
        },
        saveDataSizeData: function() {
            for (var t = this, e = t.getChartData(), a = e.length, i = 0, n = 0; a > n && (null != e[n][1] && "" != e[n][1]); n++)
                i++;
            t.chart_data_size = {
                value: i,
                undo_drag: "noUndo"
            }
        },
        saveRectData: function() {
            var t = this;
            if ("histogram" != t.kind && "bar" != t.kind && "line" != t.kind && "area" != t.kind)
                return t.chart_notCone_rect_xAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_notCone_rect_yAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                t.chart_notCone_rect_widthAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_notCone_rect_heightAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".svgChartData"), r = n.size(), s = "", o = "", d = "", c = "", g = "", u = 0; r > u; u++)
                s = s + g + n.eq(u).attr("x"),
                o = o + g + n.eq(u).attr("y"),
                d = d + g + n.eq(u).attr("width"),
                c = c + g + n.eq(u).attr("height"),
                g = " ";
            t.chart_notCone_rect_xAttrs = {
                value: s,
                undo_drag: "noUndo"
            },
            t.chart_notCone_rect_yAttrs = {
                value: o,
                undo_drag: "noUndo"
            },
            t.chart_notCone_rect_widthAttrs = {
                value: d,
                undo_drag: "noUndo"
            },
            t.chart_notCone_rect_heightAttrs = {
                value: c,
                undo_drag: "noUndo"
            }
        },
        saveConeData: function() {
            var t = this;
            if ("cone" != t.kind)
                return void (t.chart_cone_polygon_pointsAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".svgChartData"), r = n.size(), s = [], o = 0; r > o; o++)
                s.push(n.eq(o).attr("points"));
            t.chart_cone_polygon_pointsAttrs = {
                value: s,
                undo_drag: "noUndo"
            }
        },
        saveLineAndAreaData: function() {
            var t = this;
            if ("line" != t.kind && "area" != t.kind)
                return void (t.chart_lineArea_path_dAttrs = {
                    value: null,
                    undo_drag: "noUndo"
                });
            for (var e = t.getNode(), i = a(e), n = i.find(".svgChartDataLine"), r = n.size(), s = "", o = "", d = 0; r > d; d++)
                s = s + o + n.eq(d).attr("d"),
                o = " ";
            t.chart_lineArea_path_dAttrs = {
                value: s,
                undo_drag: "noUndo"
            }
        },
        saveAreaData: function() {
            var t = this;
            if ("area" != t.kind)
                return t.chart_area_polygon_pointsAttr = {
                    value: null,
                    undo_drag: "noUndo"
                },
                void (t.chart_area_defs_linearGradient_idAttr = {
                    value: null,
                    undo_drag: "noUndo"
                });
            var e = t.getNode()
              , i = a(e)
              , n = i.find(".svgChartDataArea")
              , r = i.find("linearGradient");
            t.chart_area_polygon_pointsAttr = {
                value: n.attr("points"),
                undo_drag: "noUndo"
            },
            t.chart_area_defs_linearGradient_idAttr = {
                value: r.attr("id"),
                undo_drag: "noUndo"
            }
        },
        setYAxisNumMax: function(e) {
            if (e <= this.yAxisNumMin)
                return n.back({
                    str: "最大值不能比最小值 更小！",
                    kind: "warning"
                }),
                !1;
            for (var a = this, i = a.getChartData(), r = i.length, s = Number.POSITIVE_INFINITY, o = 0; r > o; o++)
                null != i[o][0] && null != i[o][1] && (s = Math.min(s, parseFloat(i[o][1])));
            return s >= e ? (n.back({
                str: "坐标轴最大值不能比图表已有的最小数据 更小！",
                kind: "warning"
            }),
            !1) : (window.MEMENTO_ID = t.now(),
            a.yAxisNumMax = e,
            a.setData(),
            a.updateNodeAndUndo(),
            !0)
        },
        setYAxisNumMin: function(e) {
            if (e >= this.yAxisNumMax)
                return n.back({
                    str: "最小值不能比最大值 更大！",
                    kind: "warning"
                }),
                !1;
            for (var a = this, i = a.getChartData(), r = i.length, s = 0, o = 0; r > o; o++)
                null != i[o][0] && null != i[o][1] && (s = Math.max(s, parseFloat(i[o][1])));
            return e >= s ? (n.back({
                str: "坐标轴最小值不能比图表已有的最大数据 更大！",
                kind: "warning"
            }),
            !1) : (window.MEMENTO_ID = t.now(),
            a.yAxisNumMin = e,
            a.setData(),
            a.updateNodeAndUndo(),
            !0)
        },
        getYAxisAverage: function() {
            var t, e, a = this, i = 0, n = a.getMaxNum();
            return e = n.max_num,
            a.yAxisNumMax > 0 && (e = a.yAxisNumMax),
            a.yAxisNumMin > 0 && (i = a.yAxisNumMin),
            t = a._y_axis_length / (e - i)
        },
        getXAxisAverage: function() {
            var t, e, a = this, i = 0, n = a.getMaxNum();
            return e = n.max_num,
            a.yAxisNumMax > 0 && (e = a.yAxisNumMax),
            a.yAxisNumMin > 0 && (i = a.yAxisNumMin),
            t = a._x_axis_length / (e - i)
        },
        showStrokeByIndex: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find(".svgChartData").eq(t);
            r[0].setAttribute("class", r.attr("class") + " svgChartDataStroke")
        },
        hideStroke: function() {
            var t = this
              , e = t.getNode()
              , i = a(e);
            i.find(".svgChartDataStroke")[0].setAttribute("class", "svgChartData")
        },
        getMaxNum: function() {
            for (var t = this, e = t.getChartData(), a = 0, i = e.length, n = 0, r = 0; i > r && (null != e[r][1] && "" != e[r][1]); r++)
                n++,
                a = Math.max(a, parseFloat(e[r][1]));
            if (t.yAxisNumMax > 0 && (a = t.yAxisNumMax),
            10 >= a)
                return {
                    max_num: a,
                    space_num: 1,
                    rlength: n
                };
            var s, o = parseInt(a).toString(), d = o.length, c = o[0], g = o[1];
            if (4 > c && 9 >= g) {
                var u = 5 * parseInt((c + g) / 5) * Math.pow(10, d - 2);
                a > u && (u = (5 * parseInt((c + g) / 5) + 5) * Math.pow(10, d - 2)),
                s = {
                    max_num: u,
                    space_num: 5 * Math.pow(10, d - 2)
                }
            } else {
                var u = parseInt(c) * Math.pow(10, d - 1);
                a > u && (u = (parseInt(c) + 1) * Math.pow(10, d - 1)),
                s = {
                    max_num: u,
                    space_num: Math.pow(10, d - 1)
                }
            }
            return s.rlength = n,
            s
        },
        chartSetColors: function(e) {
            var i = this
              , n = a("#chartColors")
              , r = n.attr("data-colors");
            r = r.split(",");
            var s;
            if (n.hasClass("chart-no-click"))
                s = [t.colorHex(a(".customChartColorsSpan").eq(0).css("background-color"))];
            else {
                var o, d = r.length;
                s = [];
                for (var c = 0; c < e.rlength; c++)
                    o = c % d,
                    s[c] = r[o]
            }
            i.colors = {
                value: s,
                undo_drag: !0
            },
            i.showCustomColors()
        },
        showCustomColors: function() {
            var t = this
              , e = a("#customChartColors")
              , i = t.colors
              , n = i.length;
            e.children().detach();
            for (var r = 0; n > r; r++) {
                var s = a('<span class="customChartColorsSpan" style="background-color:' + i[r] + '"></span>');
                s.appendTo(e)
            }
        },
        createSvg: function() {
            var t = this
              , e = t.getNode()
              , n = a(e);
            n.addClass("svgChart");
            var r = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            r.setAttribute("x", "0px"),
            r.setAttribute("y", "0px"),
            r.setAttribute("version", "1.1"),
            r.setAttribute("xmlns", "http://www.w3.org/2000/svg"),
            r.setAttribute("xmlns:xlink", "http://www.w3.org/1999/xlink"),
            r.setAttribute("viewBox", t.viewBox),
            r.setAttribute("width", t.width * i.ZOOM_IN),
            r.setAttribute("height", t.height * i.ZOOM_IN),
            n.find("g").append(r);
            var s = document.createElementNS("http://www.w3.org/2000/svg", "text");
            s.setAttribute("text-anchor", "middle"),
            s.setAttribute("x", t.viewWidth / 2),
            s.setAttribute("y", t._title_top_p.y),
            s.setAttribute("fill", "#808284"),
            s.setAttribute("font-size", "18px"),
            s.setAttribute("class", "svgChartTitle svgChartTitleTop"),
            s.setAttribute("text-rendering", "geometricPrecision");
            var o = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            o.innerHTML = t.title,
            s.appendChild(o),
            r.appendChild(s);
            var d = document.createElementNS("http://www.w3.org/2000/svg", "text");
            d.setAttribute("text-anchor", "middle"),
            d.setAttribute("x", t.viewWidth / 2),
            d.setAttribute("y", t._title_bottom_p.y),
            d.setAttribute("fill", "#808284"),
            d.setAttribute("font-size", "18px"),
            d.setAttribute("class", "svgChartTitle svgChartTitleBottom"),
            d.setAttribute("text-rendering", "geometricPrecision");
            var c = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            c.innerHTML = t.title,
            d.appendChild(c),
            r.appendChild(d)
        },
        setTitle: function() {
            var t, e, i = this, n = i.getNode(), r = a(n), s = "1";
            t = r.find("top" == i.titlePosition ? ".svgChartTitleTop" : ".svgChartTitleBottom"),
            r.find(".svgChartTitle").css("opacity", "0"),
            e = i.title,
            "" == e && (e = "默认标题",
            s = "0"),
            i.titleShow && t.css({
                opacity: s
            }).attr("fill", i.titleColor).children().html(e)
        },
        createAxis: function() {
            var t = this
              , e = t.getSvgNode()
              , a = document.createElementNS("http://www.w3.org/2000/svg", "path");
            a.setAttribute("fill", "none"),
            a.setAttribute("stroke", "#94979B");
            var i = parseFloat(t._origin_p.x) + parseFloat(t._x_axis_length);
            a.setAttribute("d", "M" + t._origin_p.x + "," + t._origin_p.y + "L" + i + "," + t._origin_p.y),
            a.setAttribute("class", "svgXAxis"),
            e.appendChild(a);
            var n = document.createElementNS("http://www.w3.org/2000/svg", "path");
            n.setAttribute("fill", "none"),
            n.setAttribute("stroke", "#94979B");
            var r = parseFloat(t._origin_p.y) - parseFloat(t._y_axis_length);
            n.setAttribute("d", "M" + t._origin_p.x + "," + t._origin_p.y + "L" + t._origin_p.x + "," + r),
            n.setAttribute("class", "svgYAxis"),
            e.appendChild(n)
        },
        setAxis: function() {
            var t = this
              , e = t.getNode()
              , i = a(e)
              , n = i.find("svg");
            t.axisShow ? n.find(".svgXAxis, .svgYAxis, .yAxisNum").css("opacity", "1") : n.find(".svgXAxis, .svgYAxis, .yAxisNum").css("opacity", "0")
        },
        setGrid: function() {
            var t = this
              , e = t.getNode()
              , i = a(e)
              , n = i.find("svg");
            t.axisShow ? n.find(".yAxisGrid").css("opacity", "1") : n.find(".yAxisGrid").css("opacity", "0")
        },
        createAxisTitle: function() {
            var t = this
              , e = t.getSvgNode()
              , a = document.createElementNS("http://www.w3.org/2000/svg", "text");
            a.setAttribute("text-anchor", "middle"),
            a.setAttribute("x", t._origin_p.x),
            a.setAttribute("y", t._y_axis_title_p.y),
            a.setAttribute("fill", "#808284"),
            a.setAttribute("font-size", "14px"),
            a.setAttribute("text-rendering", "geometricPrecision"),
            a.setAttribute("class", "yAxisTitle");
            var i = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            i.innerHTML = t.yAxisTitle,
            a.appendChild(i),
            e.appendChild(a);
            var n = t.xAxisTitle.length
              , r = document.createElementNS("http://www.w3.org/2000/svg", "text");
            r.setAttribute("fill", "#808284"),
            r.setAttribute("font-size", "14px"),
            r.setAttribute("text-rendering", "geometricPrecision"),
            r.setAttribute("class", "xAxisTitle"),
            r.setAttribute("style", "writing-mode: tb;text-orientation: upright;");
            var s, s = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            s.setAttribute("x", t._x_axis_title_p.x),
            s.setAttribute("y", t._origin_p.y - 16 * n / 2),
            s.innerHTML = t.xAxisTitle,
            r.appendChild(s),
            e.appendChild(r)
        },
        setAxisTitle: function() {
            var t = this
              , e = t.getSvgNode()
              , i = a(e);
            t.axisTitleShow ? (i.find(".yAxisTitle").css({
                display: "block",
                opacity: "1"
            }).children("tspan")[0].innerHTML = t.yAxisTitle,
            i.find(".xAxisTitle").css({
                display: "block",
                opacity: "1"
            }).children("tspan")[0].innerHTML = t.xAxisTitle,
            i.find(".xAxisTitle").children("tspan").attr("y", t._origin_p.y - 16 * t.xAxisTitle.length / 2)) : i.find(".xAxisTitle, .yAxisTitle").css("opacity", "0")
        },
        setLegend: function() {
            var t = this
              , e = t.getNode()
              , i = a(e)
              , n = t.getMaxNum();
            if (t.legendShow) {
                i.find(".legendColor").detach(),
                i.find(".legendText").detach();
                var r = 12
                  , s = 16
                  , o = 4
                  , d = i.find("svg")
                  , c = t.viewWidth - 20
                  , g = (t.viewHeight,
                a('<span id="test_text"></span>'));
                g.css({
                    opacity: 0,
                    "font-size": "14px"
                }).appendTo(a("body"));
                for (var u, h = t.getChartData(), l = 0, _ = [0], x = [0], A = 0; A < n.rlength; A++)
                    g.html(h[A][0]),
                    u = 0 == A ? s + a("#test_text").getWidth() + o : s + a("#test_text").getWidth() + r + o,
                    _[l] = u + _[l],
                    x[l] = A,
                    _[l] > c && (_[l] = _[l] - u,
                    x[l] = A - 1,
                    l++,
                    _[l] = s + a("#test_text").getWidth() + o,
                    x[l] = A);
                var p, v, y = x.length;
                v = "bar" == t.kind ? t._legend_block_p.y + 30 : t._legend_block_p.y;
                for (var m, l = 0, b = t.colors, A = 0; y > A; A++)
                    for (p = (c - _[A]) / 2 + 10; l < x[A] + 1; l++) {
                        var w = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                        w.setAttribute("y", v + 26 * A),
                        g.html(h[l][0]);
                        var f = a("#test_text").getWidth();
                        m = 1 == b.length ? b[0] : b[l],
                        w.setAttribute("x", p),
                        w.setAttribute("width", s),
                        w.setAttribute("height", s),
                        w.setAttribute("fill", m),
                        w.setAttribute("class", "legendColor"),
                        d[0].appendChild(w);
                        var N = document.createElementNS("http://www.w3.org/2000/svg", "text");
                        N.setAttribute("text-anchor", "start"),
                        N.setAttribute("x", p + s + o),
                        N.setAttribute("y", v + 26 * A + 14),
                        N.setAttribute("fill", "#808284"),
                        N.setAttribute("font-size", "14px"),
                        N.setAttribute("text-rendering", "geometricPrecision"),
                        N.setAttribute("class", "legendText");
                        var C = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        C.innerHTML = h[l][0],
                        N.appendChild(C),
                        d[0].appendChild(N),
                        p = p + s + f + r + o
                    }
                a("#test_text").detach()
            } else
                i.find(".legendColor").css("opacity", "0"),
                i.find(".legendText").css("opacity", "0")
        },
        setYAxisNumAndGrid: function() {
            var t = this;
            if ("bar" == t.kind)
                return void t.setYAxisNumAndGridVertical();
            var e = t.getNode()
              , i = a(e);
            i.find(".yAxisNum").detach(),
            i.find(".yAxisGrid").detach();
            for (var n, r = i.find("svg"), s = t.getMaxNum(), o = t.getYAxisAverage(), d = 0 - s.space_num; d < s.max_num; )
                if (d += s.space_num,
                !(d < t.yAxisNumMin)) {
                    if (t.yAxisNumMax >= 0 && d > t.yAxisNumMax)
                        break;
                    if (!(t._yAxisNumMin > 0 && d - t.yAxisNumMin > 0 && d - t.yAxisNumMin < .3 * s.space_num || t.yAxisNumMax > 0 && t.yAxisNumMax - d > 0 && t.yAxisNumMax - d < .3 * s.space_num)) {
                        n = t._yAxisNumMin > 0 ? t._origin_p.y - o * (d - t._yAxisNumMin) : t._origin_p.y - o * d;
                        var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                        c.setAttribute("text-anchor", "end"),
                        c.setAttribute("x", t._y_axis_num_p.x),
                        c.setAttribute("y", n),
                        c.setAttribute("fill", "#808284"),
                        c.setAttribute("font-size", "14px"),
                        c.setAttribute("text-rendering", "geometricPrecision"),
                        c.setAttribute("class", "yAxisNum");
                        var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        g.setAttribute("dy", "4"),
                        g.innerHTML = d,
                        c.appendChild(g),
                        r[0].appendChild(c);
                        var u = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        u.setAttribute("fill", "none"),
                        u.setAttribute("stroke", "#E7E7E7");
                        var h = parseFloat(t._origin_p.x) + parseFloat(t._x_axis_length);
                        u.setAttribute("d", "M" + t._origin_p.x + "," + n + "L" + h + "," + n),
                        u.setAttribute("stroke-dasharray", "4,3"),
                        u.setAttribute("class", "yAxisGrid"),
                        r[0].insertBefore(u, r[0].childNodes[0])
                    }
                }
            if (t._yAxisNumMin > 0) {
                n = t._origin_p.y;
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "end"),
                c.setAttribute("x", t._y_axis_num_p.x),
                c.setAttribute("y", n),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = t._yAxisNumMin,
                c.appendChild(g),
                r[0].appendChild(c)
            }
            if (t._yAxisNumMax > 0 && t._yAxisNumMax != s.max_num) {
                n = t._origin_p.y - o * (t._yAxisNumMax - t._yAxisNumMin);
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "end"),
                c.setAttribute("x", t._y_axis_num_p.x),
                c.setAttribute("y", n),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = t._yAxisNumMax,
                c.appendChild(g),
                r[0].appendChild(c)
            }
            if (t._yAxisNumMax > 0 && t._yAxisNumMax != s.max_num) {
                n = t._origin_p.y - o * (t._yAxisNumMax - t._yAxisNumMin);
                var u = document.createElementNS("http://www.w3.org/2000/svg", "path");
                u.setAttribute("fill", "none"),
                u.setAttribute("stroke", "#E7E7E7");
                var h = parseFloat(t._origin_p.x) + parseFloat(t._x_axis_length);
                u.setAttribute("d", "M" + t._origin_p.x + "," + n + "L" + h + "," + n),
                u.setAttribute("stroke-dasharray", "4,3"),
                u.setAttribute("class", "yAxisGrid"),
                r[0].insertBefore(u, r[0].childNodes[0])
            }
            t.axisShow || r.find(".yAxisNum").css("opacity", "0"),
            t.gridShow || r.find(".yAxisGrid").css("opacity", "0")
        },
        setYAxisNumAndGridVertical: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i);
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            for (var r, s = n.find("svg"), t = e.getMaxNum(), o = e.getXAxisAverage(), d = 0 - t.space_num; d < t.max_num; )
                if (d += t.space_num,
                !(d < e.yAxisNumMin)) {
                    if (e.yAxisNumMax > 0 && d > e.yAxisNumMax)
                        break;
                    if (!(e._yAxisNumMin > 0 && d - e.yAxisNumMin > 0 && d - e.yAxisNumMin < .3 * t.space_num || e.yAxisNumMax > 0 && e.yAxisNumMax - d > 0 && e.yAxisNumMax - d < .3 * t.space_num)) {
                        r = e._yAxisNumMin > 0 ? e._origin_p.x + o * (d - e._yAxisNumMin) : e._origin_p.x + o * d;
                        var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                        c.setAttribute("text-anchor", "middle"),
                        c.setAttribute("x", r),
                        c.setAttribute("y", e._x_axis_num_p.y),
                        c.setAttribute("fill", "#808284"),
                        c.setAttribute("font-size", "14px"),
                        c.setAttribute("text-rendering", "geometricPrecision"),
                        c.setAttribute("class", "yAxisNum");
                        var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        g.setAttribute("dy", "4"),
                        g.innerHTML = d,
                        c.appendChild(g),
                        s[0].appendChild(c);
                        var u = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        u.setAttribute("fill", "none"),
                        u.setAttribute("stroke", "#E7E7E7");
                        var h = (parseFloat(e._origin_p.x) + parseFloat(e._x_axis_length),
                        e._origin_p.y - e._y_axis_length);
                        u.setAttribute("d", "M" + r + "," + e._origin_p.y + "L" + r + "," + h),
                        u.setAttribute("stroke-dasharray", "4,3"),
                        u.setAttribute("class", "yAxisGrid"),
                        s[0].insertBefore(u, s[0].childNodes[0])
                    }
                }
            if (e._yAxisNumMin > 0) {
                r = e._origin_p.x;
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "middle"),
                c.setAttribute("x", r),
                c.setAttribute("y", e._x_axis_num_p.y),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = e._yAxisNumMin,
                c.appendChild(g),
                s[0].appendChild(c)
            }
            if (e._yAxisNumMax > 0 && e._yAxisNumMax != t.max_num) {
                r = e._origin_p.x + o * (e._yAxisNumMax - e._yAxisNumMin);
                var c = document.createElementNS("http://www.w3.org/2000/svg", "text");
                c.setAttribute("text-anchor", "middle"),
                c.setAttribute("x", r),
                c.setAttribute("y", e._x_axis_num_p.y),
                c.setAttribute("fill", "#808284"),
                c.setAttribute("font-size", "14px"),
                c.setAttribute("text-rendering", "geometricPrecision"),
                c.setAttribute("class", "yAxisNum");
                var g = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                g.setAttribute("dy", "4"),
                g.innerHTML = e._yAxisNumMax,
                c.appendChild(g),
                s[0].appendChild(c)
            }
            if (e._yAxisNumMax > 0 && e._yAxisNumMax != t.max_num) {
                r = e._origin_p.x + o * (e._yAxisNumMax - e._yAxisNumMin);
                var u = document.createElementNS("http://www.w3.org/2000/svg", "path");
                u.setAttribute("fill", "none"),
                u.setAttribute("stroke", "#E7E7E7");
                var h = (parseFloat(e._origin_p.x) + parseFloat(e._x_axis_length),
                e._origin_p.y - e._y_axis_length);
                u.setAttribute("d", "M" + r + "," + e._origin_p.y + "L" + r + "," + h),
                u.setAttribute("stroke-dasharray", "4,3"),
                u.setAttribute("class", "yAxisGrid"),
                s[0].insertBefore(u, s[0].childNodes[0])
            }
            e.axisShow || s.find(".yAxisNum").css("opacity", "0"),
            e.gridShow || s.find(".yAxisGrid").css("opacity", "0")
        },
        setHistogramData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setLegend(o),
            e.setYAxisNumAndGrid();
            for (var d, c, g, u, h = e._x_axis_length / (o.rlength + 2 + (o.rlength - 1) / 3), l = e.colors, _ = e.getYAxisAverage(), x = 0; x < o.rlength; x++) {
                var A = parseFloat(s[x][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < A && (A = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (A -= e.yAxisNumMin),
                0 > A && (A = 0),
                d = _ * A,
                g = e._origin_p.y - d,
                c = e._origin_p.x + (x + 1) * h + h * x / 3,
                u = 1 == l.length ? l[0] : l[x];
                var p = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                p.setAttribute("y", g),
                p.setAttribute("x", c),
                p.setAttribute("width", h),
                p.setAttribute("height", d),
                p.setAttribute("fill", u),
                p.setAttribute("class", "svgChartData"),
                p.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                p.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(p);
                var v = document.createElementNS("http://www.w3.org/2000/svg", "text");
                v.setAttribute("text-anchor", "middle"),
                v.setAttribute("x", c + h / 2),
                v.setAttribute("y", g - 26),
                v.setAttribute("fill", u),
                v.setAttribute("class", "svgChartShapeInfo"),
                v.setAttribute("style", "opacity: 0;"),
                v.setAttribute("font-size", "18px"),
                v.setAttribute("text-rendering", "geometricPrecision"),
                v.innerHTML = s[x][1],
                r[0].appendChild(v);
                var y = document.createElementNS("http://www.w3.org/2000/svg", "text");
                y.setAttribute("text-anchor", "middle"),
                y.setAttribute("x", c + h / 2),
                y.setAttribute("y", g - 8),
                y.setAttribute("fill", u),
                y.setAttribute("class", "svgChartShapeInfo"),
                y.setAttribute("style", "opacity: 0;"),
                y.setAttribute("font-size", "14px"),
                y.setAttribute("text-rendering", "geometricPrecision"),
                y.innerHTML = s[x][0],
                r[0].appendChild(y)
            }
        },
        setConeData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            for (var d, c, g, u, h, l = e._x_axis_length / (o.rlength + 2 + (o.rlength - 1) / 3), _ = e.colors, x = e.getYAxisAverage(), A = 0; A < o.rlength; A++) {
                h = parseFloat(s[A][1]),
                e.yAxisNumMax > 0 && e.yAxisNumMax < h && (h = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (h -= e.yAxisNumMin),
                0 > h && (h = 0),
                d = x * h,
                g = e._origin_p.y - d,
                c = e._origin_p.x + (A + 1) * l + l * A / 3,
                u = 1 == _.length ? _[0] : _[A];
                var p = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                p.setAttribute("points", c + l / 2 + "," + g + " " + c + "," + (g + d) + " " + (c + l) + "," + (g + d)),
                p.setAttribute("fill", u),
                p.setAttribute("class", "svgChartData"),
                p.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                p.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(p);
                var v = document.createElementNS("http://www.w3.org/2000/svg", "text");
                v.setAttribute("text-anchor", "middle"),
                v.setAttribute("x", c + l / 2),
                v.setAttribute("y", g - 26),
                v.setAttribute("fill", u),
                v.setAttribute("font-size", "18px"),
                v.setAttribute("text-rendering", "geometricPrecision"),
                v.setAttribute("class", "svgChartShapeInfo"),
                v.setAttribute("style", "opacity: 0;"),
                v.innerHTML = s[A][1],
                r[0].appendChild(v);
                var y = document.createElementNS("http://www.w3.org/2000/svg", "text");
                y.setAttribute("text-anchor", "middle"),
                y.setAttribute("x", c + l / 2),
                y.setAttribute("y", g - 8),
                y.setAttribute("fill", u),
                y.setAttribute("font-size", "14px"),
                y.setAttribute("text-rendering", "geometricPrecision"),
                y.setAttribute("class", "svgChartShapeInfo"),
                y.setAttribute("style", "opacity: 0;"),
                y.innerHTML = s[A][0],
                r[0].appendChild(y)
            }
        },
        setBarData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            for (var d, c, g, u, h, l = e._y_axis_length / (o.rlength + 2 + (o.rlength - 1) / 3), _ = e.colors, x = e.getXAxisAverage(), A = 0; A < o.rlength; A++) {
                h = parseFloat(s[A][1]),
                e.yAxisNumMax > 0 && e.yAxisNumMax < h && (h = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (h -= e.yAxisNumMin),
                0 > h && (h = 0),
                d = x * h,
                c = e._origin_p.x,
                g = e._origin_p.y - e._y_axis_length + (A + 1) * l + l * A / 3,
                u = 1 == _.length ? _[0] : _[A];
                var p = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                p.setAttribute("y", g),
                p.setAttribute("x", c),
                p.setAttribute("width", d),
                p.setAttribute("height", l),
                p.setAttribute("fill", u),
                p.setAttribute("class", "svgChartData"),
                p.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                p.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(p);
                var v = document.createElementNS("http://www.w3.org/2000/svg", "text");
                v.setAttribute("text-anchor", "start"),
                v.setAttribute("x", c + d + 12),
                v.setAttribute("y", g + l / 2 - 2),
                v.setAttribute("fill", u),
                v.setAttribute("font-size", "18px"),
                v.setAttribute("text-rendering", "geometricPrecision"),
                v.setAttribute("class", "svgChartShapeInfo"),
                v.setAttribute("style", "opacity: 0;"),
                v.innerHTML = s[A][1],
                r[0].appendChild(v);
                var y = document.createElementNS("http://www.w3.org/2000/svg", "text");
                y.setAttribute("text-anchor", "start"),
                y.setAttribute("x", c + d + 12),
                y.setAttribute("y", g + l / 2 + 14),
                y.setAttribute("fill", u),
                y.setAttribute("font-size", "14px"),
                y.setAttribute("text-rendering", "geometricPrecision"),
                y.setAttribute("class", "svgChartShapeInfo"),
                y.setAttribute("style", "opacity: 0;"),
                y.innerHTML = s[A][0],
                r[0].appendChild(y)
            }
        },
        setLineData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            for (var d, c, g, u, h, l, _ = e._x_axis_length / (o.rlength - 1), x = e.colors, A = 10, p = e.getYAxisAverage(), v = 0; v < o.rlength; v++) {
                l = parseFloat(s[v][1]),
                e.yAxisNumMax > 0 && e.yAxisNumMax < l && (l = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (l -= e.yAxisNumMin),
                0 > l && (l = 0),
                d = p * l,
                g = e._origin_p.y - d,
                c = e._origin_p.x + v * _,
                u = 1 == x.length ? x[0] : x[v];
                var y = document.createElementNS("http://www.w3.org/2000/svg", "path");
                y.setAttribute("fill", "none"),
                y.setAttribute("stroke", "#E7E7E7");
                var m = parseFloat(e._origin_p.y) - parseFloat(e._y_axis_length);
                if (y.setAttribute("d", "M" + c + "," + e._origin_p.y + "L" + c + "," + m),
                y.setAttribute("stroke-dasharray", "4,3"),
                y.setAttribute("class", "yAxisGrid"),
                r[0].insertBefore(y, r[0].childNodes[0]),
                h) {
                    var b = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    b.setAttribute("fill", "none"),
                    b.setAttribute("stroke", "#000000"),
                    b.setAttribute("d", "M" + h.x + "," + h.y + "L" + c + "," + g),
                    b.setAttribute("class", "svgChartDataLine"),
                    r[0].appendChild(b)
                }
                h = {
                    x: c,
                    y: g
                }
            }
            e.gridShow || r.find(".yAxisGrid").css("opacity", "0");
            for (var v = 0; v < o.rlength; v++) {
                var l = parseFloat(s[v][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < l && (l = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (l -= e.yAxisNumMin),
                0 > l && (l = 0),
                d = p * l,
                g = e._origin_p.y - d,
                c = e._origin_p.x + v * _,
                u = 1 == x.length ? x[0] : x[v];
                var w = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                w.setAttribute("y", g - A / 2),
                w.setAttribute("x", c - A / 2),
                w.setAttribute("width", A),
                w.setAttribute("height", A),
                w.setAttribute("fill", u),
                w.setAttribute("stroke", "#FFF"),
                w.setAttribute("stroke-linecap", "square"),
                w.setAttribute("stroke-width", "2"),
                w.setAttribute("class", "svgChartData"),
                w.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                w.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(w);
                var f = document.createElementNS("http://www.w3.org/2000/svg", "text");
                f.setAttribute("text-anchor", "middle"),
                f.setAttribute("x", c),
                f.setAttribute("y", g - 30),
                f.setAttribute("fill", u),
                f.setAttribute("font-size", "18px"),
                f.setAttribute("text-rendering", "geometricPrecision"),
                f.setAttribute("class", "svgChartShapeInfo"),
                f.setAttribute("style", "opacity: 0;"),
                f.innerHTML = s[v][1],
                r[0].appendChild(f);
                var N = document.createElementNS("http://www.w3.org/2000/svg", "text");
                N.setAttribute("text-anchor", "middle"),
                N.setAttribute("x", c),
                N.setAttribute("y", g - 12),
                N.setAttribute("fill", u),
                N.setAttribute("font-size", "14px"),
                N.setAttribute("text-rendering", "geometricPrecision"),
                N.setAttribute("class", "svgChartShapeInfo"),
                N.setAttribute("style", "opacity: 0;"),
                N.innerHTML = s[v][0],
                r[0].appendChild(N)
            }
        },
        setAreaData: function(t) {
            var e = this
              , i = e.getNode()
              , n = a(i)
              , r = n.find("svg");
            n.find(".svgChartData").detach(),
            n.find(".svgChartDataLine").detach(),
            n.find(".svgChartDataArea").detach(),
            n.find(".svgChartShapeInfo").detach(),
            n.find(".yAxisNum").detach(),
            n.find(".yAxisGrid").detach();
            var s = e.getChartData()
              , o = e.getMaxNum();
            t && e.chartSetColors(o),
            e.setYAxisNumAndGrid(),
            e.setLegend(o);
            var d = document.createElementNS("http://www.w3.org/2000/svg", "defs")
              , c = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient")
              , g = (new Date).getTime();
            c.setAttribute("id", g),
            c.setAttribute("x1", "0%"),
            c.setAttribute("x2", "0%"),
            c.setAttribute("y1", "0%"),
            c.setAttribute("y2", "100%");
            var u = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            u.setAttribute("offset", "0%"),
            u.setAttribute("stop-color", this.colors[0]);
            var h = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            h.setAttribute("offset", "100%"),
            h.setAttribute("stop-color", this.colors[0]),
            h.setAttribute("stop-opacity", "0"),
            c.appendChild(u),
            c.appendChild(h),
            d.appendChild(c),
            r[0].appendChild(d);
            for (var l, _, x, A, p, v, y = e._x_axis_length / (o.rlength - 1), m = e.colors, b = 10, w = e.getYAxisAverage(), f = 0; f < o.rlength; f++) {
                var N = parseFloat(s[f][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < N && (N = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (N -= e.yAxisNumMin),
                0 > N && (N = 0),
                l = w * N,
                x = e._origin_p.y - l,
                _ = e._origin_p.x + f * y,
                A = 1 == m.length ? m[0] : m[f];
                var C = document.createElementNS("http://www.w3.org/2000/svg", "path");
                C.setAttribute("fill", "none"),
                C.setAttribute("stroke", "#E7E7E7");
                var S = parseFloat(e._origin_p.y) - parseFloat(e._y_axis_length);
                if (C.setAttribute("d", "M" + _ + "," + e._origin_p.y + "L" + _ + "," + S),
                C.setAttribute("stroke-dasharray", "4,3"),
                C.setAttribute("class", "yAxisGrid"),
                r[0].insertBefore(C, r[0].childNodes[0]),
                p) {
                    var M = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    M.setAttribute("fill", "none"),
                    M.setAttribute("stroke", "#000000"),
                    M.setAttribute("d", "M" + p.x + "," + p.y + "L" + _ + "," + x),
                    M.setAttribute("class", "svgChartDataLine"),
                    r[0].appendChild(M),
                    v = f == o.rlength - 1 ? v + " " + _ + "," + x + " " + _ + "," + e._origin_p.y : v + " " + _ + "," + x
                } else
                    v = _ + "," + e._origin_p.y + " " + _ + "," + x;
                p = {
                    x: _,
                    y: x
                }
            }
            e.gridShow || r.find(".yAxisGrid").css("opacity", "0");
            for (var f = 0; f < o.rlength; f++) {
                var N = parseFloat(s[f][1]);
                e.yAxisNumMax > 0 && e.yAxisNumMax < N && (N = e.yAxisNumMax),
                e.yAxisNumMin > 0 && (N -= e.yAxisNumMin),
                0 > N && (N = 0),
                l = w * N,
                x = e._origin_p.y - l,
                _ = e._origin_p.x + f * y,
                A = 1 == m.length ? m[0] : m[f];
                var D = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                D.setAttribute("y", x - b / 2),
                D.setAttribute("x", _ - b / 2),
                D.setAttribute("width", b),
                D.setAttribute("height", b),
                D.setAttribute("fill", A),
                D.setAttribute("stroke", "#FFF"),
                D.setAttribute("stroke-linecap", "square"),
                D.setAttribute("stroke-width", "2"),
                D.setAttribute("class", "svgChartData"),
                D.setAttribute("onmouseover", "window.chart_shape_info_show(evt)"),
                D.setAttribute("onmouseleave", "window.chart_shape_info_hide(evt)"),
                r[0].appendChild(D);
                var j = document.createElementNS("http://www.w3.org/2000/svg", "text");
                j.setAttribute("text-anchor", "middle"),
                j.setAttribute("x", _),
                j.setAttribute("y", x - 30),
                j.setAttribute("fill", A),
                j.setAttribute("font-size", "18px"),
                j.setAttribute("text-rendering", "geometricPrecision"),
                j.setAttribute("class", "svgChartShapeInfo"),
                j.setAttribute("style", "opacity: 0;"),
                j.innerHTML = s[f][1],
                r[0].appendChild(j);
                var k = document.createElementNS("http://www.w3.org/2000/svg", "text");
                k.setAttribute("text-anchor", "middle"),
                k.setAttribute("x", _),
                k.setAttribute("y", x - 12),
                k.setAttribute("fill", A),
                k.setAttribute("font-size", "14px"),
                k.setAttribute("text-rendering", "geometricPrecision"),
                k.setAttribute("class", "svgChartShapeInfo"),
                k.setAttribute("style", "opacity: 0;"),
                k.innerHTML = s[f][0],
                r[0].appendChild(k)
            }
            var I = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            I.setAttribute("points", v),
            I.setAttribute("class", "svgChartDataArea"),
            I.setAttribute("fill", "url(#" + g + ")"),
            r[0].insertBefore(I, r.find("defs")[0])
        },
        updateNode: function() {
            return
        },
        updateNodeAndUndo: function() {
            return
        },
        saveNode: function() {
            if (!window.ISLOGIN)
                return !1;
            var t = this
              , e = t.getNode()
              , i = a(e).clone();
            i.find("svg").attr({
                width: t.width,
                height: t.height,
                opacity: t.opacity
            }),
            i.find(".svgChartShapeInfo").detach();
            var s = i.find("svg")[0].outerHTML
              , o = {
                c: s
            };
            "" != t.id && (o.id = t.id),
            t.updateNodeAjax = a.ajax({
                url: "/material/saveChartContent.do",
                type: "POST",
                dataType: "json",
                data: o,
                success: function(e) {
                    var a = e.code
                      , i = e.id;
                    1 == a ? "" == t.id && (t.id = i) : -2 == a ? r.show() : n.back({
                        str: "修改图表错误！",
                        kind: "warning"
                    })
                },
                error: function() {
                    return window.chart_save_abort ? void (window.chart_save_abort = !1) : void n.back({
                        str: "修改图表错误！",
                        kind: "warning"
                    })
                }
            })
        },
        setData: function(t) {
            for (var e = this, a = e.getChartData(), i = a.length, n = 0; i > n; n++)
                null != a[n][0] && "" != a[n][0] && (null == a[n][1] || "" == a[n][1]) && (a[n][1] = "0");
            switch (e.kind) {
            case "histogram":
                e.setHistogramData(t);
                break;
            case "cone":
                e.setConeData(t);
                break;
            case "bar":
                e.setBarData(t);
                break;
            case "line":
                e.setLineData(t);
                break;
            case "area":
                e.setAreaData(t);
                break;
            case "scatter":
                e.setScatterData(t)
            }
        }
    },
    t.classExtend(g, e),
    g
});
;/*!/compapi/design/widgets/CircleSelect.js*/
"use strict";
define("compapi/design/widgets/CircleSelect", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/widgets/DataWidget", "compapi/design/Toolbar", "compapi/design/design_config", "widget/pop/pop"], function(e, t, n, o, r, i, s) {
    function g(e, t) {
        var n = this;
        n._owner_page = e,
        n._elements = t,
        n._split_drag = !0,
        n.resetElement(),
        n.nodeClick()
    }
    var a = function(e, t) {
        o.call(this, {}, {}),
        g.call(this, e, t)
    };
    return a.prototype = {
        constructor: a,
        _element_type: "circleSelect",
        group_inside: !1,
        createWidget: function() {},
        resetElement: function() {
            for (var t = this._owner_page, n = this._elements, o = n.length, r = [], i = 0; o > i; i++)
                r[i] = n[i].getIndex();
            e.sortByNum(r);
            for (var s, g = !1, a = 0; o > a; a++)
                s = r[a],
                t.elements[s]._group_drag ? (n[a] = t.elements[s]._element_group,
                g = !0) : n[a] = t.elements[s];
            this.group_inside = g
        },
        moveByKey: function(e, n) {
            var o = this._owner_page._owner_design
              , r = o._owner_editDiv
              , s = t(r.getNode())
              , g = this.addLeftTop(e * i.ZOOM_IN, n * i.ZOOM_IN);
            s.offset({
                top: g.top,
                left: g.left
            }),
            this.setNewJson()
        },
        getPage: function() {
            return this._owner_page
        },
        nodeClick: function() {
            var e = this._owner_page
              , t = e._owner_design
              , n = t._owner_editDiv;
            n.showByCircle(this);
            var o = t._owner_elementEditbar;
            void 0 != o && o.show(this)
        },
        getTop: function() {
            var e = this.getRect();
            return e.top
        },
        getLeft: function() {
            var e = this.getRect();
            return e.left
        },
        getWidth: function() {
            var e = this.getRect();
            return e.width
        },
        getHeight: function() {
            var e = this.getRect();
            return e.height
        },
        getShowWidth: function() {
            return this.getBox().width / i.ZOOM_IN
        },
        getShowHeight: function() {
            return this.getBox().height / i.ZOOM_IN
        },
        getRect: function() {
            var e = this._elements
              , t = e.length;
            if (void 0 != e[0]) {
                for (var n, o = e[0].getRect(), r = o.top, i = o.right, s = o.bottom, g = o.left, a = 1; t > a; a++)
                    n = e[a],
                    o = n.getRect(),
                    r > o.top && (r = o.top),
                    i < o.right && (i = o.right),
                    s < o.bottom && (s = o.bottom),
                    g > o.left && (g = o.left);
                return {
                    top: r,
                    right: i,
                    bottom: s,
                    left: g,
                    width: i - g,
                    height: s - r
                }
            }
        },
        getTranslateLeftTop: function() {
            var e = this.getRect()
              , t = this.getPage()
              , n = t.getRect()
              , o = t.getDesign().pageScale;
            return [(parseFloat(e.left) - parseFloat(n.left)) / o, (parseFloat(e.top) - parseFloat(n.top)) / o]
        },
        addLeftTop: function(e, t) {
            for (var n, o = this._elements, r = o.length, i = 0; r > i; i++)
                n = o[i],
                n.addLeftTop(e, t);
            return this.getRect()
        },
        setNewJson: function() {
            for (var t, n = this._elements, o = n.length, r = 0; o > r; r++) {
                var t = n[r];
                "elementGroup" == t._element_type || (t.transform = e.transformScale(t.getTransform(), 1 / i.ZOOM_IN))
            }
        },
        getIndex: function() {
            var e = this._elements
              , t = e.length;
            return e[t - 1].getIndex()
        },
        removeAndUndo: function() {
            for (var e = this._owner_page, t = this._elements, n = t.length, o = 0; n > o; o++) {
                var r = t[o];
                "elementGroup" == r._element_type ? r.removeAndUndo() : e.eleDelAndUndo(r, void 0, !0)
            }
        },
        copy: function(e) {
            for (var t, n, o = this._owner_page, r = this._elements, i = r.length, s = [], g = 0; i > g; g++) {
                var t = r[g];
                n = o.eleCopyAndUndo({
                    ele: t
                }, !0),
                s[g] = n
            }
            o.nodeMousedown(e),
            o._select_element = s,
            o.createCircleSelect()
        },
        overstepPageDel: function() {
            var e = this.getRect()
              , t = e.left
              , n = e.top
              , o = e.right
              , r = e.bottom
              , i = this._owner_page
              , s = i.getRect()
              , g = s.left
              , a = s.top
              , l = s.right
              , c = s.bottom;
            return g > o || a > r || n > c || t > l ? (this.remove(),
            !0) : void 0
        },
        nodeDblclick: function() {},
        groupAlignBottom: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , a = g.bottom - s.bottom;
                    o[t].addLeftTop(0, a * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, g = this.getRect(), a = this._owner_page, l = a.getRect(), c = !1, h = 0; r > h; h++) {
                var f = o[h].getRect()
                  , d = g.bottom - l.bottom
                  , _ = f.bottom - f.top - 10;
                if (d > _) {
                    c = !0;
                    break
                }
            }
            c ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignVerticalMiddle: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = n.getRectVerticalMiddle(o[t])
                      , g = l - s;
                    o[t].addLeftTop(0, g * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, n = this, o = this._elements, r = o.length, g = this.getRect(), a = g.bottom - g.top, l = g.top + a / 2, c = this._owner_page, h = c.getRect(), f = !1, d = 0; r > d; d++) {
                var _ = this.getRectVerticalMiddle(o[d])
                  , p = l - _
                  , u = _ + p
                  , m = o[d].getRect()
                  , v = m.bottom - m.top - 10;
                if (u > h.bottom + v / 2 - 10 || u < h.top - v / 2 + 10) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignTop: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , a = g.top - s.top;
                    o[t].addLeftTop(0, a * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, g = this.getRect(), a = this._owner_page, l = a.getRect(), c = !1, h = 0; r > h; h++) {
                var f = o[h].getRect()
                  , d = l.top - g.top
                  , _ = f.bottom - f.top - 10;
                if (d > _) {
                    c = !0;
                    break
                }
            }
            c ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignRight: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , a = g.right - s.right;
                    o[t].addLeftTop(a * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, g = this.getRect(), a = this._owner_page, l = a.getRect(), c = !1, h = 0; r > h; h++) {
                var f = o[h].getRect()
                  , d = g.right - l.right
                  , _ = f.right - f.left - 10;
                if (d > _) {
                    c = !0;
                    break
                }
            }
            c ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignStandardlMiddle: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = n.getRectStandardlMiddle(o[t])
                      , g = l - s;
                    o[t].addLeftTop(g * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, g = this.getRect(), a = g.right - g.left, l = g.left + a / 2, c = this._owner_page, h = c.getRect(), f = !1, d = 0; r > d; d++) {
                var _ = this.getRectStandardlMiddle(o[d])
                  , p = l - _
                  , u = _ + p
                  , m = o[d].getRect()
                  , v = m.right - m.left;
                if (u > h.right + v / 2 - 10 || u < h.left - v / 2 + 10) {
                    f = !0;
                    break
                }
            }
            f ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignLeft: function() {
            function t() {
                for (var t = 0; r > t; t++) {
                    var s = o[t].getRect()
                      , a = g.left - s.left;
                    o[t].addLeftTop(a * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            for (var n = this, o = this._elements, r = o.length, g = this.getRect(), a = this._owner_page, l = a.getRect(), c = !1, h = 0; r > h; h++) {
                var f = o[h].getRect()
                  , d = l.left - g.left
                  , _ = f.right - f.left - 10;
                if (d > _) {
                    c = !0;
                    break
                }
            }
            c ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignVerticalAuto: function() {
            function t() {
                for (var t = 1; r - 1 > t; t++) {
                    var s = g.top + g.length * t
                      , a = n.getRectVerticalMiddle(o[t])
                      , l = s - a;
                    o[t].addLeftTop(0, l * i.ZOOM_IN),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            var n = this
              , o = this._elements;
            this.resetElementByHeight();
            var r = o.length
              , g = (this.getRect(),
            {});
            g.top = this.getRectVerticalMiddle(o[0]),
            g.bottom = this.getRectVerticalMiddle(o[r - 1]),
            g.height = g.bottom - g.top,
            g.length = g.height / (r - 1);
            for (var a = this._owner_page, l = a.getRect(), c = !1, h = 0; r > h; h++) {
                var f = g.top + g.length * h
                  , d = this.getRectVerticalMiddle(o[h])
                  , _ = f - d
                  , p = d + _
                  , u = o[h].getRect()
                  , m = u.bottom - u.top - 20;
                if (p > l.bottom + m / 2 || p < l.top - m / 2) {
                    c = !0;
                    break
                }
            }
            c ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        groupAlignStandardAuto: function() {
            function t() {
                for (var t = 1; r - 1 > t; t++) {
                    var s = g.left + g.length * t
                      , a = n.getRectStandardlMiddle(o[t])
                      , l = s - a;
                    o[t].addLeftTop(l * i.ZOOM_IN, 0),
                    "elementGroup" == o[t]._element_type ? o[t].setNewJson() : o[t].transform = e.transformScale(o[t].getTransform(), 1 / i.ZOOM_IN)
                }
                n.nodeClick()
            }
            var n = this
              , o = this._elements;
            this.resetElementByWidth();
            var r = o.length
              , g = {};
            g.left = this.getRectStandardlMiddle(o[0]),
            g.right = this.getRectStandardlMiddle(o[r - 1]),
            g.width = g.right - g.left,
            g.length = g.width / (r - 1);
            for (var a = this._owner_page, l = a.getRect(), c = !1, h = 0; r > h; h++) {
                var f = g.left + g.length * h
                  , d = this.getRectStandardlMiddle(o[h])
                  , _ = f - d
                  , p = d + _
                  , u = o[h].getRect()
                  , m = u.right - u.left - 20;
                if (p > l.right + m / 2 || p < l.left - m / 2) {
                    c = !0;
                    break
                }
            }
            c ? s.confirm({
                str: "对齐后，部分素材超出画布将会丢失",
                yes: "对齐",
                no: "取消",
                successfun: function() {
                    t()
                }
            }) : t()
        },
        resetElementByHeight: function() {
            for (var e, t = this._elements, n = t.length, o = n; o > 0; o--)
                for (var r = 0; o - 1 > r; r++) {
                    var i = this.getRectVerticalMiddle(t[r])
                      , s = this.getRectVerticalMiddle(t[r + 1]);
                    i > s && (e = t[r],
                    t[r] = t[r + 1],
                    t[r + 1] = e)
                }
            this._elements = t
        },
        resetElementByWidth: function() {
            for (var e, t = this._elements, n = t.length, o = n; o > 0; o--)
                for (var r = 0; o - 1 > r; r++) {
                    var i = this.getRectStandardlMiddle(t[r])
                      , s = this.getRectStandardlMiddle(t[r + 1]);
                    i > s && (e = t[r],
                    t[r] = t[r + 1],
                    t[r + 1] = e)
                }
            this._elements = t
        },
        getRectStandardlMiddle: function(e) {
            var t = e.getRect()
              , n = t.right - t.left
              , o = t.left + n / 2;
            return o
        },
        getRectVerticalMiddle: function(e) {
            var t = e.getRect()
              , n = t.bottom - t.top
              , o = t.top + n / 2;
            return o
        },
        setMoveOpacity: function(e) {
            for (var t = this._elements, n = 0; n < t.length; n++)
                t[n].setMoveOpacity(e)
        },
        groupSetLock: function() {
            window.MEMENTO_ID = e.now();
            for (var t, n = this._elements, o = [], r = 0; r < n.length; r++)
                if ("elementGroup" === n[r]._element_type) {
                    t = n[r]._elements;
                    for (var i = 0; i < t.length; i++)
                        o.push(t[i]);
                    n[r].groupSplitAndUndo(!0)
                } else
                    o.push(n[r]);
            var s = this._owner_page
              , g = s.createElementGroupAndUndo(o, null, !0);
            g.groupSetLock(!0);
            var a = s._owner_design
              , l = a._owner_elementEditbar;
            l.hideNode(),
            s.nodeMousedown()
        },
        getBox: function() {
            for (var e, t, n, o, r, i, s, g, a, l, c, h = this._elements, f = h.length, d = 0; f > d; d++)
                e = h[d],
                "svgLayout" == e._svg_type && e.svgLayoutHide();
            if (void 0 != h[0]) {
                e = h[0],
                t = e.getBox(),
                n = e.getTranslateLeftTop(),
                o = t.x + n[0],
                r = t.y + n[1],
                i = o + t.width,
                s = r + t.height;
                for (var _ = 1; f > _; _++)
                    e = h[_],
                    t = e.getBox(),
                    n = e.getTranslateLeftTop(),
                    g = t.x + n[0],
                    a = t.y + n[1],
                    l = g + t.width,
                    c = a + t.height,
                    o > g && (o = g),
                    r > a && (r = a),
                    l > i && (i = l),
                    c > s && (s = c);
                for (d = 0; f > d; d++)
                    e = h[d],
                    "svgLayout" == e._svg_type && e.svgLayoutShow();
                return {
                    width: i - o,
                    height: s - r,
                    x: o,
                    y: r
                }
            }
        },
        getRealWidth: function() {
            return this.getBox().width
        },
        getRealHeight: function() {
            return this.getBox().height
        },
        previewWH: function(e, t) {
            e *= i.ZOOM_IN,
            t *= i.ZOOM_IN;
            for (var n, o, r, s, g, a, l, c, h, f, d, _, p, u, m, v, R, w = this.getBox(), O = w.width, M = w.height, y = w.x, N = w.y, S = this._owner_page, b = S._owner_design, T = b.pageScale, I = this._elements, Z = I.length, L = 0; Z > L; L++) {
                n = I[L],
                "text" == n._element_type ? (m = n.getStyleFontSize(),
                v = m / M,
                R = t * v,
                o = n.getSvgWidth(),
                l = o / O,
                h = e * l,
                n.previewBig(h / i.ZOOM_IN, R / i.ZOOM_IN)) : ("elementGroup" == n._element_type ? (o = n.getRealWidth(),
                r = n.getRealHeight()) : (o = n.getSvgWidth(),
                r = n.getSvgHeight()),
                l = o / O,
                c = r / M,
                h = e * l,
                f = t * c,
                n.previewWH(h / i.ZOOM_IN, f / i.ZOOM_IN)),
                a = n.getTranslateLeftTop();
                {
                    n.getBox()
                }
                s = 0 + a[0],
                g = 0 + a[1],
                d = (s - y) / O,
                _ = (g - N) / M,
                p = (e - O) * d,
                u = (t - M) * _,
                n.addLeftTop(p * T, u * T),
                I[L].hideAnt()
            }
        },
        resetPosition: function() {
            for (var e, t = this._elements, n = t.length, o = 0; n > o; o++)
                e = t[o],
                e.resetPosition()
        },
        resetWH: function(e) {
            for (var t, n = this._elements, o = n.length, r = 0; o > r; r++)
                t = n[r],
                t.resetWH();
            e || this.setNewJson()
        }
    },
    e.classExtend(a, o),
    a
});
;/*!/compapi/design/widgets/ElementGroup.js*/
"use strict";
define("compapi/design/widgets/ElementGroup", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/widgets/DataWidget", "compapi/design/Toolbar", "compapi/design/design_config", "widget/pop/pop"], function(e, t, o, n, r, i, s) {
    function a(o, n, r) {
        r = r || {};
        var s = this;
        s._owner_page = o,
        s._elements = n,
        s.id = r.id || "element_group_" + e.now(),
        s._lock = r.lock,
        s._text_ele_sum = 0,
        s._text_ele_loaded = 0,
        d.call(s);
        var a = this.getJson();
        a.transform = r.transform || "translate(0,0)",
        s._transform = a.transform;
        var h = s.getNode();
        "1.0.0" === window.DESIGN_VERSION ? h.setAttribute("transform", a.transform) : h.setAttribute("transform", e.transformScale(a.transform, i.ZOOM_IN)),
        t(n[n.length - 1].getNode()).after(h),
        g.call(s, n),
        l.call(s)
    }
    function g(t) {
        for (var o, n = this, r = n.getNode(), s = t.length, a = 0; s > a; a++)
            if (o = t[a],
            o._group || (o.group = {
                value: n.id,
                undo_drag: "noUndo"
            },
            o.groupTransform = {
                value: e.transformScale(o.getNode().getAttribute("transform"), 1 / i.ZOOM_IN),
                undo_drag: "noUndo"
            }),
            o._group_drag = !0,
            o._element_group = n,
            "text" === o._element_type && n._text_ele_sum++,
            o._fontFamilyLoaded && n._text_ele_loaded++,
            r.appendChild(o.getNode()),
            "true" === this._lock) {
                var g = o.getNode();
                e.addClass(g, "elementsSonLock")
            }
    }
    function d() {
        var t = this
          , o = t.getPage()
          , n = o.getDesign()
          , r = "pages]" + o.getIndex() + "]elegroups]";
        e.dataBinding({
            obj: t,
            prop_name: "transform",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , i = e;
                "object" == typeof e && (i = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: r + t.id + "]",
                    key: "transform",
                    value: i,
                    type: "0",
                    action: "changeElementGroup"
                }, o)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "lock",
            getFun: e.$noop,
            setFun: function(e) {
                var o = !0
                  , i = e;
                "object" == typeof e && (i = e.value,
                o = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: t,
                    loc: r + t.id + "]",
                    key: "lock",
                    value: i,
                    type: "0",
                    action: "changeElementGroup"
                }, o)
            }
        })
    }
    function l() {
        var e = this
          , t = e.getNode();
        window.addEventListener ? t.addEventListener("click", function(t) {
            return t.ctrlKey || t.metaKey || t.shiftKey ? !1 : void e.nodeClick(t)
        }) : window.attachEvent && t.attachEvent("onclick", function(t) {
            return t.ctrlKey || t.metaKey || t.shiftKey ? !1 : void e.nodeClick(t)
        })
    }
    var h = function(e, t, o) {
        n.call(this, {}, {}),
        a.call(this, e, t, o)
    };
    return h.prototype = {
        constructor: h,
        _element_type: "elementGroup",
        _transform: "",
        createWidget: function() {
            var t = e.createSvgNode("g");
            return t.setAttribute("class", "elementGroup"),
            t
        },
        getPage: function() {
            return this._owner_page
        },
        getRect: function() {
            for (var e, o = this._elements, n = o.length, r = this.getNode(), i = 0; n > i; i++)
                e = o[i],
                "svgLayout" == e._svg_type && e.svgLayoutHide();
            t(r).find(".seat-rect").css("display", "none");
            var s = this.getNode().getBoundingClientRect();
            for (t(r).find(".seat-rect").css("display", "block"),
            i = 0; n > i; i++)
                e = o[i],
                "svgLayout" == e._svg_type && e.svgLayoutShow();
            return s
        },
        getBox: function() {
            for (var e, o = this._elements, n = o.length, r = 0; n > r; r++)
                e = o[r],
                "svgLayout" == e._svg_type && e.svgLayoutHide();
            var i = this.getNode();
            t(i).find(".seat-rect").css("display", "none");
            var s = i.getBBox();
            for (t(i).find(".seat-rect").css("display", "block"),
            r = 0; n > r; r++)
                e = o[r],
                "svgLayout" == e._svg_type && e.svgLayoutShow();
            return s
        },
        intersectEle: function(e) {
            var t = this.getRect()
              , o = t.left
              , n = t.top
              , r = t.right
              , i = t.bottom;
            e._group_drag && (e = e._element_group);
            var s = e.getRect()
              , a = s.left
              , g = s.top
              , d = s.right
              , l = s.bottom;
            return o > d || n > l || g > i || a > r ? !1 : !0
        },
        moveByKey: function(e, t) {
            var o = this._owner_page._owner_design
              , n = o._owner_editDiv
              , r = o._owner_elementEditbar;
            this.addLeftTop(e * i.ZOOM_IN, t * i.ZOOM_IN),
            void 0 != n && n.showByGroup(this),
            void 0 != r && r.show(this),
            this.setNewJson()
        },
        addLeftTop: function(t, o) {
            var n = this.getNode()
              , r = this._owner_page
              , i = r._owner_design
              , s = i.pageScale
              , a = e.getTransformAttr(n.getAttribute("transform"), "translate")
              , g = [parseFloat(a[0]) + t / s, parseFloat(a[1]) + o / s]
              , d = e.setTransformAttr(n.getAttribute("transform"), "translate", g);
            return n.setAttribute("transform", d),
            this.setRotate(this.getRotate()),
            this.getRect()
        },
        resetPosition: function() {
            var e = this.getNode()
              , t = e.getBoundingClientRect()
              , o = this.getRotate();
            this.setRotate(o);
            var n = e.getBoundingClientRect();
            this.addLeftTop((t.left - n.left) * i.ZOOM_IN, (t.top - n.top) * i.ZOOM_IN)
        },
        nodeMousedown: function(e) {
            this.nodeClick();
            var t = this._owner_page
              , o = t.getDesign();
            o._owner_editDiv.nodeMousedown(e)
        },
        nodeClick: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t._owner_editDiv
              , n = t._owner_elementEditbar
              , r = this._elements;
            if (e.nodeMousedown(),
            t._focus_element = this,
            void 0 != o) {
                o.showByGroup(this);
                for (var i = 0; i < r.length; i++)
                    r[i].showAnt()
            }
            void 0 != n && n.show(this)
        },
        setRotate: function(t) {
            var o = this.getNode()
              , n = this.getBox()
              , r = n.width
              , i = n.height
              , s = r / 2 + n.x
              , a = i / 2 + n.y
              , g = [t, s, a]
              , d = e.setTransformAttr(o.getAttribute("transform"), "rotate", g);
            o.setAttribute("transform", d)
        },
        resetWH: function(e) {
            var o = this._owner_page
              , n = o._owner_design
              , r = n.pageScale
              , s = (this.getNode(),
            this.getBox())
              , a = s.width
              , g = s.height
              , d = this.getRect();
            t("#edit-div").css({
                width: a / i.ZOOM_IN * r + 1,
                height: g / i.ZOOM_IN * r + 1
            }).offset({
                left: d.left,
                top: d.top
            }),
            e || this.setNewJson();
            for (var l = this._elements, h = 0; h < l.length; h++)
                l[h].showAnt()
        },
        previewWH: function(e, t) {
            e *= i.ZOOM_IN,
            t *= i.ZOOM_IN;
            for (var o, n, r, s, a, g, d, l, h, _, u, c, f, p, v, m, w, N = this.getRealWidth(), O = this.getRealHeight(), y = this.getBox(), x = y.x, S = y.y, I = this._owner_page, b = I._owner_design, k = b.pageScale, M = this._elements, A = M.length, L = 0; A > L; L++)
                o = M[L],
                "text" == o._element_type && (v = o.getStyleFontSize(),
                m = v / O,
                w = t * m);
            for (var R = 0; A > R; R++)
                o = M[R],
                "text" != o._element_type ? (n = o.getSvgWidth(),
                r = o.getSvgHeight(),
                d = n / N,
                l = r / O,
                h = e * d,
                _ = t * l,
                o.previewWH(h / i.ZOOM_IN, _ / i.ZOOM_IN)) : (v = o.getStyleFontSize(),
                m = v / O,
                w = t * m,
                n = o.getSvgWidth(),
                d = n / N,
                h = e * d,
                o.previewBig(h / i.ZOOM_IN, w / i.ZOOM_IN)),
                g = o.getTranslateLeftTop(),
                s = g[0],
                a = g[1],
                u = (s - x) / N,
                c = (a - S) / O,
                f = (e - N) * u,
                p = (t - O) * c,
                o.addLeftTop(f * k, p * k),
                M[R].hideAnt()
        },
        hideAnt: function() {
            for (var e, t = this._elements, o = t.length, n = 0; o > n; n++)
                e = t[n],
                e.hideAnt()
        },
        getLeft: function() {
            return this.getRect().left
        },
        getTop: function() {
            return this.getRect().top
        },
        getRealWidth: function() {
            return this.getBox().width
        },
        getShowWidth: function() {
            return this.getRealWidth() / i.ZOOM_IN
        },
        getWidth: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowWidth() * o
        },
        getRealHeight: function() {
            return this.getBox().height
        },
        getShowHeight: function() {
            return this.getRealHeight() / i.ZOOM_IN
        },
        getHeight: function() {
            var e = this._owner_page
              , t = e._owner_design
              , o = t.pageScale;
            return this.getShowHeight() * o
        },
        getRotate: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "rotate");
            return o[0]
        },
        getTranslateLeftTop: function() {
            var e = this.getRect()
              , t = this.getPage()
              , o = t.getRect()
              , n = t.getDesign().pageScale;
            return [(parseFloat(e.left) - parseFloat(o.left)) / n, (parseFloat(e.top) - parseFloat(o.top)) / n]
        },
        getShowTranslateLeftTop: function() {
            var t = this.getNode()
              , o = e.getTransformAttr(t.getAttribute("transform"), "translate");
            return [parseFloat(o[0]) / i.ZOOM_IN, parseFloat(o[1]) / i.ZOOM_IN]
        },
        overstepPageDel: function() {
            {
                var e = this.getRect()
                  , t = (e.left,
                e.top,
                e.right,
                e.bottom,
                this._owner_page)
                  , o = t.getRect();
                o.left,
                o.top,
                o.right,
                o.bottom
            }
        },
        removeAndUndo: function(e, t) {
            for (var o, n = this._elements, r = n.length, i = this.getPage(), s = i.getIndex(), a = i.getDesign(), g = [], d = 0; r > d; d++)
                o = n[d],
                g.push(o.getIndex());
            for (var d = 0; r > d; d++)
                o = n[d],
                i.eleDelAndUndoByChangeBackground(o);
            a.saveDesignAndUndo({
                obj: this,
                loc: "pages]" + s + "]elegroups]",
                key: this.id,
                value: this.getNewJson(),
                type: "3",
                action: "delElementGroup",
                eles_index: g
            }, t),
            this.remove(e)
        },
        remove: function() {
            {
                var e = this._owner_page
                  , t = (e.getIndex(),
                e._owner_design,
                this._elements);
                t.length,
                this.getNode()
            }
            e.eleGroupDel(this)
        },
        getIndex: function() {
            var e = this.getFirstChildIndex();
            return e
        },
        getFirstChildIndex: function() {
            var e = this._elements;
            if (void 0 != e[0]) {
                var t = e[0].getIndex();
                return t
            }
        },
        getLastChildIndex: function() {
            var e = this._elements
              , t = e.length
              , o = e[t - 1].getIndex();
            return o
        },
        changeIndex: function(e, o) {
            var n = this.getPage()
              , r = n.getDesign()
              , i = n.elements
              , s = this.getNode()
              , a = t(s)
              , g = this.getFirstChildIndex()
              , d = e.new_index;
            if (d !== g) {
                var l, h = i[d];
                l = h._group_drag ? h._element_group.getNode() : h.getNode();
                var _, u = t(l);
                g > d ? (u.before(a),
                _ = "groupmovedown") : (u.after(a),
                _ = "groupmoveup");
                var c = {
                    index: d,
                    element: this._elements,
                    action: "groupInsert"
                };
                if (n.elements = c,
                "noUndo" !== o) {
                    var f = [{
                        page_index: n.getIndex(),
                        ele_index: this.id,
                        mememto_id: window.MEMENTO_ID,
                        action: _
                    }];
                    r.mementos = f
                }
            }
        },
        moveUp: function(e) {
            var t, o, n = this.getLastChildIndex(), r = this._owner_page, i = r.elements, s = i.length, a = i[n + 1];
            if (a._group_drag)
                for (var g = n + 1; s > g; g++) {
                    var d = i[g]
                      , l = i[g]._group;
                    if (!d._group_drag || d._group_drag && void 0 != t && t != l) {
                        o = g - 1;
                        break
                    }
                    t = l
                }
            else
                o = n + 1;
            void 0 == o && (o = s - 1),
            this.changeIndex({
                new_index: o
            }, e);
            var h = r._owner_design
              , _ = h._owner_elementEditbar;
            _._owner_element = this,
            _.moveBtnSet()
        },
        moveDown: function(e) {
            var t, o, n = this.getFirstChildIndex(), r = this._owner_page, i = r.elements, s = (i.length,
            i[n - 1]);
            if (s._group_drag)
                for (var a = n - 1; a >= 0; a--) {
                    var g = i[a]
                      , d = i[a]._group;
                    if (!g._group_drag || g._group_drag && void 0 != t && t != d) {
                        o = a + 1;
                        break
                    }
                    t = d
                }
            else
                o = n - 1;
            0 == o && (o = 1),
            this.changeIndex({
                new_index: o
            }, e);
            var l = r._owner_design
              , h = l._owner_elementEditbar;
            h._owner_element = this,
            h.moveBtnSet()
        },
        groupMousePosition: function(t) {
            for (var o, n, r, i, s, a, g, d, l, h, _, u, c, f = t.pageX, p = t.pageY, v = this.getShowTranslateLeftTop(), m = this._owner_page, w = m.getRect(), N = m._owner_design, O = N.pageScale, y = this._elements, x = y.length, S = f - w.left, I = p - w.top, b = x - 1; b >= 0; b--)
                if (o = y[b],
                n = o.getRect(),
                r = o.getShowBox(),
                i = o.getShowTranslateLeftTop(),
                s = r.x + i[0] + v[0],
                a = s + r.width,
                g = r.y + i[1] + v[1],
                d = g + r.height,
                l = (s + r.width / 2) * O,
                h = (g + r.height / 2) * O,
                _ = e.coordinateRotate(S, I, parseFloat(o.getRotate()), l, h),
                u = _.x / O,
                c = _.y / O,
                d > c && c > g && a > u && u > s) {
                    o.dblclickInGroup(t);
                    break
                }
        },
        getNewJson: function() {
            var e = this._json;
            return e.transform = this.transform,
            JSON.parse(JSON.stringify(e))
        },
        setNewJson: function() {
            for (var t, o = this._elements, n = o.length, r = 0; n > r; r++)
                t = o[r],
                t.setNewJsonFormGroup();
            var s = this.getNode();
            this.transform = e.transformScale(s.getAttribute("transform"), 1 / i.ZOOM_IN)
        },
        undoValue: function(e) {
            var t = e.key
              , o = e.val;
            switch (t) {
            case "transform":
                this.undoTransform(o);
                break;
            case "lock":
                this.groupUndoLock(o)
            }
        },
        undoTransform: function(t) {
            var o = this.getNode();
            o.setAttribute("transform", e.transformScale(t, i.ZOOM_IN)),
            this.transform = {
                value: t,
                undo_drag: "noUndo"
            },
            this.addLeftTop(1, 1)
        },
        resetGroup: function(t) {
            this._json = t;
            var o = this.getJson()
              , n = this.getNode();
            n.setAttribute("transform", e.transformScale(o.transform, i.ZOOM_IN));
            for (var r, s = this._elements, a = s.length, g = 0; a > g; g++)
                r = s[g],
                r.setNewJsonFormGroup({
                    save_drag: !0
                })
        },
        groupSplitAndUndo: function(e) {
            for (var t, o = this.getPage(), n = o.getIndex(), r = o.getDesign(), i = [], s = this._elements, a = s.length, g = 0; a > g; g++)
                t = s[g],
                i.push(t.getIndex());
            this.groupSplit(e),
            r.saveDesignAndUndo({
                obj: this,
                loc: "pages]" + n + "]elegroups]",
                key: this.id,
                value: this.getNewJson(),
                type: "3",
                action: "delElementGroup",
                eles_index: i
            }, e)
        },
        groupSplit: function(e, o) {
            for (var n, r = this._elements, i = r.length, s = 0; i > s; s++)
                n = r[s],
                n.removeFormGroupAndUndo(e);
            t(this.getNode()).remove();
            var a = this._owner_page;
            a.element_groups = {
                index: this.id
            },
            a.nodeMousedown(),
            a._select_element = r,
            o || void 0 == r[0] || a.createCircleSelect()
        },
        groupPut: function() {
            if (!window.USERINFO.isGm)
                return void s.back({
                    str: "你没有提交权限哦！",
                    kind: "warning"
                });
            var o = prompt("关键字");
            if (o) {
                var n, r = this.getBox(), a = r.width, g = r.height, d = this._owner_page, l = d.getRect(), h = l.left, _ = l.top, u = this.getRect(), c = u.left - h, f = u.top - _, p = this._elements, v = p.length;
                this.groupSplit();
                for (var m = {
                    width: a / i.ZOOM_IN,
                    height: g / i.ZOOM_IN,
                    elems: []
                }, w = {
                    title: this.id,
                    v: "1.0.0",
                    pages: [m]
                }, N = 0; v > N; N++)
                    n = p[N],
                    n.addLeftTop(-c * i.ZOOM_IN, -f * i.ZOOM_IN),
                    n.transform = e.transformScale(n.getTransform(), 1 / i.ZOOM_IN),
                    m.elems[N] = n.getNewJson();
                d.nodeMousedown(),
                t.ajax({
                    url: "/material/saveCombMaterial.do",
                    dataType: "json",
                    type: "POST",
                    data: {
                        json: JSON.stringify(w),
                        t: w.title,
                        k: o
                    },
                    error: function() {
                        console.log("上传失败")
                    },
                    success: function() {}
                })
            }
        },
        setMoveOpacity: function(e) {
            var t = this.getNode();
            e ? t.setAttribute("opacity", ".5") : t.removeAttribute("opacity")
        },
        groupSetLock: function(t) {
            var o = this.lock;
            this.lock = "true" == o ? {
                value: "false",
                undo_drag: t
            } : {
                value: "true",
                undo_drag: t
            };
            for (var n, r = this._elements, i = r.length, s = 0; i > s; s++)
                n = r[s].getNode(),
                "true" === this._lock ? e.addClass(n, "elementsSonLock") : e.removeClass(n, "elementsSonLock")
        },
        groupUndoLock: function() {
            var t = this.lock;
            this.lock = "true" == t ? {
                value: "false",
                undo_drag: "noUndo"
            } : {
                value: "true",
                undo_drag: "noUndo"
            };
            for (var o, n = this._elements, r = n.length, i = 0; r > i; i++)
                o = n[i].getNode(),
                "true" === this._lock ? e.addClass(o, "elementsSonLock") : e.removeClass(o, "elementsSonLock")
        },
        uplateTextEleLoaded: function(e) {
            var t = this;
            e ? t._text_ele_loaded++ : t._text_ele_loaded--;
            {
                var o = t._owner_page
                  , n = o._owner_design
                  , r = n._owner_editDiv
                  , i = n._owner_elementEditbar;
                t._elements
            }
            void 0 != r && r._owner_element == t && r.setGroupEdit(),
            void 0 != i && i._owner_element == t && i.groupEditbarSet(),
            t._text_ele_sum === t._text_ele_loaded && t.nodeClick()
        }
    },
    e.classExtend(h, n),
    h
});
;/*!/compapi/design/widgets/Page.js*/
"use strict";
define("compapi/design/widgets/Page", ["compapi/b", "compapi/design/Chuangkit", "compapi/design/widgets/DataWidget", "components/jquery/jquery", "compapi/design/design_config", "compapi/design/toolbar/PageEditbar", "compapi/design/widgets/Img", "compapi/design/widgets/Svg", "compapi/design/widgets/Chart", "compapi/design/widgets/Text", "libs/jquery/jquery.transit.min", "compapi/design/widgets/CircleSelect", "compapi/design/widgets/ElementGroup", "comp/config/global_config"], function(e, t, o, i, n, r, a, s, d, l, h, g, p) {
    function f(e, t) {
        var o = this;
        o._owner_design = e,
        o._elements = [],
        o._element_groups = {},
        o._focus_drag = !1,
        o._owner_pageEditbar = null,
        o._select_element = [],
        o._circleSelect = [],
        o._svgLayoutNum = 0,
        o._background_updata_drag = !1,
        o._svgLayoutCheek = {
            index: 0,
            imgIndex: 0
        },
        e.addPage(o, t);
        var n = o.getNode()
          , r = e.getNode();
        void 0 == t ? r.appendChild(n) : t - 1 == -1 ? i(r).prepend(n) : i(".page").eq(t - 1).after(n),
        c.call(o),
        u.call(o),
        m.call(o),
        "true" === e.bleed && this.showBleedBorder()
    }
    function u() {
        var e = this
          , t = e.getJson()
          , o = {
            width: t.width,
            height: t.height
        };
        e.pageWH = o,
        e._width = t.width,
        e._height = t.height;
        var i = e._owner_design;
        0 === i.pageScale ? i.setPageScale() : i.setPageScale(i.pageScale)
    }
    function m() {
        var e = this
          , t = e.getNode();
        window.addEventListener ? (t.addEventListener("mousedown", function(t) {
            return 0 != t.button ? !1 : void (e._owner_design._focus_page != e ? e.nodeMouseenter() : e.nodeMousedown())
        }, !1),
        t.addEventListener("mouseenter", function(e) {
            return 0 != e.button ? !1 : void 0
        }, !1)) : window.attachEvent && (t.attachEvent("onmousedown", function(t) {
            return 0 != t.button ? !1 : void e.nodeMousedown()
        }),
        t.attachEvent("onmouseenter", function(e) {
            return 0 != e.button ? !1 : void 0
        }))
    }
    function c() {
        var t = this
          , o = t._owner_design
          , i = "pages]";
        e.dataBinding({
            obj: t,
            prop_name: "width",
            getFun: e.$noop,
            setFun: function(e) {
                var n = !0
                  , r = e;
                "object" == typeof e && (r = e.value,
                n = e.undo_drag),
                o.saveDesignAndUndo({
                    obj: t,
                    loc: i + t.getIndex() + "]",
                    key: "width",
                    value: r,
                    type: "0",
                    action: "changePage"
                }, n)
            }
        }),
        e.dataBinding({
            obj: t,
            prop_name: "height",
            getFun: e.$noop,
            setFun: function(e) {
                var n = !0
                  , r = e;
                "object" == typeof e && (r = e.value,
                n = e.undo_drag),
                o.saveDesignAndUndo({
                    obj: t,
                    loc: i + t.getIndex() + "]",
                    key: "height",
                    value: r,
                    type: "0",
                    action: "changePage"
                }, n)
            }
        })
    }
    var _ = function(t, n, a) {
        var s = this;
        o.call(s, n),
        f.call(s, t, a);
        new r(s);
        if (!e.isNull(n)) {
            var d = n.elems
              , l = !1;
            if (d)
                for (var h in d)
                    if ("background" == d[h]["data-type"]) {
                        l = !0;
                        break
                    }
            if (!l) {
                var g = {
                    "data-type": "background",
                    "data-elem": {
                        filter: {
                            brightness: 0,
                            contrast: 0,
                            crossProcess: 0,
                            gaussianBlur: 0,
                            saturation: 0,
                            tint: 0
                        },
                        "data-key": "false",
                        width: n.width,
                        height: n.height,
                        opacity: "1",
                        "data-colors": {
                            0: "rgb(255, 255, 255)"
                        }
                    },
                    transform: "translate(0,0)",
                    reverse: ""
                };
                d.splice(0, 0, g)
            }
            if (d)
                for (var p in d) {
                    var u = d[p];
                    if ("background" == u["data-type"] && 0 == u["data-elem"].opacity && i(this.getNode()).addClass("page-transparent"),
                    void 0 != u && null != u)
                        var m = s.createElement(u)
                }
            var c, _ = n.elegroups, v = this._elements, b = v.length;
            if (_)
                for (var w in _) {
                    c = [];
                    for (var y = _[w], h = 0; b > h; h++) {
                        var m = v[h];
                        m.getJson().group == w && c.push(m)
                    }
                    this.createElementGroup(c, {
                        id: w,
                        transform: y.transform,
                        lock: y.lock
                    })
                }
        }
    };
    return _.prototype = {
        constructor: _,
        _json: {},
        _svgLayoutCheek: {
            index: 0,
            imgIndex: 0
        },
        createWidget: function() {
            var t = e.createNode("section", "page page-no-focus")
              , o = e.createSvgNode("svg")
              , i = e.createNode("div", "page_menu")
              , n = e.createNode("div", "bleed_top bleed_border")
              , r = e.createNode("div", "bleed_right bleed_border")
              , a = e.createNode("div", "bleed_bottom bleed_border")
              , s = e.createNode("div", "bleed_left bleed_border")
              , d = e.createNode("div", "bleed_ruler_top_left bleed_ruler")
              , l = e.createNode("div", "bleed_ruler_top_right bleed_ruler")
              , h = e.createNode("div", "bleed_ruler_right_top bleed_ruler")
              , g = e.createNode("div", "bleed_ruler_right_bottom bleed_ruler")
              , p = e.createNode("div", "bleed_ruler_bottom_right bleed_ruler")
              , f = e.createNode("div", "bleed_ruler_bottom_left bleed_ruler")
              , u = e.createNode("div", "bleed_ruler_left_top bleed_ruler")
              , m = e.createNode("div", "bleed_ruler_left_bottom bleed_ruler")
              , c = e.createNode("div", "bleed_line_top bleed_line")
              , _ = e.createNode("div", "bleed_line_bottom bleed_line");
            if (t.appendChild(o),
            t.appendChild(n),
            t.appendChild(r),
            t.appendChild(a),
            t.appendChild(s),
            t.appendChild(d),
            t.appendChild(l),
            t.appendChild(h),
            t.appendChild(g),
            t.appendChild(p),
            t.appendChild(f),
            t.appendChild(u),
            t.appendChild(m),
            t.appendChild(c),
            t.appendChild(_),
            2 == window.split) {
                var v = e.createNode("div", "center-line");
                t.appendChild(v)
            } else if (3 == window.split) {
                var b = e.createNode("div", "three-first-line")
                  , w = e.createNode("div", "three-secend-line");
                t.appendChild(w),
                t.appendChild(b)
            }
            return t.appendChild(i),
            t
        },
        getPageSvg: function() {
            return this.getNode().firstChild
        },
        getRect: function() {
            var e = this.getPageSvg().getBoundingClientRect();
            return {
                top: e.top,
                right: e.right,
                bottom: e.bottom,
                left: e.left,
                height: e.height,
                width: e.width
            }
        },
        _width: 0,
        _height: 0,
        set pageWH(e) {
            this._width = e.width,
            this._height = e.height;
            var t = this._elements[0];
            if (void 0 != t) {
                var o = t.getNode();
                i(o).find(".background-color").size() > 0 && (i(o).find(".background-color").attr({
                    width: this._width * n.ZOOM_IN,
                    height: this._height * n.ZOOM_IN
                }),
                t.resetWH())
            }
            this.setSvgViewBox()
        },
        get pageWH() {
            var e = {
                width: this._width,
                height: this._height
            };
            return e
        },
        _elements: [],
        set elements(e) {
            var t = this._owner_design
              , o = ("pages]" + this.getIndex() + "]elems]",
            this.getJson())
              , i = o.elems
              , n = e.element
              , r = e.index
              , a = this._elements;
            if (-1 == r)
                this._elements = [],
                i = [];
            else if (r >= 0 && void 0 == n)
                this._elements.splice(r, 1);
            else if ("insert" == e.action) {
                var s = n.getIndex();
                this._elements.splice(s, 1),
                this._elements.splice(r, 0, n)
            } else if ("groupInsert" == e.action) {
                var d, l = n.length, s = n[0].getIndex();
                if (s > r)
                    for (var h = l - 1; h >= 0; h--)
                        d = n[h].getIndex(),
                        this._elements.splice(n[h].getIndex(), 1),
                        this._elements.splice(r, 0, n[h]),
                        t.saveDesignAndUndo({
                            obj: n[h],
                            loc: "pages]" + this.getIndex() + "]elems]",
                            key: d,
                            tidx: r,
                            type: 2,
                            action: "moveIndex"
                        }, "noUndo");
                else
                    for (var h = 0; l > h; h++)
                        d = n[h].getIndex(),
                        this._elements.splice(n[h].getIndex(), 1),
                        this._elements.splice(r, 0, n[h]),
                        t.saveDesignAndUndo({
                            obj: n[h],
                            loc: "pages]" + this.getIndex() + "]elems]",
                            key: d,
                            tidx: r,
                            type: 2,
                            action: "moveIndex"
                        }, "noUndo")
            } else
                a.indexOf(n) < 0 && this._elements.splice(r, 0, n)
        },
        get elements() {
            return this._elements
        },
        _element_groups: {},
        set element_groups(e) {
            var t = this.getJson()
              , o = t.elegroups
              , i = e.element_group
              , n = e.index;
            -1 == n && (this._element_group = {},
            o = {}),
            void 0 == i ? delete this._element_groups[n] : this._element_groups[n] = i
        },
        get element_groups() {
            return this._element_groups
        },
        getDesign: function() {
            return this._owner_design
        },
        onload: function(e) {
            var t = this;
            for (var o in e)
                var i = e[o], n = t.createElement(i)
        },
        setSvgViewBox: function() {
            var e = {
                width: this._width,
                height: this._height
            }
              , t = this.getPageSvg();
            t.setAttribute("viewBox", "0 0 " + e.width * n.ZOOM_IN + " " + e.height * n.ZOOM_IN)
        },
        getLeft: function() {
            var e = this.getNode();
            return e.getBoundingClientRect().left
        },
        getTop: function() {
            var e = this.getNode();
            return e.getBoundingClientRect().top
        },
        setShowWH: function(e, t) {
            var o = this._width
              , i = this._height
              , r = o * e
              , a = i * e
              , s = this.getNode()
              , d = this.getPageSvg()
              , l = n.DESIGN_BLANK
              , h = t * (a + l.top);
            s.style.width = r + "px",
            s.style.height = a + "px",
            s.style.top = h + "px",
            d.setAttribute("width", r),
            d.setAttribute("height", a)
        },
        active: function() {
            this._focus_drag = !0
        },
        getIndex: function() {
            for (var e = this._owner_design, t = e.pages, o = e.getPageSum(), i = 0; o > i; i++)
                if (this == t[i])
                    return i;
            return -1
        },
        getElementSum: function() {
            return this.elements.length
        },
        getElement: function(e) {
            var t = this.elements;
            return t[e]
        },
        createElementAndUndo: function(e, t) {
            var o, i = this.insertElement(e), n = this.getIndex(), r = this.getDesign();
            return o = "svgChart" == i._element_type ? i.getNewJson() : i.getJson(),
            r.saveDesignAndUndo({
                obj: i,
                loc: "pages]" + n + "]elems]",
                key: i.getIndex(),
                value: o,
                type: 0,
                action: "addMaterial",
                unshift: e.unshift
            }, t),
            i
        },
        createElement: function(e) {
            var t, o = e["data-type"];
            switch (o) {
            case "background":
            case "img":
                t = new a(this,e);
                break;
            case "svgImage":
            case "svgFrame":
                t = new s(this,e);
                break;
            case "text":
                t = new l(this,e);
                break;
            case "svgChart":
                t = new d(this,e);
                break;
            default:
                console.log("元素类型:" + o + "未定义")
            }
            return t
        },
        addElement: function(e, t) {
            void 0 == t && (t = this.getElementSum());
            var o = {
                index: t,
                element: e
            };
            if (void 0 != e) {
                "background" == e.getJson()["data-type"] && (o.index = 0);
                var n = e.getNode()
                  , r = this.getPageSvg()
                  , a = this.elements;
                if (e.isBackground() && void 0 != a[0] && a[0].isBackground()) {
                    var s = a[0];
                    if (r.removeChild(r.firstChild),
                    void 0 == s)
                        return;
                    {
                        JSON.parse(JSON.stringify(s.getJson())),
                        this.getIndex()
                    }
                    this._background_updata_drag = !0;
                    {
                        this._owner_design
                    }
                    this.elements = {
                        index: 0
                    }
                }
                if (void 0 != a[0] && e.isBackground() || "background" === e.getJson()["data-type"])
                    r.insertBefore(n, r.firstChild);
                else {
                    var d = a[t];
                    void 0 == d ? r.appendChild(n) : d._group_drag ? i(d._element_group.getNode()).before(n) : i(d.getNode()).before(n)
                }
                this.elements = o
            }
        },
        addElementGroup: function(t) {
            var o = t.width
              , n = t.height
              , r = e.getTransformAttr(t.json.transform, "translate")
              , a = parseFloat(r[0])
              , s = parseFloat(r[1])
              , d = this;
            i.ajax({
                url: t.fileurl,
                type: "GET",
                error: function() {
                    console.log("返回elementgroup素材错误")
                },
                complete: function(t) {
                    for (var i, t, r, l, h, g, p, f, u = t.responseText, m = JSON.parse(u), c = m.pages[0].width, _ = m.pages[0].height, v = [], b = m.pages[0].elems, w = b.length, y = 0; w > y; y++)
                        i = b[y],
                        t = i["data-elem"],
                        t.width = o * t.width / c,
                        t.height = n * t.height / _,
                        r = e.transformScale(i.transform, o / c),
                        l = e.getTransformAttr(r, "translate"),
                        l = [parseFloat(l[0]) + a, parseFloat(l[1]) + s],
                        g = e.getTransformAttr(r, "rotate"),
                        r = e.setTransformAttr(r, "translate", l),
                        i.transform = e.setTransformAttr(r, "rotate", g),
                        "text" == i["data-type"] && (t["font-size"] = t["font-size"] * o / c),
                        i["group-transform"] && (i["group-transform"] = e.transformScale(i["group-transform"], o / c)),
                        p = i.reverse,
                        f = e.getTransformAttr(p, "translate"),
                        f = [f[0] * o / c, f[1] * o / c],
                        i.reverse = e.setTransformAttr(p, "translate", f),
                        h = d.createElementAndUndo({
                            json: i,
                            unshift: !0
                        }),
                        v.push(h);
                    var x = d.createElementGroupAndUndo(v, {
                        unshift: !0
                    });
                    x.nodeClick()
                }
            })
        },
        insertElement: function(e) {
            var t, o = e.json, i = e.index || this.getElementSum(), n = o["data-type"];
            switch (n) {
            case "background":
            case "img":
                t = new a(this,o,i);
                break;
            case "svgImage":
            case "svgFrame":
                t = new s(this,o,i);
                break;
            case "text":
                t = new l(this,o,i);
                break;
            case "svgChart":
                t = new d(this,o,i);
                break;
            default:
                console.log("元素类型:" + n + "未定义")
            }
            return t
        },
        moveUp: function(t) {
            var o = this
              , i = this.getIndex()
              , n = this._owner_design
              , r = n.pages;
            e.swapItems(r, i, i - 1),
            n.saveDesignAndUndo({
                obj: o,
                loc: "pages]",
                key: i,
                tidx: i - 1,
                type: 2,
                action: "pageMoveUp"
            }, t)
        },
        moveDown: function(t) {
            var o = this
              , i = this.getIndex()
              , n = this._owner_design
              , r = n.pages;
            e.swapItems(r, i, i + 1),
            n.saveDesignAndUndo({
                obj: o,
                loc: "pages]",
                key: i,
                tidx: i + 1,
                type: 2,
                action: "pageMoveDown"
            }, t)
        },
        copyAndUndo: function(e) {
            var t = this.copy()
              , o = this.getDesign();
            return o.saveDesignAndUndo({
                obj: t,
                loc: "pages]",
                key: t.getIndex(),
                value: t.getJson(),
                type: 0,
                action: "addPage"
            }, e),
            t
        },
        copy: function() {
            var e = this.getNewJson()
              , t = this.getIndex()
              , o = this._owner_design
              , i = new _(o,e,t + 1);
            return i.nodeMousedown(),
            o.setPageScale(o.pageScale),
            i
        },
        clear: function() {
            var e, t = (this.getPageSvg(),
            this._owner_design,
            this.elements), o = t.length;
            if (0 != o) {
                var i, n = this.element_groups;
                for (var r in n)
                    i = n[r],
                    i.groupSplitAndUndo();
                for (var a = t.length - 1; a >= 0; a--)
                    e = t[a],
                    void 0 != e && (e._group && (i = n[r],
                    i.removeAndUndo()),
                    this.eleDelAndUndoByChangeBackground(e))
            }
        },
        clearOld: function(e) {
            var t, o, i = this.getPageSvg(), n = this._owner_design, r = this.elements, a = r.length, s = this.getIndex(), d = [];
            if (0 != a) {
                var l, h = this.element_groups, g = [], p = 0;
                for (var f in h)
                    l = h[f],
                    o = JSON.parse(JSON.stringify(l.getJson())),
                    l.groupSplit(!0);
                for (f = 0; a > f; f++)
                    t = r[f],
                    void 0 != t && (o = JSON.parse(JSON.stringify(t.getJson())),
                    d[f] = {
                        page_num: s,
                        element_num: f,
                        old_json: o,
                        now_json: "",
                        action: "del"
                    });
                for (p = 0; p < g.length; p++)
                    d[f + p] = g[p];
                e || (n.mementos = d);
                for (var u, f = 0; a > f; f++)
                    u = r[f].getNode(),
                    i.removeChild(u),
                    r[f] = null;
                this.getJson().elems = [];
                var m = {
                    index: -1
                };
                this.elements = m,
                this.element_groups = m
            }
        },
        nodeMousedown: function(o) {
            if (1 != window.CTRL_PRESS) {
                var n = this._owner_design
                  , r = n._owner_editDiv;
                if (null != r) {
                    for (var a = r.getNode(), s = n._owner_elementEditbar, d = (s.getNode(),
                    r._owner_element), l = [], h = 0; h < i(".elementsSonEnter").size(); h++)
                        l.push(i(".elementsSonEnter").eq(h)[0]);
                    for (var g = 0; g < l.length; g++)
                        e.removeClass(l[g], "elementsSonEnter");
                    if (this._select_element = [],
                    "block" == i(".ss-function-colorPicker").attr("data-block") && t.colorPickupHide(i(".edit-color-span-pickup.now-click"), d, o),
                    i(".edit-div-clone").size() > 0 && i(".edit-div-clone").detach(),
                    i(".editdiv-clone").hasClass("editdiv-clone-text") && n._focus_element.finishInput(d),
                    "block" === a.style.display) {
                        n._focus_element = null;
                        {
                            i(d.getNode())
                        }
                        d._focus_drag && d.finishInput(),
                        a.style.display = "none",
                        r._owner_element = null,
                        s.hideNode()
                    }
                    i("#chartMenuBtn").hasClass("listBtnClick") && t.initChartBtn(null),
                    i(".edit-div-write-wrap").size() > 0 && i(".edit-div-write-wrap").remove(),
                    i(".editdiv-clone").detach()
                }
            }
        },
        nodeMouseenter: function() {
            var e = this._owner_design
              , t = e._focus_page;
            null != e._focus_page && i(e._focus_page.getNode()).addClass("page-no-focus"),
            e._focus_page = this,
            i(this.getNode()).removeClass("page-no-focus"),
            t != this && this.nodeMousedown()
        },
        svgLayoutWrapCreate: function() {
            var e, t, o, t, n = this.getNode(), r = i(n), a = this.elements, s = a.length, d = r.clone();
            d.find("svg").children().remove();
            var l = this.getLeft()
              , h = this.getTop();
            d.attr("class", "page-clone").appendTo(i("body")),
            d.css("z-index", 10001).offset({
                left: l,
                top: h
            }),
            this._svgLayoutCheek.index = 0,
            this._svgLayoutCheek.imgIndex = 0;
            for (var g = 0; s > g; g++)
                if (o = a[g],
                t = i(o.getNode()),
                "svgLayout" == o._svg_type) {
                    e = t.clone(),
                    e.attr("class", "svgLayout-clone").find(".layoutImgWrap").attr("data-index", g),
                    e.find(".wonAd").each(function() {
                        var e = i(this).attr("id") + "bianhao";
                        i(this).attr("id", e),
                        i(this).parent().find(".layoutImgWrap").attr("clip-path", "url(#" + e + ")")
                    });
                    var p = e.find("filter").attr("id") + "bianhao";
                    e.find("filter").attr("id", p),
                    e.find(".layoutImgWrap").attr("filter", "url(#" + p + ")"),
                    d.children("svg").append(e)
                }
        },
        svgLayoutEnter: function(e, t) {
            var o = this
              , n = i(".page-clone");
            n.find(".svgLayout-clone").find(".layoutImgWrap").mouseenter(function() {
                var t = i(this);
                e.drag = !0,
                e.index = t.attr("data-index"),
                e.imgIndex = t.parentsUntil(".svgLayout-clone").find(".layoutImgWrap").index(this)
            }).mouseleave(function() {
                e.drag = !1
            });
            var r = o.getElement(e.index)
              , a = r.getNode()
              , s = i(a)
              , d = s.find(".layoutImgWrap").eq(e.imgIndex).children()
              , l = 1;
            if ("img" == t._element_type) {
                var h = t;
                t = i(t.getNode()),
                l = "NAN"
            }
            if (e.drag) {
                if (o._svgLayoutCheek.index != e.index || o._svgLayoutCheek.imgIndex != e.imgIndex) {
                    var g = o.getElement(o._svgLayoutCheek.index)
                      , p = i(g.getNode()).find(".layoutImgWrap").eq(o._svgLayoutCheek.imgIndex).children();
                    p.attr({
                        "xlink:href": p.attr("data-old") || "",
                        width: p.attr("data-width") || "",
                        height: p.attr("data-height") || "",
                        x: p.attr("data-x") || "",
                        y: p.attr("data-y") || "",
                        transform: p.attr("data-transform") || ""
                    })
                }
                o._svgLayoutCheek.index = e.index,
                o._svgLayoutCheek.imgIndex = e.imgIndex,
                "elementsSon imgSon" == t[0].getAttribute("class") ? d.attr("xlink:href", t.find("image")[0].href.baseVal) : d.attr("xlink:href", t.children().attr("src"));
                var f;
                d.parent().parent().find("rect").size() > 0 ? f = d.parent().parent().find("rect") : d.parent().parent().find("circle").size() > 0 ? f = d.parent().parent().find("circle") : d.parent().parent().find("ellipse").size() > 0 ? f = d.parent().parent().find("ellipse") : d.parent().parent().find("line").size() > 0 ? f = d.parent().parent().find("line") : d.parent().parent().find("polyline").size() > 0 ? f = d.parent().parent().find("polyline") : d.parent().parent().find("polygon").size() > 0 ? f = d.parent().parent().find("polygon") : d.parent().parent().find("path").size() > 0 && (f = d.parent().parent().find("path"));
                var u = f[0].getBBox()
                  , m = u.width
                  , c = u.height
                  , _ = u.x
                  , v = u.y
                  , b = t.getWidth()
                  , w = t.getHeight();
                if ((0 == b || 0 == w) && (b = h.getWidth(),
                w = h.getHeight()),
                b / m > w / c) {
                    var y = m;
                    m = c / (w / b),
                    _ -= (m - y) / 2
                } else {
                    var x = c;
                    c = m / (b / w),
                    v -= (c - x) / 2
                }
                d.attr({
                    width: m,
                    height: c,
                    x: _,
                    y: v,
                    transform: ""
                }),
                t.css("opacity", ".4"),
                o.svgLayoutShowTipsShow(t)
            } else
                d.attr({
                    "xlink:href": d.attr("data-old") || "",
                    width: d.attr("data-width") || "",
                    height: d.attr("data-height") || "",
                    x: d.attr("data-x") || "",
                    y: d.attr("data-y") || "",
                    transform: d.attr("data-transform") || ""
                }),
                "NAN" == l ? t.css("opacity", "") : t.css("opacity", l),
                o.svgLayoutShowTipsHide()
        },
        svgLayoutShowTipsShow: function(e) {
            var t = e[0].getBoundingClientRect();
            i(".enterSvgLayout").css({
                left: (t.left + t.right) / 2,
                top: t.bottom + 8,
                display: "block"
            })
        },
        svgLayoutShowTipsHide: function() {
            i(".enterSvgLayout").css("display", "none")
        },
        svgLayoutWrapRemove: function(t, o) {
            if (i(".page-clone").remove(),
            i(".enterSvgLayout").css("display", "none"),
            t.drag) {
                var n, r, a = this.getElement(t.index), s = i(a.getNode()), d = s.find(".layoutImgWrap").eq(t.imgIndex).children();
                if ("img" == o._element_type ? (n = o.getImgKey(),
                r = o.getImgId()) : (n = o.children().attr("alt"),
                r = o.children().attr("data-id")),
                d.attr({
                    "data-old": d.attr("xlink:href"),
                    "data-key": n,
                    "data-width": d.attr("width"),
                    "data-height": d.attr("height"),
                    "data-x": d.attr("x"),
                    "data-y": d.attr("y"),
                    "data-transform": d.attr("transform"),
                    "data-id": r
                }),
                void 0 == n)
                    d.removeAttr("data-key"),
                    i.ajax({
                        url: "/material/getMaterialUrlsByIds.do",
                        type: "POST",
                        dataType: "json",
                        data: {
                            mids: r,
                            w: 800
                        },
                        success: function(e) {
                            var t = new Image;
                            t.src = e.urls[r],
                            t.onload = function() {
                                d.attr({
                                    "data-old": t.src,
                                    "xlink:href": t.src
                                })
                            }
                        },
                        error: function() {}
                    });
                else {
                    var l = new Image;
                    l.src = "//" + img_config.imgdomain + "/materials/" + n + "@0e_800w_800h_0c_0i_0o_1x.png",
                    l.onload = function() {
                        d.attr({
                            "data-old": l.src,
                            "xlink:href": l.src
                        })
                    }
                }
                window.MEMENTO_ID = e.now(),
                a.setLayout(),
                "img" == o._element_type && this.eleDelAndUndo(o)
            }
        },
        elementsPositionNotThis: function(e) {
            var t = this.elements
              , o = (this.getDesign(),
            t.length)
              , n = this.getRect();
            3 != window.split ? n.middle_x = (n.left + n.right) / 2 : (n.three_first = n.left + (n.right - n.left) * (parseFloat(i(".three-first-line")[0].style.left) / 100),
            n.three_secend = n.left + (n.right - n.left) * (parseFloat(i(".three-secend-line")[0].style.left) / 100)),
            n.middle_y = (n.top + n.bottom) / 2;
            for (var r, a, s, d = {
                0: n
            }, l = 1, h = e.length, g = 0; o > g; g++) {
                r = t[g],
                s = !1;
                for (var p = 0; h > p; p++)
                    r != e[p] || (s = !0);
                s || void 0 != r && (a = r.getRect(),
                a.middle_x = (a.left + a.right) / 2,
                a.middle_y = (a.top + a.bottom) / 2,
                d[l] = a,
                d[l].i = g,
                l++)
            }
            return d
        },
        flickerBackground: function(t) {
            var o = e.createNode("div", "background-flicker")
              , n = i(o)
              , r = this.getDesign()
              , a = r.pageScale
              , s = e.getTransformAttr(t.transform, "translate");
            n.css({
                width: parseFloat(this.pageWH.width) * a,
                height: parseFloat(this.pageWH.height) * a,
                position: "absolute",
                left: "0px",
                top: "0px",
                overflow: "hidden"
            });
            var d = new Image;
            d.src = window.imgsrc;
            var l = i(d);
            l.css({
                width: parseFloat(t.width) * a,
                height: parseFloat(t.height) * a,
                position: "absolute",
                left: parseFloat(s[0]) * a,
                top: parseFloat(s[1]) * a
            }),
            n.append(d);
            var h = this.getNode()
              , g = i(h);
            g.append(n),
            setTimeout(function() {
                n.detach()
            }, 500)
        },
        guideSetElementPosition: function(t, o) {
            for (var i, n = o[0].left - t.left, r = o[0].top - t.top, a = e.jsonLength(o), s = 0; a > s; s++)
                i = o[s],
                Math.abs(n) > Math.abs(i.left - t.left) && (n = i.left - t.left),
                Math.abs(n) > Math.abs(i.middle_x - t.left) && (n = i.middle_x - t.left),
                Math.abs(n) > Math.abs(i.right - t.left) && (n = i.left - t.left),
                3 == window.split && 0 == s && (Math.abs(n) > Math.abs(i.three_first - t.left) && (n = i.three_first - t.left),
                Math.abs(n) > Math.abs(i.three_secend - t.left) && (n = i.three_secend - t.left)),
                Math.abs(n) > Math.abs(i.left - t.middle_x) && (n = i.left - t.middle_x),
                Math.abs(n) > Math.abs(i.middle_x - t.middle_x) && (n = i.middle_x - t.middle_x),
                Math.abs(n) > Math.abs(i.right - t.middle_x) && (n = i.right - t.middle_x),
                3 == window.split && 0 == s && (Math.abs(n) > Math.abs(i.three_first - t.middle_x) && (n = i.three_first - t.middle_x),
                Math.abs(n) > Math.abs(i.three_secend - t.middle_x) && (n = i.three_secend - t.middle_x)),
                Math.abs(n) > Math.abs(i.left - t.right) && (n = i.left - t.right),
                Math.abs(n) > Math.abs(i.middle_x - t.right) && (n = i.middle_x - t.right),
                Math.abs(n) > Math.abs(i.right - t.right) && (n = i.right - t.right),
                3 == window.split && 0 == s && (Math.abs(n) > Math.abs(i.three_first - t.right) && (n = i.three_first - t.right),
                Math.abs(n) > Math.abs(i.three_secend - t.right) && (n = i.three_secend - t.right)),
                Math.abs(r) > Math.abs(i.top - t.top) && (r = i.top - t.top),
                Math.abs(r) > Math.abs(i.middle_y - t.top) && (r = i.middle_y - t.top),
                Math.abs(r) > Math.abs(i.bottom - t.top) && (r = i.bottom - t.top),
                Math.abs(r) > Math.abs(i.top - t.middle_y) && (r = i.top - t.middle_y),
                Math.abs(r) > Math.abs(i.top_middle_drag - t.middle_y) && (r = i.middle_y - t.middle_y),
                Math.abs(r) > Math.abs(i.bottom - t.middle_y) && (r = i.bottom - t.middle_y),
                Math.abs(r) > Math.abs(i.top - t.bottom) && (r = i.top - t.bottom),
                Math.abs(r) > Math.abs(i.middle_y - t.bottom) && (r = i.middle_y - t.bottom),
                Math.abs(r) > Math.abs(i.bottom - t.bottom) && (r = i.bottom - t.bottom);
            return Math.abs(n) <= 4 && (t.left = parseFloat(t.left) + n,
            t.middle_x = parseFloat(t.middle_x) + n,
            t.right = parseFloat(t.right) + n),
            Math.abs(r) <= 4 && (t.top = parseFloat(t.top) + r,
            t.middle_y = parseFloat(t.middle_y) + r,
            t.bottom = parseFloat(t.bottom) + r),
            t
        },
        guideShow: function(t, o) {
            var n = this.getRect();
            n.middle_x = (n.left + n.right) / 2,
            n.middle_y = (n.top + n.bottom) / 2;
            {
                var r, a = n.right - n.left, s = n.bottom - n.top, d = e.jsonLength(o), l = i("#div_design"), h = this._elements, g = h[t.i];
                i(this.getPageSvg())
            }
            t = this.guideSetElementPosition(t, o),
            i(".moveGuide").detach();
            for (var p = 0; p < i(".elementsSonEnter").size(); p++)
                g.getNode() != i(".elementsSonEnter").eq(p)[0] ? e.removeClass(i(".elementsSonEnter").eq(p)[0], "elementsSonEnter") : e.addClass(i(".elementsSonEnter").eq(p)[0], "elementsSonEnter");
            for (var f = 0; d > f; f++) {
                if (r = o[f],
                "false" != t.left_drag && (Math.round(t.left) == Math.round(r.left) || Math.round(t.left) == Math.round(r.middle_x) || Math.round(t.left) == Math.round(r.right))) {
                    var u, m, c = i("<div class='moveGuideV moveGuide'></div>"), _ = i("#div_design").offset().top;
                    r.top > t.bottom ? (u = (t.bottom - t.top + r.bottom - r.top) / 2 + (r.top - t.bottom),
                    m = (t.bottom + t.top) / 2 - _) : r.top < t.bottom && (u = (t.bottom - t.top + r.bottom - r.top) / 2 + (t.top - r.bottom),
                    m = (r.bottom + r.top) / 2 - _),
                    c.css({
                        width: "1px",
                        height: u,
                        position: "absolute"
                    }),
                    c.css(void 0 == r.i ? {
                        background: "url(" + i(".guidelineVImgR").attr("src") + ")",
                        height: s
                    } : {
                        background: "url(" + i(".guidelineVImg").attr("src") + ")",
                        top: m
                    }),
                    c.appendTo(l),
                    c.offset({
                        left: t.left
                    }),
                    t.left_drag = "false",
                    void 0 != r.i && h[r.i].showAnt()
                }
                if ("false" != t.middle_x_drag && (Math.round(t.middle_x) == Math.round(r.left) || Math.round(t.middle_x) == Math.round(r.middle_x) || Math.round(t.middle_x) == Math.round(r.right))) {
                    var u, m, c = i("<div class='moveGuideV moveGuide'></div>"), _ = i("#div_design").offset().top;
                    r.top > t.bottom ? (u = (t.bottom - t.top + r.bottom - r.top) / 2 + (r.top - t.bottom),
                    m = (t.bottom + t.top) / 2 - _) : r.top < t.bottom && (u = (t.bottom - t.top + r.bottom - r.top) / 2 + (t.top - r.bottom),
                    m = (r.bottom + r.top) / 2 - _),
                    c.css({
                        width: "1px",
                        height: u,
                        position: "absolute"
                    }),
                    c.css(void 0 == r.i ? {
                        background: "url(" + i(".guidelineVImgR").attr("src") + ")",
                        height: s
                    } : {
                        background: "url(" + i(".guidelineVImg").attr("src") + ")",
                        top: m
                    }),
                    c.appendTo(l),
                    c.offset({
                        left: t.middle_x
                    }),
                    t.middle_x_drag = "false",
                    void 0 != r.i && h[r.i].showAnt()
                }
                if ("false" != t.right_drag && (Math.round(t.right) == Math.round(r.left) || Math.round(t.right) == Math.round(r.middle_x) || Math.round(t.right) == Math.round(r.right))) {
                    var u, m, c = i("<div class='moveGuideV moveGuide'></div>"), _ = i("#div_design").offset().top;
                    r.top > t.bottom ? (u = (t.bottom - t.top + r.bottom - r.top) / 2 + (r.top - t.bottom),
                    m = (t.bottom - t.top) / 2 + t.top - _) : r.top < t.bottom && (u = (t.bottom - t.top + r.bottom - r.top) / 2 + (t.top - r.bottom),
                    m = (r.bottom + r.top) / 2 - _),
                    c.css({
                        width: "1px",
                        height: u,
                        position: "absolute"
                    }),
                    c.css(void 0 == r.i ? {
                        background: "url(" + i(".guidelineVImgR").attr("src") + ")",
                        height: s
                    } : {
                        background: "url(" + i(".guidelineVImg").attr("src") + ")",
                        top: m
                    }),
                    c.appendTo(l),
                    c.offset({
                        left: t.right
                    }),
                    t.right_drag = "false",
                    void 0 != r.i && h[r.i].showAnt()
                }
                if ("false" != t.top_drag && (Math.round(t.top) == Math.round(r.top) || Math.round(t.top) == Math.round(r.middle_y) || Math.round(t.top) == Math.round(r.bottom))) {
                    var v, b, c = i("<div class='moveGuideA moveGuide'></div>"), w = i("#div_design").offset().left;
                    t.left < r.right ? (v = (t.right - t.left + r.right - r.left) / 2 + (r.left - t.right),
                    b = (t.right + t.left) / 2 - w) : t.left > r.right && (v = (t.right - t.left + r.right - r.left) / 2 + (t.left - r.right),
                    b = (r.right + r.left) / 2 - w),
                    c.css({
                        width: v,
                        height: "1px",
                        position: "absolute"
                    }),
                    c.css(void 0 == r.i ? {
                        background: "url(" + i(".guidelineAImgR").attr("src") + ")",
                        width: a
                    } : {
                        background: "url(" + i(".guidelineAImg").attr("src") + ")",
                        left: b
                    }),
                    c.appendTo(l),
                    c.offset({
                        top: t.top
                    }),
                    t.top_drag = "false",
                    void 0 != r.i && h[r.i].showAnt()
                }
                if ("false" != t.middle_y_drag && (Math.round(t.middle_y) == Math.round(r.top) || Math.round(t.middle_y) == Math.round(r.middle_y) || Math.round(t.middle_y) == Math.round(r.bottom))) {
                    var v, b, c = i("<div class='moveGuideA moveGuide'></div>"), w = i("#div_design").offset().left;
                    t.left < r.right ? (v = (t.right - t.left + r.right - r.left) / 2 + (r.left - t.right),
                    b = (t.right + t.left) / 2 - w) : t.left > r.right && (v = (t.right - t.left + r.right - r.left) / 2 + (t.left - r.right),
                    b = (r.right + r.left) / 2 - w),
                    c.css({
                        width: v,
                        height: "1px",
                        position: "absolute"
                    }),
                    c.css(void 0 == r.i ? {
                        background: "url(" + i(".guidelineAImgR").attr("src") + ")",
                        width: a
                    } : {
                        background: "url(" + i(".guidelineAImg").attr("src") + ")",
                        left: b
                    }),
                    c.appendTo(l),
                    c.offset({
                        top: t.middle_y
                    }),
                    t.middle_y_drag = "false",
                    void 0 != r.i && h[r.i].showAnt()
                }
                if ("false" != t.bottom_drag && (Math.round(t.bottom) == Math.round(r.top) || Math.round(t.bottom) == Math.round(r.middle_y) || Math.round(t.bottom) == Math.round(r.bottom))) {
                    var v, b, c = i("<div class='moveGuideA moveGuide'></div>"), w = i("#div_design").offset().left;
                    t.left < r.right ? (v = (t.right - t.left + r.right - r.left) / 2 + (r.left - t.right),
                    b = (t.right + t.left) / 2 - w) : t.left > r.right && (v = (t.right - t.left + r.right - r.left) / 2 + (t.left - r.right),
                    b = (r.right + r.left) / 2 - w),
                    c.css({
                        width: v,
                        height: "1px",
                        position: "absolute"
                    }),
                    c.css(void 0 == r.i ? {
                        background: "url(" + i(".guidelineAImgR").attr("src") + ")",
                        width: a
                    } : {
                        background: "url(" + i(".guidelineAImg").attr("src") + ")",
                        left: b
                    }),
                    c.appendTo(l),
                    c.offset({
                        top: t.bottom
                    }),
                    t.bottom_drag = "false",
                    void 0 != r.i && h[r.i].showAnt()
                }
            }
            return t
        },
        changeElePosition: function(e, t, o) {
            return {
                left: e.left + t,
                right: e.right + t,
                top: e.top + o,
                bottom: e.bottom + o,
                middle_x: (e.left + e.right) / 2 + t,
                middle_y: (e.top + e.bottom) / 2 + o
            }
        },
        eleMoveUp: function(e, t) {
            var o = e.getNode()
              , n = i(o)
              , r = n.next();
            if (void 0 == r[0])
                return !1;
            r.after(n);
            var a = e.getIndex()
              , s = {
                index: a,
                element: a + 1
            };
            if (this.elements = s,
            !t) {
                var d = [{
                    page_num: this.getIndex(),
                    element_num: a + 1,
                    old_json: "",
                    now_json: "",
                    action: "moveup"
                }]
                  , l = this._owner_design;
                l.mementos = d
            }
        },
        eleMoveDown: function(e, t) {
            var o = e.getNode()
              , n = i(o)
              , r = n.prev();
            if (void 0 == r[0])
                return !1;
            r.before(n);
            var a = e.getIndex()
              , s = {
                index: a,
                element: a - 1
            };
            if (this.elements = s,
            !t) {
                var d = [{
                    page_num: this.getIndex(),
                    element_num: a - 1,
                    old_json: "",
                    now_json: "",
                    action: "movedown"
                }]
                  , l = this._owner_design;
                l.mementos = d
            }
        },
        eleCopyAndUndo: function(t) {
            var o;
            o = void 0 == t.ele ? JSON.parse(t.json) : t.ele.getNewJson();
            var i = (o["data-elem"],
            this._owner_design)
              , n = i.pageScale
              , r = JSON.parse(JSON.stringify(o))
              , a = e.getTransformAttr(r.transform, "translate")
              , s = e.getTransformAttr(r.transform, "rotate")
              , d = 20 / n;
            a[0] = parseFloat(a[0]) + d,
            a[1] = parseFloat(a[1]) + d,
            r.transform = e.setTransformAttr(r.transform, "translate", a),
            r.transform = e.setTransformAttr(r.transform, "rotate", s);
            var l = this.createElementAndUndo({
                json: r
            });
            return l
        },
        eleDelAndUndoByChangeBackground: function(e, t) {
            var o = e.getIndex()
              , i = this.getIndex()
              , n = this.getDesign();
            n.saveDesignAndUndo({
                obj: e,
                loc: "pages]" + i + "]elems]",
                key: o,
                value: e.getNewJson(),
                type: "3",
                action: "delMaterial",
                unshift: !0
            }, t),
            this.eleDel(e)
        },
        eleDelAndUndo: function(e, t, o) {
            var i = e.getIndex()
              , n = this.getIndex()
              , r = this.getDesign();
            return e.getPage() != this ? void this.nodeMousedown() : (r.saveDesignAndUndo({
                obj: e,
                loc: "pages]" + n + "]elems]",
                key: i,
                value: e.getNewJson(),
                type: "3",
                action: "delMaterial",
                unshift: o
            }, t),
            void this.eleDel(e))
        },
        eleDel: function(e) {
            if (void 0 != e) {
                this.nodeMousedown(!0);
                var t = e.getNode()
                  , o = this.getPageSvg()
                  , i = e.getIndex();
                "svgLayout" == e._svg_type && this._svgLayoutNum--;
                try {
                    o.removeChild(t)
                } catch (n) {}
                var r = {
                    index: i
                };
                this.elements = r
            }
        },
        eleDelOld: function(e, t, o) {
            if (void 0 != e) {
                this.nodeMousedown();
                var i = e.getNode()
                  , n = this.getPageSvg()
                  , r = e.getIndex();
                "svgLayout" == e._svg_type && this._svgLayoutNum--;
                var a = !1;
                "background" != e._element_type || o || (a = !0);
                var s = e.getJson()
                  , d = JSON.parse(JSON.stringify(s));
                n.removeChild(i);
                var l = {
                    index: r
                };
                if (this.elements = l,
                t) {
                    if (1 === t) {
                        var h = [{
                            page_num: this.getIndex(),
                            element_num: r,
                            old_json: d,
                            now_json: "",
                            action: "del",
                            drag: !0
                        }]
                          , g = this._owner_design;
                        g.mementos = h
                    } else if (2 === t) {
                        var h = [{
                            page_num: this.getIndex(),
                            element_num: r,
                            old_json: d,
                            now_json: "",
                            action: "del"
                        }];
                        return h
                    }
                } else {
                    var h = [{
                        page_num: this.getIndex(),
                        element_num: r,
                        old_json: d,
                        now_json: "",
                        action: "del"
                    }]
                      , g = this._owner_design;
                    g.mementos = h
                }
                e = null,
                1 == a && this.addWhiteBackground()
            }
        },
        addEles: function(t) {
            var o, i, n, r, a, s, d, l = this, h = t.length, g = this._owner_design, p = g.pageScale, f = [], u = {};
            u.id = "element_group_" + e.now();
            for (var m = 0; h > m; m++) {
                if (o = JSON.parse(t[m]),
                void 0 == o["data-elem"]) {
                    u.transform = o.transform;
                    break
                }
                i = e.getTransformAttr(o.transform, "translate"),
                n = e.getTransformAttr(o.transform, "rotate"),
                r = 20 / p,
                i[0] = parseFloat(i[0]) + r,
                i[1] = parseFloat(i[1]) + r,
                o.transform = e.setTransformAttr(o.transform, "translate", i),
                o.transform = e.setTransformAttr(o.transform, "rotate", n);
                var c = o["group-transform"];
                "" != c && void 0 != c && (s = e.getTransformAttr(c, "translate"),
                d = e.getTransformAttr(c, "rotate"),
                s[0] = parseFloat(s[0]) + r,
                s[1] = parseFloat(s[1]) + r,
                o["group-transform"] = e.setTransformAttr(c, "translate", s),
                o["group-transform"] = e.setTransformAttr(c, "rotate", d),
                o.group = u.id,
                o.transform = e.setTransformAttr(c, "translate", s)),
                a = l.createElementAndUndo({
                    json: o,
                    unshift: !0
                }),
                f.push(a)
            }
            if (u.unshift = !0,
            u.transform) {
                var _ = l.createElementGroupAndUndo(f, u);
                return _
            }
            return l._select_element = f,
            l.selectElementUp()
        },
        eleGroupDel: function(e) {
            this.nodeMousedown();
            var t = this.getPageSvg()
              , o = e.getNode();
            t.removeChild(o),
            this.element_groups = {
                index: e.id
            },
            e = null
        },
        getNewJson: function() {
            var e = this.getJson()
              , t = {
                width: this.width,
                height: this.height
            };
            e.width = parseFloat(t.width).toFixed(8).toString(),
            e.height = parseFloat(t.height).toFixed(8).toString(),
            e.elems = [],
            e.elegroups = {};
            for (var o = 0; o < this.elements.length; o++) {
                var i = this.elements[o];
                void 0 != i && (e.elems[o] = i.getNewJson())
            }
            var n = this.element_groups;
            for (var r in n) {
                var a = n[r];
                e.elegroups[r] = a.getNewJson()
            }
            return e
        },
        getBackgroundColor: function() {
            var e = this.elements
              , t = e[0];
            if (void 0 == t)
                return "#FFF";
            var o = t.getJson()
              , i = o["data-elem"];
            return "false" == i["data-key"] ? i["data-colors"][0] || "#FFF" : "#FFF"
        },
        selectElement: function(t, o, i, n) {
            var r, a, s = this.elements, d = s.length;
            this._select_element = [];
            for (var l = 0, h = 0; d > h; h++)
                if (r = s[h],
                !(void 0 == r || r.isBackground() || "true" == r.lock || r._group_drag && "true" == r._element_group.lock))
                    if (a = r.getRect(),
                    a.top > i || a.right < n || a.bottom < t || a.left > o)
                        r.hideAnt();
                    else {
                        if (r._group_drag) {
                            for (var g = !1, p = 0; p < this._select_element.length; p++)
                                this._select_element[p].id === r._element_group.id && (g = !0);
                            if (g)
                                continue;
                            this._select_element[l] = r._element_group
                        } else
                            this._select_element[l] = r;
                        e.hasClass(r.getNode(), "elementsSonEnter") || r.showAnt(),
                        l++
                    }
        },
        selectElementUp: function() {
            var e = this._select_element;
            if (1 == e.length)
                e[0].nodeClick();
            else if (e.length > 0)
                return this.createCircleSelect()
        },
        createCircleSelect: function() {
            var e = this._select_element;
            if (!(e.length < 0)) {
                var t = new g(this,e);
                return t
            }
        },
        createElementGroup: function(e, t) {
            if (this.nodeMousedown(),
            0 == e.length)
                return null;
            var o = new p(this,e,t);
            return this.element_groups = {
                index: o.id,
                element_group: o
            },
            o
        },
        createElementGroupAndUndo: function(e, t, o) {
            var i;
            void 0 != t && t.unshift && (i = t.unshift);
            for (var n, r = this.createElementGroup(e, t), a = this.getDesign(), s = [], d = 0; d < e.length; d++)
                n = e[d],
                s.push(n.getIndex());
            return a.saveDesignAndUndo({
                obj: r,
                loc: "pages]" + this.getIndex() + "]elegroups]",
                key: r.id,
                value: r.getJson(),
                type: "0",
                action: "addElementGroup",
                eles_index: s,
                unshift: i
            }, o),
            "noUndo" != o && r.setNewJson(),
            r
        },
        onloadTemplate: function(e, t) {
            var o = this._owner_design;
            this.clear();
            var i = this.getJson();
            i = e.pages[t];
            var r = i.elems
              , t = (this.getIndex(),
            0);
            if (void 0 != r[0] && "background" != r[0]["data-type"] || void 0 == r[0]) {
                var a = {
                    "data-type": "background",
                    "data-elem": {
                        filter: {
                            brightness: 0,
                            contrast: 0,
                            crossProcess: 0,
                            gaussianBlur: 0,
                            saturation: 0,
                            tint: 0
                        },
                        "data-key": "false",
                        width: this.width,
                        height: this.height,
                        opacity: "1",
                        "data-colors": {
                            0: "rgb(255, 255, 255)"
                        }
                    },
                    transform: "translate(0,0)",
                    reverse: ""
                };
                r.splice(0, 0, a)
            }
            if (r)
                for (var s in r) {
                    var d = r[s]
                      , l = n.BLEED_SIZE;
                    o.bleed && "false" != o.bleed && "true" != e.bleed && (d = o.jsonAddleftTop(r[s], l)),
                    o.bleed && "true" != o.bleed && "true" == e.bleed && (d = o.jsonAddleftTop(r[s], -l));
                    {
                        this.createElementAndUndo({
                            json: d,
                            unshift: !0
                        })
                    }
                }
            this._pop_drag = !1
        },
        compareElementPosition: function(t) {
            var o = t.getNewJson();
            if ("img" != t.dataType && "background" != t.dataType || "false" === o["data-elem"]["data-key"])
                return !1;
            var i, n = t.transform, r = e.getTransformAttr(n, "translate"), a = t.getShowWidth(), s = t.getShowHeight(), d = t.getRotate(), l = {
                top: parseFloat(r[1]),
                right: parseFloat(r[0]) + a,
                bottom: parseFloat(r[1]) + s,
                left: parseFloat(r[0])
            }, h = (t.getPage(),
            {
                width: this.width,
                height: this.height
            });
            i = e.coordinateRotate(0, 0, d, l.left + a / 2, l.top + s / 2);
            var g, p = !0, f = !0, u = !0, m = !0;
            return (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (p = !1),
            i = e.coordinateRotate(h.width, 0, d, l.left + a / 2, l.top + s / 2),
            (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (f = !1),
            i = e.coordinateRotate(h.width, h.height, d, l.left + a / 2, l.top + s / 2),
            (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (u = !1),
            i = e.coordinateRotate(0, h.height, d, l.left + a / 2, l.top + s / 2),
            (i.x < l.left || i.x > l.right || i.y < l.top || i.y > l.bottom) && (m = !1),
            g = p && f && u && m ? !0 : !1
        },
        pageBleed: function(t, o) {
            var i, r = this.elements;
            if (r[0].isBackground()) {
                i = 1;
                var a;
                if (a = t > 0 ? !0 : !1,
                r[0].reseatBackgroundPosition(o * n.ZOOM_IN, o * n.ZOOM_IN, a),
                r.length <= 1)
                    return
            } else
                i = 0;
            for (var s, d = i; d < r.length; d++)
                s = r[d],
                s._group_drag || (s.addLeftTop(t * n.ZOOM_IN, t * n.ZOOM_IN, s.getNode()),
                s.transform = {
                    value: e.transformScale(s.getTransform(), 1 / n.ZOOM_IN),
                    undo_drag: "noUndo"
                });
            var l = this._element_groups;
            for (var h in l)
                l[h].addLeftTop(t * n.ZOOM_IN, t * n.ZOOM_IN),
                l[h].setNewJson()
        },
        showBleedBorder: function() {
            var e = this.getDesign()
              , t = {
                width: this.width,
                height: this.height
            }
              , o = n.BLEED_SIZE
              , i = e.pageScale
              , r = i * o
              , a = 100 * (o / t.width)
              , s = 100 * (o / t.height);
            this.showBleedBorderByPrecent(a, s, r)
        },
        showBleedBorderByPrecent: function(e, t, o) {
            var n = i("#rightPanel");
            n.find(".bleed_top, .bleed_bottom").css("height", t + "%").show(),
            n.find(".bleed_right, .bleed_left").css({
                width: e + "%",
                height: 100 - 2 * t + "%",
                top: t + "%"
            }).show(),
            n.find(".bleed_ruler_top_left, .bleed_ruler_top_right").css("top", o + "px").show(),
            n.find(".bleed_ruler_right_top, .bleed_ruler_right_bottom").css("right", o + "px").show(),
            n.find(".bleed_ruler_bottom_right, .bleed_ruler_bottom_left").css("bottom", o + "px").show(),
            n.find(".bleed_ruler_left_top, .bleed_ruler_left_bottom").css("left", o + "px").show(),
            n.find(".bleed_line_top").css({
                top: o + "px",
                left: o + "px",
                width: 100 - 2 * e + "%"
            }).show(),
            n.find(".bleed_line_bottom").css({
                bottom: o + "px",
                left: o + "px",
                width: 100 - 2 * e + "%"
            }).show(),
            i(".three-secend-line").css({
                left: (100 - 2 * e) / 3 * 2 + e + "%"
            }),
            i(".three-first-line").css({
                left: (100 - 2 * e) / 3 + e + "%"
            })
        },
        eleSeatRectSet: function() {
            for (var e = this._elements, t = 0; t < e.length; t++)
                e[t].seatRectSet()
        },
        addWhiteBackgroundAndUndo: function(e) {
            var t = this.width
              , o = this.height
              , i = {
                "data-type": "background",
                "data-elem": {
                    "data-key": "false",
                    width: t,
                    height: o,
                    opacity: 1,
                    "data-colors": {
                        0: "rgb(255, 255, 255)"
                    }
                },
                transform: "translate(0,0)"
            };
            this.createElementAndUndo({
                json: i,
                unshift: e
            })
        }
    },
    e.classExtend(_, o),
    _
});
;/*!/compapi/design/toolbar/ElementEditbar.js*/
"use strict";
define("compapi/design/toolbar/ElementEditbar", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/Widget", "compapi/design/toolbar/toolbar_config", "compapi/design/Toolbar", "libs/jquery/jquery.easing.1.3", "compapi/design/toolbar/SvgFilter", "compapi/design/design_config", "widget/pop/pop", "widget/vipExclusive/vipExclusive"], function(e, t, o, n, i, s, r, a, l, c, d) {
    function u() {
        var e = this;
        f.call(e)
    }
    function f() {
        var n = this
          , s = this.getNode()
          , r = t(s);
        r.on("mousedown", function(e) {
            e.stopPropagation()
        }),
        r.find(".ele-color").mousedown(function(e) {
            if ("block" == t("#texteventtarget").css("display")) {
                var o = n._owner_element;
                o.finishInput()
            }
            var i = t(this);
            n.editColorShow(e, i),
            e.stopPropagation()
        });
        var a = i.getEditColor();
        a.on("mousedown", ".edit-color-span", function(o) {
            return e.addBugTrackClick("e8"),
            t(this).hasClass("edit-color-span-nocolor") || t(this).hasClass("edit-color-span-pickup") ? (o.stopPropagation(),
            !1) : (n.setEleColor(o, t(this)),
            void o.stopPropagation())
        }),
        a.find(".edit-color-span").not(".edit-color-span-pickup").mouseenter(function(e) {
            if (t(this).hasClass("edit-color-span-nocolor"))
                return e.stopPropagation(),
                !1;
            var o = n._owner_element
              , i = t(this).css("background-color")
              , s = t(".element-edit-bar").find(".ele-color").index(t(".element-edit-bar").find(".ele-color.now-click"));
            "svg" == o._element_type ? o.previewColor(i, s) : o.previewColor(i)
        }),
        a.find(".edit-color-btn").mousedown(function(e) {
            return t(this).hasClass("now-click") ? (e.stopPropagation(),
            !1) : (a.find(".edit-color-btn").removeClass("now-click"),
            t(this).addClass("now-click"),
            t(this).hasClass("default-edit-color-btn") ? (a.find(".default-edit-color-wrap").css({
                top: "0px",
                opacity: "1"
            }),
            a.find(".team-edit-color-wrap").css({
                top: "222px",
                opacity: "0"
            })) : (a.find(".default-edit-color-wrap").css({
                top: "-222px",
                opacity: "0"
            }),
            a.find(".team-edit-color-wrap").css({
                top: "0px",
                opacity: "1"
            })),
            void e.stopPropagation())
        }),
        window.TEAM_ID > 0 && (a.css("width", "348px").find(".edit-color-btn-wrap").css("display", "inline-block"),
        t.ajax({
            url: "/team/getTeamBaseInfo.do",
            dataType: "json",
            type: "POST",
            data: {
                tid: window.TEAM_ID
            },
            success: function(e) {
                if (e.team) {
                    var t = e.team.colorValue
                      , o = a.find(".team-edit-color-wrap");
                    if (t.length > 0) {
                        t = t.split(",");
                        var n;
                        o.empty();
                        for (var i = 0; i < t.length; i++)
                            n = '<div class="edit-color-span" style="background-color:' + t[i] + '" title="' + t[i] + '"></div>',
                            o.append(n)
                    } else
                        o.find("a").attr("href", "/team/setup.html?id=" + window.TEAM_ID)
                }
            },
            error: function() {
                console.log("获取团队色值失败！")
            }
        })),
        a.find(".edit-color-span-pickup").mousedown(function(e) {
            if (0 != e.button)
                return !1;
            var n = t(this);
            n.mouseup(function() {
                n.off("mouseup"),
                o.colorPickupShow(n)
            }),
            e.stopPropagation()
        }),
        r.find(".text-family").mousedown(function(o) {
            if (e.addBugTrackClick("e4"),
            "block" == t("#texteventtarget").css("display")) {
                var i = n._owner_element;
                i.finishInput()
            }
            n.fontFamilyWrapShow(o, t(this)),
            o.stopPropagation()
        }).children("div").css("background-image", "url(" + window.font_family.font_family_img_url + ")");
        var l = i.getFontFamily()
          , c = l.find("#text-family-list");
        c.on("click", "li", function(e) {
            return t(this).hasClass("now-size") ? !1 : t(this).hasClass("text-family-group") ? !1 : t(this).find(".text-family-vip").length > 0 && !window.ISVIP && window.TEAM_ID <= 0 ? void d.show() : (n.setEleFontFamily(e, t(this)),
            n.fontHistorySet(e, t(this).clone()),
            void e.stopPropagation())
        });
        var u = l.find(".text-family-hidtory-font");
        u.on("click", "li", function(e) {
            n.setEleFontFamily(e, t(this)),
            e.stopPropagation()
        });
        var f = l.find("#text-family-history");
        f.on("click", ".text-family-back-top", function() {
            c.animate({
                scrollTop: "0px"
            }, 500)
        }),
        f.on("click", ".text-family-show-more", function() {
            var e = t(this)
              , o = e.parent().next();
            if (e.hasClass("now-click"))
                o.hide(),
                e.text("展开").removeClass("show-less").addClass("show-more"),
                e.removeClass("now-click");
            else {
                if (o.children("li").size() <= 0)
                    return !1;
                o.show(),
                e.text("收起").removeClass("show-more").addClass("show-less"),
                e.addClass("now-click")
            }
        });
        var p, m, h, w = l.find(".text-family-group"), g = l.find(".text-family-font-showing");
        c.scroll(function() {
            w.each(function() {
                return p = g.offset().top,
                m = t(this).offset().top - 15,
                p > m ? (h = t(this).children("span").html(),
                void g.children("span").html(h)) : void g.children("span").html(h)
            })
        }),
        r.find(".text-size").mousedown(function(o) {
            if (e.addBugTrackClick("e5"),
            "block" == t("#texteventtarget").css("display")) {
                var i = n._owner_element;
                i.finishInput()
            }
            n.fontSizeWrapShow(o, t(this)),
            o.stopPropagation()
        });
        var v;
        v = i.getFontSize("px" === window.DESIGN_ORIGINAL_UNIT ? 12 : 3),
        v.find("ul").children().mouseenter(function() {
            var e = n._owner_element
              , o = t(this).text();
            "px" != window.DESIGN_ORIGINAL_UNIT && (o = o / 72 * 300);
            var i = parseInt(o);
            e.previewFontSize(i)
        }).mousedown(function(e) {
            n.setEleFontSize(e, t(this)),
            e.stopPropagation()
        }),
        r.find(".text-align-bar").mousedown(function(e) {
            if ("block" == t("#texteventtarget").css("display")) {
                var o = n._owner_element;
                o.finishInput()
            }
            n.textAlignShow(e, t(this)),
            e.stopPropagation()
        });
        var k = i.getFontAlign();
        k.find(".text-align-left").mousedown(function(o) {
            e.addBugTrackClick("e9"),
            n.setAlign(o, t(this)),
            o.stopPropagation()
        }),
        k.find(".text-align-center").mousedown(function(o) {
            e.addBugTrackClick("e9"),
            n.setAlign(o, t(this)),
            o.stopPropagation()
        }),
        k.find(".text-align-right").mousedown(function(o) {
            e.addBugTrackClick("e9"),
            n.setAlign(o, t(this)),
            o.stopPropagation()
        }),
        r.find(".text-style-bold").mousedown(function(o) {
            return e.addBugTrackClick("e10"),
            "block" == t("#texteventtarget").css("display") && n._owner_element.finishInput(),
            n.textBoldShow(o, t(this)),
            !1
        });
        var _ = i.getBoldWrap();
        _.find("#bold-scroll").mousedown(function(e) {
            return n.boldMove(e, t(this)),
            !1
        }),
        _.find("#bold-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            0 > e ? (e = 0,
            t(this).val(0)) : e > 100 && (e = 100,
            t(this).val(100));
            var o = n._owner_element;
            e /= 100,
            o.previewBold(e);
            var i = 67 + 150 * e;
            _.find("#bold-scroll").css("left", i).attr("data-num", parseInt(100 * e))
        }),
        r.find(".text-style-i").mousedown(function(o) {
            e.addBugTrackClick("e10"),
            n.textItalic(o, t(this)),
            o.stopPropagation()
        }),
        r.find(".text-style-underline").mousedown(function(o) {
            e.addBugTrackClick("e10"),
            n.textDecoration(o, t(this)),
            o.stopPropagation()
        });
        var b = i.getEleMove();
        b.find(".ele-moveup").mousedown(function(o) {
            e.addBugTrackClick("e12");
            var i = t(this);
            return i.hasClass("no-click") ? !1 : (n.moveupMousedown(o, i),
            void o.stopPropagation())
        }),
        b.find(".ele-movedown").mousedown(function(o) {
            e.addBugTrackClick("e13");
            var i = t(this);
            return i.hasClass("no-click") ? !1 : (n.movedownMousedown(o, i),
            void o.stopPropagation())
        }),
        r.find(".img-cut").mousedown(function(o) {
            e.addBugTrackClick("f5"),
            n.eleImgCutMousedown(o, t(this)),
            o.stopPropagation()
        }),
        r.find(".ele-copy").mousedown(function(o) {
            e.addBugTrackClick("e1");
            var i = t(this);
            n.eleCopyMousedown(o, i),
            o.stopPropagation()
        }),
        r.find(".ele-del").mousedown(function(o) {
            e.addBugTrackClick("e11");
            var i = t(this);
            n.eleDelMousedown(o, i),
            o.stopPropagation()
        }),
        r.find(".group-edit-split").mousedown(function(o) {
            if (t(this).hasClass("no-click"))
                return !1;
            e.addBugTrackClick("h2");
            var i = t(this);
            window.MEMENTO_ID = e.now(),
            n.groupSplit(o, i),
            o.stopPropagation()
        }),
        r.find(".group-edit-put").mousedown(function(e) {
            var o = t(this);
            n.groupPut(e, o),
            e.stopPropagation()
        });
        var y = i.getTextMenuMore();
        y.find(".text-more-up").mousedown(function(e) {
            var o = t(this);
            return n.moveupMousedown(e, o),
            !1
        }),
        y.find(".text-more-down").mousedown(function(e) {
            var o = t(this);
            return n.movedownMousedown(e, o),
            !1
        }),
        r.find(".ele-opacity").mousedown(function(o) {
            return e.addBugTrackClick("e14"),
            n.opacityWrapShow(o, t(this)),
            !1
        });
        var C = i.getOpacityWrap();
        C.find("#opacity-scroll").mousedown(function(e) {
            return n.opacityMove(e, t(this)),
            !1
        }),
        C.find("#opacity-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            0 > e ? (e = 0,
            t(this).val(0)) : e > 100 && (e = 100,
            t(this).val(100));
            var o = n._owner_element;
            o.previewOpacity((100 - e) / 100);
            var i = e / 100 * 160 + 67;
            i > 200 && (i -= 10),
            C.find("#opacity-scroll").css("left", i + "px").attr("data-num", e)
        }),
        r.find(".text-spacing").mousedown(function(e) {
            return n.textSpacingShow(e, t(this)),
            !1
        });
        var x = i.getTextSpaceWrap().find("#wspace-wrap");
        x.find("#wspace-scroll").mousedown(function(e) {
            return n.wspaceMove(e, t(this)),
            !1
        }),
        x.find("#wspace-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            if (e.indexOf("-") >= 0)
                var o = !0;
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            o && (e = 0 - e),
            -400 > e ? (e = -400,
            t(this).val(-400)) : e > 1600 && (e = 1600,
            t(this).val(1600));
            var i = n._owner_element;
            i.previewWspace(e);
            var s = (parseInt(e) + 400) / 2e3 * 150 + 67;
            x.find("#wspace-scroll").css("left", s).attr("data-num", e)
        });
        var M = i.getTextSpaceWrap().find("#vspace-wrap");
        M.find("#vspace-scroll").mousedown(function(e) {
            return n.vspaceMove(e, t(this)),
            !1
        }),
        M.find("#vspace-input").bind("input propertychange", function() {
            var e = t(this).val().toString();
            if (e.indexOf("-") >= 0)
                var o = !0;
            e = e.replace(/[^0-9]+/g, ""),
            e = parseInt(e),
            o && (e = 0 - e),
            -400 > e ? (e = -400,
            t(this).val(-400)) : e > 1600 && (e = 1600,
            t(this).val(1600));
            var i = n._owner_element;
            i.previewVspace(e);
            var s = (parseInt(e) + 400) / 2e3 * 150 + 67;
            M.find("#vspace-scroll").css("left", s).attr("data-num", e)
        }),
        r.find(".ele-turn").mousedown(function(e) {
            return n.eleReverseShow(e, t(this)),
            !1
        }),
        r.find(".ele-move").mousedown(function(e) {
            return n.eleMoveShow(e, t(this)),
            !1
        }),
        r.find(".group-align").mousedown(function(e) {
            return n.groupAlignShow(e, t(this)),
            !1
        }),
        r.find(".group-distributed").mousedown(function(e) {
            return n.groupDistributedShow(e, t(this)),
            !1
        });
        var I = i.getEleReverse();
        I.find(".ele-turn-verticalReverse").mousedown(function(o) {
            return e.addBugTrackClick("e15"),
            window.MEMENTO_ID = e.now(),
            n.verticalReverse(o, t(this)),
            !1
        }),
        I.find(".ele-turn-horizontalReverse").mousedown(function(o) {
            return e.addBugTrackClick("e16"),
            window.MEMENTO_ID = e.now(),
            n.horizontalReverse(o, t(this)),
            !1
        }),
        r.find(".img-filter").mousedown(function(o) {
            e.addBugTrackClick("f3"),
            n.imgFilterShow(o, t(this)),
            o.stopPropagation()
        }),
        r.find(".img-set-background").mousedown(function(e) {
            n.imgChangeToBackground(e, t(this)),
            e.stopPropagation()
        });
        var E = i.getFilter();
        E.find(".filter-parameter-son-dot").mousedown(function(e) {
            n.filterDotMove(e, t(this)),
            e.stopPropagation()
        }),
        E.find(".filter-preset-son-div").click(function(e) {
            n.filterClick(e, t(this)),
            e.stopPropagation()
        });
        var S = i.getEleGroupAlign()
          , T = i.getEleGroupDistributed();
        S.on("click", "li", function(o) {
            window.MEMENTO_ID = e.now(),
            n.groupElementAlign(o, t(this)),
            o.stopPropagation()
        }),
        T.on("click", "li", function(o) {
            window.MEMENTO_ID = e.now(),
            n.groupElementAlign(o, t(this)),
            o.stopPropagation()
        }),
        r.find(".group-set").click(function(o) {
            e.addBugTrackClick("h1"),
            window.MEMENTO_ID = e.now(),
            n.setGroup(o, t(this)),
            o.stopPropagation()
        }),
        r.find(".ele-lock").click(function(o) {
            e.addBugTrackClick("e17"),
            window.MEMENTO_ID = e.now(),
            n.setLock(o, t(this)),
            o.stopPropagation()
        });
        var N = window.localStorage.getItem("already_use_names") || "";
        N.indexOf("ele_lock") < 0 && r.find(".ele-lock-close").click(function() {
            r.find(".ele-lock-introduce-wrap").fadeOut(200),
            N += "...ele_lock",
            window.localStorage.setItem("already_use_names", N)
        })
    }
    var p = function(e) {
        s.call(this),
        this._owner_design = e,
        e._owner_elementEditbar = this,
        u.call(this)
    };
    return p.prototype = {
        constructor: p,
        createWidget: function() {
            return i.getElementEditbar()[0]
        },
        _owner_element: null,
        show: function(e) {
            this._owner_element = e;
            var o, n = e._element_type;
            switch (n) {
            case "background":
                o = this.backgroundEditbarSet();
                break;
            case "img":
                o = this.imgEditbarSet();
                break;
            case "svg":
                o = this.svgEditbarSet();
                break;
            case "text":
                o = this.textEditbarSet();
                break;
            case "circleSelect":
                o = this.selectEditbarSet();
                break;
            case "elementGroup":
                o = this.groupEditbarSet();
                break;
            case "svgChart":
                o = this.chartEditbarSet();
                break;
            default:
                console.log("素材类型未定义")
            }
            var i = t(o);
            i.stop();
            var s = t("#rightPanel").width()
              , r = t("#leftPanel").outerWidth();
            i.css({
                width: s + "px",
                position: "fixed",
                display: "block",
                top: "10px",
                left: r + "px"
            }).appendTo(t("#rightPanel")).animate({
                top: "50px"
            }, 200, function() {
                var t = i.find(".ele-lock");
                "true" == e.lock ? (i.find(".ele-lock span").addClass("now-set"),
                i.find(".ele-del, .group-edit-split").addClass("no-click"),
                t.addClass("ele-lock-shake"),
                window.ELE_LOCK_REMOVECLASS = setTimeout(function() {
                    t.removeClass("ele-lock-shake")
                }, 1500)) : (t.removeClass("ele-lock-shake"),
                i.find(".ele-lock span").removeClass("now-set"),
                i.find(".ele-del, .group-edit-split").removeClass("no-click"))
            }),
            this.moveBtnSet()
        },
        hideNode: function() {
            this.hideMoreMenu();
            var e = this.getNode()
              , o = t(e);
            o.stop(),
            t(e).animate({
                top: "10px"
            }, 200, function() {
                t(e).hide()
            }),
            this._owner_element = null
        },
        showInGroup: function(e) {
            this._owner_element = e;
            var o = e._element_type
              , n = this._owner_design;
            n._focus_element = e;
            var i;
            switch (o) {
            case "background":
                i = this.backgroundEditbarSet(!0);
                break;
            case "img":
                i = this.imgEditbarSet(!0);
                break;
            case "svg":
                i = this.svgEditbarSet(!0);
                break;
            case "text":
                i = this.textEditbarSet(!0);
                break;
            case "circleSelect":
                i = this.selectEditbarSet(!0);
                break;
            case "elementGroup":
                i = this.groupEditbarSet();
                break;
            case "svgChart":
                i = this.chartEditbarSet();
                break;
            default:
                console.log("素材类型未定义")
            }
            var s = t(i)
              , r = t("#rightPanel").width()
              , a = t("#leftPanel").outerWidth();
            s.css({
                width: r + "px",
                position: "fixed",
                display: "block",
                top: "10px",
                left: a + "px"
            }).appendTo(t("#rightPanel")).animate({
                top: "50px"
            }, 200, function() {}),
            this.moveBtnSet()
        },
        moveBtnSet: function() {
            var e = t(this.getNode())
              , o = i.getTextMenuMore()
              , n = this._owner_element;
            if ("circleSelect" !== n._element_type) {
                var s = n.getPage()
                  , r = s.elements
                  , a = r.length
                  , l = n.getIndex();
                "elementGroup" === n._element_type && (l = n.getLastChildIndex());
                var c = 0
                  , d = 0;
                if (l == a - 1)
                    e.find(".ele-moveup").addClass("no-click"),
                    o.find(".text-more-up").addClass("no-click");
                else {
                    for (var u = !1, f = !1, p = l + 1; a > p; p++)
                        f = n.intersectEle(r[p]),
                        f && c++,
                        u = u || f;
                    u ? (e.find(".ele-moveup").removeClass("no-click"),
                    o.find(".text-more-up").removeClass("no-click")) : (e.find(".ele-moveup").addClass("no-click"),
                    o.find(".text-more-up").addClass("no-click"))
                }
                if ("elementGroup" === n._element_type && (l = n.getFirstChildIndex()),
                1 >= l)
                    e.find(".ele-movedown").addClass("no-click"),
                    o.find(".text-more-down").addClass("no-click");
                else {
                    for (var m = !1, h = !1, p = l - 1; p > 0; p--)
                        h = n.intersectEle(r[p]),
                        h && d++,
                        m = m || h;
                    m ? (e.find(".ele-movedown").removeClass("no-click"),
                    o.find(".text-more-down").removeClass("no-click")) : (e.find(".ele-movedown").addClass("no-click"),
                    o.find(".text-more-down").addClass("no-click"))
                }
                return {
                    sum: d + c,
                    num: d
                }
            }
        },
        chartEditbarSet: function(e) {
            var n = this.getNode()
              , i = t(n);
            i.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click"),
            i.children().filter(".ele-color-clone").detach(),
            i.children().filter(".ele-common").css("display", "block"),
            i.children().filter(".ele-turn ").css("display", "none");
            var s = this._owner_element;
            o.initChartBtn(s);
            var r = t("#chartMenuBtn");
            return r.hasClass("listBtnClick") || (t("#leftPanelContentWrap").css({
                top: -1 * t("#leftPanelWrap").getHeight() * t(".leftPanelMenuListBtn").index(r)
            }),
            r.addClass("listBtnClick").siblings().removeClass("listBtnClick"),
            t("#leftPanelMenuBorder").css({
                top: r.offset().top - 50
            })),
            e && i.children().filter(".group-no-show").css("display", "none"),
            this.getNode()
        },
        backgroundEditbarSet: function(e) {
            var o = t(this.getNode());
            o.children().removeClass("now-click").css("display", "none").filter("img-filter").removeClass("no-click"),
            o.children().filter(".img-filter, .ele-common").css("display", "block"),
            o.children().filter(".background-no-show").css("display", "none");
            var n = t(this._owner_element.getNode());
            return void 0 == n.find("image").attr("href") && o.children().filter(".img-filter").addClass("no-click"),
            e && o.children().filter(".group-no-show").css("display", "none"),
            window.ISVIP || o.children().filter(".ele-opacity").css("display", "none"),
            this.getNode()
        },
        imgEditbarSet: function(e) {
            var o = this.getNode()
              , n = t(o);
            n.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click"),
            n.children().filter(".ele-color-clone").detach(),
            n.children().filter(".img-edit-bar, .ele-common").css("display", "block"),
            t(".panelArrow").hasClass("rightArrow") ? n.find(".img-filter").hide() : n.find(".img-filter").show();
            var i = this._owner_element
              , s = i.getJson();
            return "false" == s["data-elem"]["data-key"] && n.children().filter(".img-filter").css("display", "none"),
            "image/png" === i._img_kind ? n.children().filter(".img-cut").css("display", "none") : n.children().filter(".img-cut").css("display", "block"),
            e && n.children().filter(".group-no-show").css("display", "none"),
            this.getNode()
        },
        svgEditbarSet: function(o) {
            var n = this.getNode()
              , i = t(n);
            i.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click"),
            i.children().filter(".ele-common").css("display", "block"),
            o && i.children().filter(".group-no-show").css("display", "none");
            var s = this._owner_element
              , r = s.getJson()
              , a = (r["data-elem"],
            t(s.getNode()));
            a.find("svg") && e.jsonLength(s.colors) > 0 && this.svgColorsSet();
            for (var l = a.find(".layoutImgWrap"), c = !1, d = 0; d < l.size(); d++)
                if (void 0 != l.eq(d).children().attr("data-old") && "" != l.eq(d).children().attr("data-old")) {
                    c = !0;
                    break
                }
            return c && (i.find(".img-filter").css("display", "block"),
            o || i.find(".img-cut").css("display", "block")),
            this.getNode()
        },
        textEditbarSet: function(e) {
            var o = (this.getNode(),
            t(this.getNode()));
            o.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click");
            var n = this._owner_element
              , i = n.getFontFocusColor();
            o.children(".ele-color").children().css("background-color", i),
            o.children().filter(".ele-color-clone").detach();
            var s = n.getFontFocusFamily();
            this.getFontFamilyPosition(s);
            var r = n.getFontFocusSize();
            return "px" != window.DESIGN_ORIGINAL_UNIT && (r = r / 300 * 72),
            o.children(".text-size").text(parseInt(r)),
            o.children().filter(".text-edit-bar, .ele-common").css("display", "block"),
            e && o.children().filter(".group-no-show").css("display", "none"),
            "true" == n.italic ? o.find(".text-style-i span").addClass("now-set") : o.find(".text-style-i span").removeClass("now-set"),
            "true" == n.decoration ? o.find(".text-style-underline span").addClass("now-set") : o.find(".text-style-underline span").removeClass("now-set"),
            n.bold > 0 ? o.find(".text-style-bold span").addClass("now-set") : o.find(".text-style-bold span").removeClass("now-set"),
            this.getNode()
        },
        selectEditbarSet: function() {
            var e = this.getNode()
              , o = t(e);
            o.children().removeClass("now-click").css("display", "none").filter(".img-filter").removeClass("no-click");
            this._owner_element;
            o.children().filter(".group-align-edit, .ele-lock, .ele-copy, .ele-del").css("display", "block");
            var n = this._owner_element;
            return n.group_inside ? (o.find(".group-set, .ele-lock, .ele-copy").hide(),
            o.find(".group-align").addClass("group-align-no-before")) : (o.find(".group-set, .ele-lock, .ele-copy").show(),
            o.find(".group-align").removeClass("group-align-no-before")),
            this.getNode()
        },
        groupEditbarSet: function() {
            var e = this.getNode()
              , o = t(e);
            o.children().removeClass("now-click").css("display", "none").filter(".group-edit-bar").css("display", "block");
            var n = this._owner_element;
            return n._text_ele_loaded === n._text_ele_sum ? (o.children(".group-edit-split").css("display", "block"),
            void 0 != window.USERINFO && window.USERINFO.isGm ? o.children(".group-edit-put").show() : o.children(".group-edit-put").hide()) : (o.children(".group-edit-split").css("display", "none"),
            o.children(".group-edit-put").hide()),
            this.getNode()
        },
        getFontFamilyPosition: function(e, o) {
            var n, s = i.getFontFamily(), r = s.find("#text-family-list");
            if (r.children().each(function() {
                t(this).children().attr("data-alt") == e && (n = t(this))
            }),
            r.children(".now-size").removeClass("now-size"),
            void 0 != n) {
                n.addClass("now-size"),
                o && r.scrollTop(n.offset().top - o);
                var a = t(this.getNode());
                a.children(".text-family").children("div").css("background-position", n.children().css("background-position"))
            }
        },
        setEleFontFamily: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this
              , s = i.getNode()
              , r = (t(s),
            i._owner_element);
            window.MEMENTO_ID = e.now();
            var a = n.children().attr("data-alt");
            r.setFontFamilyAndUndo(a),
            i.getFontFamilyPosition(a),
            i.hideMoreMenu();
            var l;
            l = window.FONT_FAMILY[a] ? window.FONT_FAMILY[a].group_name : "旧字体";
            var c = "字体-" + l + "-" + a;
            e.addSomeMouseClick(c)
        },
        fontHistorySet: function(e, o) {
            if (0 != e.button)
                return !1;
            if (!o.hasClass("text-family-history-son")) {
                var n = i.getFontFamily()
                  , s = n.find(".text-family-hidtory-font");
                s.children().removeClass("now-size");
                var r = o.children().attr("data-index")
                  , a = !1;
                s.children().each(function() {
                    t(this).children().attr("data-index") == r && (a = !0)
                }),
                a || (s.children().size() > 2 && s.children().last().remove(),
                s.prepend(o)),
                s.children().addClass("text-family-history-son"),
                n.find(".text-family-btn").show()
            }
        },
        svgColorsSet: function() {
            var o = this.getNode()
              , n = t(o)
              , i = this._owner_element;
            n.find(".ele-color-clone").detach();
            var s = n.find(".ele-color")
              , r = i.colors;
            if (e.jsonLength(r) > 0) {
                s.css({
                    display: "block"
                }).children().css({
                    "background-color": r["color-1"]
                });
                for (var a in r)
                    if ("color-1" != a) {
                        var l = s.clone(!0).addClass("ele-color-clone");
                        l.children().css({
                            "background-color": r[a]
                        }),
                        n.find(".ele-color").last().after(l)
                    }
            } else
                s.css({
                    display: "none"
                })
        },
        moveupMousedown: function(t, o) {
            function n() {
                var t = i._owner_element
                  , o = t._owner_page;
                if (window.MEMENTO_ID = e.now(),
                "elementGroup" === t._element_type)
                    return void t.moveUp();
                for (var n, s, r = o.elements, a = r.length, l = t.getIndex(), c = l, d = l + 1; a > d; d++)
                    if (n = r[d],
                    s = t.intersectEle(r[d])) {
                        c = n._group_drag ? n._element_group.getLastChildIndex() : d;
                        break
                    }
                t.changeIndexAndUndo({
                    new_index: c
                });
                var u = i.moveBtnSet();
                u.before_num = u.sum - u.num,
                u.after_num = u.sum - (u.num - 1),
                u.num = u.sum - (u.num - 1),
                i.showDownUpLayout(u)
            }
            if (0 != t.button)
                return !1;
            var i = this;
            t.execute && n(),
            o.mouseup(function() {
                o.off("mouseup"),
                n()
            })
        },
        movedownMousedown: function(t, o) {
            function n() {
                var t = i._owner_element
                  , o = t._owner_page;
                if (window.MEMENTO_ID = e.now(),
                "elementGroup" === t._element_type)
                    return void t.moveDown();
                for (var n, s, r = o.elements, a = (r.length,
                t.getIndex()), l = a, c = a - 1; c > 0; c--)
                    if (n = r[c],
                    s = t.intersectEle(r[c])) {
                        l = n._group_drag ? n._element_group.getFirstChildIndex() : c;
                        break
                    }
                0 == l && "background" == r[0]._element_type && (l = 1),
                t.changeIndexAndUndo({
                    new_index: l
                });
                var d = i.moveBtnSet();
                d.before_num = d.sum - (d.num + 1),
                d.after_num = d.sum - d.num,
                d.num = d.sum - (d.num + 1),
                i.showDownUpLayout(d)
            }
            if (0 != t.button)
                return !1;
            var i = this;
            t.execute && n(),
            o.mouseup(function() {
                o.off("mouseup"),
                n()
            })
        },
        showDownUpLayout: function(o) {
            t(".down-up-layout").detach();
            var n = document.getElementById("edit-div")
              , i = n.getBoundingClientRect()
              , s = i.top
              , r = i.right
              , a = e.createNode("ul", "down-up-layout");
            a.addEventListener("animationend", function(e) {
                e.target == a && document.querySelector("body").removeChild(this)
            });
            var l;
            a.style.top = s + "px",
            a.style.left = r + 10 + "px",
            document.querySelector("body").appendChild(a);
            for (var c = 0; c <= o.sum; c++)
                l = e.createNode("li", "down-up-layout-li"),
                c == o.num && t(l).addClass("down-up-layout-li-now"),
                c == o.before_num && t(l).addClass("down-up-layout-li-before"),
                c == o.after_num && t(l).addClass("down-up-layout-li-after"),
                a.appendChild(l)
        },
        eleImgCutMousedown: function(t, o) {
            if (0 != t.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup");
                var t = n._owner_element
                  , i = t._owner_page;
                i.nodeMousedown(),
                "img" == t.dataType ? (window.MEMENTO_ID = e.now(),
                t.cutOut()) : t.nodeDblclick()
            })
        },
        eleCopyMousedown: function(t, o) {
            if (e.addBugTrackClick("e1"),
            0 != t.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup"),
                window.MEMENTO_ID = e.now();
                var i = n._owner_design
                  , s = i.getCurPage()
                  , r = n._owner_element;
                if (s.nodeMousedown(),
                r._elements)
                    return void r.copy(t);
                var a = s.eleCopyAndUndo({
                    ele: r
                });
                a.nodeClick()
            })
        },
        eleDelMousedown: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this
              , s = i._owner_element;
            if ("true" == s.lock) {
                t("#edit-resize-br").removeClass("edit-resize-lock-enlarge");
                var r = t(i.getNode())
                  , a = r.find(".ele-lock");
                return t("#edit-resize-br").hasClass("edit-resize-lock-shake") || (t("#edit-resize-br").addClass("edit-resize-lock-shake"),
                a.addClass("ele-lock-shake"),
                window.ELE_LOCK_REMOVECLASS = setTimeout(function() {
                    t("#edit-resize-br").removeClass("edit-resize-lock-shake"),
                    a.removeClass("ele-lock-shake")
                }, 1500)),
                !1
            }
            n.mouseup(function() {
                n.off("mouseup");
                var t = i._owner_design
                  , o = t.getCurPage();
                return o.nodeMousedown(),
                window.MEMENTO_ID = e.now(),
                s._elements ? void s.removeAndUndo() : void ("background" === s.dataType ? (o.eleDelAndUndo(s),
                o.addWhiteBackgroundAndUndo(!0)) : o.eleDelAndUndo(s))
            })
        },
        groupSplit: function(e) {
            if (0 != e.button)
                return !1;
            {
                var t = this
                  , o = t._owner_element;
                o._elements,
                o.id
            }
            o.groupSplitAndUndo(),
            o = null
        },
        groupPut: function(e) {
            if (0 != e.button)
                return !1;
            var t = this
              , o = t._owner_element;
            o.groupPut()
        },
        hideMoreMenu: function() {
            var n = this.getNode()
              , i = t(n)
              , s = this._owner_element;
            if (null != s) {
                {
                    var r = s.getJson()
                      , a = s.colors;
                    r["data-elem"]
                }
                if ("block" == t("#edit-color").css("display") || "block" == t("#color-pickup").attr("data-block")) {
                    var l = t(".element-edit-bar").find(".ele-color").index(t(".element-edit-bar").find(".ele-color.now-click"));
                    "block" == t(".ss-function-colorPicker").attr("data-block") && (o.colorPickupHide(t("#edit-color").find(".edit-color-span-pickup"), s),
                    a = s.colors),
                    "svg" == s._element_type ? s.previewColor(a["color-" + (l + 1)], l) : s.previewColor(a)
                }
                if ("block" == t("#text-size-bar").css("display") && s.previewFontSize(s.fontSize),
                "block" == t("#opacity-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setOpacity(s.getOpacity())),
                "block" == t("#bold-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setBold(t("#bold-scroll").attr("data-num") / 100)),
                "block" == t("#wspace-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setWspace(t("#wspace-scroll").attr("data-num"))),
                "block" == t("#vspace-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setVspace(t("#vspace-scroll").attr("data-num"))),
                "block" == t("#text-spacing-wrap").css("display") && (window.MEMENTO_ID = e.now(),
                s.setWspace(t("#wspace-scroll").attr("data-num")),
                s.setVspace(t("#vspace-scroll").attr("data-num"))),
                0 != parseInt(t("#leftPanel").css("left"))) {
                    t("#leftPanel").stop(),
                    t("#leftPanel").animate({
                        left: "0px"
                    }, 300),
                    t(".panelArrowWrap").show();
                    var c = parseInt(t("#filter-parameter-num-brightness").text())
                      , d = parseInt(t("#filter-parameter-num-contrast").text())
                      , u = parseInt(t("#filter-parameter-num-saturation").text())
                      , f = parseInt(t("#filter-parameter-num-tint").text())
                      , p = parseInt(t("#filter-parameter-num-gaussianblur").text())
                      , m = parseInt(t("#filter-parameter-num-crossprocess").text())
                      , h = {
                        brightness: c,
                        contrast: d,
                        crossProcess: m,
                        gaussianBlur: p,
                        saturation: u,
                        tint: f
                    };
                    window.MEMENTO_ID = e.now(),
                    s.setFilter(h)
                }
                i.children(".now-click").removeClass("now-click"),
                t(".edit-more-drop").css("display", "none"),
                t("#text-spacing-wrap").css("display", "none")
            }
        },
        editColorShow: function(e, n) {
            if (0 != e.button)
                return !1;
            var s = this;
            n.mouseup(function() {
                if (n.off("mouseup"),
                n.hasClass("now-click"))
                    s.hideMoreMenu();
                else {
                    s.hideMoreMenu(),
                    n.siblings(".now-click").removeClass("now-click"),
                    n.addClass("now-click");
                    var e = (s._owner_element,
                    i.getEditColor())
                      , r = n.offset().left - 10
                      , a = n.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    })
                }
                o.colorBtnSet()
            })
        },
        fontFamilyWrapShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.siblings(".now-click").removeClass("now-click"),
                    o.addClass("now-click");
                    var e = n._owner_element
                      , s = i.getFontFamily()
                      , r = s.find("#text-family-history")
                      , a = e.getFontFocusFamily()
                      , l = o.offset().top + 34;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar"));
                    var c = parseFloat(r.height());
                    l += c,
                    n.getFontFamilyPosition(a, l)
                }
                s.find("#text-family-list").css("height", s.height() - s.find("#text-family-history").height() + "px")
            })
        },
        fontSizeWrapShow: function(e, o) {
            if (0 != e.button)
                return !1;
            {
                var n = this
                  , s = this._owner_design;
                s.pageScale
            }
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.siblings(".now-click").removeClass("now-click"),
                    o.addClass("now-click");
                    var e = n._owner_element
                      , s = i.getFontSize(11)
                      , r = e.getFontFocusSize();
                    "px" != window.DESIGN_ORIGINAL_UNIT && (r = r / 300 * 72);
                    var a = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar"));
                    var l;
                    s.find("ul").children().each(function() {
                        t(this).removeClass("now-size"),
                        t(this).text() == parseInt(r) && (l = t(this))
                    }),
                    l.addClass("now-size"),
                    s.find("ul").scrollTop(l.offset().top - a)
                }
            })
        },
        textAlignShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup");
                var e = i.getFontAlign();
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.siblings(".now-click").removeClass("now-click"),
                    o.addClass("now-click");
                    var s = o.offset().left - 57
                      , r = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: s
                    })
                }
                var a = n._owner_element.getAlign();
                e.children().removeClass("now-click"),
                "right" == a ? e.find(".text-align-right").addClass("now-click") : "center" == a ? e.find(".text-align-center").addClass("now-click") : e.find(".text-align-left").addClass("now-click")
            })
        },
        setAlign: function(o, n) {
            if (0 != o.button)
                return !1;
            if (n.hasClass("now-click"))
                return !1;
            var i = this
              , s = n.attr("class");
            switch (s) {
            case "text-align-left":
                s = "left";
                break;
            case "text-align-center":
                s = "center";
                break;
            case "text-align-right":
                s = "right"
            }
            n.mouseup(function() {
                var o = t(this);
                o.off("mouseup"),
                t("#text-align-bar").children(".now-click").removeClass("now-click"),
                o.addClass("now-click");
                var n = i._owner_element;
                window.MEMENTO_ID = e.now(),
                n.setAlign(s)
            })
        },
        eleReverseShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleReverse()
                      , r = o.offset().left - 26
                      , a = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    })
                }
            })
        },
        eleMoveShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleMove()
                      , r = o.offset().left - 26
                      , a = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    })
                }
            })
        },
        groupAlignShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleGroupAlign()
                      , r = o.offset().left - 26
                      , a = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    })
                }
            })
        },
        groupDistributedShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var s = i.getEleGroupDistributed()
                      , r = o.offset().left - 26
                      , a = o.offset().top + 50;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    })
                }
            })
        },
        textStyleShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                "block" == t("#texteventtarget").css("display")) {
                    var e = n._owner_element;
                    e.finishInput()
                }
                var s = i.getFontStyle();
                if (o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.siblings(".now-click").removeClass("now-click"),
                    o.addClass("now-click");
                    var r = o.offset().left - 43
                      , a = o.offset().top + 45;
                    s.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    })
                }
                var e = n._owner_element;
                "true" == e.italic ? s.find(".text-style-i").addClass("now-click") : s.find(".text-style-i").removeClass("now-click"),
                "true" == e.decoration ? s.find(".text-style-underline").addClass("now-click") : s.find(".text-style-underline").removeClass("now-click")
            })
        },
        textBoldShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var e = i.getBoldWrap()
                      , s = o.offset().left - 130
                      , r = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: r,
                        left: s
                    }),
                    n.getBold()
                }
            })
        },
        boldMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#bold-back").offset().left;
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setBold(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setBold: function(e, t) {
            var o = (e - 67) / 150 * 100;
            t.attr("data-num", parseInt(o)),
            t.next().val(parseInt(o));
            var n = this._owner_element;
            n.previewBold(o / 100)
        },
        getBold: function() {
            var e = this._owner_element
              , o = e.bold || 0
              , n = 67 + 150 * o;
            t("#bold-scroll").css("left", n).attr("data-num", parseInt(100 * o)),
            t("#bold-input").val(parseInt(100 * o))
        },
        textItalic: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this;
            n.children().hasClass("now-set") ? n.children().removeClass("now-set") : n.children().addClass("now-set"),
            n.mouseup(function() {
                t(this).off("mouseup");
                var o = i._owner_element;
                "block" == t("#texteventtarget").css("display") && o.finishInput(),
                window.MEMENTO_ID = e.now(),
                o.setItalic()
            })
        },
        textDecoration: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this;
            n.children().hasClass("now-set") ? n.children().removeClass("now-set") : n.children().addClass("now-set"),
            n.mouseup(function() {
                t(this).off("mouseup");
                var o = i._owner_element;
                "block" == t("#texteventtarget").css("display") && o.finishInput(),
                window.MEMENTO_ID = e.now(),
                o.setDecoration(),
                i.hideMoreMenu()
            })
        },
        setEleFontSize: function(o, n) {
            if (0 != o.button)
                return !1;
            var i = this;
            n.mouseup(function() {
                n.off("mouseup");
                var o = i.getNode()
                  , s = t(o)
                  , r = i._owner_element
                  , a = n.html();
                s.find(".text-size").html(a),
                "px" != window.DESIGN_ORIGINAL_UNIT && (a = a / 72 * 300),
                window.MEMENTO_ID = e.now(),
                r.setFontSize(a),
                i.hideMoreMenu()
            })
        },
        setEleColor: function(n, i) {
            if (0 != n.button)
                return !1;
            var s = this;
            i.mouseup(function() {
                i.off("mouseup");
                var n = s.getNode()
                  , r = (t(n),
                s._owner_element)
                  , a = t(".element-edit-bar").find(".ele-color").index(t(".element-edit-bar").find(".ele-color.now-click"))
                  , l = i.css("background-color");
                window.MEMENTO_ID = e.now(),
                r.setColor(l, a),
                t(".element-edit-bar").find(".ele-color.now-click").children().css("background-color", l),
                "block" == t(".ss-function-colorPicker").attr("data-block") && o.colorPickupHide(t(".edit-color-span-pickup.now-click"), r, !0),
                s.hideMoreMenu()
            })
        },
        opacityWrapShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click"),
                    "block" == t("#texteventtarget").css("display") && n._owner_element.finishInput();
                    var e = i.getOpacityWrap()
                      , s = n.getNode()
                      , r = (t(s),
                    o.offset().left - 122 - 30)
                      , a = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    }),
                    n.getOpacity()
                }
            })
        },
        textSpacingShow: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click"),
                    "block" == t("#texteventtarget").css("display") && n._owner_element.finishInput();
                    var e = i.getTextSpaceWrap()
                      , s = n.getNode()
                      , r = (t(s),
                    o.offset().left - 130)
                      , a = o.offset().top + 50;
                    e.css({
                        display: "block"
                    }).appendTo(t(".element-edit-bar")).offset({
                        top: a,
                        left: r
                    }).children("div").css("display", "block"),
                    n.getWspace(),
                    n.getVspace()
                }
            })
        },
        opacityMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#opacity-back").offset().left;
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setOpacity(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setOpacity: function(e, o) {
            var n = 100 - (e - 67) / 150 * 100;
            o.attr("data-num", parseInt(100 - n)),
            t("#opacity-input").val(parseInt(100 - n));
            var i = this._owner_element;
            i.previewOpacity(n / 100)
        },
        getOpacity: function() {
            var e = this._owner_element
              , o = e.opacity || 0
              , n = 67 + 150 * (1 - o);
            t("#opacity-scroll").css("left", n).attr("data-num", parseInt(100 * (1 - o))),
            t("#opacity-input").val(parseInt(100 * (1 - o)))
        },
        wspaceMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#wspace-back").offset().left
              , s = n._owner_element;
            s.setVspace(t("#vspace-scroll").attr("data-num")),
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setWspace(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setWspace: function(e, o) {
            var n = (e - 67) / 150 * 2e3 - 400;
            o.attr("data-num", parseInt(n)),
            t("#wspace-input").val(parseInt(n));
            var i = this._owner_element;
            i.previewWspace(n)
        },
        getWspace: function() {
            var e = this._owner_element
              , o = e.wspace || 0
              , n = (parseInt(o) + 400) / 2e3 * 150 + 67;
            t("#wspace-scroll").css("left", n).attr("data-num", o),
            t("#wspace-input").val(parseInt(o))
        },
        vspaceMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = t("#vspace-back").offset().left
              , s = n._owner_element;
            s.setWspace(t("#wspace-scroll").attr("data-num")),
            t(document).mousemove(function(e) {
                var t = e.pageX
                  , s = t - i + 67;
                s > 217 && (s = 217),
                67 > s && (s = 67),
                o.css({
                    left: s
                }),
                n.setVspace(s, o)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        setVspace: function(e, o) {
            var n = (e - 67) / 150 * 2e3 - 400;
            o.attr("data-num", parseInt(n)),
            t("#vspace-input").val(parseInt(n));
            var i = this._owner_element;
            i.previewVspace(n)
        },
        getVspace: function() {
            var e = this._owner_element
              , o = e.vspace || 0
              , n = (parseInt(o) + 400) / 2e3 * 150 + 67;
            t("#vspace-scroll").css("left", n).attr("data-num", o),
            t("#vspace-input").val(parseInt(o))
        },
        verticalReverse: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = this;
            t.mouseup(function() {
                t.off("mouseup");
                var e = o._owner_design
                  , n = (e.getCurPage(),
                o._owner_element);
                n.setVerticalReverse();
                var i = e._owner_editDiv;
                i.resetEditDivPosition()
            })
        },
        horizontalReverse: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = this;
            t.mouseup(function() {
                t.off("mouseup");
                var e = o._owner_design
                  , n = (e.getCurPage(),
                o._owner_element);
                n.setHorizontalReverse();
                var i = e._owner_editDiv;
                i.resetEditDivPosition()
            })
        },
        imgFilterShow: function(e, o) {
            if (0 != e.button)
                return !1;
            o.hasClass("now-click") ? t(".panelArrowWrap").show() : t(".panelArrowWrap").hide();
            var n = this;
            o.mouseup(function() {
                if (o.off("mouseup"),
                o.hasClass("now-click"))
                    n.hideMoreMenu();
                else {
                    n.hideMoreMenu(),
                    o.addClass("now-click");
                    var e, i, s = n._owner_element, r = s.getImgNode(), a = r.getBBox(), l = a.width, c = a.height;
                    l > c ? (i = 56,
                    e = 56 * (l / c)) : (e = 56,
                    i = 56 * (c / l));
                    for (var d = 0; d < t(".filter-preset-son-div").size(); d++)
                        t(".filter-preset-son-div").find("image").attr("width", e),
                        t(".filter-preset-son-div").find("image").attr("height", i),
                        t(".filter-preset-son-div").find("image").attr("xlink:href", r.getAttribute("href") || r.getAttribute("xlink:href"));
                    t("#leftPanel").stop(),
                    t("#leftPanel").animate({
                        left: -t("#leftToolbarWrap").getWidth()
                    }, 300);
                    var u = s.filter;
                    for (var d in u)
                        n.setFilterPosition(u[d], d)
                }
            })
        },
        filterDotMove: function(e, o) {
            if (0 != e.button)
                return !1;
            var n = this
              , i = o.prev().offset().left
              , s = n._owner_element
              , r = o.attr("data-filter")
              , a = parseInt(o.attr("data-max"))
              , l = parseInt(o.attr("data-min"));
            t(document).mousemove(function(e) {
                var t = e.pageX - i;
                0 >= t && (t = 0),
                t >= 269 && (t = 269),
                o.css("left", t);
                var n = parseInt((a - l) / 269 * t + l, "10");
                s.filterMove(n, r),
                o.parent().find(".filter-parameter-son-num").text(n)
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup")
            })
        },
        filterClick: function(e, t) {
            var o = this._owner_element
              , n = parseInt(t.attr("data-brightness"))
              , i = parseInt(t.attr("data-contrast"))
              , s = parseInt(t.attr("data-saturation"))
              , r = parseInt(t.attr("data-tint"))
              , a = parseInt(t.attr("data-gaussianblur"))
              , l = parseInt(t.attr("data-crossprocess"));
            "NAN" !== n && (this.setFilterPosition(n, "brightness"),
            o.filterMove(n, "brightness")),
            "NAN" !== i && (this.setFilterPosition(i, "contrast"),
            o.filterMove(i, "contrast")),
            "NAN" !== l && (this.setFilterPosition(l, "crossProcess"),
            o.filterMove(l, "crossProcess")),
            "NAN" !== a && (this.setFilterPosition(a, "gaussianBlur"),
            o.filterMove(a, "gaussianBlur")),
            "NAN" !== s && (this.setFilterPosition(s, "saturation"),
            o.filterMove(s, "saturation")),
            "NAN" !== r && (this.setFilterPosition(r, "tint"),
            o.filterMove(r, "tint"))
        },
        setFilterPosition: function(e, o) {
            var n = t("#filter-dot-" + o)
              , i = parseInt(n.attr("data-max"))
              , s = parseInt(n.attr("data-min"))
              , r = (e - s) / ((i - s) / 269);
            n.css("left", r),
            n.parent().find(".filter-parameter-son-num").text(e)
        },
        imgChangeToBackground: function(t, o) {
            if (0 != t.button)
                return !1;
            var n = this;
            o.mouseup(function() {
                o.off("mouseup");
                var t = n._owner_element
                  , i = t.getPage();
                i.nodeMousedown(),
                window.MEMENTO_ID = e.now(),
                t.changeSizeByPage(),
                t.imgChangeToBackground(),
                t.setLock(),
                t.nodeClick()
            })
        },
        groupElementAlign: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = this._owner_element
              , n = t.attr("data-align");
            "bottom" == n ? o.groupAlignBottom() : "vertical-middle" == n ? o.groupAlignVerticalMiddle() : "top" == n ? o.groupAlignTop() : "right" == n ? o.groupAlignRight() : "standard-middle" == n ? o.groupAlignStandardlMiddle() : "left" == n ? o.groupAlignLeft() : "vertical-auto" == n ? o.groupAlignVerticalAuto() : "standard-auto" == n && o.groupAlignStandardAuto()
        },
        setGroup: function(e) {
            if (0 != e.button)
                return !1;
            for (var t, o = this._owner_design, n = o.getCurPage(), i = this._owner_element, s = i._elements, r = s.length, a = n.createElementGroupAndUndo(s), l = (n.getIndex(),
            s[r - 1].getIndex()), c = 1, d = r - 2; d >= 0; d--)
                t = s[d],
                t.getIndex() != l - c && t.changeIndexAndUndoForCreateGroup({
                    new_index: l - c
                }),
                c++;
            a.nodeClick()
        },
        setLock: function(e, t) {
            if (0 != e.button)
                return !1;
            var o = (window.localStorage.getItem("already_use_names") || "",
            this._owner_design)
              , n = o._owner_editDiv;
            t.children().hasClass("now-set") ? (t.children().removeClass("now-set"),
            t.parent().find(".ele-del, .group-edit-split").removeClass("no-click"),
            n.setUnLock()) : (t.children().addClass("now-set"),
            t.parent().find(".ele-del, .group-edit-split").addClass("no-click"),
            n.setLock());
            var i = this._owner_element;
            return i._elements ? void i.groupSetLock() : void i.setLock()
        }
    },
    e.classExtend(p, s),
    p
});
;/*!/compapi/design/toolbar/EditDiv.js*/
"use strict";
define("compapi/design/toolbar/EditDiv", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/toolbar/toolbar_config", "compapi/design/Toolbar", "libs/jquery/jquery.transit.min", "compapi/design/design_config"], function(e, t, i, s, o, n, r) {
    function a() {
        {
            var e = this;
            e._owner_design
        }
        d.call(e)
    }
    function d() {
        var i = this
          , s = i.getNode()
          , o = t(s);
        window.addEventListener ? (s.addEventListener("mousedown", function(e) {
            t(".materialInfoClose").mousedown(),
            i.nodeMousedown(e),
            e.stopPropagation()
        }, !1),
        s.addEventListener("click", function(e) {
            return t(s).hasClass("edit-div-clone") ? !1 : (i.nodeClick(e),
            void e.stopPropagation())
        }, !1),
        s.addEventListener("dblclick", function(e) {
            return t(s).hasClass("edit-div-clone") ? !1 : (i.nodeDblclick(e),
            void e.stopPropagation())
        }, !1)) : window.attachEvent && (s.attachEvent("onmousedown", function(e) {
            t(".materialInfoClose").mousedown(),
            i.nodeMousedown(e),
            e.stopPropagation()
        }),
        s.attachEvent("onclick", function(e) {
            return t(s).hasClass("edit-div-clone") ? !1 : (i.nodeClick(e),
            void e.stopPropagation())
        }),
        s.attachEvent("ondblclick", function(e) {
            return t(s).hasClass("edit-div-clone") ? !1 : (i.nodeDblclick(e),
            void e.stopPropagation())
        })),
        o.find("#edit-rotate").mousedown(function(t) {
            return e.addBugTrackClick("e3"),
            i.rotateMousedown(t),
            !1
        }),
        o.find(".edit-resize-middle").mousedown(function(e) {
            return i.resizeMousedown(e, this),
            !1
        }),
        o.find(".edit-resize").mousedown(function(e) {
            return i.resizeMousedown(e, this),
            !1
        })
    }
    function l(e, i) {
        if (0 != e.button)
            return !1;
        var s = e.pageX
          , o = e.pageY
          , n = t(".select_element").css({
            width: "0px",
            height: "0px"
        }).offset({
            left: s,
            top: o
        })
          , r = i._owner_design
          , a = r.getCurPage();
        t(document).mousemove(function(e) {
            var t = e.pageX - s
              , i = e.pageY - o
              , r = s
              , d = o;
            0 > t && (r = e.pageX,
            t = -t),
            0 > i && (d = e.pageY,
            i = -i),
            n.css({
                width: t + 1,
                height: i + 1,
                display: "block"
            }).offset({
                left: r,
                top: d
            }),
            a.selectElement(d, r + t, d + i, r)
        }).mouseup(function() {
            t(this).off("mouseup").off("mousemove"),
            n.css("display", "none"),
            a.selectElementUp()
        })
    }
    var c = function(e) {
        var t = this;
        o.call(t),
        t._owner_design = e,
        e._owner_editDiv = t,
        a.call(t)
    };
    return c.prototype = {
        constructor: c,
        createWidget: function() {
            return s.getEditDiv()[0]
        },
        _owner_design: null,
        _owner_element: null,
        _move_drag: !1,
        start_lt: {
            left: 0,
            top: 0
        },
        across_clone: {
            dom: null,
            x: 0,
            y: 0
        },
        start_transform: {
            left: 0,
            top: 0
        },
        show: function(e) {
            this._owner_element = e;
            var i = this._owner_design;
            i._focus_element = e;
            var s = t(this.getNode())
              , o = e.getWidth()
              , n = e.getHeight()
              , r = e.getLeft()
              , a = e.getTop()
              , d = e.getRotate();
            if (s.css({
                width: o + 1,
                height: n + 1,
                display: "block"
            }).appendTo(t("#rightPanel")).css({
                rotate: d
            }).offset({
                left: r,
                top: a
            }).find("#edit-rotate").css("display", "block"),
            s.find(".edit-resize").css("display", "block"),
            s.find(".edit-resize-middle").css("display", "block"),
            e.hideAnt(),
            "text" == e._element_type)
                s.find(".edit-resize-middle").css("display", "none"),
                s.find(".edit-resize-rl").css("display", "block");
            else if ("img" == e._element_type || "background" == e._element_type || "svgChart" == e._element_type)
                s.find(".edit-resize-middle").css("display", "none");
            else if ("svg" == e._element_type) {
                var l = e.getNode()
                  , c = t(l)
                  , h = c.find("svg").children()[0];
                if (null != h) {
                    var g = h.getAttribute("id");
                    "hx" == g ? s.find(".edit-resize-tb").css("display", "none") : "zx" == g ? s.find(".edit-resize-rl").css("display", "none") : "ry" == g || "hx_def" == g || "hs" == g || s.find(".edit-resize-middle").css("display", "none"),
                    "svgLayout" == e._svg_type && void 0 == e.cutwidth && s.find(".edit-resize-middle").css("display", "none");
                    var f = h.getAttribute("class");
                    "line" == f && s.find(".edit-resize").css("display", "none")
                } else
                    s.find(".edit-resize-middle").css("display", "none")
            }
            "true" == e.lock ? this.setLock() : this.setUnLock(),
            this.resizeCursorSet()
        },
        setLock: function() {
            var e = t(this.getNode());
            e.find(".edit-resize-middle").addClass("edit-resize-no-click"),
            e.find("#edit-resize-br").addClass("edit-resize-lock").attr("title", "点击解锁"),
            e.find("#edit-rotate").addClass("edit-rotate-lock")
        },
        setUnLock: function() {
            t("#edit-div").css("display", "block");
            var e = t(this.getNode());
            e.find(".edit-resize-middle").removeClass("edit-resize-no-click"),
            e.find("#edit-resize-br").removeClass("edit-resize-lock").removeAttr("title"),
            e.find("#edit-rotate").removeClass("edit-rotate-lock"),
            e.find(".edit-resize-lock-enlarge").removeClass("edit-resize-lock-enlarge"),
            e.find(".edit-resize-lock-shake").removeClass("edit-resize-lock-shake"),
            t(".element-edit-bar").find(".ele-lock").removeClass("ele-lock-shake")
        },
        showByCircle: function(e) {
            this._owner_element = e;
            var i = this._owner_design;
            i._focus_element = e;
            var s = t(this.getNode())
              , o = e.getRect();
            if (void 0 != o) {
                var n = o.right - o.left
                  , r = o.bottom - o.top
                  , a = o.left
                  , d = o.top;
                s.css({
                    width: n + 1,
                    height: r + 1,
                    display: "block",
                    rotate: "0deg"
                }).appendTo(t("#rightPanel")).offset({
                    left: a,
                    top: d
                }).find("#edit-rotate").css("display", "none"),
                s.find(".edit-resize-middle").css("display", "none"),
                s.find(".edit-resize").removeClass("edit-resize-lock"),
                this.resizeCursorSet()
            }
        },
        showByGroup: function(e) {
            this._owner_element = e;
            var i = this._owner_design;
            i._focus_element = e;
            var s = e.getRect()
              , o = e.getWidth()
              , n = e.getHeight()
              , r = e.getRotate()
              , a = s.left
              , d = s.top
              , l = t(this.getNode());
            this.setGroupEdit(),
            l.css({
                width: o + 1,
                height: n + 1,
                display: "block",
                rotate: r + "deg"
            }).appendTo(t("#rightPanel")).offset({
                left: a,
                top: d
            }),
            l.find(".edit-resize-middle").css("display", "none"),
            "true" == e.lock ? this.setLock() : this.setUnLock(),
            this.resizeCursorSet()
        },
        setGroupEdit: function() {
            var e = this._owner_element
              , i = t(this.getNode());
            e._text_ele_sum === e._text_ele_loaded ? (i.find("#edit-rotate").css("display", "block"),
            i.find(".edit-resize").css("display", "block")) : (i.find("#edit-rotate").css("display", "none"),
            i.find(".edit-resize").css("display", "none"))
        },
        showInGroup: function(e) {
            var i = t(this.getNode()).clone();
            i.children().detach();
            var s = e.getWidth()
              , o = e.getHeight()
              , n = (e.getRotate(),
            e.getRect())
              , r = n.left
              , a = n.top;
            i.addClass("editdiv-clone").css({
                width: s + 1,
                height: o + 1,
                display: "block",
                rotate: e.getRotateFormNode() + "deg"
            }).appendTo(t("#rightPanel")).offset({
                left: r,
                top: a
            });
            for (var d = this._owner_element._elements, l = 0; l < d.length; l++)
                d[l].hideAnt();
            "text" == e._element_type && i.addClass("editdiv-clone-text"),
            i.mousedown(function() {
                return !1
            })
        },
        resizeCursorSet: function() {
            var e = t(this.getNode());
            this.resizeCursor(e.find("#edit-resize-br")),
            this.resizeCursor(e.find("#edit-resize-r")),
            this.resizeCursor(e.find("#edit-resize-b"))
        },
        svgLayoutShow: function(e) {
            this._owner_element = e;
            var i = this._owner_design
              , s = i._owner_elementEditbar
              , o = s.getNode();
            o.style.display = "none",
            i._focus_element = e;
            var n = (e._layout_index,
            t(this.getNode()))
              , r = e.getSvgImageRect()
              , a = e.getShowSvgImageBox()
              , d = i.pageScale
              , l = e.getSvgScale()
              , c = r.top
              , h = r.left
              , g = a.height * l * d
              , f = a.width * l * d
              , p = e.getRotate();
            n.css({
                width: f + 1,
                height: g + 1,
                display: "block"
            }).css({
                rotate: p
            }).offset({
                left: h,
                top: c
            }).find("#edit-rotate").css("display", "none"),
            n.find(".edit-resize-middle").css("display", "none"),
            t(".edit-div-clone").size() > 0 ? t(".edit-div-clone").before(n) : n.appendTo(t("#rightPanel"));
            t(e.getNode());
            this.createSvgLayoutWrite(),
            0 == t(".edit-div-clone").size() && "cut1" == e.getJson()["data-elem"].id && (t(".edit-div-clone").detach(),
            this.createSvgCut(e))
        },
        createSvgCut: function(e) {
            var i = this
              , s = this._owner_design;
            s._focus_element = e;
            var o = t(this.getNode()).clone();
            o.mousedown(function(e) {
                return i.nodeMousedown(e),
                !1
            }),
            o.find(".edit-resize-middle").mousedown(function(e) {
                return i.resizeMousedown(e, this),
                !1
            });
            var n = e.getWidth()
              , r = e.getHeight()
              , a = e.getLeft()
              , d = e.getTop()
              , l = e.getRotate();
            o.css({
                width: n + 1,
                height: r + 1,
                display: "block",
                cursor: "move"
            }).appendTo(t("#rightPanel")).css({
                rotate: l
            }).offset({
                left: a,
                top: d
            }).addClass("edit-div-clone"),
            o.find(".edit-resize").css("display", "none"),
            o.find(".edit-resize-middle").css("display", "block")
        },
        createSvgLayoutWrite: function() {
            t(".edit-div-write-wrap").remove();
            var i = this._owner_element
              , s = t(i.getNode())
              , o = this._owner_design
              , n = i.getSvgImageRect()
              , a = i.getSvgImageBox()
              , d = i.getSvgImageSrc()
              , l = o.pageScale
              , c = i.getSvgScale()
              , h = a.height * c * l
              , g = a.width * c * l
              , f = e.createSvgNode("g")
              , p = (t(f),
            e.createSvgNode("image"))
              , u = g / l
              , m = h / l;
            p.setAttribute("width", u),
            p.setAttribute("height", m),
            p.href.baseVal = d,
            f.appendChild(p),
            f.setAttribute("class", "edit-div-write-wrap");
            var _ = i.getJson()
              , v = _.transform
              , w = e.getTransformAttr(v, "rotate")
              , y = e.setTransformAttr("", "rotate", w);
            y = e.transformScale(y, r.ZOOM_IN),
            f.setAttribute("opacity", "0.6"),
            f.setAttribute("transform", y),
            s.before(t(f));
            var z = f.getBoundingClientRect()
              , b = (n.left - z.left) / l
              , k = (n.top - z.top) / l
              , S = [b, k];
            y = e.setTransformAttr(y, "translate", S),
            y = e.setTransformAttr(y, "rotate", w),
            f.setAttribute("transform", e.transformScale(y, r.ZOOM_IN))
        },
        svgLayoutImageMove: function(t, i) {
            var s = this._owner_design
              , o = this._owner_element
              , n = o.getRotate()
              , r = s.pageScale
              , a = o.getSvgScale()
              , d = e.coordinateRotate(t, i, n)
              , l = d.x / r / a
              , c = d.y / r / a;
            return o.setSvgImageLT(l, c),
            o.getSvgImageRect()
        },
        nodeMousedown: function(i) {
            if (0 != i.button)
                return !1;
            "true" == this._owner_element.lock && t("#edit-resize-br").removeClass("edit-resize-lock-enlarge edit-resize-lock-shake");
            var s = this
              , o = s._owner_design
              , n = o._owner_elementEditbar;
            if (t(".editdiv-clone").size() > 0) {
                t(".editdiv-clone").hasClass("editdiv-clone-text") && o._focus_element.finishInput(this._owner_element),
                t(".editdiv-clone").detach(),
                o._focus_element = this._owner_element,
                n.show(this._owner_element);
                for (var a = this._owner_element._elements, d = 0; d < a.length; d++)
                    a[d].showAnt()
            }
            n.hideMoreMenu();
            var c = o.getCurPage()
              , h = n.getNode()
              , g = i.pageX
              , f = i.pageY
              , p = g
              , u = f
              , m = t(s.getNode())
              , _ = s._owner_element
              , v = !1;
            t(".edit-div-write-wrap").size() > 0 && ("none" == h.style.display,
            v = !0);
            var a, w = _.getRect(), y = {
                left: w.left,
                right: w.right,
                top: w.top,
                bottom: w.bottom,
                middle_x: (w.left + w.right) / 2,
                middle_y: (w.top + w.bottom) / 2
            };
            if ("circleSelect" == _._element_type || "elementGroup" == _._element_type) {
                a = _._elements;
                var z = {};
                z.left = y.left,
                z.top = y.top
            } else {
                a = [_];
                var b = _.getTranslateLeftTop()
            }
            {
                var k, S, C = c.elementsPositionNotThis(a), M = o.pageScale;
                t(".element-edit-bar").find(".ele-lock")
            }
            t(document).mousemove(function(i) {
                if ("true" == s._owner_element.lock)
                    return s.getNode().style.display = "none",
                    t(this).off("mousemove"),
                    l(i, s),
                    !1;
                var o = i.pageX
                  , n = i.pageY
                  , a = o - g
                  , d = n - f;
                if (v) {
                    var h = s.svgLayoutImageMove(a, d);
                    m.offset({
                        top: h.top,
                        left: h.left
                    }),
                    s.createSvgLayoutWrite(),
                    g = o,
                    f = n
                } else {
                    k = c.changeElePosition(y, a, d),
                    k.i = _.getIndex(),
                    S = c.guideShow(k, C);
                    var h;
                    "circleSelect" == _._element_type || "elementGroup" == _._element_type ? (h = _.addLeftTop((S.left - z.left) * r.ZOOM_IN, (S.top - z.top) * r.ZOOM_IN),
                    z.left = S.left,
                    z.top = S.top) : h = _.setLeftTop([b[0] + (S.left - y.left) / M * r.ZOOM_IN, b[1] + (S.top - y.top) / M * r.ZOOM_IN]),
                    m.offset({
                        top: h.top,
                        left: h.left
                    })
                }
                Math.abs(o - p) < 2 && Math.abs(n - u) < 2 ? s._move_drag = !1 : (s._move_drag = !0,
                _.setMoveOpacity(!0));
                var w, x;
                if ("elementGroup" == _._element_type || "circleSelect" == _._element_type) {
                    var N = _.getTranslateLeftTop();
                    w = parseInt(N[0]),
                    x = parseInt(N[1])
                } else if ("svgChart" == _._element_type || "text" == _._element_type) {
                    var N = _.getPosition();
                    w = parseInt(N[0]),
                    x = parseInt(N[1])
                } else
                    w = parseInt(e.getTransformAttr(_.getTransform(), "translate")[0] / r.ZOOM_IN),
                    x = parseInt(e.getTransformAttr(_.getTransform(), "translate")[1] / r.ZOOM_IN);
                t("#edit-data").text(w + "," + x).fadeIn(250)
            }).mouseup(function() {
                _.setMoveOpacity(!1);
                for (var i = 0; i < t(".elementsSonEnter").size(); i++)
                    e.removeClass(t(".elementsSonEnter").eq(i)[0], "elementsSonEnter");
                t("#edit-data").fadeOut(250),
                t(this).off("mousemove").off("mouseup"),
                t(".moveGuide").detach();
                var o = _.overstepPageDel();
                if (o)
                    return !1;
                if (window.MEMENTO_ID = e.now(),
                s._move_drag) {
                    "circleSelect" == _._element_type || "elementGroup" == _._element_type ? _.setNewJson() : v ? _.setLayout() : _.transform = e.transformScale(_.getTransform(), 1 / r.ZOOM_IN);
                    var n = s._owner_design
                      , a = n._owner_elementEditbar;
                    a.moveBtnSet()
                }
            })
        },
        nodeClick: function(t) {
            if (this._move_drag)
                return void (this._move_drag = !1);
            for (var i, s, o, n, r, a, d, l, c, h, g, f, p, u, m, _, v, w = this._owner_element, y = w.getIndex(), z = w._owner_page, b = z.getRect(), k = z._owner_design, S = k.pageScale, C = z.elements, M = t.pageX, x = t.pageY, N = C.length - 1; N > y; N--)
                if (w = C[N],
                i = w.getRect(),
                s = w.getShowBox(),
                h = w.getShowTranslateLeftTop(),
                g = parseFloat(h[0]),
                f = parseFloat(h[1]),
                u = s.x + g,
                _ = u + s.width,
                m = s.y + f,
                v = m + s.height,
                a = M - b.left,
                d = x - b.top,
                l = (u + s.width / 2) * S,
                c = (m + s.height / 2) * S,
                p = e.coordinateRotate(a, d, parseFloat(w.getRotate()), l, c),
                n = p.x / S,
                r = p.y / S,
                v > r && r > m && _ > n && n > u) {
                    o = N;
                    break
                }
            o && (w._group_drag ? w._element_group.nodeClick() : w.nodeClick())
        },
        resizeCursor: function(e) {
            var t = this._owner_element
              , i = t.getRect()
              , s = i.left + i.width / 2
              , o = i.top + i.height / 2
              , n = e.offset().left + e.getWidth() / 2
              , r = e.offset().top + e.getHeight() / 2
              , a = 15;
            "edit-resize-br" == e.attr("id") && (a = 1),
            n > s && (r > o && e.css("cursor", "se-resize"),
            o > r && e.css("cursor", "ne-resize")),
            s > n && (r > o && e.css("cursor", "sw-resize"),
            o > r && e.css("cursor", "nw-resize")),
            Math.abs(r - o) / Math.abs(n - s) < Math.tan(a * Math.PI / 180) && (n > s && e.css("cursor", "e-resize"),
            s > n && e.css("cursor", "w-resize")),
            Math.abs(r - o) / Math.abs(n - s) > Math.tan((90 - a) * Math.PI / 180) && (r > o && e.css("cursor", "s-resize"),
            o > r && e.css("cursor", "n-resize"))
        },
        rotateMousedown: function(i) {
            if (0 != i.button)
                return !1;
            var s = this
              , o = s._owner_element;
            if ("true" == o.lock)
                return !1;
            o._focus_drag && o.finishInput();
            var n = s._owner_design
              , a = n._owner_elementEditbar;
            t(".editdiv-clone").size() > 0 && (t(".editdiv-clone").hasClass("editdiv-clone-text") && n._focus_element.finishInput(o),
            n._focus_element = o,
            t(".editdiv-clone").detach());
            var d = t(s.getNode())
              , l = o.getRect()
              , c = l.width
              , h = l.height
              , g = l.left
              , f = l.top
              , p = g + c / 2
              , u = f + h / 2
              , m = a.getNode();
            "block" === m.style.display && (m.style.display = "none");
            var _;
            t(document).mousemove(function(e) {
                var i = e.pageX
                  , n = e.pageY
                  , r = i - p
                  , a = n - u
                  , l = Math.abs(r)
                  , c = Math.abs(a);
                _ = s.rotatedeg(r, a, l, c),
                o.setRotate(_),
                d.css({
                    rotate: _
                });
                var h = s.getRotateTextNode();
                t(h).text(parseInt(_) + "°").css({
                    display: "block",
                    rotate: 360 - _
                })
            }).mouseup(function() {
                t(this).off("mousemove").off("mouseup");
                var i = s.getRotateTextNode();
                i.style.display = "none",
                window.MEMENTO_ID = e.now(),
                "circleSelect" == o._element_type || "elementGroup" == o._element_type ? o.setNewJson() : o.transform = e.transformScale(o.getTransform(), 1 / r.ZOOM_IN),
                s.resizeCursorSet(),
                a.show(o)
            })
        },
        checkImgCover: function(t, i) {
            var s, o = t.getJson(), n = o.transform, r = e.getTransformAttr(n, "translate"), a = t.getShowWidth(), d = t.getShowHeight(), l = {
                top: parseFloat(r[1]),
                right: parseFloat(r[0]) + a,
                bottom: parseFloat(r[1]) + d,
                left: parseFloat(r[0])
            }, c = t._owner_page, h = {
                width: c.width,
                height: c.height
            };
            return s = e.coordinateRotate(0, 0, i, h.width / 2, h.height / 2),
            s.x < l.left || s.x > l.right || s.y < l.top || s.y > l.bottom ? !1 : (s = e.coordinateRotate(h.width, 0, i, h.width / 2, h.height / 2),
            s.x < l.left || s.x > l.right || s.y < l.top || s.y > l.bottom ? !1 : (s = e.coordinateRotate(h.width, h.height, i, h.width / 2, h.height / 2),
            s.x < l.left || s.x > l.right || s.y < l.top || s.y > l.bottom ? !1 : (s = e.coordinateRotate(0, h.height, i, h.width / 2, h.height / 2),
            s.x < l.left || s.x > l.right || s.y < l.top || s.y > l.bottom ? !1 : !0)))
        },
        getRotateTextNode: function() {
            return document.getElementById("edit-rotate-text")
        },
        rotatedeg: function(e, t, i, s) {
            var o, n = 180 * Math.atan(i / s) / Math.PI, r = 5;
            return 0 >= e && 0 > t ? (o = 180 - n,
            o > 135 - r && 135 + r > o ? o = 135 : 90 + r > o ? o = 90 : o > 180 - r && (o = 180)) : e > 0 && 0 >= t ? (o = 180 + n,
            o > 225 - r && 225 + r > o ? o = 225 : 180 + r > o ? o = 180 : o > 270 - r && (o = 270)) : e >= 0 && t > 0 ? (o = 360 - n,
            o > 315 - r && 315 + r > o ? o = 315 : 270 + r > o ? o = 270 : o > 360 - r && (o = 360)) : (o = n,
            o > 45 - r && 45 + r > o ? o = 45 : 0 + r > o ? o = 0 : o > 90 - r && (o = 90)),
            o
        },
        nodeDblclick: function(e) {
            var t = this._owner_element;
            "elementGroup" == t._element_type ? t.groupMousePosition(e) : t.nodeDblclick(e)
        },
        resetHeight: function(e) {
            var i = this.getNode()
              , s = t(i);
            t(".editdiv-clone").size() > 0 && (i = t(".editdiv-clone")[0],
            s = t(".editdiv-clone"));
            var o = i.getBoundingClientRect()
              , n = o.left
              , r = o.top;
            i.style.height = e + "px",
            s.offset({
                left: n,
                top: r
            })
        },
        getWHLT: function(e) {
            var i = this.getNode();
            if (void 0 != e && t(e).parent().hasClass("edit-div-clone")) {
                var s = t(".edit-div-clone")[0];
                return {
                    width: parseFloat(s.style.width) - 1,
                    height: parseFloat(s.style.height) - 1,
                    left: parseFloat(s.style.left),
                    top: parseFloat(s.style.top)
                }
            }
            return {
                width: parseFloat(i.style.width) - 1,
                height: parseFloat(i.style.height) - 1,
                left: parseFloat(i.style.left),
                top: parseFloat(i.style.top)
            }
        },
        resizeMousedown: function(i, s) {
            if (0 != i.button)
                return !1;
            var o = this
              , n = o.getNode()
              , a = (t(n),
            o._owner_element)
              , d = o._owner_design
              , l = d._owner_elementEditbar;
            if ("true" == a.lock)
                return o.setUnLock(),
                l.setLock(i, t(".ele-lock")),
                !1;
            a._focus_drag && a.finishInput(),
            t(".editdiv-clone").size() > 0 && (t(".editdiv-clone").hasClass("editdiv-clone-text") && d._focus_element.finishInput(a),
            d._focus_element = a,
            t(".editdiv-clone").detach());
            var c = o.getWHLT(s);
            l.hideMoreMenu();
            var h = l.getNode()
              , g = t(s);
            g.addClass("resize-hover");
            var f = o.resizeNode(s)
              , p = t(f)
              , u = {
                dom: p,
                x: p.offset().left + p.getWidth() / 2,
                y: p.offset().top + p.getHeight() / 2
            }
              , m = Math.atan(c.height / c.width)
              , _ = {
                x: g.offset().left + g.getWidth() / 2,
                y: g.offset().top + g.getHeight() / 2,
                sin: Math.sin(m),
                cos: Math.cos(m)
            }
              , v = (_.y - u.y) / (_.x - u.x)
              , w = -1 / v
              , y = {
                a: v,
                b: u.y - v * u.x,
                a2: w,
                b2: _.y - w * _.x
            }
              , z = u.x * w + y.b2;
            y.drag = z > u.y;
            var b = !1;
            return t(".edit-div-write-wrap").size() > 0 && ("none" == h.style.display,
            b = !0),
            t(document).mousemove(function(e) {
                o._move_drag = !0;
                var i = e.pageX
                  , n = e.pageY
                  , r = Math.sqrt(y.a * y.a + 1)
                  , d = Math.abs(y.a * i - n + y.b)
                  , l = d / r
                  , h = Math.sqrt((i - _.x) * (i - _.x) + (n - _.y) * (n - _.y))
                  , g = Math.sqrt(h * h - l * l);
                _.x - u.x == 0 && (g = Math.abs(n - _.y));
                var f = g
                  , p = g;
                u.dom.hasClass("edit-resize") && (f = g * _.cos,
                p = g * _.sin);
                var m = f + c.width
                  , v = p + c.height
                  , w = i * y.a2 + y.b2;
                y.drag ? w > n && (m = c.width - f,
                v = c.height - p) : (n > w && (m = c.width - f,
                v = c.height - p),
                isNaN(w) && (u.x > _.x ? i > _.x && (m = c.width - f,
                v = c.height - p) : i < _.x && (m = c.width - f,
                v = c.height - p))),
                b && !t(s).parent().hasClass("edit-div-clone") ? o.resizeSetSvgLayoutWH(m, v) : u.dom.hasClass("edit-resize-rl") ? o.resizeSetWidth(m) : u.dom.hasClass("edit-resize-tb") ? o.resizeSetHeight(v) : u.dom.hasClass("edit-resize") && o.resizeSetWH(m, v),
                t("#edit-data").text(parseInt(a.getShowWidth()) + "," + parseInt(a.getShowHeight())).fadeIn(250)
            }).mouseup(function() {
                o.resizeCursorSet(),
                o.resetEditDivPosition(),
                t("#edit-data").fadeOut(250),
                t(this).off("mousemove").off("mouseup"),
                g.removeClass("resize-hover"),
                window.MEMENTO_ID = e.now(),
                b && !t(s).parent().hasClass("edit-div-clone") ? a.setLayout() : (a.resetPosition(),
                u.dom.hasClass("edit-resize-rl") ? a.resetWidth() : u.dom.hasClass("edit-resize-tb") ? a.resetHeight() : u.dom.hasClass("edit-resize") && a.resetWH(),
                "elementGroup" !== a._element_type && "circleSelect" !== a._element_type && (a.transform = e.transformScale(a.getTransform(), 1 / r.ZOOM_IN),
                a.seatRectSet()))
            }),
            !1
        },
        resizeNode: function(e) {
            var i, s = e.getAttribute("id"), o = t(e);
            switch (s) {
            case "edit-resize-tl":
                i = o.siblings("#edit-resize-br");
                break;
            case "edit-resize-tr":
                i = o.siblings("#edit-resize-bl");
                break;
            case "edit-resize-bl":
                i = o.siblings("#edit-resize-tr");
                break;
            case "edit-resize-br":
                i = o.siblings("#edit-resize-tl");
                break;
            case "edit-resize-r":
                i = o.siblings("#edit-resize-l");
                break;
            case "edit-resize-l":
                i = o.siblings("#edit-resize-r");
                break;
            case "edit-resize-t":
                i = o.siblings("#edit-resize-b");
                break;
            case "edit-resize-b":
                i = o.siblings("#edit-resize-t");
                break;
            default:
                console.log("放大缩小按钮定位出错")
            }
            return i
        },
        resetEditDivPosition: function() {
            var e = this._owner_element
              , i = e.getLeft()
              , s = e.getTop()
              , o = e.getWidth()
              , n = e.getHeight()
              , r = this.getNode()
              , a = t(r);
            t(".edit-div-clone").size() > 0 ? t(".edit-div-clone").css({
                width: o + 1,
                height: n + 1
            }).offset({
                left: i,
                top: s
            }) : a.css({
                width: o + 1,
                height: n + 1
            }).offset({
                left: i,
                top: s
            });
            this._owner_design
        },
        resizeSetWidth: function(e) {
            1 > e && (e = 1);
            var t = this._owner_design
              , i = t.pageScale
              , s = this._owner_element;
            s.previewWidth(e / i),
            this.resetEditDivPosition()
        },
        resizeSetHeight: function(e) {
            1 > e && (e = 1);
            var t = this._owner_design
              , i = t.pageScale
              , s = this._owner_element;
            s.previewHeight(e / i),
            this.resetEditDivPosition()
        },
        resizeSetWH: function(e, t) {
            var i = e / t;
            t > e ? 1 > e && (e = 1,
            t = e / i) : 1 > t && (t = 1,
            e = t * i);
            var s = this._owner_design
              , o = s.pageScale
              , n = this._owner_element;
            n.previewWH(e / o, t / o),
            this.resetEditDivPosition()
        },
        resizeSetSvgLayoutWH: function(e, t) {
            var i = this._owner_design
              , s = this._owner_element
              , o = i.pageScale;
            s.previewSvgLayoutWH(e / o, t / o),
            this.svgLayoutShow(s)
        }
    },
    e.classExtend(c, o),
    c
});
;/*!/compapi/design/widgets/Design.js*/
"use strict";
define("compapi/design/widgets/Design", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/widgets/DataWidget", "compapi/design/widgets/Page", "compapi/design/design_config", "compapi/design/toolbar/ElementEditbar", "compapi/design/toolbar/EditDiv", "compapi/design/toolbar/toolbar_config", "compapi/design/toolbar/SvgFilter", "widget/logreg/logreg", "widget/pop/pop", "compapi/design/widgets/ElementGroup", "compapi/api/toolbar/DesignEditbar", "compapi/design/toolbar/DesignEditbar"], function(e, n, t, a, o, i, s, d, l, r, g, p, h) {
    function c() {
        var e = this;
        e._wrap = e.getNode().parentNode,
        u.call(e),
        e._bleed = e.getJson().bleed
    }
    function u() {
        var n = this;
        e.dataBinding({
            obj: n,
            prop_name: "bleed",
            getFun: e.$noop,
            setFun: function(e) {
                var t = !0
                  , a = e;
                "object" == typeof e && (a = e.value,
                t = e.undo_drag),
                n.saveDesignAndUndo({
                    obj: n,
                    loc: "",
                    key: "bleed",
                    value: a,
                    type: "0",
                    action: "changeDesign"
                }, t)
            }
        })
    }
    function f() {
        n(".onload-black").animate({
            opacity: "0"
        }, function() {
            n(".onload-black").css("display", "none"),
            n(".login-first").css("display", "block")
        }),
        n(".second-element-edit-bar").css({
            top: n(".page").eq(0).offset().top,
            left: n(".page").eq(0).offset().left - 150
        }),
        n(".second-page-edit-bar").css({
            top: n(".page_menu").eq(0).offset().top - 170,
            left: n(".page_menu").eq(0).offset().left - 30
        }),
        n(".second-undo-edit-bar").css({
            top: 0,
            left: n(".undo").offset().left - 30
        }),
        window.api || n(".third-title").css({
            top: 0,
            left: n(".design_title").offset().left - 150
        })
    }
    var v = function(e) {
        window.DESIGN_MAKING = !0,
        document.ondragstart = function() {
            return !1
        }
        ;
        var o;
        o = require(window.api ? "compapi/api/toolbar/DesignEditbar" : "compapi/design/toolbar/DesignEditbar");
        var i = this;
        i.options = n.extend(!0, {}, i.options, e),
        a.call(i, i.options.design_json),
        c.call(i);
        var l = new r(this);
        this._svg_filter = l;
        var g = i.options.design_json.pages;
        if (g)
            for (var p in g)
                i.createPage(g[p]);
        "1.0.2" != window.DESIGN_VERSION && (t.saveJsonAttr = {
            data: {
                loc: "",
                cont: [{
                    type: 0,
                    key: "v",
                    val: "1.0.2",
                    cLoc: ""
                }]
            },
            obj: null
        },
        window.DESIGN_VERSION = "1.0.2");
        this.pageScale,
        new o(i),
        new s(i),
        new d(i);
        f(),
        void 0 != i.pages[0] && i.pages[0].nodeMouseenter(),
        "px" == window.DESIGN_ORIGINAL_UNIT || n(".page-bleed").hasClass("page-bleed-showing") || void 0 != i.options.design_json.bleed || (n(".page-bleed").eq(0).mousedown(),
        i._mementos = []),
        window.DESIGN_MAKING = !1
    };
    return v.prototype = {
        constructor: v,
        _json: {},
        options: {
            id: null,
            design_json: {
                title: "默认标题"
            }
        },
        createWidget: function() {
            var e = document.getElementById(this.options.id);
            return e
        },
        _owner_designEditbar: null,
        _owner_elementEditbar: null,
        _owner_editDiv: null,
        _svg_filter: null,
        _focus_element: null,
        _focus_page: null,
        _bleed: "",
        _pages: [],
        set pages(e) {
            void 0 == e.page ? this._pages.splice(e.index, 1) : this._pages.splice(e.index, 0, e.page)
        },
        get pages() {
            return this._pages
        },
        _pageScale: 0,
        set pageScale(e) {
            0 === e ? this.setPageScale() : this._pageScale = e
        },
        get pageScale() {
            return 0 === this._pageScale && (this.pageScale = 0),
            this._pageScale
        },
        _minPageScale: 0,
        _maxPageScale: 0,
        createPage: function(e, n) {
            var t;
            return t = void 0 != n ? new o(this,e,n) : new o(this,e)
        },
        insertPage: function(e, n) {
            var t;
            return t = void 0 != n ? new o(this,e,n) : new o(this,e),
            t.nodeMousedown(),
            this.setPageScale(this.pageScale),
            t
        },
        insertPageAndUndo: function(e, n, t) {
            var a = this.insertPage(e, n);
            return this.saveDesignAndUndo({
                obj: a,
                loc: "pages]",
                key: a.getIndex(),
                value: JSON.parse(JSON.stringify(e)),
                type: "0",
                action: "addPage"
            }, t),
            a
        },
        addPage: function(e, n) {
            void 0 == n && (n = this.getPageSum());
            var t = {
                index: n,
                page: e
            };
            this.pages = t
        },
        getPageSum: function() {
            var e = this.pages.length;
            return e
        },
        changeDesignKind: function(e, n) {
            for (var t = this, a = t.getNewJson(), o = JSON.stringify(a), i = this.pages, s = i.length, d = 0; s > d; d++)
                this.postingDesign(o, {
                    i: d,
                    drag: !0,
                    width: e,
                    height: n
                });
            this.changePageWH(e, n)
        },
        changePageWH: function(t, a) {
            for (var o = this.pages, s = 0; s < o.length; s++) {
                o[s].width = {
                    value: t,
                    undo_drag: "noUndo"
                },
                o[s].height = {
                    value: a,
                    undo_drag: "noUndo"
                };
                var d = o[s]._elements[0];
                if (void 0 != d && "background" === d._element_type) {
                    var l, r, g = this.pageScale, p = d.getWidth() / g, h = d.getHeight() / g;
                    p / t > h / a ? (l = a * (p / h),
                    r = a,
                    d.previewWH(l, r)) : (l = t,
                    r = t * (h / p),
                    d.previewWH(l, r));
                    {
                        d.getJson()
                    }
                    d.setLeftTop([(t - l) / 2 * i.ZOOM_IN, (a - r) / 2 * i.ZOOM_IN]),
                    d.resetWH(),
                    d.transform = e.transformScale(d.getTransform(), 1 / i.ZOOM_IN)
                }
                o[s].setSvgViewBox()
            }
            window.DESIGN_WIDTH = t,
            window.DESIGN_HEIGHT = a,
            this.setPageScale();
            var g = this.pageScale;
            n(".design-scale-num").children().html(parseInt(100 * g) + "%")
        },
        postingDesign: function(e, n) {
            var t = n.page || this.pages[n.i];
            t.clear(),
            e = this.suitJson(e, n)
        },
        suitJson: function(e, n) {
            e = JSON.parse(e);
            for (var t = e.pages, a = parseFloat(t[n.i].width), o = parseFloat(t[n.i].height), i = n.page || this.pages[n.i], s = {
                width: i.width,
                height: i.height
            }, d = n.width || s.width, l = n.height || s.height, r = d / a, g = l / o, p = Math.min(r, g), h = t[n.i].elems, c = h.length, u = 0; c > u; u++) {
                var f = this.suitEleJson(h[u], p, d, l, a, o);
                "text" == f["data-type"] && (f["data-elem"].paragraphs = []),
                i.createElementAndUndo({
                    json: f,
                    unshift: !0
                })
            }
        },
        suitEleJson: function(n, t, a, o, i, s) {
            var d = n.transform
              , l = e.getTransformAttr(d, "translate")
              , r = [];
            r[0] = parseFloat(l[0]) / i * a,
            r[1] = parseFloat(l[1]) / s * o,
            d = e.setTransformAttr(d, "translate", r);
            var g = e.getTransformAttr(d, "rotate");
            if (0 != g[0]) {
                var p = [];
                p[0] = g[0],
                p[1] = parseFloat(g[1]) / i * a,
                p[2] = parseFloat(g[2]) / s * o,
                d = e.setTransformAttr(d, "rotate", p)
            }
            n.transform = d;
            var h = n["data-elem"]
              , i = h.width
              , s = h.height
              , c = h["font-size"];
            h.width = i * t,
            h.height = s * t;
            var u = n["data-type"];
            return "text" == u && (h["font-size"] = c * t),
            "background" == u && ("false" != h["data-key"] ? (i / a > s / o ? (i = o * (i / s),
            s = o) : (s = a * (s / i),
            i = a),
            d = "translate(" + (a - i) / 2 + "," + (o - s) / 2 + ")") : (i = a,
            s = o,
            d = "translate(0,0)"),
            h.width = i,
            h.height = s,
            n.transform = d),
            n
        },
        setPageScale: function(e, t) {
            var a = this.pages[0]
              , o = this._wrap.offsetWidth
              , s = this._wrap.offsetHeight;
            t > 0 && (o = t);
            var d, l, r, g = i.DESIGN_BLANK, p = o - g.left - g.right, h = s - g.top - g.bottom;
            void 0 == e ? (e = 1,
            d = a.width,
            l = a.height,
            r = d / l,
            l / h > d / p ? (l = h,
            d = l * r) : (d = p,
            l = d / r),
            e = l / a.height,
            this._minPageScale = e / 4,
            this._maxPageScale = 4 * e,
            this._minPageScale > 1 && (this._minPageScale = 1),
            this._maxPageScale < 1 && (this._maxPageScale = 1)) : (d = a.width * e,
            l = a.height * e),
            this.pageScale = e;
            var c = this.pages.length
              , u = c * l + g.bottom + (c - 1) * g.top
              , f = d + g.right
              , v = f
              , _ = u
              , m = (s - _) / 2
              , w = (o - v) / 2;
            m = m < g.top ? g.top : m,
            w = w < g.left ? g.left : w;
            var x = this.getNode();
            if (t > 0) {
                var U = n(x);
                U.animate({
                    width: v + "px",
                    height: _ + "px",
                    left: w + "px",
                    top: m + "px"
                }, 400)
            } else
                x.style.width = v + "px",
                x.style.height = _ + "px",
                x.style.left = w + "px",
                x.style.top = m + "px";
            this.setPagePosition()
        },
        setPagePosition: function() {
            for (var e, n = this.pages, t = n.length, a = 0; t > a; a++)
                e = n[a],
                e.setShowWH(this.pageScale, a),
                e.eleSeatRectSet()
        },
        getCurPage: function() {
            return null == this._focus_page ? this.pages[0] : this._focus_page
        },
        removePageAndUndo: function(e, n) {
            var t, a;
            e.constructor == o ? (a = e,
            t = e.getIndex()) : (t = e,
            a = this.pages[t]);
            var i = a.getDesign();
            i.saveDesignAndUndo({
                obj: a,
                loc: "pages]",
                key: t,
                value: a.getNewJson(),
                type: "3",
                action: "delPage"
            }, n),
            this.removePage(e);
            var s = this.pages
              , d = s[0]._owner_pageEditbar;
            d.setBtnState()
        },
        removePage: function(e) {
            var n, t;
            e.constructor == o ? (t = e,
            n = e.getIndex()) : (n = e,
            t = this.pages[n]);
            var a = {
                index: n
            }
              , i = this.getNode()
              , s = t.getNode();
            i.removeChild(s),
            this.pages = a,
            t = null,
            this.setPageScale(this.pageScale),
            n - 1 >= 0 ? this.pages[n - 1].nodeMouseenter() : this.pages[n].nodeMouseenter()
        },
        nodeMousedown: function() {
            var e = this.getCurPage();
            e.nodeMousedown()
        },
        pageEnterCheek: function(e, t) {
            for (var a, o, i, s, d, l = this.pages, r = l.length, g = this.pageScale, p = {
                width: l[0].width,
                height: l[0].height
            }, h = 0; r > h; h++)
                if (a = n(l[h].getNode()),
                o = a.offset().top,
                d = a.offset().left,
                s = o + p.height * g,
                i = d + p.width * g,
                s > t && t > o && i > e && e > d)
                    return h;
            return -1
        },
        _mementos: [],
        set mementos(e) {
            if (void 0 != e) {
                var n = this._mementos
                  , t = n.length;
                e.redo_drag || this.clearReMemento(),
                t > 0 && n[t - 1][0].memento_id === e[0].memento_id ? e[0].unshift_drag ? n[t - 1].unshift(e[0]) : "addElementGroup" === n[t - 1][0].action && "moveIndex" === e[0].action ? n[t - 1].splice(1, 0, e[0]) : n[t - 1].push(e[0]) : n.push(e)
            }
        },
        get mementos() {
            var e = this._mementos
              , n = e.pop();
            return this.remementos = n,
            n
        },
        clearMemento: function() {
            this._mementos = []
        },
        _remementos: [],
        set remementos(e) {
            if (void 0 != e) {
                var n = this._remementos;
                n.push(e)
            }
        },
        get remementos() {
            var e = this._remementos
              , n = e.pop();
            return void 0 == n ? void 0 : (n.redo_drag = !0,
            this.mementos = n,
            n)
        },
        clearReMemento: function() {
            this._remementos = []
        },
        redoMemento: function() {
            var e = this.remementos;
            if (void 0 != e) {
                var n, t, a, o, i, s, d, l, r, g, p = e.length, h = [], c = 0;
                window.undo = !0;
                for (var u = [], f = !1, v = !1, _ = p, m = 0, w = 0; p > w; w++)
                    if ("addMaterial" == e[w].action && (v = !0),
                    "delMaterial" == e[w].action && v && 0 == m && (m = w),
                    "delElementGroup" === e[w].action) {
                        u = e[w],
                        f = !0;
                        break
                    }
                p = m,
                0 != u.length && this.pages[u.page_index]._element_groups[u.ele_index].groupSplitAndUndo("noUndo"),
                u = [];
                var x = !1;
                void 0 != e[1] && "change" === e[1].action && "background" === e[1].new_value && "img" === e[1].old_value && (x = !0);
                for (var U = _ - 1; U >= m; U--)
                    if (n = e[U],
                    t = n.action,
                    a = n.key,
                    o = n.new_value,
                    i = n.page_index,
                    d = n.ele_index,
                    s = this.pages[i],
                    "delElementGroup" !== t)
                        if ("change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            if (f && "group-transform" === a || x && "data-type" === a)
                                continue;
                            l.undoValue({
                                key: a,
                                val: o
                            })
                        } else if ("addMaterial" === t)
                            l = s.createElementAndUndo({
                                json: o,
                                index: d
                            }, "noUndo");
                        else if ("delMaterial" === t) {
                            if (x)
                                continue;
                            l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++
                        } else if ("moveIndex" === t) {
                            if (x)
                                continue;
                            g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo")
                        } else if ("delPage" === t)
                            this.removePageAndUndo(s, "noUndo");
                        else if ("addPage" === t)
                            this.insertPageAndUndo(o, i, "noUndo");
                        else if ("addElementGroup" === t)
                            u = n;
                        else if ("delElementGroup" === t)
                            ;
                        else if ("groupmovedown" === t)
                            l = s._element_groups[d],
                            l.moveDown("noUndo");
                        else if ("groupmoveup" === t)
                            l = s._element_groups[d],
                            l.moveUp("noUndo");
                        else if ("changeElementGroup" === t) {
                            if (c > 0)
                                continue;
                            if (l = s._element_groups[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: o
                            })
                        } else
                            "changeDesign" === t ? this.undoBleed(o) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t && (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageUp("noUndo")));
                if (0 != m)
                    for (var b = p - 1; b >= 0; b--)
                        if (n = e[b],
                        t = n.action,
                        a = n.key,
                        o = n.new_value,
                        i = n.page_index,
                        d = n.ele_index,
                        s = this.pages[i],
                        "change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            if (f && "group-transform" === a || x && "data-type" === a)
                                continue;
                            l.undoValue({
                                key: a,
                                val: o
                            })
                        } else if ("addMaterial" === t)
                            l = s.createElementAndUndo({
                                json: o,
                                index: d
                            }, "noUndo");
                        else if ("delMaterial" === t) {
                            if (x)
                                continue;
                            l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++
                        } else if ("moveIndex" === t) {
                            if (x)
                                continue;
                            g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo")
                        } else if ("delPage" === t)
                            this.removePageAndUndo(s, "noUndo");
                        else if ("addPage" === t)
                            this.insertPageAndUndo(o, i, "noUndo");
                        else if ("addElementGroup" === t)
                            u = n;
                        else if ("delElementGroup" === t)
                            ;
                        else if ("groupmovedown" === t)
                            l = s._element_groups[d],
                            l.moveDown("noUndo");
                        else if ("groupmoveup" === t)
                            l = s._element_groups[d],
                            l.moveUp("noUndo");
                        else if ("changeElementGroup" === t) {
                            if (c > 0)
                                continue;
                            if (l = s._element_groups[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: o
                            })
                        } else
                            "changeDesign" === t ? this.undoBleed(o) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t && (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageUp("noUndo")));
                else
                    for (var w = 0; p > w; w++)
                        if (n = e[w],
                        t = n.action,
                        a = n.key,
                        o = n.new_value,
                        i = n.page_index,
                        d = n.ele_index,
                        s = this.pages[i],
                        "change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            if (f && "group-transform" === a || x && "data-type" === a)
                                continue;
                            l.undoValue({
                                key: a,
                                val: o
                            })
                        } else if ("addMaterial" === t)
                            l = s.createElementAndUndo({
                                json: o,
                                index: d
                            }, "noUndo");
                        else if ("delMaterial" === t) {
                            if (x)
                                continue;
                            l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++
                        } else if ("moveIndex" === t) {
                            if (x)
                                continue;
                            g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo")
                        } else if ("delPage" === t)
                            this.removePageAndUndo(s, "noUndo");
                        else if ("addPage" === t)
                            this.insertPageAndUndo(o, i, "noUndo");
                        else if ("addElementGroup" === t)
                            u = n;
                        else if ("delElementGroup" === t)
                            ;
                        else if ("groupmovedown" === t)
                            l = s._element_groups[d],
                            l.moveDown("noUndo");
                        else if ("groupmoveup" === t)
                            l = s._element_groups[d],
                            l.moveUp("noUndo");
                        else if ("changeElementGroup" === t) {
                            if (c > 0)
                                continue;
                            if (l = s._element_groups[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: o
                            })
                        } else
                            "changeDesign" === t ? this.undoBleed(o) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t && (s = this.pages[n.new_index],
                            s._owner_pageEditbar.pageUp("noUndo")));
                if (0 != u.length) {
                    for (var S = u.eles_index, D = u.eles_index.length, U = 0; D > U; U++)
                        h.push(s.elements[S[U]]);
                    var o = u.new_value
                      , i = u.page_index
                      , d = u.ele_index
                      , s = this.pages[i]
                      , E = s.createElementGroupAndUndo(h, {
                        id: d,
                        transform: o.transform
                    }, "noUndo");
                    h = [],
                    E.nodeClick()
                }
                if (x)
                    for (var w = 3; w >= 0; w--)
                        if (n = e[w],
                        t = n.action,
                        a = n.key,
                        o = n.new_value,
                        i = n.page_index,
                        d = n.ele_index,
                        s = this.pages[i],
                        "change" === t) {
                            if (l = s.elements[d],
                            void 0 == l)
                                continue;
                            l.undoValue({
                                key: a,
                                val: o
                            })
                        } else
                            "delMaterial" === t ? (l = s.elements[d],
                            s.eleDelAndUndo(l, "noUndo"),
                            c++) : "moveIndex" === t && (g = n.ele_index,
                            l = s.elements[g],
                            r = n.new_index,
                            l.changeIndexAndUndo({
                                new_index: r
                            }, "noUndo"));
                window.undo = !1
            }
        },
        undoMemento: function() {
            var e = this.mementos;
            if (void 0 != e) {
                var n, t, a, o, i, s, d, l, r, g, p = e.length, h = [], h = [], c = 0;
                window.undo = !0;
                for (var u = 0; p > u; u++)
                    if (n = e[u],
                    t = n.action,
                    a = n.key,
                    o = n.old_value,
                    i = n.page_index,
                    d = n.ele_index,
                    s = this.pages[i],
                    "change" === t) {
                        if (l = s.elements[d],
                        void 0 == l)
                            continue;
                        l.undoValue({
                            key: a,
                            val: o
                        })
                    } else if ("addMaterial" === t)
                        l = s.elements[d],
                        s.eleDelAndUndo(l, "noUndo"),
                        c++;
                    else if ("delMaterial" === t)
                        l = s.createElementAndUndo({
                            json: o,
                            index: d
                        }, "noUndo");
                    else if ("moveIndex" === t)
                        g = n.new_index,
                        l = s.elements[g],
                        r = n.ele_index,
                        l.changeIndexAndUndo({
                            new_index: r
                        }, "noUndo");
                    else if ("delPage" === t)
                        this.insertPageAndUndo(o, i, "noUndo");
                    else if ("addPage" === t)
                        this.removePageAndUndo(s, "noUndo");
                    else if ("addElementGroup" === t)
                        l = s._element_groups[d],
                        l.groupSplitAndUndo("noUndo");
                    else if ("delElementGroup" === t) {
                        for (var f = n.eles_index, v = n.eles_index.length, _ = 0; v > _; _++)
                            h.push(s.elements[f[_]]);
                        s.createElementGroupAndUndo(h, {
                            id: d,
                            transform: o.transform
                        }, "noUndo"),
                        h = []
                    } else if ("groupmovedown" === t)
                        l = s._element_groups[d],
                        l.moveUp("noUndo");
                    else if ("groupmoveup" === t)
                        l = s._element_groups[d],
                        l.moveDown("noUndo");
                    else if ("changeElementGroup" === t) {
                        if (c > 0)
                            continue;
                        if (l = s._element_groups[d],
                        void 0 == l)
                            continue;
                        l.undoValue({
                            key: a,
                            val: o
                        })
                    } else
                        "changeDesign" === t ? this.undoBleed(o) : "changePage" === t || ("pageMoveUp" === t ? (s = this.pages[n.new_index],
                        s._owner_pageEditbar.pageDown("noUndo")) : "pageMoveDown" === t && (s = this.pages[n.new_index],
                        s._owner_pageEditbar.pageUp("noUndo")));
                window.undo = !1
            }
        },
        undoBleed: function(e) {
            this.bleed = {
                value: e,
                undo_drag: "noUndo"
            },
            "false" === e ? this.hideBleed() : this.showBleed()
        },
        saveDesignTitle: function(e) {
            var n = this;
            n.saveDesignAndUndo({
                obj: n,
                loc: "",
                key: "title",
                value: e,
                type: "0",
                action: "changeDesign"
            }, "noUndo")
        },
        getNewJson: function() {
            var e = this.getJson();
            e.pages = [];
            var t = n(".design_title").children("input");
            e.title = "" == t.val() ? "默认标题" : t.val(),
            e.v = "1.0.2";
            for (var a = 0; a < this.pages.length; a++) {
                var o = this.pages[a];
                e.pages[a] = o.getNewJson()
            }
            return e
        },
        _saveDrag: "saved",
        _saveTimer: null,
        saveDesignAndUndo: function(n, a) {
            var i = n.obj
              , s = n.key
              , d = n.value
              , l = n.loc
              , r = n.type
              , g = n.cLoc || ""
              , p = n.action
              , c = n.tidx
              , u = n.unshift;
            a = a || "save";
            var f, _, m;
            i instanceof o ? (f = i,
            _ = i.getIndex(),
            m = 0) : i instanceof v || (f = i.getPage(),
            _ = f.getIndex(),
            m = i.getIndex(),
            i instanceof h && (m = i.id)),
            void 0 != f && (f._pop_drag = !0),
            "moveIndex" === p && (m = s);
            var w = [{
                type: r,
                key: s,
                val: d,
                cLoc: g,
                tidx: c
            }];
            if (-1 != m) {
                "delMaterial" === p ? w[0].val = "" : "delPage" === p && (w[0].val = ""),
                "delMaterial" === p && (w[0].val = "");
                var x = {
                    loc: l,
                    cont: w
                };
                if (t.saveJsonAttr = {
                    data: x,
                    obj: i
                },
                "noUndo" !== a) {
                    var U = [{
                        page_index: _,
                        ele_index: m,
                        memento_id: window.MEMENTO_ID,
                        action: p,
                        unshift_drag: u,
                        eles_index: n.eles_index,
                        new_value: d
                    }];
                    "addMaterial" === p || ("delMaterial" === p ? U[0].old_value = d : "moveIndex" === p ? U[0].new_index = n.tidx : "change" === p ? (U[0].key = s,
                    U[0].old_value = "object" == typeof i[s] ? JSON.parse(JSON.stringify(i[s])) : i[s],
                    "data-colors" === s && (U[0].old_value = JSON.parse(JSON.stringify(i.colors))),
                    "data-xhref-imgs" === s && (U[0].old_value = JSON.parse(JSON.stringify(i.xhrefImgs))),
                    "group-transform" === s && (U[0].old_value = JSON.parse(JSON.stringify(i.groupTransform))),
                    "fill" === s && (U[0].old_value = i.colors),
                    "font-size" === s && (U[0].old_value = i.fontSize),
                    "font-family" === s && (U[0].old_value = i.fontFamily),
                    "data-align" === s && (U[0].old_value = i.fontAlign),
                    "data-bold" === s && (U[0].old_value = i.bold),
                    "data-italic" === s && (U[0].old_value = i.italic),
                    "data-decoration" === s && (U[0].old_value = i.decoration),
                    "data-type" === s && (U[0].old_value = i.dataType),
                    "cut-width" === s && (U[0].old_value = i.cutwidth),
                    "cut-height" === s && (U[0].old_value = i.cutheight),
                    "repeat-width" === s && (U[0].old_value = i.repeatwidth),
                    "real-width" === s && (U[0].old_value = i.realWidth),
                    "real-height" === s && (U[0].old_value = i.realHeight),
                    "chart-data" === s && (U[0].old_value = e.deepClone(i.data)),
                    "chart-colors" === s && (U[0].old_value = e.deepClone(i.colors)),
                    "chart-kind" === s && (U[0].old_value = i.kind),
                    "chart-title" === s && (U[0].old_value = i.title),
                    "chart-titleShow" === s && (U[0].old_value = i.titleShow),
                    "chart-titleColor" === s && (U[0].old_value = i.titleColor),
                    "chart-titlePosition" === s && (U[0].old_value = i.titlePosition),
                    "chart-axisShow" === s && (U[0].old_value = i.axisShow),
                    "chart-axisTitleShow" === s && (U[0].old_value = i.axisTitleShow),
                    "chart-xAxisTitle" === s && (U[0].old_value = i.xAxisTitle),
                    "chart-yAxisTitle" === s && (U[0].old_value = i.yAxisTitle),
                    "chart-yAxisNumMin" === s && (U[0].old_value = i.yAxisNumMin),
                    "chart-yAxisNumMax" === s && (U[0].old_value = i.xAxisNumMax),
                    "chart-gridShow" === s && (U[0].old_value = i.gridShow),
                    "chart-legendShow" === s && (U[0].old_value = i.legendShow)) : "addPage" === p || ("delPage" === p ? U[0].old_value = d : "delElementGroup" === p ? U[0].old_value = d : "changeElementGroup" === p ? (U[0].key = s,
                    U[0].old_value = i[s]) : "changeDesign" === p ? (U[0].key = s,
                    U[0].old_value = this.bleed) : ("pageMoveUp" === p || "pageMoveDown" === p) && (U[0].new_index = n.tidx,
                    U[0].page_index = n.key))),
                    this.mementos = U
                }
            }
        },
        saveDesignOld: function(e) {
            {
                var t = this;
                t.getJson()
            }
            t._saveDrag = "will save",
            n(".ppt-show").addClass("design-no-click"),
            window.api && !e && n(".download-design").addClass("design-no-click"),
            clearTimeout(t._saveTimer),
            e || (t._saveTimer = setTimeout(function() {}, 2e3))
        },
        saveDesignAjax: function() {
            var t = this;
            t._saveDrag = "saveing";
            var a = l.getDownload().find(".sure_download")
              , o = l.getShareTitle().find(".publick_share_button");
            if (a.addClass("not-download"),
            o.addClass("not-share"),
            window.ISLOGIN) {
                var i = t.getNewJson();
                n(".save-design .span_img").animate({
                    left: "-56px"
                }, {
                    easing: "swing"
                }),
                n(".save-design .span_text").animate({
                    left: "-30px"
                }, {
                    easing: "swing"
                }),
                n(".save-design .saving_text").animate({
                    left: "17px"
                }, {
                    easing: "swing",
                    complete: function() {
                        var s = new FormData;
                        s.append("json", JSON.stringify(i)),
                        s.append("k", KIND_ID),
                        s.append("d", DESIGN_ID),
                        s.append("kt", KIND_TITLE),
                        s.append("t", TEMPLATE_ID),
                        s.append("w", KIND_WIDTH),
                        s.append("h", KIND_HEIGHT),
                        s.append("sec", DESIGN_SEC),
                        s.append("dt", n(".design_title").children().val());
                        var d = function() {
                            return null == IS_ET ? 0 : IS_ET
                        }();
                        s.append("et", d),
                        s.append("mp", window.MAX_PAGE),
                        n.ajax({
                            url: "/design/saveDesignV2.do",
                            type: "POST",
                            dataType: "json",
                            data: s,
                            cache: !1,
                            contentType: !1,
                            processData: !1,
                            error: function() {
                                e.addSomeMouseClick("设计-保存失败"),
                                alert("设计保存失败，请尝试刷新当前页面。您还可以加入创客贴qq服务群，群号133818453（已满），538351505。或拨打创客贴服务热线：400-871-8211。")
                            },
                            success: function(e) {
                                var i;
                                if (clearTimeout(i),
                                e.LoginTimeOut === !0) {
                                    n("#onloadDesign").removeAttr("data-asdf"),
                                    n("#loginBackground").show(),
                                    n("#toLogin").trigger("click"),
                                    n(".share-design").hide(),
                                    n(".download-design").hide(),
                                    n(".save-design").hide();
                                    var s = n('<div id="afterLogin"><div id="afterLoginCanDownload">当前用户仅供设计体验，注册后可进行分享、保存与下载等更多功能<span style="margin-left:18px" class="register-btn">注册</span>or<span class="login-btn">登录</span></div></div>');
                                    s.find("span").on("click", function() {
                                        n("#div_design").mousedown();
                                        var e = n(this);
                                        n.ajax({
                                            url: "/user/getUserInfo.do",
                                            dataType: "json",
                                            type: "POST",
                                            success: function(t) {
                                                t.LoginTimeOut ? "login-btn" === e.attr("class") ? g.show() : (g.show(),
                                                n("#logreg-register-btn").trigger("click")) : t.isLogin && (n("#afterLoginCanDownload").detach(),
                                                n(".share-design").show(),
                                                n(".download-design").show(),
                                                n(".save-design").show(),
                                                window.ISLOGIN = !0)
                                            },
                                            error: function() {
                                                "login-btn" === e.attr("class") ? g.show() : (g.show(),
                                                n("#logreg-register-btn").trigger("click"))
                                            }
                                        })
                                    }),
                                    s.appendTo(n("#designTitle"))
                                } else
                                    t._saveDrag = "saved",
                                    a.removeClass("not-download"),
                                    o.removeClass("not-share"),
                                    DESIGN_ID = e.designId,
                                    KIND_TITLE = null,
                                    DESIGN_SEC = null;
                                n(".save-design").addClass("saved-design"),
                                n(".save-design .span_img").animate({
                                    left: "18px"
                                }, {
                                    easing: "swing"
                                }),
                                n(".save-design .span_text").text("成功").animate({
                                    left: "44px"
                                }, {
                                    easing: "swing"
                                }),
                                n(".ppt-show").removeClass("design-no-click"),
                                window.api && n(".download-design").removeClass("design-no-click"),
                                n(".save-design .saving_text").animate({
                                    left: "90px"
                                }, {
                                    easing: "swing",
                                    complete: function() {
                                        i = setTimeout(function() {
                                            n(".save-design").removeClass("saved-design"),
                                            n(".save-design .span_text").html("保存")
                                        }, 500)
                                    }
                                }),
                                "" != e.error && void 0 != e.error && (alert("保存异常"),
                                location.href = "/h/dc.html")
                            }
                        })
                    }
                })
            }
        },
        jsonAddleftTop: function(n, t) {
            if ("background" == n["data-type"]) {
                var a = this.getCurPage();
                if (0 == n["data-elem"]["data-key"])
                    n["data-elem"].width = a.width,
                    n["data-elem"].height = a.height;
                else {
                    var o = n["data-elem"].width
                      , i = n["data-elem"].height
                      , s = o / i;
                    o / a.width > i / a.height ? (i = a.height,
                    o = i * s) : (o = a.width,
                    i = o / s),
                    n["data-elem"].width = o,
                    n["data-elem"].height = i
                }
            } else {
                var d = n.transform
                  , l = e.getTransformAttr(d, "translate")
                  , r = e.getTransformAttr(d, "rotate");
                l[0] = parseFloat(l[0]) + parseFloat(t),
                l[1] = parseFloat(l[1]) + parseFloat(t),
                d = e.setTransformAttr(d, "translate", l),
                d = e.setTransformAttr(d, "rotate", r),
                n.transform = d
            }
            return n
        },
        showBleed: function() {
            var e = this.pages
              , n = {
                width: e[0].width,
                height: e[0].height
            }
              , t = i.BLEED_SIZE
              , a = parseFloat(n.width) + 2 * t
              , o = parseFloat(n.height) + 2 * t;
            this.changePageWH(a, o);
            for (var s = this.pageScale, d = s * t, l = 100 * (t / a), r = 100 * (t / o), g = 0; g < e.length; g++)
                e[g].pageBleed(d, t),
                e[g].showBleedBorderByPrecent(l, r, d)
        },
        hideBleed: function() {
            for (var e = this.pages, t = {
                width: e[0].width,
                height: e[0].height
            }, a = i.BLEED_SIZE, o = this.pageScale, s = o * a, d = 0; d < e.length; d++)
                e[d].pageBleed(-s, a);
            var l = parseFloat(t.width) - 2 * a
              , r = parseFloat(t.height) - 2 * a;
            this.changePageWH(l, r),
            n("#rightPanel").find(".bleed_border").hide(),
            n("#rightPanel").find(".bleed_ruler").hide(),
            n("#rightPanel").find(".bleed_line").hide(),
            n(".three-secend-line").css({
                left: 100 / 3 * 2 + "%"
            }),
            n(".three-first-line").css({
                left: 100 / 3 + "%"
            })
        }
    },
    e.classExtend(v, a),
    v
});
;/*!/compapi/design/toolbar/DesignEditbar.js*/
"use strict";
define("compapi/design/toolbar/DesignEditbar", ["compapi/b", "components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/Widget", "compapi/design/toolbar/toolbar_config", "compapi/design/Toolbar", "compapi/design/widgets/Page", "compapi/design/widgets/Design", "libs/jquery/jquery.qrcode.min", "libs/jquery/jPages", "libs/jquery/jquery.zeroclipboard", "compapi/design/design_config", "widget/pop/pop", "widget/cooperative/cooperative", "widget/logreg/logreg", "libs/clipboard.min"], function(e, i, n, t, a, s, o, d, c, r, l, p, h, _, w, u) {
    function g() {
        var e = this;
        e.show(),
        f.call(e),
        v.call(e),
        I.call(e)
    }
    function f() {
        var e = this
          , n = e._owner_design;
        e._min_scale = n._minPageScale,
        e._max_scale = n._maxPageScale,
        e._change_scale = (e._max_scale - e._min_scale) / 10;
        var t = n.pages[0];
        (t.width > 1e4 || t.height > 1e4) && (e._change_scale = (e._max_scale - e._min_scale) / 20),
        e._now_scale = n.pageScale;
        var a = n.pageScale
          , s = i(e.getNode()[2]);
        s.find(".design-scale-num").children().html(parseInt(100 * a) + "%")
    }
    function v() {
        var t = this
          , s = t._owner_design
          , o = s.getCurPage()
          , d = i(t.getNode()[0])
          , c = i(t.getNode()[1])
          , r = i(t.getNode()[2]);
        window.ISEXIST || i(".ppt-show, .set-team-template, .share-design, .download-design, .design_copy, .design_size_move, .design_change_sence, .print-design").addClass("design-no-click"),
        c.find(".design_copy").mousedown(function(n) {
            if (e.addSomeMouseClick("上方-复制设计"),
            i(this).hasClass("design-no-click"))
                return !1;
            if (0 != n.button)
                return !1;
            o.nodeMousedown();
            var a = {
                designId: window.DESIGN_ID
            };
            window.TEAM_ID > 0 && (a.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (a.c = !0),
            i.ajax({
                url: "/design/copyDesign.do",
                type: "post",
                dataType: "json",
                data: a,
                success: function(e) {
                    var n, a = e.newDesignIds;
                    n = window.TEAM_ID > 0 ? "&tid=" + window.TEAM_ID : "",
                    window.open("/mod/design/design.html?d=" + a[0] + n),
                    t.popHide(i(".pop-wrap"))
                }
            })
        }),
        c.find(".design_open").mousedown(function(i) {
            return 0 != i.button ? !1 : (window.open("/designmanage"),
            void e.addSomeMouseClick("上方-打开设计"))
        }),
        c.find(".design_size_move").mousedown(function(n) {
            if (e.addSomeMouseClick("上方-调整尺寸"),
            i(this).hasClass("design-no-click"))
                return !1;
            if (0 != n.button)
                return !1;
            var s = a.getCanvasSize();
            return t.popShow(s, {}),
            !1
        }),
        c.find(".design_change_sence").mousedown(function(n) {
            if (e.addSomeMouseClick("上方-智能场景变换"),
            0 != n.button)
                return !1;
            if (i(this).hasClass("design-no-click"))
                return !1;
            var s = a.getChangesence();
            return window.ISVIP || window.TEAM_ID > 0 ? (s.find(".sure-but").removeClass("notVipMember").html("确认调整"),
            s.find(".jion-vip").css("display", "none")) : s.find(".sure-but").addClass("notVipMember").html("升级成为VIP会员"),
            t.popShow(s, {}),
            !1
        }),
        c.find(".design_set").mousedown(function(i) {
            if (e.addSomeMouseClick("上方-置入设计"),
            0 != i.button)
                return !1;
            var n = a.getMydesign();
            return t.popShow(n, {}),
            K(t, !0),
            !1
        }),
        c.find(".design_save").mousedown(function(i) {
            return e.addBugTrackClick("d1"),
            0 != i.button ? !1 : (o.nodeMousedown(),
            void n.saveDesign(!0))
        }),
        D.call(t),
        d.find(".ppt-show").mousedown(function(e) {
            return i(this).hasClass("design-no-click") ? !1 : 0 != e.button ? !1 : (n.saveDesign(),
            void window.open("/h/show.html?d=" + DESIGN_ID))
        }),
        i("#design_title").children().change(function() {
            var e = i("#design_title").children().val()
              , n = /[\/\/\\:*?"<>\/|]/g;
            n.test(e) && (h.back({
                str: '设计名不能包括以下任何字符 \\ / : * ? " < > |',
                kind: "warning"
            }),
            e = e.replace(n, ""),
            console.log(e)),
            i("#design_title").children().val(e),
            s.saveDesignTitle(e)
        }),
        r.find(".design-scale-add").mousedown(function(i) {
            if (e.addSomeMouseClick("画布-放大"),
            e.addBugTrackClick("a7"),
            0 != i.button)
                return !1;
            o.nodeMousedown();
            var n = s.pageScale + t._change_scale;
            return t.changeDesignScale(n),
            !1
        }),
        r.find(".design-scale-sub").mousedown(function(i) {
            if (e.addSomeMouseClick("画布-缩小"),
            e.addBugTrackClick("a7"),
            0 != i.button)
                return !1;
            o.nodeMousedown();
            var n = s.pageScale - t._change_scale;
            return t.changeDesignScale(n),
            !1
        }),
        r.find(".design-scale-screen").mousedown(function(n) {
            if (e.addBugTrackClick("a8"),
            0 != n.button)
                return !1;
            o.nodeMousedown();
            var a, s = i(this);
            return s.hasClass("now-click") ? (e.addSomeMouseClick("画布-合适大小"),
            s.removeClass("now-click"),
            s.attr("title", "实际大小"),
            a = t._now_scale) : (e.addSomeMouseClick("画布-实际大小"),
            s.addClass("now-click"),
            s.attr("title", "合适大小"),
            a = 1),
            t.changeDesignScale(a),
            !1
        }),
        d.find(".set-team-cooperate").click(function() {
            _.show(window.DESIGN_ID, window.TEAM_ID)
        }),
        d.find(".set-team-template").mousedown(function(t) {
            if (window.TEAM_ID <= 0 || i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-设置为团队模板"),
            0 != t.button)
                return !1;
            o.nodeMousedown(),
            n.saveDesign();
            var a = {
                ids: DESIGN_ID,
                tid: window.TEAM_ID
            };
            window.COOPERATE_DESIGN && (a.c = !0),
            i.ajax({
                url: "/designtemplate/setAsTeamTemplate.do",
                type: "POST",
                dataType: "json",
                data: a,
                error: function() {
                    h.back({
                        str: "设置团队模版失败！",
                        kind: "warning"
                    })
                },
                success: function(e) {
                    var i = e.code;
                    1 == i ? h.back({
                        str: "设置团队模版成功！",
                        kind: "success"
                    }) : (h.back({
                        str: "设置团队模版失败！",
                        kind: "warning"
                    }),
                    console.log(i))
                }
            })
        }),
        i("#designTitle").find(".undo").mousedown(function(i) {
            return e.addSomeMouseClick("上方-撤销"),
            e.addBugTrackClick("b1"),
            0 != i.button ? !1 : (o.nodeMousedown(),
            void s.undoMemento())
        }),
        i("#designTitle").find(".redo").mousedown(function(i) {
            return e.addSomeMouseClick("上方-撤销"),
            e.addBugTrackClick("b2"),
            0 != i.button ? !1 : (o.nodeMousedown(),
            void s.redoMemento())
        }),
        d.find(".print-design").mousedown(function(e) {
            if (0 != e.button)
                return !1;
            o.nodeMousedown(),
            n.saveDesign(!0);
            var t = window.open("");
            window.DESIGN_IS_PRINT && i.ajax({
                url: "/design/getPrintDetail.do",
                type: "POST",
                dataType: "json",
                data: {
                    id: window.DESIGN_ID
                },
                error: function() {},
                success: function(e) {
                    -3 === e.code ? (h.back({
                        str: "设计的分类不支持印刷",
                        kind: "error"
                    }),
                    t.close()) : -4 === e.code ? (h.back({
                        str: "设计的尺寸不符合印刷要求",
                        kind: "error"
                    }),
                    t.close()) : -5 === e.code ? (h.back({
                        str: "设计的页数不符合印刷要求",
                        kind: "error"
                    }),
                    t.close()) : t.location.href = window.location.origin + "/order?d=" + window.DESIGN_ID
                }
            })
        }),
        d.find(".download-design").mousedown(function(s) {
            if (i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-下载"),
            0 != s.button)
                return !1;
            if (o.nodeMousedown(),
            i(".design-click").size() > 0)
                return t.popHide(i(".pop-wrap")),
                !1;
            var d = i(this);
            d.addClass("design-click"),
            n.saveDesign();
            var c = a.getDownload();
            t.popShow(c, {})
        }),
        d.find(".quit-design").mousedown(function() {
            window.location.href = "/dc.html"
        }),
        j.call(t),
        d.find(".share-design").click(function() {
            return i(this).hasClass("design-no-click") ? (i(this).find("ul").hide(),
            !1) : void i(this).find("ul").toggle(200)
        }),
        d.find(".share-design-li").mousedown(function(s) {
            if (i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-分享"),
            0 != s.button)
                return !1;
            if (o.nodeMousedown(),
            i(".design-click").size() > 0)
                return t.popHide(i(".pop-wrap")),
                !1;
            var d = i(this);
            d.parent().hide(),
            i(".share-design").addClass("design-click"),
            n.saveDesign();
            var c = {
                d: window.DESIGN_ID
            };
            window.TEAM_ID > 0 && (c.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (c.c = !0),
            i.ajax({
                url: "/design/getDesignV3.do",
                type: "POST",
                dataType: "json",
                data: c,
                error: function() {
                    window.clearInterval(t._download_rate),
                    P(),
                    alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")分享失败。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
                },
                success: function(e) {
                    if (1 == e.shareState || 3 == e.shareState) {
                        var n = e.shareState;
                        e.state = 3,
                        W(e, t, n)
                    } else if (2 == e.shareState || 4 == e.shareState) {
                        var n = e.shareState;
                        e.state = 3;
                        var s = a.getShareTitle();
                        s.find(".password_zone").children("input").val(e.sharePwd),
                        W(e, t, n)
                    } else {
                        var o = a.getShareTitle();
                        o.find(".share_box").css("display", "block"),
                        o.find(".success_share_box, .private_share_box, .private_share_failed").css("display", "none"),
                        o.find(".design_name").removeClass("design_name_tips");
                        var s = a.getShareTitle();
                        s.find(".design_name").val(i("#design_title").children().val()),
                        t.popShow(o, {})
                    }
                }
            })
        }),
        d.find(".active-design-li").mousedown(function(s) {
            if (i(this).hasClass("design-no-click"))
                return !1;
            if (e.addSomeMouseClick("上方-参加活动"),
            0 != s.button)
                return !1;
            if (o.nodeMousedown(),
            i(".design-click").size() > 0)
                return t.popHide(i(".pop-wrap")),
                !1;
            var d = i(this);
            d.parent().hide(),
            i(".share-design").addClass("design-click"),
            n.saveDesign(),
            i.ajax({
                url: "/activity/isJoined.do",
                type: "POST",
                dataType: "json",
                data: {
                    designId: window.DESIGN_ID
                },
                error: function() {
                    window.clearInterval(t._download_rate),
                    P(),
                    alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")参加活动失败。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
                },
                success: function(e) {
                    var i = a.getActive()
                      , n = i.find(".publish")
                      , s = i.find(".publish-success");
                    0 == e.code ? (n.hide(),
                    s.show(),
                    s.find(".link-input").val(window.location.origin + "/activecenter/share?workId=" + e.workId),
                    s.find(".open-link").attr("href", window.location.origin + "/activecenter/share?workId=" + e.workId),
                    s.find(".already-join").attr("href", "/activecenter/active?id=" + e.activityId),
                    t.popShow(i, {})) : 1 == e.code ? (s.hide(),
                    n.show(),
                    n.find(".name-input").val(""),
                    n.find(".description-input").val(""),
                    n.find(".selected-active-title").text("").attr("data-active", ""),
                    t.popShow(i, {})) : h.back({
                        str: "查询是是否已参加活动失败！",
                        kind: "error"
                    })
                }
            })
        }),
        z.call(t),
        L.call(t),
        m.call(t)
    }
    function m() {
        var e = this
          , n = a.getConfirm();
        n.find(".confirm-false").click(function() {
            n.css("display", "none"),
            i(".pop-wrap").css("z-index", "20000")
        }),
        n.find(".confirm-true").click(function() {
            n.css("display", "none"),
            e.confirmTrue()
        })
    }
    function I() {
        i(".design_present_size").html("当前尺寸为 ： " + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT).attr("title", "当前尺寸为 ： " + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT);
        var e = a.getCanvasSize();
        e.find(".old_size").children("span").html(window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT + "&nbsp;&nbsp;( 宽 * 高 )"),
        e.find(".unit_count").text(window.DESIGN_ORIGINAL_UNIT);
        var n = a.getChangesence();
        n.find(".old-sence").children("span").html(DESIGN_KIND_TITLE + "&nbsp;&nbsp;" + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT + "&nbsp;&nbsp;( 宽 * 高 )"),
        n.find(".sence-input").html(DESIGN_KIND_TITLE + " " + window.DESIGN_ORIGINAL_WIDTH + " * " + window.DESIGN_ORIGINAL_HEIGHT),
        n.find(".sence-input").attr("data-width", parseFloat(window.DESIGN_ORIGINAL_WIDTH) + window.DESIGN_ORIGINAL_UNIT),
        n.find(".sence-input").attr("data-height", parseFloat(window.DESIGN_ORIGINAL_HEIGHT) + window.DESIGN_ORIGINAL_UNIT),
        n.find(".sence-input").attr("data-title", DESIGN_KIND_TITLE),
        n.find(".sence-input").attr("data-id", KIND_ID),
        0 == n.find(".design_kind_list").children(".design_kind_li").size() && k.call(this)
    }
    function k() {
        var e = this
          , n = a.getChangesence()
          , t = n.find(".design_kind_list");
        i.ajax({
            url: "/home/getDesignType.do",
            dataType: "json",
            type: "POST",
            success: function(i) {
                var n = i.result;
                e._design_kind = n;
                var a = n.length;
                window.DESIGN_PRINT_KIND_LIST = [];
                for (var s = 0; a > s; s++) {
                    var o = n[s]
                      , d = '<li class="design_kind_title">' + o.pKindName + "</li>";
                    t.append(d);
                    for (var c = o.designKind, r = c.length, l = 0; r > l; l++) {
                        var p = c[l]
                          , h = '<li class="design_kind_li" data-title="' + p.kindTitle + '" data-width="' + p.kindWidth + '" data-height="' + p.kindHeight + '" data-id="' + p.kindId + '">' + p.kindTitle + " " + p.kindWidth + " * " + p.kindHeight + "</li>";
                        t.append(h),
                        p.isPrint && window.DESIGN_PRINT_KIND_LIST.push(p.kindId)
                    }
                }
                var _ = '<li class="design_kind_li custom_kind_li" data-title="自定义">自定义</li>';
                t.append(_)
            },
            error: function() {
                console.log("返回designkind失败")
            }
        })
    }
    function D() {
        var t = this
          , s = a.getCanvasSize();
        s.find(".sure_button").click(function() {
            var e, n, a = s.find(".wd_count").val(), o = s.find(".ht_count").val(), d = 40, c = 1e4, r = 25e3;
            "cm" == window.DESIGN_ORIGINAL_UNIT ? (d = 1,
            c = 200,
            r = 200,
            e = (.3937008 * a * 300).toFixed(8),
            n = (.3937008 * o * 300).toFixed(8)) : "mm" == window.DESIGN_ORIGINAL_UNIT ? (d = 1,
            c = 2e3,
            r = 2e3,
            e = (.3937008 * a * 30).toFixed(8),
            n = (.3937008 * o * 30).toFixed(8)) : (e = parseFloat(a),
            n = parseFloat(o));
            var l = !1
              , p = !1;
            isNaN(a) || "" == a || parseInt(a) < d || parseInt(a) > c ? s.find(".wd_count").addClass("design_name_tips") : l = !0,
            isNaN(o) || "" == o || parseInt(o) < d || parseInt(o) > r ? s.find(".ht_count").addClass("design_name_tips") : p = !0,
            l && p ? (s.find(".ht_count").removeClass("design_name_tips"),
            s.find(".wd_count").removeClass("design_name_tips"),
            e < parseInt(DESIGN_WIDTH) || n < parseInt(DESIGN_HEIGHT) ? t.popConfirm("新尺寸小于原尺寸，将对画布进行裁剪，超出画布的元素将<span style='color:red'>丢失</span>，并且将会<span style='color:red'>清空撤销步骤</span>，是否继续尺寸调整", function() {
                t._owner_design.changePageWH(e, n),
                window.DESIGN_ORIGINAL_WIDTH = s.find(".wd_count").val().toString() + window.DESIGN_ORIGINAL_UNIT,
                window.DESIGN_ORIGINAL_HEIGHT = s.find(".ht_count").val().toString() + window.DESIGN_ORIGINAL_UNIT,
                t.popHide(s),
                I.call(t),
                i(".preview-page-all").each(function() {
                    i(this).remove()
                }),
                i(".page_preview").css("display", "none"),
                h.back({
                    str: "尺寸调整成功"
                }),
                t._owner_design.clearMemento()
            }) : t.popConfirm("调整尺寸后不能撤销，将会<span style='color:red'>清空撤销步骤</span>，是否继续调整尺寸", function() {
                t._owner_design.changePageWH(e, n),
                window.DESIGN_ORIGINAL_WIDTH = s.find(".wd_count").val().toString() + window.DESIGN_ORIGINAL_UNIT,
                window.DESIGN_ORIGINAL_HEIGHT = s.find(".ht_count").val().toString() + window.DESIGN_ORIGINAL_UNIT,
                t.popHide(s),
                I.call(t),
                i(".preview-page-all").each(function() {
                    i(this).remove()
                }),
                i(".page_preview").css("display", "none"),
                h.back({
                    str: "尺寸调整成功"
                }),
                t._owner_design.clearMemento()
            })) : h.back({
                str: "宽高只能为数字，并且最大为5000，最小为40",
                kind: "warning"
            })
        }),
        s.find(".close-button").click(function() {
            t.popHide(s)
        });
        var o = a.getChangesence();
        o.find(".close-but").click(function() {
            t.popHide(i(".pop-wrap"))
        });
        var d = a.getMydesign();
        d.find(".close-but").click(function() {
            t.popHide(i(".pop-wrap"))
        }),
        d.on("click", ".accross_list_get_vip", function(e) {
            e.stopPropagation()
        }),
        d.on("click", ".accross_list", function() {
            var n = i(this);
            if (n.hasClass("no-click") || n.hasClass("now-click")) {
                d.animate({
                    left: "+=150px"
                }, {
                    easing: "easeOutQuint"
                });
                var s = a.getMyDesignPage();
                return s.animate({
                    left: "+=150px",
                    opacity: "0"
                }, {
                    easing: "easeOutQuint",
                    complete: function() {
                        i(this).css("display", "none")
                    }
                }),
                i(".accross_list").removeClass("no-click"),
                void i(".accross_list").removeClass("now-click")
            }
            if (n.hasClass("multipage_show_li")) {
                i(".accross_list").not(this).each(function() {
                    i(this).addClass("no-click")
                }),
                n.addClass("now-click"),
                y(n);
                var s = a.getMyDesignPage();
                return d.animate({
                    left: "-=150px"
                }, {
                    easing: "easeOutQuint"
                }),
                s.css({
                    left: parseFloat(d.css("left")) + d.width() + 20,
                    top: parseFloat(d.css("top")),
                    display: "block",
                    opacity: "0"
                }),
                s.appendTo("body"),
                void s.animate({
                    left: "-=150px",
                    opacity: "1"
                }, {
                    easing: "easeOutQuint"
                })
            }
            window.MEMENTO_ID = e.now();
            var o = i(this).attr("data-id");
            S(t, o, 0),
            t.popHide(d)
        }),
        d.on("click", ".pic_list", function() {
            C(t)
        }),
        d.on("click", ".word_li", function() {
            var e = i(this);
            i(".word_li.now-click").removeClass("now-click"),
            e.addClass("now-click");
            var n = e.text();
            i(".pic_list").text(n),
            "none" == i(".list_word").css("display") ? i(".list_word").show() : i(".list_word").hide(),
            K(t, !0),
            O()
        }),
        d.on("click", ".sort_new", function() {
            var e = i(this);
            N(t, e)
        }),
        d.on("click", ".sort_list", function() {
            "none" == i(".sort_word").css("display") ? i(".sort_word").show() : i(".sort_word").hide()
        }),
        d.on("click", ".sort_li", function() {
            var e = i(this);
            E(t, e)
        }),
        d.on("click", ".file_top", function() {
            var e = i(".file_content_all");
            "block" == e.css("display") ? (e.hide(),
            i(".file_tips").hide()) : (e.show(),
            x())
        }),
        d.on("click", ".file_create", function() {
            var e = i(this);
            M(t, e)
        }),
        d.on("click", ".file_creates", function() {
            var e = i(this);
            M(t, e)
        });
        var o = a.getChangesence();
        o.click(function() {
            var e = o.find(".design_kind_list");
            o.find(".sence-input").removeClass("now-click"),
            e.css("display", "none")
        }),
        o.find(".sence-input").click(function() {
            var e = i(this)
              , n = o.find(".design_kind_list");
            return e.hasClass("now-click") ? (n.css("display", "none"),
            e.removeClass("now-click")) : (n.css("display", "block"),
            e.addClass("now-click")),
            !1
        }),
        o.on("click", ".design_kind_li", function() {
            var e = i(this)
              , n = o.find(".design_kind_list")
              , t = o.find(".sence-input");
            n.css("display", "none");
            var a = e.html();
            if (t.html(a),
            t.removeClass("now-click"),
            e.hasClass("custom_kind_li"))
                return o.find(".size-count").css("display", "block"),
                o.find(".size_instrution").css("display", "block"),
                o.css("height", "435px"),
                t.removeAttr("data-width"),
                t.removeAttr("data-height"),
                t.attr("data-id", "127"),
                t.attr("data-title", "自定义px"),
                !1;
            o.find(".size-count").css("display", "none"),
            o.find(".size_instrution").css("display", "none"),
            o.css("height", "325px");
            var s = e.attr("data-width")
              , d = e.attr("data-height")
              , c = e.attr("data-id")
              , r = e.attr("data-title");
            return t.attr("data-width", s),
            t.attr("data-height", d),
            t.attr("data-id", c),
            t.attr("data-title", r),
            !1
        }),
        o.find(".download-checkbox").click(function() {
            var e = i(this);
            e.toggleClass("download-checkbox-click")
        }),
        o.find(".sure-but").click(function() {
            if (i(this).hasClass("notVipMember"))
                return window.open("/price?p=1"),
                e.addSomeMouseClick("上方-智能变换会员入口"),
                !1;
            var a = o.find(".download-checkbox")
              , s = !1;
            a.hasClass("download-checkbox-click") && (s = !0);
            var d = parseInt(DESIGN_WIDTH)
              , c = parseInt(DESIGN_HEIGHT)
              , r = o.find(".sence-input")
              , l = r.attr("data-width") || o.find(".wd_count").val()
              , _ = r.attr("data-height") || o.find(".ht_count").val()
              , w = r.attr("data-id") || 127
              , u = r.attr("data-title");
            i(".preview-page-all").each(function() {
                i(this).remove()
            }),
            i(".page_preview").find(".page-edit-bar-text").text("开启预览"),
            6 != w && 4 != w && 20 != w ? i(".page_preview").css("display", "none") : (i(".page_preview").css("display", "block"),
            i(".page_preview").removeClass("preview-showing no-click"));
            var g = !0
              , f = !0;
            if (127 == w && (isNaN(l) || "" == l || parseInt(l) < 40 || parseInt(l) > 5e3 ? (o.find(".wd_count").addClass("design_name_tips"),
            g = !1) : g = !0,
            isNaN(_) || "" == _ || parseInt(_) < 40 || parseInt(_) > 5e3 ? (o.find(".ht_count").addClass("design_name_tips"),
            g = !1) : f = !0),
            !g || !f)
                return alert("宽高只能为数字，并且最大为5000"),
                !1;
            o.find(".wd_count").removeClass("design_name_tips"),
            o.find(".ht_count").removeClass("design_name_tips"),
            window.DESIGN_ORIGINAL_WIDTH = l,
            window.DESIGN_ORIGINAL_HEIGHT = _;
            var v = /cm/
              , m = /mm/;
            if (l.match(v) ? (l = (.3937008 * parseFloat(l) * 300).toFixed(8),
            _ = (.3937008 * parseFloat(_) * 300).toFixed(8),
            window.DESIGN_ORIGINAL_UNIT = "cm") : l.match(m) ? (l = (.3937008 * parseFloat(l) * 30).toFixed(8),
            _ = (.3937008 * parseFloat(_) * 30).toFixed(8),
            window.DESIGN_ORIGINAL_UNIT = "mm") : (l = parseFloat(l).toFixed(8),
            _ = parseFloat(_).toFixed(8),
            window.DESIGN_ORIGINAL_UNIT = "px"),
            d == parseInt(l) && c == parseInt(_))
                t.popHide(o);
            else {
                var k = t._owner_design;
                t.popConfirm("变换后不能撤销，将会<span style='color:red'>清空撤销步骤</span>，是否继续变换场景", function() {
                    var e = {
                        designId: DESIGN_ID,
                        kindId: w
                    };
                    window.TEAM_ID > 0 && (e.tid = window.TEAM_ID),
                    window.COOPERATE_DESIGN && (e.c = !0),
                    i.ajax({
                        url: "/design/updateKindIdOfDesign.do",
                        dataType: "json",
                        type: "POST",
                        data: e,
                        success: function() {
                            k.changeDesignKind(l, _),
                            window.KIND_ID = w;
                            for (var e = !1, a = 0; a < window.DESIGN_PRINT_KIND_LIST.length; a++)
                                if (window.DESIGN_PRINT_KIND_LIST[a] == w) {
                                    e = !0;
                                    break
                                }
                            e ? i(".print-design").show() : i(".print-design").hide(),
                            window.DESIGN_KIND_TITLE = u,
                            t.popHide(o),
                            I.call(t),
                            i("#templateShow").children(".templateLi").remove(),
                            i("#collectionTemplate").children(".templateLi").remove(),
                            i("#templateShow").children(".nohaveTipsTemplate").remove(),
                            n.queryTemplate({
                                pageNo: 1,
                                pageSize: p.MATERIAL_PAGE_SIZE,
                                secondKindId: KIND_ID,
                                timeOrder: 1
                            }, "templateShow"),
                            h.back({
                                str: "场景变化成功"
                            }),
                            k.clearMemento()
                        },
                        error: function() {
                            console.log("更改分类错误")
                        }
                    })
                })
            }
        });
        var c = a.getMyDesignPage();
        c.on("click", ".sence-change-page-thumb", function() {
            var e = i(this).attr("data-id")
              , n = i(this).attr("data-index");
            S(t, e, n),
            t.popHide(i(".pop-wrap"))
        })
    }
    function y(e) {
        var i = a.getMyDesignPage()
          , n = e.find(".accross_list_title").html()
          , t = e.attr("data-id")
          , s = e.attr("data-size");
        i.find(".sence-change-page-title").html(n + " ( " + s + "页 )"),
        i.find(".sence-change-page-thumb-wrap").children().detach();
        for (var o = e.find(".accross_list_img").attr("src").split("@")[0], d = e.find(".accross_list_img").width(), c = e.find(".accross_list_img").height(), r = 0; s > r; r++) {
            var l;
            l = 0 == r ? o + "@230w_100Q_1x.jpg" : o + "_" + r + "@230w_100Q_1x.jpg";
            var p = '<li style="width:' + d + "px;height:" + c + 'px" data-id="' + t + '" data-index="' + r + '" class="sence-change-page-thumb"><img src="' + l + '" alt="" style="width:' + d + "px;height:" + c + 'px"><div class="sence-change-page-thumb-hover"></div></li>';
            i.find(".sence-change-page-thumb-wrap").append(p)
        }
    }
    function S(e, n, t) {
        var a = e._owner_design
          , s = {
            d: n
        };
        window.TEAM_ID > 0 && (s.tid = window.TEAM_ID),
        i.ajax({
            url: "/design/getDesignV3.do",
            type: "POST",
            dataType: "json",
            data: s,
            error: function() {
                alert("参数错误")
            },
            success: function(i) {
                (1 == i.loginTimeOut || "权限不足" == i.error) && alert("权限不足");
                var n = i.design_json;
                e._owner_design.postingDesign(n, {
                    i: t,
                    page: a.getCurPage()
                }),
                h.back({
                    str: "置入我的设计成功"
                })
            }
        })
    }
    function b(e, n) {
        var t = {
            d: DESIGN_ID,
            type: e
        };
        window.TEAM_ID > 0 && (t.tid = window.TEAM_ID),
        window.COOPERATE_DESIGN && (t.c = !0),
        t.resultType = i(".sure_download_phone").hasClass("no-click") ? 1 : 0,
        i.ajax({
            url: "/design/getMakeImageState.do",
            type: "POST",
            dataType: "json",
            data: t,
            error: function() {
                window.clearInterval(n._download_rate),
                P(),
                alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成遇到特殊问题。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
            },
            success: function(e) {
                H(e, n, t.type)
            }
        })
    }
    function C(e) {
        "none" == i(".list_word").css("display") ? i(".list_word").show() : i(".list_word").hide(),
        T(e)
    }
    function T(e) {
        for (var n = e._design_kind, t = n.length, a = 0; t > a; a++)
            for (var s = n[a].designKind, o = s.length, d = 0; o > d; d++) {
                var c = s[d]
                  , r = '<li class="word_li" data-id="' + c.kindId + '">' + c.kindTitle + "</li>";
                i(".list_word").append(r)
            }
    }
    function N(e, n) {
        i(".pic_list").attr("data-id");
        n.children(".reflush").hasClass("reflush_click") ? n.children(".reflush").removeClass("reflush_click") : n.children(".reflush").addClass("reflush_click"),
        K(e, !0)
    }
    function E(e, n) {
        var t = n.text();
        i(".sort_list").text(t),
        i(".sort_li.now-click").removeClass("now-click"),
        i(".sort_word").hide(),
        n.addClass("now-click"),
        K(e, !0),
        O()
    }
    function x() {
        i.ajax({
            url: "/design/queryUserFolders.do",
            dataType: "json",
            type: "POST",
            success: function(e) {
                null == e.folderList ? (Z = [],
                G()) : (Z = e.folderList,
                G())
            }
        })
    }
    function G() {
        if (i(".file_create").detach(),
        0 == Z.length)
            ;
        else
            for (var e = Z.length, n = 0; e > n; n++) {
                var t = Z[n]
                  , a = '<div class="file_create" data-id="' + t.folder_id + '"><span class="file_close"></span><span class="file_designer">' + t.folder_name + '</span><span class="write"></span><span class="delete_file"></span><span class="file_size">' + t.design_count + "</span></div>";
                i(".file_content_all").append(a)
            }
    }
    function M(e, n) {
        i(".file_creates .now-file").removeClass("now-file"),
        n.addClass("now-file");
        var t = n.children(".file_designer").text();
        n.parents(".file_content_all").siblings(".file_designer").text(t);
        var a = n.children(".file_size").text();
        n.parents(".file_content_all").siblings(".file_size").text(a),
        K(e, !0),
        O()
    }
    function O() {
        i(".accross_list_all").children().detach(),
        i("#page_list").removeAttr("data-page-no"),
        i("#page_list").children().detach()
    }
    function H(e, n, t) {
        var s = e;
        if (-1 == s.code)
            return window.clearInterval(n._download_rate),
            A(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”参数错误“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (-2 == s.code)
            return window.clearInterval(n._download_rate),
            A(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”权限不足“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (-3 == s.code)
            return window.clearInterval(n._download_rate),
            A(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”图片类型错误“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (-4 == s.code)
            return window.clearInterval(n._download_rate),
            A(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”登录超时“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (4 == s.state)
            return window.clearInterval(n._download_rate),
            A(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成时”超时“。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (5 == s.state || 6 == s.state)
            return window.clearInterval(n._download_rate),
            A(),
            void alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成遇到特殊问题。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。");
        if (3 == s.state) {
            window.clearInterval(n._download_rate);
            var o = s.url;
            if (i(".sure_download_phone").hasClass("no-click")) {
                i("#download-wait, .black-main").fadeOut(200);
                var d = a.getDownloadPhone()
                  , c = e.token;
                o = window.location.protocol + "//" + window.location.hostname + "/download?did=" + window.DESIGN_ID + "&type=" + t + "&token=" + c,
                d.find(".download-text").text("使用微信扫一扫，扫码下载"),
                d.find(".qrcode").empty().qrcode({
                    width: 166,
                    height: 166,
                    correctLevel: 0,
                    text: o
                }),
                n.popShow(d, {}),
                clearTimeout(window.PHONE_DOWNLOAD_DESIGN_CLOCK),
                window.PHONE_DOWNLOAD_DESIGN_CLOCK = setTimeout(function() {
                    d.find(".download-text").text("二维码已过期，请重新下载")
                }, 1e3 * e.exp)
            } else
                A(),
                i("#f").attr("src", o)
        } else if (1 == s.state || 2 == s.state) {
            var r = a.getDownloadWait();
            r.find(".download-wait-title").html("设计生成中...").next().show().text("请稍等1分钟左右")
        }
    }
    function A() {
        var e = a.getDownloadWait();
        e.animate({
            top: (i(window).getHeight() - e.getHeight()) / 2 - 20,
            opacity: 0
        }, {
            easing: "easeOutQuint",
            complete: function() {
                i(this).css("display", "none"),
                i(".black-main").css("display", "none")
            }
        })
    }
    function P() {
        var e = a.getThumbWait();
        e.animate({
            top: (i(window).getHeight() - e.getHeight()) / 2 - 20,
            opacity: 0
        }, {
            easing: "easeOutQuint",
            complete: function() {
                i(this).css("display", "none"),
                i(".black-main").css("display", "none")
            }
        })
    }
    function j() {
        var n = this
          , t = a.getDownload()
          , s = t.find(".download-pdf")
          , o = {
            name: "design_page_download_pdf",
            element: s[0],
            position_left: 83,
            position_top: 6,
            color: "#07AEFC"
        };
        h.pointOut(o),
        t.find(".closeBtn").click(function() {
            n.popHide(t)
        });
        var d = a.getDownloadPhone();
        d.find(".closeBtn").click(function() {
            n.popHide(d)
        }),
        t.find(".download-checkbox").mousedown(function() {
            var e = i(this);
            e.parent().find(".download-checkbox-click").removeClass("download-checkbox-click"),
            e.addClass("download-checkbox-click")
        }),
        t.find(".download-radio").mousedown(function() {
            var e = i(this);
            e.parent().find(".download-radio-click").removeClass("download-radio-click"),
            e.addClass("download-radio-click")
        }),
        t.find(".sure_download, .sure_download_phone").click(function() {
            i(".sure_download, .sure_download_phone").removeClass("no-click"),
            i(this).addClass("no-click");
            var s = {
                d: DESIGN_ID,
                type: 0
            };
            if ("block" == i(".download-img-content").css("display")) {
                var o = i(".quality").find(".download-checkbox-click").attr("data-quality")
                  , d = i(".type").find(".download-radio-click").attr("data-type");
                s.type = 5,
                1 == d && (s.jpg = 1),
                (window.ISVIP || window.TEAM_ID > 0) && (s.opa = 1);
                var c = i(".split").find(".download-radio-click").attr("data-split");
                s.join = c;
                var r = i(".choose_page").find(".download-radio-click").attr("data-page");
                if (2 == r) {
                    var l = i(".download-img-content").find(".select_box").val()
                      , p = n.testPageNum(l);
                    if ("false" == p)
                        return alert("非法字符，或者页码超过最大值"),
                        !1;
                    s.range = p
                }
            }
            if ("block" == i(".download-pdf-content").css("display")) {
                var o = i(".download-pdf").find(".download-checkbox-click").attr("data-quality")
                  , d = i(".type_pdf").find(".download-radio-click").attr("data-type");
                s.type = 3 == o ? 3 : 6;
                var r = i(".choose_pdf").find(".download-radio-click").attr("data-page");
                if (2 == r) {
                    var l = i(".download-pdf-content").find(".select_box").val()
                      , p = n.testPageNum(l);
                    if ("false" == p)
                        return alert("非法字符，或者页码超过最大值"),
                        !1;
                    s.range = p
                }
            }
            if ("block" == i(".download-ppt-content").css("display")) {
                var d = i(".type_ppt").find(".download-radio-click").attr("data-type");
                4 == d && (s.type = 4);
                var r = i(".choose_ppt").find(".download-radio-click").attr("data-page");
                if (2 == r) {
                    var l = i(".download-ppt-content").find(".select_box").val()
                      , p = n.testPageNum(l);
                    if ("false" == p)
                        return alert("非法字符，或者页码超过最大值"),
                        !1;
                    s.range = p
                }
            }
            var h = a.getDownloadWait();
            window.ISVIP ? h.find(".download-wait-title").html("尊敬的VIP用户，<br />您的设计将会优先生成。").next().hide() : h.find(".download-wait-title").html("设计生成排队中...").next().html("PS：加入VIP可以免去排队时间优先生成哦~"),
            n.downloadWaitShow(),
            1 == s.jpg ? 2 == s.type ? (e.addBugTrackClick("c1"),
            e.addSomeMouseClick("下载-jpg-标准"),
            1 == s.join ? e.addSomeMouseClick("下载-jpg-标准-无缝") : 2 == s.join) : 5 == s.type && (e.addBugTrackClick("c1"),
            e.addSomeMouseClick("下载-jpg-高清"),
            1 == s.join ? e.addSomeMouseClick("下载-jpg-高清-无缝") : 2 == s.join) : 2 == s.type ? (e.addBugTrackClick("c2"),
            e.addSomeMouseClick("下载-png-标准"),
            2 == s.join && e.addSomeMouseClick("下载-png-标准-有缝")) : 5 == s.type ? (e.addBugTrackClick("c2"),
            e.addSomeMouseClick("下载-png-高清"),
            2 == s.join && e.addSomeMouseClick(" 下载-png-高清-有缝")) : 3 == s.type ? (e.addBugTrackClick("c3"),
            e.addSomeMouseClick("下载-pdf-标准")) : 6 == s.type ? (e.addBugTrackClick("c4"),
            e.addSomeMouseClick("下载-pdf-印刷")) : 4 == s.type && (e.addBugTrackClick("c5"),
            e.addSomeMouseClick("下载-ppt")),
            window.TEAM_ID > 0 && (s.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (s.c = !0),
            i.ajax({
                url: "/design/addMakeImageTask.do",
                type: "POST",
                dataType: "json",
                data: s,
                success: function() {
                    n._download_rate = setInterval(function() {
                        b(s.type, n)
                    }, 3e3),
                    i(".download-design").removeClass("design-click"),
                    t.css("display", "none")
                }
            })
        }),
        t.find(".content-wrap-title").click(function() {
            var e = i(this);
            if (e.hasClass("content-wrap-title-click"))
                return !1;
            if (i(".content-wrap-title-click").removeClass("content-wrap-title-click"),
            e.addClass("content-wrap-title-click"),
            i(".download-content").css("display", "none"),
            e.hasClass("download-img"))
                i(".download_list").css("height", "340px"),
                t.find(".sure_download_phone").show();
            else if (e.hasClass("download-pdf")) {
                i(".download_list").css("height", "242px");
                var n = e.find(".point-out-circle");
                if (n.length > 0) {
                    var n = n[0];
                    h.pointOutHide(n)
                }
                t.find(".sure_download_phone").hide()
            } else
                i(".download_list").css("height", "152px"),
                t.find(".sure_download_phone").hide();
            e.children("ul").css("display", "block")
        });
        var c = a.getDownloadPhone();
        c.find(".return-btn").click(function() {
            i("#download_phone, .black-main").fadeOut(200),
            n.popShow(t, {})
        })
    }
    function z() {
        function e() {
            var n = {
                d: window.DESIGN_ID,
                type: 12
            };
            window.TEAM_ID > 0 && (n.tid = window.TEAM_ID),
            window.COOPERATE_DESIGN && (n.c = !0),
            i.ajax({
                url: "/design/getMakeImageState.do",
                type: "POST",
                dataType: "json",
                data: n,
                error: function() {
                    P(),
                    h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "error"
                    })
                },
                success: function(n) {
                    var t = n.state
                      , a = n.code;
                    if (1 == a)
                        if (3 == t)
                            i("#thumb-wait").fadeOut(),
                            c.popShow(s, {});
                        else {
                            if (t > 3)
                                return P(),
                                void h.back({
                                    str: "发布分享作品失败，请稍后重试！",
                                    kind: "error"
                                });
                            t >= 0 && setTimeout(function() {
                                e()
                            }, 3e3)
                        }
                    else
                        -4 == a ? (P(),
                        w.show()) : (P(),
                        h.back({
                            str: "发布分享作品失败，请稍后重试！",
                            kind: "error"
                        }))
                }
            })
        }
        function n(e) {
            i.ajax({
                url: "/activity/list.do",
                type: "POST",
                dataType: "json",
                data: {
                    pageNo: 1,
                    pageSize: 100
                },
                success: function(t) {
                    var a = t.code
                      , s = o.find(".active-list");
                    if (0 == a)
                        s.empty();
                    else if (1 == a) {
                        for (var d = t.page.recordData, c = 0; c < d.length; c++) {
                            for (var r = d[c].designKinds, l = !1, p = 0; p < r.length; p++)
                                r[p].kindId == window.KIND_ID && (l = !0);
                            var h = i('<li data-active="' + d[c].activityId + '">' + d[c].activityName + "</li>");
                            l || h.addClass("no-click"),
                            s.append(h)
                        }
                        e < t.page.pageTotal && n(e++)
                    }
                },
                error: function() {
                    h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "error"
                    })
                }
            })
        }
        var t = {
            shareHref: "",
            shareTitle: "创客贴活动",
            thumbnail: "http://eyuankupub.oss-cn-beijing.aliyuncs.com/sys/weixinorcode.png",
            thunbnailweibo: "",
            desc: "我参加了本次活动，快来给点赞！我和奖品就差个你了～",
            summary: "我参加了本次活动，快来给点赞！我和奖品就差个你了～",
            Qzonedesc: "",
            contentMate: "utf-8",
            QzoneShareHref: "",
            site: "创客贴www.chuangkit.com"
        }
          , s = a.getActive()
          , o = s.find(".publish")
          , d = s.find(".publish-success")
          , c = this;
        s.on("click", ".closeBtn", function() {
            c.popHide(s)
        }),
        d.on("click", ".social-icon", function() {
            t.shareHref = d.find(".link-input").val();
            var e = i(this);
            if (e.hasClass("weixin")) {
                var n = a.getActiveWeixinShare();
                n.find(".active-weixin-qrcode").empty().qrcode({
                    width: 160,
                    height: 160,
                    correctLevel: 0,
                    text: t.shareHref
                }),
                c.popHide(s),
                c.popShow(n, {})
            } else if (e.hasClass("qq")) {
                var o = "http://connect.qq.com/widget/shareqq/index.html?url=" + t.shareHref + "&title=" + t.shareTitle + "&site=" + t.site + "&summary=" + t.summary + "&pics=" + t.thumbnail + "&desc=" + t.Qzonedesc;
                window.open(o)
            } else if (e.hasClass("weibo")) {
                var o = "http://service.weibo.com/share/share.php?url=" + t.shareHref + "&content=" + t.contentMate + "&title=" + t.desc + "&pic=" + t.thumbnailweibo + "&appkey=3818167868";
                window.open(o)
            }
        }),
        o.on("keyup", ".name-input", function() {
            var e = i(this).val().length;
            i(this).next().text(e + "/20")
        }),
        o.on("click", ".selected-active", function() {
            o.find(".active-list").toggle(100)
        }),
        o.on("click", ".active-list li", function() {
            var e = i(this);
            return e.hasClass("no-click") ? !1 : void o.find(".selected-active-title").text(e.text()).attr("data-active", e.attr("data-active"))
        }),
        d.find(".link-input").mouseenter(function() {
            i(this).focus().select()
        });
        var r = d.find(".copy-btn")
          , l = new u(r[0]);
        l.on("success", function() {
            r.text("复制成功").css("color", "#27c383")
        }),
        l.on("error", function() {
            h.back({
                str: "复制失败，请手动复制链接到剪贴板。",
                kind: "warning"
            })
        }),
        o.on("click", ".join-now", function() {
            var n = o.find(".name-input").val()
              , t = o.find(".description-input").val()
              , a = o.find(".selected-active-title").attr("data-active");
            return n.length <= 0 ? (h.back({
                str: "请填写作品名称！",
                kind: "warning"
            }),
            !1) : t.length <= 0 ? (h.back({
                str: "请填写作品描述！",
                kind: "warning"
            }),
            !1) : a.length <= 0 ? (h.back({
                str: "请选择要参加的活动！",
                kind: "warning"
            }),
            !1) : void i.ajax({
                url: "/activity/publishWork.do",
                type: "POST",
                dataType: "json",
                data: {
                    workName: n,
                    workDesc: t,
                    designId: window.DESIGN_ID,
                    aid: a
                },
                success: function(i) {
                    var n = i.code;
                    1 == n ? (d.find(".link-input").val(window.location.origin + "/activecenter/share?workId=" + i.workId),
                    d.find(".open-link").attr("href", window.location.origin + "/activecenter/share?workId=" + i.workId),
                    d.find(".already-join").attr("href", "/activecenter/active?id=" + a + "&order=0&pageNo=1"),
                    o.hide().next().show(),
                    s.hide(),
                    c.waitPopShow(),
                    e()) : 3 == n ? w.show() : h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "warning"
                    })
                },
                error: function() {
                    h.back({
                        str: "发布分享作品失败，请稍后重试！",
                        kind: "error"
                    })
                }
            })
        }),
        n(1)
    }
    function L() {
        var n = a.getShareTitle()
          , t = this;
        n.find(".design_name").val(i("#design_title").children().val()),
        n.find(".publick_share_button, .private_share_button").click(function() {
            if (i(this).hasClass("not-share"))
                return !1;
            var a = i(this).attr("shareType");
            if (2 == a && (e.addSomeMouseClick("私密分享"),
            0 == window.ISVIP && window.TEAM_ID <= 0))
                return i(".get_vip_btn").click(function() {
                    e.addSomeMouseClick("私密分享-会员入口")
                }),
                n.find(".share_box").css("display", "none"),
                n.find(".private_share_failed").css({
                    display: "block"
                }).animate({
                    opacity: 1
                }, {
                    easing: "easeOutQuint"
                }),
                void i(".share").css({
                    top: "-=100px"
                });
            if (1 == a && e.addSomeMouseClick("公开分享"),
            "" == i(".design_name").val())
                i(".design_name").addClass("design_name_tips");
            else {
                var s = i(".design_name").val();
                i("#design_title").children().val(s);
                var o = t._owner_design;
                o.saveDesignTitle(s),
                i(".design_name").removeClass("design_name_tips");
                var d;
                i(".select_share").hasClass("select_share_click") ? (d = 1,
                e.addSomeMouseClick("分享-设计改动")) : d = 0;
                var c = "";
                t.waitPopShow();
                var r = {
                    d: DESIGN_ID,
                    ty: a,
                    a: d,
                    ti: s,
                    de: c
                };
                window.TEAM_ID > 0 && (r.tid = window.TEAM_ID),
                window.COOPERATE_DESIGN && (r.c = !0),
                i.ajax({
                    url: "/share/makeShareV3.do",
                    type: "POST",
                    dataType: "json",
                    data: r,
                    success: function(e) {
                        t._download_rate = setInterval(function() {
                            R(d, t, a)
                        }, 3e3),
                        2 == a && e.p && n.find(".password_zone").children("input").val(e.p),
                        n.css("display", "none")
                    }
                })
            }
        });
        var s = n.find("#copyLink")
          , o = new l(s);
        o.on("copy", function(i) {
            var t = n.find("#public_share_link").val();
            i.clipboardData.setData("text/plain", t),
            s.children("p").text("复制成功").css("color", "#27c383"),
            e.addSomeMouseClick("公开分享-复制链接")
        });
        var d = n.find(".password_copy_btn")
          , c = new l(d);
        c.on("copy", function(i) {
            var t = n.find("#private_share_link").val()
              , a = n.find("#private_share_password").val()
              , s = "链接: " + t + " 密码: " + a;
            i.clipboardData.setData("text/plain", s),
            n.find(".copy_link_success").show(),
            e.addSomeMouseClick("私密分享-复制链接密码")
        });
        var r = l.state();
        (1 == r.flash.disabled || null == r.flash.disabled) && (d.click(function() {
            alert("复制失败，请手动复制链接到剪贴板。")
        }),
        s.click(function() {
            alert("复制失败，请手动复制链接到剪贴板。")
        })),
        n.find("#public_share_link, #private_share_link").mouseenter(function() {
            i(this).focus().select()
        }),
        n.find(".share_button_question").mouseenter(function() {
            i(this).next().css("display", "block")
        }).mouseleave(function() {
            i(this).next().css("display", "none")
        }),
        n.find(".mail_send").click(function() {
            if ("" != i(this).prev().children("input").val() && /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(i(this).prev().children("input").val())) {
                e.addSomeMouseClick("分享-发送"),
                i(this).prev().children("input").removeClass("design_name_tips");
                var n = i(this).prev().children("input").val()
                  , a = (i(".link_address").children().val(),
                {
                    email: n,
                    designId: DESIGN_ID
                });
                window.TEAM_ID > 0 && (a.tid = window.TEAM_ID),
                window.COOPERATE_DESIGN && (a.c = !0),
                i.ajax({
                    url: "/design/shareDesignByEmail.do",
                    type: "POST",
                    dataType: "json",
                    data: a,
                    error: function() {},
                    success: function() {
                        alert("发送成功"),
                        t.popHide(i(".pop-wrap"))
                    }
                })
            } else
                i(this).prev().children("input").addClass("design_name_tips")
        }),
        n.find(".closeBtn").click(function() {
            t.popHide(n),
            n.find(".copy_link_success").hide(),
            s.children("p").text("复制链接").css("color", "#515151")
        }),
        n.find(".stop_share").click(function() {
            e.addSomeMouseClick("分享-停止分享");
            var n = {
                d: DESIGN_ID,
                ty: 0
            };
            window.TEAM_ID > 0 && (n.tid = window.TEAM_ID),
            i.ajax({
                url: "/share/makeShareV3.do",
                type: "POST",
                dataType: "json",
                data: n,
                error: function() {
                    window.clearInterval(t._download_rate),
                    P(),
                    alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")取消分享失败。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
                },
                success: function() {
                    i(".success_share_box").hide(),
                    i(".private_share_box").hide(),
                    i(".private_share_failed").hide(),
                    i(".share_box").show(),
                    i(".share").css({
                        top: "+=100px"
                    })
                }
            })
        }),
        n.find(".select_share").click(function() {
            i(this).hasClass("select_share_click") ? i(this).removeClass("select_share_click") : i(this).addClass("select_share_click")
        });
        a.getShare();
        n.find(".same_zone").click(function() {
            if (i(this).hasClass("not-share"))
                return !1;
            var n;
            return i(this).hasClass("zone_qq") ? (n = "Qzone",
            e.addSomeMouseClick("分享-qq空间")) : i(this).hasClass("zone_qqfriend") ? (n = "qq",
            e.addSomeMouseClick("分享-qq")) : i(this).hasClass("zone_weibo") ? (n = "weibo",
            e.addSomeMouseClick("分享-微博")) : i(this).hasClass("zone_renren") ? (n = "renren",
            e.addSomeMouseClick("分享-人人")) : (n = "weixin",
            e.addSomeMouseClick("分享-微信")),
            q(n, t),
            !1
        }),
        n.find(".public_share_edit").click(function() {
            i(this).hasClass("select_share_edit") ? Q(window.DESIGN_ID, 1, i(this)) : Q(window.DESIGN_ID, 3, i(this))
        }),
        n.find(".private_share_edit").click(function() {
            i(this).hasClass("select_share_edit") ? Q(window.DESIGN_ID, 2, i(this)) : Q(window.DESIGN_ID, 4, i(this))
        })
    }
    function Q(e, n, t) {
        i.ajax({
            url: "/share/updatePublishState.do",
            type: "POST",
            dataType: "json",
            data: {
                d: e,
                s: n
            },
            success: function(e) {
                1 == e.code ? 1 == n || 2 == n ? t.removeClass("select_share_edit") : t.addClass("select_share_edit") : -2 == e.code ? w.show() : h.back({
                    str: "更新分享状态错误！",
                    kind: "warning"
                })
            },
            error: function() {
                h.back({
                    str: "更新分享状态错误！",
                    kind: "warning"
                })
            }
        })
    }
    function q(e, n) {
        if ("weixin" == e) {
            n.popHide(i(".share"), !0);
            var t = a.getShareYes();
            t.appendTo("body").css({
                top: function() {
                    return "weixin" == e ? (i(window).getHeight() - 260) / 2 + 20 : (i(window).getHeight() - 110) / 2 + 20
                }(),
                left: (i(window).getWidth() - t.getWidth()) / 2,
                display: "block"
            }).animate({
                top: function() {
                    return "weixin" == e ? (i(window).getHeight() - 260) / 2 : (i(window).getHeight() - 110) / 2
                }(),
                opacity: 1
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    t.find(".share-yes-content").text("生成缩略图成功，请扫描下面二维码"),
                    t.css({
                        height: "260px"
                    }),
                    t.find(".share-yes-btn").css("display", "none"),
                    t.find(".share-yes-img").css("display", "block"),
                    t.find(".share-yes-img").children().detach(),
                    t.find(".share-yes-img").qrcode({
                        width: 160,
                        height: 160,
                        correctLevel: 0,
                        text: n.shareConfig.shareHref
                    })
                }
            })
        } else
            window.open(n.shareFun()[e])
    }
    function R(e, n, t) {
        var a = {
            d: DESIGN_ID,
            a: e
        };
        window.TEAM_ID > 0 && (a.tid = window.TEAM_ID),
        window.COOPERATE_DESIGN && (a.c = !0),
        i.ajax({
            url: "/share/getMakeShareImageStatus.do",
            type: "POST",
            dataType: "json",
            data: a,
            error: function() {
                window.clearInterval(n._download_rate),
                P(),
                alert("抱歉，系统检测到您的设计(id:" + DESIGN_ID + ")生成遇到特殊问题。请您联系创客贴服务QQ:2316289865，我们会第一时间帮助您解决遇到的问题。创客贴的成长期待您的帮助和反馈。")
            },
            success: function(e) {
                W(e, n, t)
            }
        })
    }
    function W(e, n, t) {
        if (3 == e.state) {
            window.clearInterval(n._download_rate);
            var s;
            s = void 0 == e.url ? e.imgurl : e.url,
            s = s + "?" + Date.parse(new Date),
            n.shareConfig.shareHref = "http://www.chuangkit.com/mod/share/share.html?d=" + DESIGN_ID,
            n.shareConfig.thumbnailweibo = "https:" + s + "||" + n.shareConfig.thumbnail,
            n.shareConfig.QzoneShareHref = "http://www.chuangkit.com/mod/share/share.html?d%3D" + DESIGN_ID;
            var o = i("#design_title").children("input").val();
            n.shareConfig.shareTitle = o;
            var d = a.getThumbWait();
            d.animate({
                top: (i(window).getHeight() - d.getHeight()) / 2 - 20,
                opacity: 0
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    i(this).css("display", "none")
                }
            }),
            1 == t || 3 == t ? F(n, t) : (2 == t || 4 == t) && B(n, t)
        }
    }
    function F(e, n) {
        var t = a.getShareTitle();
        t.find(".share_box").css("display", "none"),
        t.find(".success_share_box").css("display", "block"),
        e.popShow(t, {}),
        i(".design_title").children().val(i(".design_name").val()),
        i(".link_address").children().val("www.chuangkit.com/mod/share/share.html?d=" + DESIGN_ID),
        3 == n || 4 == n ? t.find(".public_share_edit").addClass("select_share_edit") : t.find(".public_share_edit").removeClass("select_share_edit")
    }
    function B(e, n) {
        var t = a.getShareTitle();
        t.find(".share_box").css("display", "none"),
        t.find(".private_share_box").css("display", "block"),
        e.popShow(t, {}),
        i(".design_title").children().val(i(".design_name").val()),
        i(".link_address").children().val("www.chuangkit.com/mod/share/share.html?d=" + DESIGN_ID),
        4 == n && t.find(".private_share_edit").addClass("select_share_edit")
    }
    function K(n, t) {
        null != n._myDesign_ajax && "pending" == n._myDesign_ajax.promise().state() && n._myDesign_ajax.abort();
        var s = a.getMydesign()
          , o = s.find(".file_content_all").find(".now-file").attr("data-id")
          , d = s.find(".list_word").find(".now-click").attr("data-id")
          , c = {
            page_drag: t,
            page_no: 1,
            page_size: 15,
            folder_id: o,
            kind_id: d
        };
        c.time_order = s.find(".reflush").hasClass("reflush_click") ? "创建日期" == s.find(".sort_list").text() ? 3 : 1 : "创建日期" == s.find(".sort_list").text() ? 0 : 2,
        window.TEAM_ID > 0 && (c.tid = window.TEAM_ID),
        n._myDesign_ajax = i.ajax({
            url: "/design/queryUserDesigns.do",
            dataType: "json",
            data: c,
            success: function(t) {
                if (c.page_drag) {
                    var a = t.totalCount
                      , s = Math.ceil(a / c.page_size);
                    if (0 >= s)
                        return void i(".accross_list_all").hide().next().show();
                    i(".accross_list_all").show().next().hide();
                    var o = !1;
                    V(s, function() {
                        c.page_no = i("#page_num_list").attr("data-page-no"),
                        i(".accross_list_all").children(".accross_list").detach(),
                        K(n, o)
                    })
                }
                i(".accross_list_all").children().remove();
                for (var d, r, l, p, h, _, w, u, g, f, v, m, I, k, D, y = t.list.length, S = [0, 0, 0], b = 0; y > b; b++)
                    d = t.list[b],
                    r = d.lastThumbTime,
                    l = d.imgUrl + "@230w.src?v=" + r,
                    p = parseInt(d.design_width),
                    h = parseInt(d.design_height),
                    _ = h / p * 240,
                    I = e.htmlUtil(d.designTitle, !0),
                    k = d.createTime,
                    D = d.designId,
                    "" == I && (I = "默认标题"),
                    w = e.arrMin(S).min,
                    g = e.arrMin(S).num,
                    f = w + 20,
                    S[g] = f + _ + 70,
                    v = 250 * g,
                    m = '<li class="accross_list" style="top:' + f + "px;left:" + v + 'px" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + _ + 'px"><div class="accross_list_hover" style="height:' + _ + 'px"></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>",
                    !window.ISVIP && window.TEAM_ID <= 0 && (m = '<li class="accross_list" style="top:' + f + "px;left:" + v + 'px" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + _ + 'px"><div class="accross_list_get_vip" style="height:' + _ + 'px"><span>此功能为VIP会员专享，<br><a href="/price?p=1" target="_blank">点此升级VIP会员</a>后方可使用</span></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>"),
                    d.designPageCount > 1 && (m = '<li class="accross_list multipage_show_li" style="top:' + f + "px;left:" + v + 'px" data-size="' + d.designPageCount + '" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + _ + 'px"><div class="accross_list_hover accross_list_hover_page" style="height:' + _ + 'px"></div><div class="multipage_show"></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>",
                    !window.ISVIP && window.TEAM_ID <= 0 && (m = '<li class="accross_list multipage_show_li" style="top:' + f + "px;left:" + v + 'px" data-size="' + d.designPageCount + '" data-id="' + D + '"><img class="accross_list_img" src="' + l + '" alt="" style="width:240px;height:' + _ + 'px"><div class="accross_list_get_vip" style="height:' + _ + 'px"><span>此功能为VIP会员专享，<br><a href="/price?p=1" target="_blank">点此升级VIP会员</a>后方可使用</span></div><div class="multipage_show"></div><span class="accross_list_text_wrap"><span class="accross_list_title">' + I + '</span><span class="accross_list_time">' + k + "</span></span></li>")),
                    i(".accross_list_all").append(m),
                    u = e.arrMax(S).max,
                    i(".accross_list_all").height(u)
            },
            error: function() {
                console.log("取得用户设计出错")
            }
        })
    }
    function V(e, n) {
        i("#page_num_list").children().remove(),
        i("#page_num_list").jPages({
            page_num: e,
            ajaxFunction: n
        })
    }
    var U = function(e) {
        var i = this;
        s.call(i),
        i._owner_design = e,
        e._owner_designEditbar = i,
        g.call(i)
    };
    return U.prototype = {
        constructor: U,
        _owner_design: null,
        _download_rate: null,
        _min_scale: null,
        _max_scale: null,
        _change_scale: null,
        _now_scale: null,
        _myDesign_ajax: null,
        _design_kind: null,
        createWidget: function() {
            return a.getDesignEditbar()
        },
        show: function() {
            var e = this._owner_design;
            document.body.appendChild(this.getNode()[0]),
            document.getElementById("designTitle").appendChild(this.getNode()[1]),
            e._wrap.appendChild(this.getNode()[2]),
            i("#printDesignBtn").attr("href", "/order?d=" + window.DESIGN_ID)
        },
        changeDesignScale: function(e) {
            var n = this._owner_design
              , t = e;
            e > this._max_scale ? t = this._max_scale : e < this._min_scale && (t = this._min_scale);
            var a = i(this.getNode()[2]);
            a.find(".design-scale-num").children().html(parseInt(100 * t) + "%"),
            n.setPageScale(t),
            i(".preview-page-all").css("transform", "scale(" + t + ")");
            var s = n.getCurPage()
              , o = s._owner_pageEditbar;
            o.setEditbarStyle();
            var d = s.getNode()
              , c = i(d).find(".page-bleed").hasClass("page-bleed-showing");
            if (c)
                for (var r = n.pages, l = 0; l < r.length; l++)
                    r[l].showBleedBorder()
        },
        shareConfig: {
            shareHref: "http://www.chuangkit.com/share/shareCallback.do?designId=",
            shareTitle: "戳我就变射鸡师",
            thumbnail: "http://eyuankupub.oss-cn-beijing.aliyuncs.com/sys/weixinorcode.png",
            thunbnailweibo: "",
            desc: "快来看我在@创客贴（www.chuangkit.com）设计的美图吧！这里有海量免费的素材和模板，只要会用鼠标托拉拽，就可以用几分钟的时间，免费在线设计出心仪的图片啦！什么海报、朋友圈封面、PPT、名片都能轻松搞定！学生党、微商、运营小编、社交达人们快来和我一起分享你的设计",
            summary: "快来看我在创客贴www.chuangkit.com设计的美图吧！这里有海量免费的素材和模板，只要托拉拽就可以免费在线设计出心仪的图片啦！",
            Qzonedesc: "这里有海量免费的素材和模板，只要会用鼠标托拉拽，就可以用几分钟的时间轻松搞定海报、朋友圈封面、PPT、名片！学生党、微商、运营小编、社交达人们快来和我一起分享你的设计和创意吧！创客贴——设计从未如此简单有趣。",
            contentMate: "utf-8",
            QzoneShareHref: "",
            site: "创客贴www.chuangkit.com"
        },
        shareFun: function() {
            return {
                weibo: "http://service.weibo.com/share/share.php?url=" + this.shareConfig.shareHref + "&content=" + this.shareConfig.contentMate + "&title=" + this.shareConfig.desc + "&pic=" + this.shareConfig.thumbnailweibo + "&appkey=3818167868",
                qq: "http://connect.qq.com/widget/shareqq/index.html?url=" + this.shareConfig.shareHref + "&title=" + this.shareConfig.shareTitle + "&site=" + this.shareConfig.site + "&summary=" + this.shareConfig.summary + "&pics=" + this.shareConfig.thumbnail + "&desc=" + this.shareConfig.Qzonedesc,
                Qzone: "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=" + this.shareConfig.QzoneShareHref + "&title=" + this.shareConfig.shareTitle + "&pics=" + this.shareConfig.thumbnailweibo + "&desc=" + this.shareConfig.Qzonedesc + "&summary=" + this.shareConfig.summary,
                renren: "http://widget.renren.com/dialog/share?srcUrl=" + this.shareConfig.shareHref + "&resourceUrl=" + this.shareConfig.shareHref + "&title=" + this.shareConfig.shareTitle + "&description=" + this.shareConfig.summary + "&pic=" + this.shareConfig.thumbnail + "&message=" + this.shareConfig.Qzonedesc
            }
        },
        confirmTrue: e.noop(),
        popConfirm: function(e, n) {
            var t = a.getConfirm();
            t.find(".confirm-string").html(e);
            var s = "body";
            t.appendTo(s);
            var o = i("body").getWidth()
              , d = i("body").getHeight()
              , c = t.getWidth()
              , r = t.getHeight()
              , l = (o - c) / 2
              , p = (d - r) / 2;
            t.css({
                display: "block",
                left: l,
                top: p,
                opacity: "1"
            }),
            i(".pop-wrap").css({
                "z-index": "10000"
            }),
            this.confirmTrue = n
        },
        popShow: function(e, n) {
            var t = i("body").getWidth()
              , a = i("body").getHeight()
              , s = "body";
            void 0 != n.pop_wrap && (s = n.pop_wrap),
            e.appendTo(s);
            var o = e.getWidth()
              , d = e.getHeight()
              , c = (t - o) / 2
              , r = (a - d) / 2;
            void 0 != n.change_top && (r += parseFloat(n.change_top)),
            void 0 != n.top && (r = n.top),
            void 0 != n.left && (c = n.left);
            var l = 80;
            void 0 != n.initial_top && (l = n.initial_top),
            e.css({
                display: "block",
                left: c,
                top: r - l,
                "z-index": "20000"
            }),
            this.blackShow(),
            e.animate({
                top: r,
                opacity: 1
            }, {
                easing: "easeOutQuint"
            })
        },
        popHide: function(e, n) {
            i(".share-design").removeClass("design-click"),
            i(".download-design").removeClass("design-click"),
            i(".design_file").css("z-index", "10004"),
            e.stop(),
            n || i(".black-main").animate({
                opacity: 0
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    i(this).detach()
                }
            }),
            e.animate({
                top: "80px",
                opacity: 0
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    e.css("display", "none")
                }
            })
        },
        waitPopShow: function() {
            var e = a.getThumbWait();
            e.find(".thumb-text").text("正在生成，请耐心等待1分钟左右..."),
            e.appendTo("body");
            var n = e.getWidth()
              , t = e.getHeight()
              , s = i("body").getWidth()
              , o = i("body").getHeight()
              , d = (s - n) / 2
              , c = (o - t) / 2;
            e.css({
                top: c + 20,
                left: d,
                display: "block",
                opacity: 0
            }).animate({
                top: c,
                opacity: 1
            })
        },
        downloadWaitShow: function() {
            var e = a.getDownloadWait();
            e.appendTo("body");
            var n = e.getWidth()
              , t = e.getHeight()
              , s = i("body").getWidth()
              , o = i("body").getHeight()
              , d = (s - n) / 2
              , c = (o - t) / 2;
            e.css({
                top: c + 20,
                left: d,
                display: "block",
                opacity: 0
            }).animate({
                top: c,
                opacity: .8
            })
        },
        blackShow: function() {
            var e = this
              , n = i('<div class="black-main"></div>');
            n.css({
                width: i("body").getWidth(),
                height: i("body").getHeight(),
                top: 0,
                left: 0
            }).appendTo("body").animate({
                opacity: 1
            }, {
                easing: "easeOutQuint",
                complete: function() {
                    i(this).click(function() {
                        return "block" == i("#thumb-wait").css("display") || "block" == i(".confirm-container").css("display") || "block" == i("#download-wait").css("display") ? !1 : void e.popHide(i(".pop-wrap"))
                    })
                }
            })
        },
        testPageNum: function(e) {
            for (var i = this._owner_design, n = i.getPageSum(), e = e.replace(/\s+/g, ","), t = e.split(","), a = 0; a < t.length; a++)
                if (/^\d+\-\d+$/.test(t[a])) {
                    for (var s = t[a].split("-"), o = 0; o < s.length; o++)
                        if (isNaN(s[o]) || parseFloat(s[o]) > n)
                            return "false"
                } else if (isNaN(t[a]) || parseFloat(t[a]) > n)
                    return "false";
            return e
        }
    },
    e.classExtend(U, s),
    U;
    var Z
});
;/*!/compapi/design/toolbar/scrollbar.js*/
!function(n) {
    "function" == typeof define && define.amd ? define("compapi/design/toolbar/scrollbar", [], n) : n()
}(function() {
    function n() {}
    n.prototype = {}
});
;/*!/compapi/design/toolbar/ShowBorder.js*/
define("compapi/design/toolbar/ShowBorder", ["components/jquery/jquery", "compapi/design/Chuangkit", "compapi/design/toolbar/toolbar_config", "compapi/design/Toolbar", "libs/jquery/jquery.transit.min"], function(e, t, i, o) {
    function s() {}
    var l = function(e, t) {
        o.call(this, t),
        s.call(this),
        this._owner_design = e
    };
    return l.prototype = {
        constructor: l,
        options: {},
        _owner_design: null,
        eleMsg: {
            eleP: {
                x: "",
                y: ""
            },
            eleS: {
                w: "",
                h: ""
            },
            eleR: ""
        },
        eleToAdd: '<div class="parentDiv"><div class="h" id="left"></div><div class="w" id="top"></div><div class="h" id="right"></div><div class="w" id="bottom"></div></div>',
        createWidget: function() {
            return i.getEditDiv()
        },
        getEleMessage: function(e) {
            return this.eleMsg.eleR = e.css("rotate"),
            this.eleMsg.eleS.w = e.width(),
            this.eleMsg.eleS.h = e.height(),
            this.eleMsg.eleP.y = e.offset().top,
            this.eleMsg.eleP.x = e.offset().left,
            this.eleMsg
        },
        setEleStyle: function(t) {
            var i = this.getEleMessage(t)
              , o = i.eleS.w
              , s = i.eleS.h
              , l = i.eleP.x
              , n = i.eleP.y
              , r = i.eleR;
            e(".parentDiv").css({
                width: o,
                height: s,
                rotate: r,
                position: "relative"
            }).offset({
                top: n,
                left: l
            }),
            e(".h").css({
                height: s,
                "background-color": "#646464",
                position: "absolute",
                width: "1px"
            }),
            e(".w").css({
                width: o,
                "background-color": "#646464",
                position: "absolute",
                height: "1px"
            }),
            e("#left").css({
                top: 0,
                left: 0
            }),
            e("#top").css({
                top: 0,
                left: 0
            }),
            e("#right").css({
                right: 0,
                top: 0
            }),
            e("#bottom").css({
                bottom: 0,
                left: 0
            })
        },
        addEleToPage: function(t) {
            e(".element_wrap").prepend(this.eleToAdd),
            this.setEleStyle(t)
        },
        removeShowBorder: function() {
            e(".parentDiv").remove()
        }
    },
    t.extend(l, o),
    l
});
;/*!/compapi/design/widgets/ChartKind.js*/
define("compapi/design/widgets/ChartKind", ["require", "components/jquery/jquery"], function() {
    var t = function(t) {
        this._owner_design = t
    };
    return t.prototype = {
        constructor: t,
        _owner_design: null,
        _titleSize: 0,
        _moreSize: 0,
        createSvg: function(t) {
            var e = t.width
              , r = t.height
              , i = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            return i.setAttribute("x", "0px"),
            i.setAttribute("y", "0px"),
            i.setAttribute("version", "1.1"),
            i.setAttribute("xmlns", "http://www.w3.org/2000/svg"),
            i.setAttribute("xmlns:xlink", "http://www.w3.org/1999/xlink"),
            i.setAttribute("viewBox", "0 0 " + e + " " + r),
            i.setAttribute("xml:space", "preserve"),
            i
        },
        createTitle: function(t) {
            if (null == t.chartTitle)
                return null;
            var e = t.width
              , r = t.height
              , i = document.createElementNS("http://www.w3.org/2000/svg", "text");
            i.setAttribute("text-anchor", "middle");
            var n, s;
            s = "top" == t.chartTitlePosition ? 22 : r - 5,
            n = e / 2,
            i.setAttribute("x", n),
            i.setAttribute("y", s),
            i.setAttribute("fill", "#808284"),
            i.setAttribute("font-size", this._titleSize),
            i.setAttribute("class", "svgChartTitle"),
            i.setAttribute("style", "display:none");
            var o = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
            return o.innerHTML = t.chartTitle,
            i.appendChild(o),
            i
        },
        createXAxis: function() {
            var t = document.createElementNS("http://www.w3.org/2000/svg", "path");
            return t.setAttribute("fill", "none"),
            t.setAttribute("stroke", "#000000"),
            t.setAttribute("d", "M60,400.5L460,400.5"),
            t.setAttribute("class", "svgXAxis"),
            t
        },
        createYAxisGrid: function() {},
        legendShow: function(t) {
            var e, r, i = t.legend, n = t.legend_width, s = t.chartColors, o = t.width, a = t.height, l = i.length;
            r = "bottom" == t.chartTitlePosition ? a - 60 : a - 10;
            for (var u, h = 0, c = document.createElementNS("http://www.w3.org/2000/svg", "g"), g = 0; l > g; g++)
                for (e = (o - n[g]) / 2 + 10; h < i[g] + 1; h++) {
                    var w = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    w.setAttribute("y", r - 20 * (l - g)),
                    $test_text.html(data[h + 1][0]);
                    var p = $("#test_text").getWidth() * this_scale;
                    u = 1 == s.length ? s[0] : s[h],
                    w.setAttribute("x", e),
                    w.setAttribute("width", legend_color_block),
                    w.setAttribute("height", legend_color_block),
                    w.setAttribute("fill", u),
                    w.setAttribute("class", "legendColor"),
                    c.appendChild(w);
                    var d = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    d.setAttribute("text-anchor", "start"),
                    d.setAttribute("x", e + legend_color_block + color_space),
                    d.setAttribute("y", r - 20 * (l - g) + 12),
                    d.setAttribute("fill", "#808284"),
                    d.setAttribute("font-size", "14px"),
                    d.setAttribute("class", "legendText");
                    var m = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                    m.innerHTML = data[h + 1][0],
                    d.appendChild(m),
                    c.appendChild(d),
                    e = e + legend_color_block + p + legend_space + color_space
                }
        },
        getWrapHeight: function(t, e) {
            var r = t.height / e
              , i = r - 10
              , n = r - 70;
            i = "top" == t.chartTitlePosition ? r - 10 : r - 60,
            null == t.chartTitle && (i = r = 10,
            n = r - 20),
            i -= t.legend_height,
            n -= t.legend_height
        },
        getMaxNum: function(t) {
            for (var e = t.data, r = 0, i = e.length, n = 0, s = 1; i > s && (null != e[s][1] && "" != e[s][1]); s++)
                n++,
                r = Math.max(r, parseFloat(e[s][1]));
            if (10 >= r)
                return {
                    max_num: r,
                    space_num: 1,
                    rlength: n
                };
            var o, a = r.toString(), l = a.length, u = a[0], h = a[0];
            if (5 > u && 9 >= h) {
                var c = 5 * parseInt((u + h) / 5) * Math.pow(10, l - 2);
                r > c && (c = (5 * parseInt((u + h) / 5) + 5) * Math.pow(10, l - 2)),
                o = {
                    max_num: c,
                    space_num: 5 * Math.pow(10, l - 2)
                }
            } else {
                var c = parseInt(u) * Math.pow(10, l - 1);
                r > c && (c = (parseInt(u) + 1) * Math.pow(10, l - 1)),
                o = {
                    max_num: c,
                    space_num: Math.pow(10, l - 1)
                }
            }
            return o.rlength = n,
            o
        },
        getFontSize: function(t) {
            this._titleSize = .02 * t,
            this._moreSize = .01 * t
        }
    },
    t
});
